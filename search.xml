<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ã€‹å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2021%2F12%2F21%2Farchitecture%2Farchitecture_one%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹è¶å‘¨æœ«æ—¶é—´è†œæ‹œäº†å¤§ä½¬å†™çš„ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ã€‹ä¸€ä¹¦ï¼Œä¹Ÿæ˜¯å¯¹ç³»ç»Ÿæ¶æ„æœ‰äº†ä¸€äº›å…¥é—¨çº§çš„äº†è§£ã€‚çœ‹äº†å‰é¢ä¸‰ç« ï¼Œæ„Ÿè§‰é€šç†Ÿæ˜“æ‡‚ï¼Œå—ç›ŠåŒªæµ…ï¼Œæƒ³ä»¥ç¬”è®°çš„æ–¹å¼è®°å½•ä¸€ä¸‹ã€‚ å¤§å‹ç½‘ç«™æ¶æ„çš„æ¼”åŒ–å‘å±•å†ç¨‹åˆå§‹é˜¶æ®µçš„ç½‘ç«™æ¶æ„åº”ç”¨ç¨‹åºã€æ–‡ä»¶ã€æ•°æ®åº“ LAMP=linux+apache+mysql+php å­˜åœ¨çš„é—®é¢˜ è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·è®¿é—®å¯¼è‡´æ€§èƒ½è¶Šæ¥è¶Šå·®ï¼Œè¶Šæ¥è¶Šå¤šçš„æ•°æ®å¯¼è‡´å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚ åº”ç”¨æœåŠ¡å’Œæ•°æ®æœåŠ¡åˆ†ç¦»ç‰¹ç‚¹ åº”ç”¨å’Œæ•°æ®åˆ†ç¦»åï¼Œä¸é€šç‰¹å¾çš„æœåŠ¡å™¨æ‰¿æ‹…ä¸é€šçš„æœåŠ¡è§’è‰²ï¼Œç½‘ç«™çš„å¹¶å‘å¤„ç†èƒ½åŠ›å’Œæ•°æ®å­˜å‚¨ç©ºé—´å¾—åˆ°å¾ˆå¤§æ”¹å–„ å­˜åœ¨çš„é—®é¢˜ éšç€ç”¨æˆ·é€æ¸å¢å¤šï¼Œæ•°æ®åº“å‹åŠ›å¤ªå¤§å¯¼è‡´è®¿é—®å»¶è¿Ÿ ä½¿ç”¨ç¼“å­˜æ”¹å–„ç½‘ç«™æ€§èƒ½ç‰¹ç‚¹ æ·˜å®ä¹°å®¶æµè§ˆçš„å•†å“é›†ä¸­åœ¨å°‘éƒ¨åˆ†æˆäº¤æ•°å¤šã€è¯„ä»·è‰¯å¥½çš„å•†å“ä¸Šï¼›ç™¾åº¦æœç´¢å…³é”®è¯é›†ä¸­åœ¨å°‘éƒ¨åˆ†çƒ­é—¨è¯æ±‡ä¸Šï¼›åªæœ‰ç»å¸¸ç™»é™†çš„ç”¨æˆ·æ‰ä¼šå‘å¾®åšã€åˆ·å¾®åšã€‚å°±åƒäºŒå…«å®šå¾‹ï¼Œ80%çš„ä¸šåŠ¡è®¿é—®é›†ä¸­åœ¨20%çš„æ•°æ®ä¸Šï¼Œæ—¢ç„¶å¤§éƒ¨åˆ†ä¸šåŠ¡è®¿é—®é›†ä¸­åœ¨ä¸€å°éƒ¨åˆ†æ•°æ®ä¸Šï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸€å°éƒ¨åˆ†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå°±å¯ä»¥è§ä¸Šæ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚ åº”ç”¨æœ¬åœ°ç¼“å­˜ æœ¬åœ°ç¼“å­˜è®¿é—®çš„é€Ÿåº¦æ›´å¿«ä¸€äº›ï¼Œä½†æ˜¯å—åº”ç”¨æœåŠ¡å™¨å†…å­˜çš„å½±å“ï¼Œå…¶ç¼“å­˜æ•°æ®é‡æœ‰é™ï¼Œè€Œä¸”ä¼šå’Œåº”ç”¨ç¨‹åºäº‰ç”¨å†…å­˜çš„æƒ…å†µã€‚ åˆ†å¸ƒå¼ç¼“å­˜ è¿œç¨‹åˆ†å¸ƒå¼ç¼“å­˜å¯ä»¥ä½¿ç”¨é›†ç¾¤çš„æ–¹å¼ï¼Œéƒ¨ç½²å¤§å†…å­˜çš„æœåŠ¡å™¨ä½œä¸ºä¸“é—¨çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨ç†è®ºä¸Šåšåˆ°ä¸å—å†…å­˜å®¹å™¨é™åˆ¶çš„ç¼“å­˜æœåŠ¡ã€‚ å­˜åœ¨çš„é—®é¢˜ ä½†æ˜¯å•ä¸€åº”ç”¨æœåŠ¡å™¨èƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚è¿æ¥æœ‰é™ï¼Œåœ¨ç½‘ç«™è®¿é—®é«˜å³°æœŸï¼Œåº”ç”¨æœåŠ¡å™¨æˆä¸ºæ•´ä¸ªç½‘ç«™çš„ç“¶é¢ˆã€‚ ä½¿ç”¨åº”ç”¨æœåŠ¡å™¨é›†ç¾¤æ”¹å–„ç½‘ç«™çš„å¹¶å‘å¤„ç†èƒ½åŠ›ç‰¹ç‚¹ ä½¿ç”¨é›†ç¾¤æ˜¯ç½‘ç«™è§£å†³é«˜å¹¶å‘ã€æµ·é‡æ•°æ®é—®é¢˜çš„å¸¸ç”¨æ‰‹æ®µã€‚å½“ä¸€å°æœåŠ¡å™¨å¤„ç†èƒ½åŠ›ã€å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶ï¼Œä¸è¦ä¼å›¾å»æ›´æ¢æ›´å¼ºå¤§çš„æœåŠ¡å™¨ï¼Œå¯¹å¤§å‹ç½‘ç«™è€Œè¨€ï¼Œä¸ç®¡å¤šä¹ˆå¼ºå¤§çš„æœåŠ¡å™¨ï¼Œéƒ½æ»¡è¶³ä¸äº†ç½‘ç«™æŒç»­å¢é•¿çš„ä¸šåŠ¡éœ€æ±‚ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ›´æ°å½“çš„åšæ³•æ˜¯å¢åŠ ä¸€å°æœåŠ¡å™¨åˆ†æ‹…åŸæœ‰æœåŠ¡å™¨çš„è®¿é—®åŠå­˜å‚¨å‹åŠ›ã€‚ï¼ˆåŒæ—¶é‡‡ç”¨é›†ç¾¤éƒ¨ç½²çš„æ–¹å¼æå‡ç³»ç»Ÿçš„ä¼¸ç¼©æ€§ï¼‰ ä¾èµ–é¡¹ éœ€è¦å¼•å…¥è´Ÿè½½å‡è¡¡è°ƒåº¦æœåŠ¡å™¨ï¼Œå°†æ¥è‡ªç”¨æˆ·æµè§ˆå™¨çš„è®¿é—®è¯·æ±‚åˆ†å‘åˆ°åº”ç”¨æœåŠ¡å™¨é›†ç¾¤ä¸­çš„ä»»ä½•ä¸€å°æœåŠ¡å™¨ä¸Šã€‚ ä»å­˜åœ¨çš„é—®é¢˜ ç¼“å­˜çš„ä½¿ç”¨ï¼Œä½¿ç»å¤§éƒ¨åˆ†æ•°æ®è¯»æ“ä½œè®¿é—®å¯ä»¥ä¸ç”¨é€šè¿‡æ•°æ®åº“å®Œæˆï¼Œä½†ä»æœ‰ä¸€éƒ¨åˆ†è¯»æ“ä½œï¼ˆç¼“å­˜è®¿é—®ä¸å‘½ä¸­ï¼Œç¼“å­˜è¿‡æœŸï¼‰å’Œå…¨éƒ¨çš„å†™æ“ä½œéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œåœ¨ç½‘ç«™çš„ç”¨æˆ·è¾¾åˆ°ä¸€å®šçš„è§„æ¨¡åï¼Œæ•°æ®åº“å› ä¸ºè´Ÿè½½å‹åŠ›è¿‡é«˜è€Œæˆä¸ºç½‘ç«™çš„ç“¶é¢ˆã€‚ æ•°æ®åº“è¯»å†™åˆ†ç¦»ç‰¹ç‚¹ ç›®å‰å¤§éƒ¨åˆ†ä¸»æµæ•°æ®åº“éƒ½æä¾›ä¸»ä»çƒ­å¤‡åŠŸèƒ½ï¼Œé€šè¿‡é…ç½®ä¸¤å°æ•°æ®åº“ä¸»ä»å…³ç³»ï¼Œå¯ä»¥å°†ä¸€å°æ•°æ®åº“æœåŠ¡å™¨çš„æ•°æ®æ›´æ–°åˆ°å¦ä¸€å°æœåŠ¡å™¨ä¸Šã€‚ç½‘ç«™åˆ©ç”¨æ•°æ®åº“çš„è¿™ä¸€åŠŸèƒ½ï¼Œå®ç°æ•°æ®è¯»å†™åˆ†ç¦»ï¼Œä»è€Œæ”¹å–„æ•°æ®åº“è´Ÿè½½å‹åŠ›ã€‚ ä¾èµ–é¡¹ ä¸ºäº†ä¾¿äºåº”ç”¨ç¨‹åºè®¿é—®è¯»å†™åˆ†ç¦»åçš„æ•°æ®åº“ï¼Œé€šå¸¸åœ¨åº”ç”¨æœåŠ¡å™¨ä½¿ç”¨ä¸“é—¨çš„æ•°æ®è®¿é—®æ¨¡å—ï¼Œä½¿æ•°æ®åº“è¯»å†™åˆ†ç¦»å¯¹åº”ç”¨é€æ˜ï¼ˆè¯»å†™åˆ†ç¦»ï¼Œä¸€èˆ¬éœ€è¦ä¸­é—´ä»¶æˆ–è€…AOPï¼Œå¯¹æ€§èƒ½æœ‰ä¸€å®šçš„æŸè€—ï¼‰ ä½¿ç”¨åå‘ä»£ç†å’ŒCDNåŠ é€Ÿç½‘ç«™å“åº”ç‰¹ç‚¹ CDNå’Œåå‘ä»£ç†çš„åŸºæœ¬åŸç†éƒ½æ˜¯ç¼“å­˜ï¼ŒåŒºåˆ«åœ¨äºCDNéƒ¨ç½²åœ¨ç½‘ç»œæä¾›å•†çš„æœºæˆ¿ï¼Œä½¿ç”¨æˆ·åœ¨è¯·æ±‚ç½‘ç«™æœåŠ¡æ—¶ï¼Œå¯ä»¥ä»è·ç¦»è‡ªå·±æœ€è¿‘çš„ç½‘ç»œæä¾›å•†æœºæˆ¿è·å–æ•°æ®ï¼›è€Œåå‘ä»£ç†åˆ™éƒ¨ç½²åœ¨ç½‘ç«™çš„ä¸­å¿ƒæœºæˆ¿ï¼Œå½“ç”¨æˆ·è¯·æ±‚åˆ°è¾¾ä¸­å¿ƒæœºæˆ¿åï¼Œé¦–å…ˆè®¿é—®çš„æ˜¯åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¦‚æœåå‘ä»£ç†æœåŠ¡å™¨ä¸­ç¼“å­˜ç€ç”¨æˆ·çš„è¯·æ±‚èµ„æºï¼Œå°±å°†èµ„æºç›´æ¥è¿”å›ç»™ç”¨æˆ·ã€‚ ä½œç”¨ ä½¿ç”¨CDNå’Œåå‘ä»£ç†çš„ç›®çš„éƒ½æ˜¯å°½æ—©è¿”å›æ•°æ®ç»™ç”¨æˆ·ï¼Œä¸€æ–¹é¢åŠ å¿«ç”¨æˆ·è®¿é—®é€Ÿåº¦ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå‡è½»åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›ã€‚ ä½¿ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿå’Œåˆ†å¸ƒå¼æ•°æ®åº“ç‰¹ç‚¹ åˆ†å¸ƒå¼æ•°æ®åº“æ˜¯ç½‘ç«™æ•°æ®åº“æ‹†åˆ†çš„æœ€åæ‰‹æ®µï¼Œåªæœ‰åœ¨å•è¡¨æ•°æ®è§„æ¨¡éå¸¸åºå¤§çš„æ—¶å€™æ‰ä½¿ç”¨ã€‚ä¸åˆ°ä¸å¾—å·²æ—¶ï¼Œç½‘ç«™æ›´å¸¸ç”¨çš„æ•°æ®åº“æ‹†åˆ†æ‰‹æ®µæ˜¯ä¸šåŠ¡åˆ†åº“ï¼Œå°†ä¸åŒä¸šåŠ¡çš„æ•°æ®åº“éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚ ä½¿ç”¨NoSQLå’Œæœç´¢å¼•æ“ç‰¹ç‚¹ NoSQLå’Œæœç´¢å¼•æ“éƒ½æ˜¯æºè‡ªäº’è”ç½‘æŠ€æœ¯æ‰‹æ®µï¼Œå¯¹å¯ä¼¸ç¼©çš„åˆ†å¸ƒå¼ç‰¹æ€§å…·æœ‰è‰¯å¥½çš„æ”¯æŒã€‚å¯¹åº”ç”¨æœåŠ¡å™¨åœ¨é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¨¡å—è®¿é—®å„ç§æ•°æ®ï¼Œå‡è½»åº”ç”¨ç¨‹åºç®¡ç†è¯¸å¤šæ•°æ®çš„éº»çƒ¦ã€‚ ä¸šåŠ¡æ‹†åˆ†ç‰¹ç‚¹ æ ¹æ®ä¸šåŠ¡å¯¹åº”ç”¨æœåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œåˆ†ä¸åŒçš„äº§å“çº¿ï¼Œäº¤ç”±ä¸åŒçš„ä¸šåŠ¡å›¢é˜Ÿå’ŒæŠ€æœ¯å›¢é˜Ÿè´Ÿè´£ã€‚ ä¾èµ–é¡¹ æœåŠ¡æ³¨å†Œä¸­å¿ƒæˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿›è¡Œåº”ç”¨æœåŠ¡é—´çš„ä¸šåŠ¡é€šä¿¡ åˆ†å¸ƒå¼æœåŠ¡ç‰¹ç‚¹ å°†ä¸åŒæ¨¡å—çš„å…¬å…±ä¸šåŠ¡æå–å‡ºæ¥ï¼Œä½œä¸ºå…¬å…±ä¸šåŠ¡æœåŠ¡ï¼Œç‹¬ç«‹éƒ¨ç½²ã€‚æ¯”å¦‚è¿æ¥æ•°æ®åº“ï¼Œåº”ç”¨ç¼“å­˜ç­‰æ“ä½œéƒ½ç»´æŠ¤åœ¨è¿™ä¸ªæœåŠ¡ä¸­ï¼Œç„¶åä»¥é›†ç¾¤å¤šå®ä¾‹çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²ã€‚ æ¼”åŒ–ä»·å€¼è§‚ ç½‘ç«™çš„ä»·å€¼åœ¨äºå®ƒèƒ½ç»™ç”¨æˆ·æä¾›ä»€ä¹ˆä»·å€¼ï¼Œåœ¨äºç½‘ç«™èƒ½åšä»€ä¹ˆï¼Œè€Œä¸åœ¨äºå®ƒæ˜¯æ€ä¹ˆåšçš„ã€‚ å¤§å‹ç½‘ç«™éƒ½æ˜¯ä»å°å‹ç½‘ç«™å‘å±•è€Œæ¥ï¼Œå°å‹ç½‘ç«™è¦åšçš„å°±æ˜¯ä¸ºç”¨æˆ·æä¾›å¥½çš„æœåŠ¡æ¥åˆ›é€ ä»·å€¼ï¼Œå¾—åˆ°ç”¨æˆ·çš„è®¤å¯ï¼Œé‡è›®ç”Ÿé•¿ã€‚ é©±åŠ¨å¤§å‹ç½‘ç«™æŠ€æœ¯å‘å±•çš„ä¸»è¦åŠ›é‡æ˜¯ç½‘ç«™çš„ä¸šåŠ¡å‘å±•ã€‚æ˜¯ä¸šåŠ¡æˆå°±äº†æŠ€æœ¯ï¼Œæ˜¯äº‹ä¸šæˆå°±äº†äººï¼Œè€Œä¸æ˜¯ç›¸åã€‚ æ‰€ä»¥ç½‘ç«™æ¶æ„å¸ˆåº”è¯¥å¯¹æˆå°±è‡ªå·±æŠ€æœ¯æˆç»©çš„ç½‘ç«™äº‹ä¸šå¿ƒå­˜æ„Ÿæ¿€ï¼Œå¹¶åŠªåŠ›æé«˜æŠ€æœ¯åé¦ˆä¸šåŠ¡ã€‚ ç½‘ç«™æ¶æ„è®¾è®¡è¯¯åŒº ä¸€å‘³è¿½éšå¤§å…¬å¸çš„è§£å†³æ–¹æ¡ˆ ä¸ºäº†æŠ€æœ¯è€ŒæŠ€æœ¯ ä¼å›¾ç”¨æŠ€æœ¯è§£å†³æ‰€æœ‰çš„é—®é¢˜ 12306çœŸæ­£çš„é—®é¢˜å…¶å®ä¸åœ¨äºå®ƒçš„æŠ€æœ¯æ¶æ„ï¼Œè€Œåœ¨äºå®ƒçš„ä¸šåŠ¡æ¶æ„ï¼ˆæ¯”å¦‚æ•´ç‚¹å”®ç¥¨ï¼‰ æŠ€æœ¯æ˜¯ç”¨æ¥è§£å†³ä¸šåŠ¡é—®é¢˜çš„ï¼Œè€Œä¸šåŠ¡çš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸šåŠ¡çš„æ‰‹æ®µå»è§£å†³ã€‚ å¤§å‹ç½‘ç«™çš„æ¶æ„æ¨¡å¼åˆ†å±‚ï¼ˆæ¨ªå‘åˆ†ï¼Œæ¯”å¦‚åº”ç”¨å±‚ã€æœåŠ¡å±‚ã€æ•°æ®å±‚ï¼‰ åˆ†å‰²ï¼ˆçºµå‘åˆ†ï¼ŒæŒ‰ä¸šåŠ¡åŠŸèƒ½è¿›è¡Œåˆ†ï¼‰ åˆ†å¸ƒå¼ï¼šåˆ†å¸ƒå¼äº‹åŠ¡å¸¦æ¥æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œå¯ç”¨æ€§é™ä½ é›†ç¾¤ï¼šæé«˜å¯ç”¨æ€§ ç¼“å­˜ï¼šæ”¹å–„æ€§èƒ½ å¼‚æ­¥ï¼šç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å¼ï¼Œæé«˜å¯ç”¨æ€§ã€åŠ å¿«ç½‘ç«™å“åº”ï¼Œå‰Šå³°å¡«è°· å†—ä½™ï¼šæ•°æ®ç¾å¤‡ï¼ˆå†·å¤‡ä»½ã€çƒ­å¤‡ä»½ï¼‰ è‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œè‡ªåŠ¨åŒ–ç›‘æ§æŠ¥è­¦ å®‰å…¨ï¼šé˜²æ­¢XSSæ”»å‡»ã€SQLæ³¨å…¥ å¤§å‹ç½‘ç«™æ ¸å¿ƒæ¶æ„è¦ç´ ä»€ä¹ˆæ˜¯æ¶æ„ æœ€é«˜å±‚æ¬¡çš„è§„åˆ’ï¼Œéš¾ä»¥æ”¹å˜çš„å†³å®š é™¤äº†å½“å‰ç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚å¤–ï¼Œè½¯ä»¶æ¶æ„è¿˜éœ€è¦å…³æ³¨æ€§èƒ½ï¼Œå¯ç”¨æ€§ï¼Œä¼¸ç¼©æ€§ã€æ‰©å±•æ€§å’Œå®‰å…¨æ€§ æ€§èƒ½å®šä¹‰ è¡¡é‡ç½‘ç«™çš„æ€§èƒ½æœ‰ä¸€ç³»åˆ—æŒ‡æ ‡ï¼Œé‡è¦çš„æœ‰å“åº”æ—¶é—´ï¼ŒTPSï¼Œç³»ç»Ÿæ€§èƒ½è®¡æ•°å™¨ç­‰ æµè§ˆå™¨ç«¯ CDNç¼“å­˜ åº”ç”¨æœåŠ¡ç«¯ç¼“å­˜ å¼‚æ­¥ é›†ç¾¤å¤šå®ä¾‹ å¤šçº¿ç¨‹ æ•°æ®åº“ å¯ç”¨æ€§ åº”ç”¨æœåŠ¡å™¨ å­˜å‚¨æœåŠ¡å™¨ è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­çš„è´¨é‡ä¿è¯ï¼ˆæŒç»­äº¤äº’ï¼‰ ä¼¸ç¼©æ€§å®šä¹‰ é€šè¿‡ä¸æ–­å‘é›†ç¾¤ä¸­åŠ å…¥æœåŠ¡å™¨çš„æ‰‹æ®µæ¥ç¼“è§£ä¸æ–­ä¸Šå‡çš„ç”¨æˆ·å¹¶å‘è®¿é—®å‹åŠ›å’Œä¸æ–­å¢é•¿çš„æ•°æ®å­˜å‚¨éœ€æ±‚ åº”ç”¨æœåŠ¡å™¨é›†ç¾¤ ç¼“å­˜æœåŠ¡å™¨é›†ç¾¤ï¼ˆè¾ƒéš¾ï¼‰ æ‰©å±•æ€§å®šä¹‰ ä¸åŒäºå…¶ä»–æ¶æ„è¦ç´ å…³æ³¨éåŠŸèƒ½æ€§éœ€æ±‚ï¼Œç½‘ç«™çš„æ‰©å±•æ€§æ¶æ„ç›´æ¥å…³æ³¨ç½‘ç«™çš„åŠŸèƒ½éœ€æ±‚ï¼Œè¡¡é‡çš„ä¸»è¦æ ‡å‡†æ˜¯åœ¨ç½‘ç«™å¢åŠ æ–°çš„ä¸šåŠ¡äº§å“æ—¶ï¼Œæ˜¯å¦å¯ä»¥å®ç°å¯¹ç°æœ‰äº§å“é€æ˜æ— å½±å“ï¼Œä¸éœ€è¦ä»»ä½•æ”¹åŠ¨æˆ–è€…å¾ˆå°‘æ”¹åŠ¨æ—¢æœ‰ä¸šåŠ¡åŠŸèƒ½å°±å¯ä»¥ä¸Šçº¿æ–°äº§å“ã€‚ äº‹ä»¶é©±åŠ¨æ¶æ„ åˆ†å¸ƒå¼æœåŠ¡ å®‰å…¨æ€§å®šä¹‰ è¡¡é‡ç½‘ç«™å®‰å…¨æ¶æ„çš„æ ‡å‡†å°±æ˜¯é’ˆå¯¹ç°å­˜å’Œæ½œåœ¨çš„å„ç§æ”»å‡»ä¸çªƒå¯†æ‰‹æ®µï¼Œæ˜¯å¦æœ‰å¯é çš„åº”å¯¹ç­–ç•¥ã€‚]]></content>
      <categories>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¿¡å¿ƒã€ä¹è§‚å’Œå‹‡æ°”]]></title>
    <url>%2F2021%2F06%2F20%2Fdailylog%2Fconfidence-optimism-courage%2F</url>
    <content type="text"><![CDATA[é¢˜è®° &emsp;&emsp;é•¿å¤§æ‰å‘ç°ï¼ŒåŸæ¥é£ç­åªæœ‰é€†ç€é£ï¼Œå®ƒæ‰èƒ½æ…¢æ…¢çš„å¾€ä¸Šé£ã€‚æ„¿é£ç­å¦‚ä½ ï¼Œä¸€åˆ‡å®‰å¥½ï¼ &emsp;&emsp;ç”Ÿä¹‹ï¼Œå¹¸ä¹Ÿï¼Œæ¶ˆå¤±åŠå¹´çš„é™ˆä¸‰å¤šç»ˆäºåˆå›æ¥äº†ã€‚æ›¾å‡ ä½•æ—¶ï¼Œé¢ä¸´å¤±ä¸šçš„æƒ¶æè€Œä¿¡å¿µåŠ¨æ‘‡ï¼Œæœ‰äº†è¦ç¦»å¼€åŒ—äº¬çš„æƒ³æ³•ï¼›æ›¾å‡ ä½•æ—¶ï¼Œç”±äºå†¬è®­è·‘é‡è¿‡å¤§å¼•å‘è†ç›–çš„ç–¼ç—›ï¼Œæ¿’ä¸´äºå´©æºƒæ”¾å¼ƒçš„è¾¹ç¼˜ã€‚æ›¾å‡ ä½•æ—¶ï¼Œè¿ç»­å‡ ä¸ªæœˆæ–­æ–­ç»­ç»­çš„å¤±çœ ï¼Œè®©è‡ªå·±åˆå›åˆ°é‚£ç§æµ´ç«é‡ç”Ÿçš„çŠ¶æ€ã€‚ä½†åº†å¹¸çš„æ˜¯ï¼Œåœ¨ç»å†ç¤¾ä¼šçš„æ¯’æ‰“åçš„æˆ‘åˆæ´»äº†è¿‡æ¥ï¼Œå°±åƒç”Ÿå‘½é‡ç”Ÿä¸€æ ·ï¼Œå¸¦ç€å¯¹æœªæ¥çš„æœŸå¾…ï¼Œæˆ‘å¯¹ç”Ÿæ´»ï¼Œå¯¹åŒ—äº¬è¿™ä¸ªåŸå¸‚æœ‰äº†æ–°çš„è¿·æ‹å’Œå–œçˆ±ã€‚ &emsp;&emsp;ä»Šå¤©åˆšå¥½æ˜¯å…¥èŒç½‘æ˜“æ»¡ä¸¤ä¸ªæœˆçš„æ—¶é—´ï¼Œè²Œä¼¼ä¸€åˆ‡éƒ½æœ‰äº†æ›´å¥½çš„å®‰æ’ã€‚æ›¾ç»ä»¥ä¸ºä¼šç•™ä¸‹é—æ†¾çš„ï¼Œç»ˆç©¶ä¸æ˜¯çœŸæ­£çš„é—æ†¾ã€‚åŸæ¥åªè¦å¿ƒä¸­æœ‰ä¸€é“ä¿¡å¿µï¼Œé‚£ä½ å°±èƒ½ä¸ç¾å¥½çš„è‡ªå·±ç›¸é‡ã€‚å¾ˆæ„Ÿè°¢ç»å†è¿™ä¸€åˆ‡çš„è‡ªå·±ï¼Œæ²¡æœ‰é€‰æ‹©æ”¾å¼ƒç¦»å¼€çš„è‡ªå·±ï¼Œæ²¡æœ‰è¢«äº‹å®æ‰“è´¥è€Œæ˜¯è°ƒæ•´å¿ƒæ€ï¼Œé‡æ–°æ¥çº³é€‰æ‹©é‡æ–°å‡ºå‘çš„è‡ªå·±ã€‚æƒ³å¿…è¿™ä¸€åˆ‡çš„ç»å†å°±æ˜¯äººç”Ÿè·¯ä¸Šçš„ç‚¼é‡‘çŸ³ï¼Œæ˜¯äººä¸€ç”Ÿä¸­æœ€ä¼Ÿå¤§çš„ç²¾ç¥è´¢å¯Œã€‚ &emsp;&emsp;å°±å¥½æ¯”è‡ªå·±æ˜¯ä¸€ç²’ç§å­ï¼Œç§å­ç”Ÿæ ¹å‘èŠ½æ‰èƒ½ç”Ÿé•¿ï¼Œä½†æ²¡æœ‰å“ªæ£µæ ‘æ˜¯æ²¡æœ‰é˜³å…‰é›¨éœ²ï¼Œç‹‚é£æš´é›¨å°±èƒ½é•¿æˆçš„ã€‚è¿™åŠå¹´é‡Œé¢ï¼Œæˆ‘ä¹Ÿç»å†è¿™å„ç§å„æ ·çš„ç¯å¢ƒï¼Œæœ‰æ¥è‡ªæ„Ÿæƒ…æ–¹é¢çš„ï¼Œæœ‰æ¥è‡ªå·¥ä½œæ–¹é¢çš„ï¼Œæœ‰æ¥è‡ªèº«ä½“æ–¹é¢çš„ã€‚å¦‚æœè‡ªå·±ä¿¡å¿µä¸æ·±ï¼Œå°±å¦‚ç§å­æ‰æ ¹ä¸å¤Ÿæ·±çš„è¯ï¼Œä½ æ‰€å¤„ç¯å¢ƒéšæ—¶çš„ä¸€é˜µé£ï¼Œå°±å¯ä»¥æŠŠä½ åˆ®è·‘ï¼Œåªæœ‰çœŸæ­£æŒå®ˆåˆ°åº•çš„ï¼Œæ ¹æ‰èƒ½æ‰å¾—æ›´æ·±ï¼Œæ‰èƒ½ä»æ³¥åœŸä¸­æ±²å–æ›´å¤šçš„å…»åˆ†ï¼Œæˆä¸ºä¸€æ£µå‚å¤©å¤§æ ‘ã€‚ &emsp;&emsp;æˆ–è®¸2021å¹´å·²ç»è¿‡å»äº†ä¸€åŠï¼Œä½†å¹´åˆçš„æ¢¦æƒ³å¹¶æ²¡æœ‰å¿˜è®°ã€‚äººåªæœ‰ä»ç»å†ä¸­æ‰èƒ½æ›´å¥½çš„äº†è§£è‡ªå·±ï¼Œäº†è§£è‡ªå·±æƒ³è¦çš„æ˜¯ä»€ä¹ˆã€‚å°½ç®¡æˆ‘çš„å®¶äººä¹Ÿç»å†ç€ç”Ÿç¦»æ­»åˆ«ï¼Œä½†2021å¹´å¿…å°†æ˜¯ä¿¡å¿ƒä¸å˜å³å°†å¾—èƒœçš„ä¸€å¹´ã€‚æˆ‘çŸ¥é“æˆ‘è¿™æ ·çš„ä»˜å‡ºä¸æ˜¯ä¸ºäº†è‡ªå·±ï¼Œè€Œæ˜¯ä¸ºäº†æˆ‘çš„å®¶äººä»¬ï¼Œæˆ‘èº«è¾¹çš„äººä»¥åŠæˆ‘çš„åä»£ã€‚äººä¸€æ—¦æœ‰äº†ä¿¡å¿µï¼ŒçŸ¥é“è‡ªå·±æƒ³è¦åšçš„ï¼Œæ‰ä¼šå¯¹è‡ªå·±å¯¹ç›®æ ‡äº§ç”Ÿæ›´å¤§çš„è®¤åŒæ„Ÿï¼Œæ‰èƒ½å¤ŸæŠµåˆ¶è¯±æƒ‘ï¼Œæ‰èƒ½ä¹‰æ— åé¡¾çš„å¼€å§‹è¡ŒåŠ¨ï¼Œå°†æ›´å¤šçš„ç²¾åŠ›å’Œæ—¶é—´æ”¾åœ¨è‡ªå·±åšä¿¡çš„äº‹æƒ…ä¸Šé¢ã€‚ é˜…è¯»åŸæ–‡]]></content>
      <categories>
        <category>dailylog</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å“ˆå¸Œè¡¨çš„è¿›åŒ–ï¼Œä»HashMapåˆ°ConcurrentHashMap]]></title>
    <url>%2F2020%2F10%2F14%2Fcollection%2Fhashmap_concurrentMap%2F</url>
    <content type="text"><![CDATA[å¼•è¨€æˆ‘ä»¬ç†ŸçŸ¥ï¼Œä¸€èˆ¬æ•°ç»„å’Œé“¾è¡¨ä¸èƒ½æ»¡è¶³æˆ‘ä»¬å¸¸ç”¨çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘æƒ³å­˜ä¸€ç§key-valç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå…¶å®æ¥è¯´ï¼ŒArrayListä¹Ÿå¯ä»¥çœ‹æˆä¸€ç§ç®€å•çš„å“ˆå¸Œç»“æ„ï¼Œåªæ˜¯keyåªèƒ½å–intç±»å‹ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦æœ‰å“ˆå¸Œç»“æ„å‘¢ï¼Ÿå°±æ˜¯ä¸ºäº†å¼¥è¡¥æ•°ç»„ä¸é“¾è¡¨ä¹‹é—´æŸ¥è¯¢ä¸ä¿®æ”¹çš„æ€§èƒ½å­˜åœ¨é—®é¢˜ã€‚ åŸºäºæ•°ç»„çš„é¡ºåºè¡¨ArrayList ç”±äºå ç”¨çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œæ•…æŸ¥è¯¢ä¿®æ”¹è¾ƒå¿«ï¼Œæ’å…¥åˆ é™¤è¾ƒæ…¢ã€‚åŸºäºNodeèŠ‚ç‚¹çš„åŒå‘é“¾è¡¨LinkedList ç”±äºå½“å‰èŠ‚ç‚¹æŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹çš„æ–¹å¼ï¼Œå„ä¸ªèŠ‚ç‚¹åœ¨å†…å­˜ä¸­ä¸æ˜¯è¿ç»­çš„ï¼Œæ•…æ’å…¥åˆ é™¤è¾ƒå¿«ï¼ŒæŸ¥è¯¢ä¿®æ”¹è¾ƒæ…¢ã€‚ ä¸ºäº†å¼¥è¡¥è¿™ä¸¤ç§æ•°æ®ç»“æ„çš„çŸ­æ¿ï¼Œå“ˆå¸Œç»“æ„çš„æ•°æ®ç±»å‹åº”è¿è€Œç”Ÿï¼Œæœ€å…ˆå¼€å§‹çš„æ˜¯Hashtableï¼Œç”±äºå½“æ—¶è€ƒè™‘åˆ°çº¿ç¨‹å®‰å…¨ï¼Œè¿™ä¸ªç±»ä¸€ä¸Šæ¥å°±åŠ synchronizedé”ï¼ŒåŠ é”å¿…ç„¶æ¶ˆè€—æ€§èƒ½ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬æ›´å¤šåœºæ™¯çš„æ˜¯ä¸éœ€è¦é”çš„ï¼Œæ‰€ä»¥æ‰æœ‰äº†HashMapã€‚HashMapæ˜¯ä¸€ä¸ªæ€§èƒ½å¾ˆä¸é”™çš„å“ˆå¸Œè¡¨ï¼Œä½†æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚åæ¥åˆæœ‰äº†çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMapï¼Œå¹¶ä¸”ä»–ä¿©åœ¨jdk1.8è¿›è¡Œäº†ä¸€æ¬¡è¾ƒå¤§çš„å‡çº§ï¼Œæ¥ä¸‹æ¥çš„æ–‡ç« ï¼Œæˆ‘ä»¬å°±æ ¹æ®jdk1.7 å’Œ jdk1.8 çš„æºç æ¥åˆ†æä¸€ä¸‹ HashMap å’ŒConcurrenthashMapã€‚ HashMapjdk1.7ç»“æ„åˆå§‹åŒ–123456789101112131415161718public HashMap() &#123; this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR); -- é»˜è®¤åˆå§‹åŒ–å¤§å°16ã€è´Ÿè½½å› å­0.75&#125; public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) -- MAXIMUM_CAPACITY = 1 &lt;&lt; 30 initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; threshold = initialCapacity; init();&#125; å®ä¾‹å˜é‡123456789101112131415161718static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;static final float DEFAULT_LOAD_FACTOR = 0.75f;static final Entry&lt;?,?&gt;[] EMPTY_TABLE = &#123;&#125;;transient Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE;transient int size;// If table == EMPTY_TABLE then this is the initial capacity at which the// table will be created when inflated.int threshold;final float loadFactor; java1.7 çš„hashMapç»“æ„å¦‚ä¸‹å›¾ï¼š Entryç»“æ„12345678910111213141516static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final K key; V value; Entry&lt;K,V&gt; next; int hash; /** * Creates new entry. */ Entry(int h, K k, V v, Entry&lt;K,V&gt; n) &#123; value = v; next = n; key = k; hash = h; &#125;&#125; putæ–¹æ³•æ€è€ƒï¼šå¾€HashMap æ·»åŠ 1000ä¸ªå…ƒç´ éœ€è¦æ‰©å®¹å¤šå°‘æ¬¡ï¼Ÿ (Add first)â€”&gt; 16 â€”&gt;ä»¥åéƒ½æ˜¯ä¸¤å€çš„æ‰©å®¹210=1024 ,è¿˜éœ€è¦6æ¬¡æ‰©å®¹ 123456789101112131415161718192021222324public V put(K key, V value) &#123; if (table == EMPTY_TABLE) &#123; inflateTable(threshold); // é»˜è®¤æ–¹å¼æ‰©å®¹ &#125; if (key == null) return putForNullKey(value); // keyå€¼ä¸ºç©ºå¤„ç† int hash = hash(key); // æ‰¾åˆ°keyçš„hashå€¼ int i = indexFor(hash, table.length); // æ‰¾åˆ°ä½äºå“ªä¸ªå“ˆå¸Œæ§½ï¼Œå³æ•°ç»„çš„ä¸‹æ ‡ for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; // éå†å“ˆå¸Œæ¡¶é‡Œçš„å…ƒç´ ï¼Œå¦‚æœæœ‰ç›¸ç­‰çš„keyï¼Œç›´æ¥æ›¿æ¢valï¼Œè¿”å›åŸæ¥çš„val if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; modCount++; // å¦åˆ™ï¼Œå°†å…ƒç´ æ’å…¥ä¸‹æ ‡ä¸ºiçš„å“ˆå¸Œæ¡¶ addEntry(hash, key, value, i); return null;&#125; addEntryæ–¹æ³•12345678910111213void addEntry(int hash, K key, V value, int bucketIndex) &#123; // æ ¡éªŒæ˜¯å¦éœ€è¦æ‰©å®¹,ä¸ªæ•°å¤§äºé˜€å€¼å¹¶ä¸”å“ˆå¸Œæ§½é‡Œé¢å·²ç»æœ‰äº†å…ƒç´  if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; // å¯¹æ•°ç»„è¿›è¡Œä¸¤å€çš„æ‰©å®¹ resize(2 * table.length); hash = (null != key) ? hash(key) : 0; // æ‰©å®¹å®Œä¹‹åé‡æ–°è·å–æ¡¶çš„ä¸‹æ ‡ bucketIndex = indexFor(hash, table.length); &#125; // æ·»åŠ å…ƒç´  createEntry(hash, key, value, bucketIndex);&#125; createEntryæ–¹æ³•12345678// æ’å…¥å…ƒç´ æ—¶ï¼Œåº”æ’å…¥å“ˆå¸Œæ¡¶çš„å¤´éƒ¨ï¼Œè€Œä¸æ˜¯å°¾éƒ¨void createEntry(int hash, K key, V value, int bucketIndex) &#123; // å–å‡ºæ§½é‡Œçš„å…ƒç´  Entry&lt;K,V&gt; e = table[bucketIndex]; // ï¼ˆç¬¬ä¸€å¤„ï¼‰ // å°†å½“å‰æ–°ç”Ÿæˆçš„Entryæ”¾åœ¨æ§½é‡Œï¼ŒnextèŠ‚ç‚¹æŒ‡å‘ä¹‹å‰æ§½é‡Œçš„å…ƒç´  table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++;&#125; resizeæ–¹æ³•12345678910111213141516171819void resize(int newCapacity) &#123; Entry[] oldTable = table; // åŸæ•°ç»„çš„é•¿åº¦ int oldCapacity = oldTable.length; // æ³¨æ„MAXIMUM_CAPACITY=1 &lt;&lt; 30ï¼Œå¦‚æœ1&lt;&lt;31 åˆ™æˆ Intager çš„æœ€å°å€¼ï¼š-2147483648 if (oldCapacity == MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return; &#125; // æ–°å»ºæ•°ç»„ Entry[] newTable = new Entry[newCapacity]; //ï¼ˆç¬¬å››å¤„ï¼‰ // æ ¹æ®hashé‡æ–°å®šä½å…ƒç´ ä¸‹æ ‡ï¼Œä»æ—§è¡¨è¿ç§»åˆ°æ–°è¡¨ transfer(newTable, initHashSeedAsNeeded(newCapacity)); //ï¼ˆç¬¬äºŒå¤„ï¼‰ // èµ‹å€¼å†…éƒ¨æ•°ç»„ï¼ˆåœ¨æ­¤æ­¥éª¤å®Œæˆå‰ï¼Œæ—§è¡¨ä¾ç„¶å¯ä»¥æ·»åŠ å…ƒç´ ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰ table = newTable; //ï¼ˆç¬¬ä¸‰å¤„ï¼‰ // ä¿®æ”¹é˜€å€¼ threshold = (int)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1);&#125; getæ–¹æ³•1234567public V get(Object key) &#123; if (key == null) return getForNullKey(); Entry&lt;K,V&gt; entry = getEntry(key); return null == entry ? null : entry.getValue();&#125; getEntryæ–¹æ³•12345678910111213final Entry&lt;K,V&gt; getEntry(Object key) &#123; if (size == 0) &#123; return null; &#125; int hash = (key == null) ? 0 : hash(key); for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];e != null;e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp;((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; return null;&#125; hashæ–¹æ³•1234567891011121314final int hash(Object k) &#123; int h = hashSeed; if (0 != h &amp;&amp; k instanceof String) &#123; return sun.misc.Hashing.stringHash32((String) k); &#125; h ^= k.hashCode(); // This function ensures that hashCodes that differ only by // constant multiples at each bit position have a bounded // number of collisions (approximately 8 at default load factor). h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12); return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);&#125; indexForæ–¹æ³•1234static int indexFor(int h, int length) &#123; // assert Integer.bitCount(length) == 1 : "length must be a non-zero power of 2"; return h &amp; (length-1);&#125; remove(key)æ–¹æ³•1234567891011121314151617181920212223242526272829303132333435363738public V remove(Object key) &#123; Entry&lt;K,V&gt; e = removeEntryForKey(key); return (e == null ? null : e.value);&#125;final Entry&lt;K,V&gt; removeEntryForKey(Object key) &#123; if (size == 0) &#123; return null; &#125; int hash = (key == null) ? 0 : hash(key); int i = indexFor(hash, table.length); // æ‰¾åˆ°ä½äºå“ªä¸ªæ¡¶ Entry&lt;K,V&gt; prev = table[i]; Entry&lt;K,V&gt; e = prev; while (e != null) &#123; // nextæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ Entry&lt;K,V&gt; next = e.next; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; modCount++; size--; // å¦‚æœåœ¨æ¡¶é‡Œï¼Œåˆ™å°†ä¸‹ä¸ªèŠ‚ç‚¹æ”¾å…¥æ¡¶é‡Œ if (prev == e) table[i] = next; else // å¦åˆ™ï¼Œå‰èŠ‚ç‚¹çš„nextèŠ‚ç‚¹æŒ‡å‘åˆ é™¤èŠ‚ç‚¹çš„nextèŠ‚ç‚¹ prev.next = next; e.recordRemoval(this); return e; &#125; // ä¸ç­‰çš„è¯ï¼Œé€ä¸ªéå† prev = e; e = next; &#125; return e;&#125; å¹¶å‘é—®é¢˜å¯¹è±¡ä¸¢å¤±é—®é¢˜123456789101112131415161718192021222324252627282930313233343536373839404142public class MapApplication &#123; private static Map hashMap = new HashMap(); public static void main(String[] args) throws InterruptedException &#123; MapApplication mp = new MapApplication(); Thread1 t1 = mp.new Thread1(); Thread2 t2 = mp.new Thread2(); Thread thread1 = new Thread(t1); Thread thread2 = new Thread(t2); thread1.start(); thread2.start(); thread1.join(); thread2.join(); System.out.println(hashMap.size()); &#125; class Thread1 implements Runnable &#123; @Override public void run() &#123; for (int i = 1; i &lt;= 100000; i++) &#123; hashMap.put(i, i); &#125; &#125; &#125; class Thread2 implements Runnable &#123; @Override public void run() &#123; for (int i = 100001; i &lt;= 200000; i++) &#123; hashMap.put(i, i); &#125; &#125; &#125;&#125; é€šè¿‡ç¨‹åºå‘ç°ï¼Œå½“æ¯ä¸ªçº¿ç¨‹æ·»åŠ å…ƒç´ æ•°æ®é‡åœ¨1000æ—¶ï¼Œå¾—åˆ°çš„ç»“æœå¹¶ä¸æ˜¯2000ï¼Œè€Œæ€»æ˜¯å°äº2000ã€‚ è¯´æ˜å¹¶å‘æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚å¯¼è‡´çš„åŸå› ä¹‹ä¸€æ˜¯åœ¨createEntryæ–¹æ³•ä¸­çš„ç¬¬ä¸€å¤„ï¼Œä¸€ä¸ªçº¿ç¨‹çš„èµ‹å€¼è¢«å¦ä¸€ä¸ªçº¿ç¨‹çš„è¦†ç›–äº†ã€‚ åŒæ—¶åœ¨resizeæ–¹æ³•çš„ç¬¬äºŒå¤„å’Œç¬¬ä¸‰å¤„ä¹Ÿä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ç¬¬äºŒå¤„éå†çš„æ—¶å€™å¦‚æœæœ‰å¦ä¸€ä¸ªçº¿ç¨‹å°†æ•°æ®æ’å…¥åˆ°å·²ç»éå†çš„æ¡¶é‡Œé¢ï¼Œåœ¨æ­¥éª¤ï¼ˆç¬¬ä¸‰å¤„ï¼‰èµ‹å€¼å®Œä¹Ÿä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ åŒæ—¶ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥åˆ°resizeçš„ï¼ˆç¬¬å››å¤„ï¼‰ä»£ç ï¼ŒnewTable = new Entry[newCapacity]ï¼Œç”±äºæ˜¯å±€éƒ¨å˜é‡çº¿ç¨‹ä¸å¯è§ï¼Œåœ¨resizeå®Œèµ‹å€¼ä¹‹åä¼šè¦†ç›–å…¶ä»–çº¿ç¨‹çš„æ“ä½œï¼Œå¯¼è‡´åœ¨â€œæ–°è¡¨â€ä¸­æ’å…¥çš„å…ƒç´ æ— æƒ…çš„ä¸¢å¤±ã€‚ åŸå› æ€»ç»“ å¹¶å‘èµ‹å€¼æ—¶è¢«è¦†ç›– å·²éå†åŒºé—´æ–°å¢å…ƒç´ ä¼šä¸¢å¤± â€œæ–°è¡¨â€è¢«è¦†ç›– å½“æ•°æ®é‡åœ¨100000æ—¶ï¼Œæ‰§è¡Œç¨‹åºå°±ä¸èƒ½æ°¸è¿œé€€å‡ºï¼Œæ˜¯å› ä¸ºæ‰©å®¹çš„æ—¶å€™å¯¼è‡´æ­»é“¾çš„é—®é¢˜ã€‚ æ­»é“¾é—®é¢˜123456789101112131415161718192021222324252627282930public class ResizeMapApplication &#123; public static void main(String[] args) &#123; Map hashMap = new HashMap(); // æ‰©å®¹çš„é˜€å€¼æ˜¯16*0.75=12 // ç¬¬ä¸€æ¬¡æ‰©å®¹å‘ç”Ÿputç¬¬13ä¸ªå…ƒç´ æ—¶ for (int i = 1; i &lt;= 13; i++) &#123; hashMap.put(new UserKey(), i); &#125; Set&lt;Map.Entry&lt;Integer, Integer&gt;&gt; entrySet = hashMap.entrySet(); for (Map.Entry&lt;Integer, Integer&gt; entry : entrySet) &#123; System.out.println(entry.getKey() + "---" + entry.getValue()); &#125; &#125;&#125;class UserKey &#123; @Override public int hashCode() &#123; // ä¿è¯åœ¨åŒä¸€ä¸ªæ§½ return 1; &#125; @Override public boolean equals(Object obj) &#123; // ä¿è¯ä¸æ˜¯ç›¸åŒçš„å…ƒç´  return false; &#125;&#125; æ ¹æ®æºç å¯ä»¥è¿½è¸ªæ‰©å®¹å‰å†…éƒ¨å…ƒç´ çš„æƒ…å†µ ç”±äºæ‰€æœ‰çš„å…ƒç´ éƒ½ä¼šä½äºtable[1]çš„å“ˆå¸Œæ¡¶é‡Œï¼Œæ‰€ä»¥åªéœ€è·Ÿè¸ªtable[1]çš„å…ƒç´  æ‰©å®¹å‰ï¼šæ•°ç»„çš„é•¿åº¦ä¸º16ï¼Œé˜€å€¼ä¸º12 12â€”&gt;11â€”&gt;10 â€¦ â€¦ â€”&gt;2â€”&gt;1 æ‰©å®¹åï¼šæ•°ç»„çš„é•¿åº¦ä¸º32ï¼Œé˜€å€¼ä¸º24 13â€”&gt;1â€”&gt;2â€”&gt;3â€¦ â€”&gt;11â€”&gt;12 å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥resizeæ–¹æ³•çš„ç¬¬äºŒå¤„æ—¶ï¼Œä¼šé‡æ–°rehashæ¯ä¸€ä¸ªå“ˆå¸Œæ¡¶é‡Œçš„å…ƒç´ ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š 1234567891011121314151617void transfer(Entry[] newTable, boolean rehash) &#123; int newCapacity = newTable.length; // ä½¿ç”¨foreachéå†æ•´ä¸ªæ•°ç»„ä¸‹æ ‡ for (Entry&lt;K,V&gt; e : table) &#123; // å¦‚æœæ§½ä¸Šå­˜åœ¨å…ƒç´ ï¼Œåˆ™éå†å“ˆå¸Œæ¡¶ï¼Œç›´åˆ°e==nullï¼Œé€€å‡ºå¾ªç¯ while(null != e) &#123; Entry&lt;K,V&gt; next = e.next; if (rehash) &#123; e.hash = null == e.key ? 0 : hash(e.key); &#125; int i = indexFor(e.hash, newCapacity); e.next = newTable[i]; newTable[i] = e; e = next; &#125; &#125;&#125; äº§ç”Ÿé—®é¢˜çš„æ ¹æºæ˜¯nextçš„æŒ‡é’ˆè¢«å¹¶å‘çº¿ç¨‹ä¿®æ”¹ã€‚ jdk1.8åœ¨jdk1.8ä¸­ï¼ŒHashMapåšäº†æ¯”è¾ƒå¤§çš„å‡çº§ï¼Œå…³äºå‡çº§çš„å†…å®¹æˆ‘ä»¬é€šè¿‡æºç æ¥éªŒè¯ä¸€ä¸‹ã€‚ jdk1.7æ˜¯å…ˆæ‰©å®¹ï¼Œå†æ’å…¥å…ƒç´ ã€‚è€Œjdk1.8æ˜¯ï¼Œå…ˆæ’å…¥å…ƒç´ ï¼Œå†æ‰©å®¹ã€‚ jdk1.7HashMapå½“é“¾è¡¨é•¿åº¦è¿‡é•¿æ—¶ï¼Œå­˜åœ¨éå†æ€§èƒ½çš„é—®é¢˜ã€‚jdk1.8å¼•å…¥äº†çº¢é»‘æ ‘ï¼Œè§£å†³äº†è¯¥é—®é¢˜ã€‚ jdk1.7æ‰©å®¹æ—¶ï¼Œå“ˆå¸Œæ¡¶é‡Œçš„å…ƒç´ ä¼šé‡æ–°rehashï¼Œé¡ºåºä¼šé¢ å€’ã€‚è€Œjdk1.8æ˜¯ä¸ä¸€æ ·çš„ã€‚ ç»“æ„123456789101112131415161718192021222324252627282930313233343536373839404142434445static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;static final float DEFAULT_LOAD_FACTOR = 0.75f;/** * The bin count threshold for using a tree rather than list for a * bin. Bins are converted to trees when adding an element to a * bin with at least this many nodes. The value must be greater * than 2 and should be at least 8 to mesh with assumptions in * tree removal about conversion back to plain bins upon * shrinkage. */static final int TREEIFY_THRESHOLD = 8;/** * The bin count threshold for untreeifying a (split) bin during a * resize operation. Should be less than TREEIFY_THRESHOLD, and at * most 6 to mesh with shrinkage detection under removal. */static final int UNTREEIFY_THRESHOLD = 6;/** * The smallest table capacity for which bins may be treeified. * (Otherwise the table is resized if too many nodes in a bin.) * Should be at least 4 * TREEIFY_THRESHOLD to avoid conflicts * between resizing and treeification thresholds. */static final int MIN_TREEIFY_CAPACITY = 64;// jdk1.8 ä½¿ç”¨çš„æ˜¯ NodeèŠ‚ç‚¹ï¼Œä»£æ›¿1.7çš„Entry,ä½†å«æ³•ä¸ä¸€æ ·ï¼Œç»“æ„æ˜¯ä¸€æ ·çš„static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; final K key; V value; Node&lt;K,V&gt; next; Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125;&#125; putæ–¹æ³•123public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125; hashæ–¹æ³•12345static final int hash(Object key) &#123; int h; // åŠ å…¥é«˜ä½è¿ç®—ï¼Œåˆ°æ•°ç»„çš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¿è¯é«˜åœ°ä½bitå‚åˆ°è®¡ç®—ä¸­ return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; putValæ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455final V putVal(int hash, K key, V value, boolean onlyIfAbsent,boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; if ((tab = table) == null || (n = tab.length) == 0) // é»˜è®¤æ‰©å®¹ï¼Œè·å–æ•°ç»„çš„é•¿åº¦ n = (tab = resize()).length; if ((p = tab[i = (n - 1) &amp; hash]) == null) // å“ˆå¸Œæ§½ä¸ºç©ºï¼Œç›´æ¥æ’å…¥ tab[i] = newNode(hash, key, value, null); else &#123; // å¦åˆ™ï¼Œå…ˆåˆ¤æ–­å“ˆå¸Œæ§½é‡Œçš„å…ƒç´  Node&lt;K,V&gt; e; K k; if (p.hash == hash &amp;&amp;((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))&#123; // å¦‚æœkeyä¸å“ˆå¸Œæ¡¶é‡Œçš„keyç›¸ç­‰ï¼Œåˆ™æ‰¾åˆ°äº† e = p; &#125;else if (p instanceof TreeNode) // å“ˆå¸Œæ§½æ˜¯å¦æ˜¯TreeNodeç»“æ„ï¼Œæ˜¯çš„è¯ï¼Œè¿›è¡Œæ’å…¥ e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; // éå†å“ˆå¸Œæ¡¶é‡Œçš„å…ƒç´  for (int binCount = 0; ; ++binCount) &#123; // å¦‚æœéå†åˆ°æœ€åçš„èŠ‚ç‚¹ if ((e = p.next) == null) &#123; // è¿½åŠ åœ¨æœ€åçš„èŠ‚ç‚¹æœ«å°¾ p.next = newNode(hash, key, value, null); // å¦‚æœé“¾è¡¨çš„é•¿åº¦å¤§äºç­‰äº7ï¼ˆé™¤å»å“ˆå¸Œæ§½çš„å…ƒç´ ï¼Œç”±äºåŠ ä¸Šäº†nextæŒ‡é’ˆï¼Œè¿™æ—¶çš„é•¿åº¦å·²ç»æ˜¯8äº†ï¼‰ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st // å°†é“¾è¡¨è½¬åŒ–æˆçº¢é»‘æ ‘ treeifyBin(tab, hash); break; &#125; // æ‰¾åˆ°ç›¸åŒçš„key if (e.hash == hash &amp;&amp;((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))&#123; break; &#125; // æŒ‡å‘nextæŒ‡é’ˆ p = e; &#125; &#125; // å¦‚æœæ‰¾åˆ°ç›¸åŒçš„key,è¿”å›åŸå§‹val if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; // åˆ¤æ–­size+1æ˜¯å¦å¤§äºé˜€å€¼ if (++size &gt; threshold) // å¤§äºçš„è¯å°±è¿›è¡Œæ‰©å®¹ resize(); afterNodeInsertion(evict); return null;&#125; å¯ä»¥çœ‹åˆ°ï¼Œåœ¨jdk1.8ä¸­ jdk1.8æ˜¯ï¼Œå…ˆæ’å…¥å…ƒç´ ï¼Œå†æ‰©å®¹ã€‚ å¼•å…¥äº†çº¢é»‘æ ‘ï¼Œä¸”å“ˆå¸Œæ§½é‡Œæ”¾çš„æ˜¯æ ‘çš„TreeNodeç»“æ„ å¦‚æœå“ˆå¸Œæ¡¶æ˜¯é“¾è¡¨ç»“æ„ï¼Œé•¿åº¦ä¸å¤§äº8çš„è¯ï¼Œåˆ™è¿½åŠ çš„èŠ‚ç‚¹åœ¨é“¾è¡¨çš„æœ«å°¾ã€‚ åˆ°æ­¤ï¼ŒéªŒè¯ä¸€ã€éªŒè¯äºŒ å·²ç»å¾—åˆ°éªŒè¯ï¼Œç°åœ¨æ¥éªŒè¯ä¸‰ã€‚ resizeæ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; if (oldCap &gt; 0) &#123; // æ•°ç»„ä¸èƒ½è¶…è¿‡1&lt;&lt;30 if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; // é˜€å€¼è®¾ç½®ä¸ºæœ€å¤§å€¼ threshold = Integer.MAX_VALUE; return oldTab; &#125; else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) // å®¹é‡ã€é˜€å€¼ä¹Ÿä¸¤å€æ‰©å®¹ newThr = oldThr &lt;&lt; 1; // double threshold &#125; else if (oldThr &gt; 0) // initial capacity was placed in threshold newCap = oldThr; else &#123; // zero initial threshold signifies using defaults // å¦‚æœé»˜è®¤åˆå§‹åŒ–ï¼Œåˆ™è®¾ç½®é»˜è®¤å®¹é‡ newCap = DEFAULT_INITIAL_CAPACITY; // é»˜è®¤çš„é˜€å€¼ newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; // é‡æ–°ç½®é˜€å€¼ if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; threshold = newThr; // åˆå§‹åŒ–æ–°çš„table Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; table = newTab; // æ‰©å®¹å‰çš„tableä¸ä¸ºç©º if (oldTab != null) &#123; // é€ä¸ªéå†å“ˆå¸Œæ¡¶ for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; // å“ˆå¸Œæ§½æŒ‡é’ˆ if ((e = oldTab[j]) != null) &#123; oldTab[j] = null; // å“ˆå¸Œæ§½é‡Œåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™é‡æ–°hashå³å¯ if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; // å¦‚æœå“ˆå¸Œæ§½æ˜¯TreeNodeèŠ‚ç‚¹ï¼Œåˆ™æŒ‰ç…§æ ‘çš„æ–¹å¼å¤„ç† else if (e instanceof TreeNode) ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); // æ˜¯é“¾è¡¨ç»“æ„ï¼Œåˆ™é€ä¸ªéå†å¤„ç† else &#123; // preserve order Node&lt;K,V&gt; loHead = null, loTail = null; Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; do &#123; next = e.next; if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) loHead = e; else loTail.next = e; loTail = e; &#125; else &#123; if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab;&#125; jdk1.8ä¸­åœ¨è®¡ç®—æ–°ä½ç½®çš„æ—¶å€™å¹¶æ²¡æœ‰è·Ÿ1.7ä¸­ä¸€æ ·é‡æ–°è¿›è¡Œhashè¿ç®—ï¼Œè€Œæ˜¯ç”¨äº†åŸä½ç½®+åŸæ•°ç»„é•¿åº¦è¿™æ ·ä¸€ç§å¾ˆå·§å¦™çš„æ–¹å¼ï¼Œè€Œè¿™ä¸ªç»“æœä¸hashè¿ç®—å¾—åˆ°çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯ä¼šæ›´å¿«ã€‚ getæ–¹æ³•1234public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125; getNodeæ–¹æ³•1234567891011121314151617181920212223final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;(first = tab[(n - 1) &amp; hash]) != null) &#123; // åˆ¤æ–­å“ˆå¸Œæ§½é‡Œçš„å…ƒç´  if (first.hash == hash &amp;&amp; ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))&#123; return first; &#125; // å¦‚æœå“ˆå¸Œæ§½é‡Œçš„å…ƒç´ ä¸ä¸ºç©º if ((e = first.next) != null) &#123; // åˆ¤æ–­æ˜¯å¦æ˜¯æ ‘ç»“æ„ï¼Œæ˜¯çš„è¯ï¼ŒæŒ‰ç…§æ ‘å»è·å– if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); do &#123; // éå†é“¾è¡¨çš„å…ƒç´  if (e.hash == hash &amp;&amp;((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))&#123; return e; &#125; &#125; while ((e = e.next) != null); &#125; &#125; // å¦åˆ™ï¼Œè¿”å› null return null;&#125; ç®€å•æ€»ç»“ä¸‹ HashMapï¼šæ— è®ºæ˜¯ 1.7 è¿˜æ˜¯ 1.8 å…¶å®éƒ½èƒ½çœ‹å‡º JDK æ²¡æœ‰å¯¹å®ƒåšä»»ä½•çš„åŒæ­¥æ“ä½œï¼Œæ‰€ä»¥å¹¶å‘ä¼šå‡ºé—®é¢˜ï¼Œç”šè‡³ 1.7 ä¸­å‡ºç°æ­»å¾ªç¯å¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼ˆ1.8 å·²ç»ä¿®å¤æ­»å¾ªç¯é—®é¢˜ï¼‰ ConcurrentHashMapjdk1.7ç”±äºHashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹ä¼šå‡ºç°å®‰å…¨é—®é¢˜ï¼Œæ•…å¼•å…¥äº†ConcurrentHashMapï¼Œæ”¯æŒå¤šå¹¶å‘çš„åœºæ™¯ã€‚ ç»“æ„123456789101112131415161718192021222324252627282930313233343536static final int MIN_SEGMENT_TABLE_CAPACITY = 2; static final int MAX_SEGMENTS = 1 &lt;&lt; 16; // slightly conservative// Mask value for indexing into segments. // The upper bits of a key's hash code are used to choose the segment.final Segment&lt;K,V&gt;[] segments;// Shift value for indexing within segments.final int segmentMask;final int segmentShift; static final class HashEntry&lt;K,V&gt; &#123; final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next; HashEntry(int hash, K key, V value, HashEntry&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125;&#125;static final class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable &#123; transient volatile HashEntry&lt;K,V&gt;[] table; transient int count; transient int threshold; final float loadFactor; Segment(float lf, int threshold, HashEntry&lt;K,V&gt;[] tab) &#123; this.loadFactor = lf; this.threshold = threshold; this.table = tab; &#125; // PUTæ–¹æ³• // REMOVEæ–¹æ³•&#125; java1.7 çš„ConcurentHashMapç»“æ„å¦‚ä¸‹å›¾ï¼š åˆå§‹åŒ–12345678910111213141516171819202122232425262728293031323334353637// æ— å‚æ„é€ æ–¹æ³• é»˜è®¤å€¼åˆ†åˆ«ä¸ºï¼š16ï¼Œ0.75ï¼Œ16public ConcurrentHashMap() &#123; this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR, DEFAULT_CONCURRENCY_LEVEL);&#125;public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) &#123; // å‚æ•°æ ¡éªŒ if (!(loadFactor &gt; 0) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); if (concurrencyLevel &gt; MAX_SEGMENTS) concurrencyLevel = MAX_SEGMENTS; // Find power-of-two sizes best matching arguments int sshift = 0; int ssize = 1; while (ssize &lt; concurrencyLevel) &#123; ++sshift; ssize &lt;&lt;= 1; &#125; this.segmentShift = 32 - sshift; this.segmentMask = ssize - 1; if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; int c = initialCapacity / ssize; if (c * ssize &lt; initialCapacity) ++c; int cap = MIN_SEGMENT_TABLE_CAPACITY; while (cap &lt; c) cap &lt;&lt;= 1; // create segments and segments[0] Segment&lt;K,V&gt; s0 = new Segment&lt;K,V&gt;(loadFactor, (int)(cap * loadFactor), (HashEntry&lt;K,V&gt;[])new HashEntry[cap]); Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])new Segment[ssize]; UNSAFE.putOrderedObject(ss, SBASE, s0); // ordered write of segments[0] this.segments = ss; &#125; getæ–¹æ³•12345678910111213141516171819public V get(Object key) &#123; Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead HashEntry&lt;K,V&gt;[] tab; int h = hash(key); // æ ¹æ®hashæ‰¾åˆ°å“ªä¸ªSegment long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) &#123; // å¦‚æœä¸ä¸ºç©ºï¼Œéå†åˆ†æ®µé”æ¡¶é‡Œé¢çš„å…ƒç´  for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) &#123; K k; if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; &#125; &#125; return null;&#125; getæ–¹æ³•æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œå› ä¸ºæ²¡æœ‰åŠ é”ã€‚æ˜¯é€šè¿‡HashEntryçš„valueåŠ äº†volatileä¿®é¥°ç¬¦ï¼Œä¿è¯äº†å†…å­˜çš„å¯è§æ€§ã€‚ putæ–¹æ³•12345678910111213public V put(K key, V value) &#123; Segment&lt;K,V&gt; s; if (value == null) throw new NullPointerException(); int hash = hash(key); int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; // æ‰¾åˆ°åˆ†æ®µé”æ¡¶çš„ä½ç½® if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject // nonvolatile; recheck (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) // in ensureSegment s = ensureSegment(j); // å¾€åˆ†æ®µé”æ¡¶é‡Œputå€¼ return s.put(key, hash, value, false);&#125; Segment.putæ–¹æ³•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123; // å°è¯•è·å–é” HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value); // è·å–å¤±è´¥ï¼Œè¯´æ˜æœ‰çº¿ç¨‹ç«äº‰ï¼Œåˆ™è‡ªæ—‹è·å–é”ï¼ˆé»˜è®¤64ï¼‰ V oldValue; try &#123; HashEntry&lt;K,V&gt;[] tab = table; // æ‰¾åˆ°å“ˆå¸Œæ§½ä¸‹æ ‡ int index = (tab.length - 1) &amp; hash; // è·å–å“ˆå¸Œæ¡¶ HashEntry&lt;K,V&gt; first = entryAt(tab, index); // éå†å“ˆå¸Œæ¡¶é‡Œçš„å…ƒç´  for (HashEntry&lt;K,V&gt; e = first;;) &#123; if (e != null) &#123; K k; // éå†æ˜¯å¦å­˜åœ¨ç›¸åŒçš„keyå€¼ if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123; // æœ‰çš„è¯å°±æ›¿æ¢ oldValue = e.value; if (!onlyIfAbsent) &#123; e.value = value; ++modCount; &#125; // é€€å‡ºå¾ªç¯ break; &#125; e = e.next; &#125; else &#123; // éå†å®Œå‘ç°æ²¡æœ‰ç›¸åŒçš„key,å¦‚æœnodeèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œç›´æ¥å°†nodeèŠ‚ç‚¹çš„nextæŒ‡å‘å“ˆå¸Œæ¡¶çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ if (node != null) node.setNext(first); else // ä¸ºç©ºçš„è¯ï¼Œå°±ç”Ÿæˆæ–°çš„èŠ‚ç‚¹ node = new HashEntry&lt;K,V&gt;(hash, key, value, first); int c = count + 1; if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) // æ‰©å®¹ rehash(node); else // é‡æ–°æ”¾ç½®HashEntryåœ¨æ¡¶é‡Œ setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; &#125; &#125; &#125; finally &#123; unlock(); &#125; return oldValue;&#125; removeæ–¹æ³•123456public V remove(Object key) &#123; int hash = hash(key); Segment&lt;K,V&gt; s = segmentForHash(hash); // æ³¨æ„è¿™é‡Œä¼ çš„valueå€¼æ˜¯ç©º return s == null ? null : s.remove(key, hash, null);&#125; Segment.removeæ–¹æ³•123456789101112131415161718192021222324252627282930313233343536373839404142final V remove(Object key, int hash, Object value) &#123; // å°è¯•è·å–é” if (!tryLock()) // é˜»å¡æ€§è·å–é” scanAndLock(key, hash); V oldValue = null; try &#123; HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash; // è·å–å“ˆå¸Œæ§½ HashEntry&lt;K,V&gt; e = entryAt(tab, index); HashEntry&lt;K,V&gt; pred = null; while (e != null) &#123; K k; // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ HashEntry&lt;K,V&gt; next = e.next; // æ‰¾åˆ°è¦åˆ é™¤çš„key if ((k = e.key) == key ||(e.hash == hash &amp;&amp; key.equals(k))) &#123; V v = e.value; // è¿™é‡Œåœ¨å¹²å˜›ï¼Œåº”è¯¥æ˜¯å…¼å®¹æŒ‡å®švalueåˆ é™¤ if (value == null || value == v || value.equals(v)) &#123; // å¦‚æœå“ˆå¸Œæ¡¶ä¸ºç©ºï¼Œç½®ç©º if (pred == null) setEntryAt(tab, index, next); else // å¦åˆ™ï¼ŒæŒ‡å‘predä¸‹ä¸€ä¸ªæŒ‡é’ˆ pred.setNext(next); ++modCount; --count; // è¿”å›åŸå§‹val oldValue = v; &#125; break; &#125; pred = e; e = next; &#125; &#125; finally &#123; unlock(); &#125; return oldValue;&#125; å‚è€ƒcrossoverJieæ–‡ç« ]]></content>
      <categories>
        <category>collection</category>
        <category>hashmap</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[leetcodeç³»åˆ—ï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„]]></title>
    <url>%2F2020%2F10%2F04%2Falgorithm%2Fleetcode-088%2F</url>
    <content type="text"><![CDATA[æè¿°ç»™ä½ ä¸¤ä¸ªæœ‰åºæ•´æ•°æ•°ç»„ nums1 å’Œ nums2ï¼Œè¯·ä½ å°† nums2 åˆå¹¶åˆ° nums1 ä¸­ï¼Œä½¿ nums1 æˆä¸ºä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚ è¯´æ˜: åˆå§‹åŒ– nums1 å’Œ nums2 çš„å…ƒç´ æ•°é‡åˆ†åˆ«ä¸º m å’Œ n ã€‚ä½ å¯ä»¥å‡è®¾ nums1 æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼ˆç©ºé—´å¤§å°å¤§äºæˆ–ç­‰äº m + nï¼‰æ¥ä¿å­˜ nums2 ä¸­çš„å…ƒç´ ã€‚ ç¤ºä¾‹: è¾“å…¥: nums1 = [1,2,3,0,0,0], m = 3nums2 = [2,5,6], n = 3 è¾“å‡º: [1,2,2,3,5,6] æ€è·¯è§£ä¸€ç”±äºnums1å·²ç»æ˜¯æ’åºäº†çš„ï¼Œæˆ‘ä»¬èƒ½å‚è€ƒæ’å…¥æ’åºçš„æ€æƒ³ï¼Œå°†nums2ä¸­çš„å…ƒç´ ï¼Œé€ä¸ªä¸nums1æœ«å°¾çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„ä½ç½®æ’å…¥ä¸ºæ­¢ã€‚ 123456789101112131415161718192021class Solution &#123; public void merge(int[] nums1, int m, int[] nums2, int n) &#123; assert nums1 != null &amp;&amp; nums2 != null; for (int i = 0; i &lt; n &amp;&amp; m &lt; nums1.length; i++, m++) &#123; nums1[m] = nums2[i]; for (int j = m; j &gt; 0; j--) &#123; if (nums1[j] &gt;= nums1[j - 1]) &#123; break; &#125; else &#123; swapArr(nums1, j, j - 1); &#125; &#125; &#125; &#125; private static void swapArr(int[] arr, int i, int j) &#123; int temp = arr[i]; arr[i] = arr[j]; arr[j] = temp; &#125;&#125; è¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ç†æƒ³ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º Oï¼ˆN*Mï¼‰ è§£äºŒåŒæŒ‡é’ˆæ€æƒ³ pä¸ºnums1çš„æœ«å°¾ï¼Œqä¸ºæ–°æ’å…¥çš„ä½ç½®ã€‚ ä»åé¢å¼€å§‹éå†æ•°ç»„nums2ï¼Œé€ä¸ªæ¯”è¾ƒnums[i] ä¸ nums1[p] çš„å€¼ å¦‚æœ nums1[p] &gt; nums2[i] ï¼Œäº¤æ¢p,qæŒ‡æ ‡çš„å€¼ï¼Œä¸€ç›´å¾ªç¯åˆ°nums1[p] &lt;= nums2[i]ï¼Œå°†å¤§çš„å€¼nums2[i]æ”¾ç½®qä½ç½® 123456789101112131415161718192021222324252627public class MergeArr &#123; public void merge(int[] nums1, int m, int[] nums2, int n) &#123; assert nums1 != null &amp;&amp; nums2 != null; // ä¸ºnums1çš„æœ«å°¾æŒ‡é’ˆ int p = m - 1; // æ‰¾åˆ°æ¯”è¾ƒååº”è¯¥æ’å…¥çš„ä½ç½®ï¼Œèµ·åˆä¸ºm + n - 1 int q = m + n - 1; // ä»åé¢å¼€å§‹éå†æ•°ç»„nums2 for (int i = n - 1; i &gt;= 0; i--) &#123; // å¦‚æœnums1[p] &gt; nums2[i] while (p &gt;= 0 &amp;&amp; nums1[p] &gt; nums2[i]) &#123; // äº¤æ¢è¿™ä¸¤ä¸ªå€¼ï¼Œäº¤æ¢åpï¼Œqå¾€å‰ç§»ä¸€ä½ swapArr(nums1, p--, q--); &#125; // å¦åˆ™ï¼Œå°†å¤§çš„å€¼æ”¾ç½®qä½ç½®ï¼Œqå¾€å‰ç§»ä¸€ä½ nums1[q--] = nums2[i]; &#125; &#125; private static void swapArr(int[] arr, int i, int j) &#123; int temp = arr[i]; arr[i] = arr[j]; arr[j] = temp; &#125;&#125; æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆN+Mï¼‰ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºOï¼ˆ1ï¼‰ å‚è€ƒå‚ä¸€ç›´æ¥ä½¿ç”¨jdkæºç æ•°ç»„æ‹·è´ 123456class Solution &#123; public void merge(int[] nums1, int m, int[] nums2, int n) &#123; System.arraycopy(nums2, 0, nums1, m, n); Arrays.sort(nums1); &#125;&#125; å‚äºŒé€ä¸ªæ¯”è¾ƒï¼Œæ¯”è¾ƒå¤§çš„æ”¾ç½®åé¢ï¼Œåªæ˜¯æœ«å°¾éœ€è¦é¢å¤–çš„å¤åˆ¶ï¼Œæœ€åæƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO((n+m)log(n+m)) 123456789101112131415161718class Solution &#123; public void merge(int[] nums1, int m, int[] nums2, int n) &#123; // two get pointers for nums1 and nums2 int p1 = m - 1; int p2 = n - 1; // set pointer for nums1 int p = m + n - 1; // while there are still elements to compare while ((p1 &gt;= 0) &amp;&amp; (p2 &gt;= 0)) // compare two elements from nums1 and nums2 // and add the largest one in nums1 nums1[p--] = (nums1[p1] &lt; nums2[p2]) ? nums2[p2--] : nums1[p1--]; // add missing elements from nums2 System.arraycopy(nums2, 0, nums1, 0, p2 + 1); &#125;&#125; æœ€å¥½æ—¶é—´å¤æ‚åº¦Oï¼ˆN+Mï¼‰ githubä»£ç é“¾æ¥è§ä¸Šé¢ğŸ‘†]]></content>
      <categories>
        <category>algorithm</category>
        <category>leetcodeç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[leetcodeç³»åˆ—ï¼šç§»åŠ¨é›¶]]></title>
    <url>%2F2020%2F10%2F01%2Falgorithm%2Fleetcode-283%2F</url>
    <content type="text"><![CDATA[æè¿°Given an array nums, write a function to move all 0â€™s to the end of it while maintaining the relative order of the non-zero elements. Example: Input: [0,1,0,3,12]Output: [1,3,12,0,0] Note: You must do this in-place without making a copy of the array.Minimize the total number of operations. æ€è·¯è§£ä¸€è®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆiã€jï¼Œç”¨iæŒ‡å‘ä¸º0çš„æ•°å­—ï¼Œç”¨jæŒ‡å‘ä¸ä¸º0çš„æ•°å­—ã€‚åªæœ‰å½“j&gt;içš„æ—¶å€™ï¼Œæ‰éœ€è¦äº¤æ¢nums[i],nums[j]ã€‚é‚£ä¹ˆå…ˆéå†ä¸€éæ•°ç»„ï¼Œç”¨iæ¥è¡¨ç¤ºï¼Œå¦‚æœnums[i]ä¸ä¸º0ï¼Œè·³è¿‡ï¼›å¦‚æœä¸º0ï¼Œæ‰æœ‰å¯èƒ½äº¤æ¢ã€‚ç„¶åå°†ièµ‹å€¼ç»™jï¼Œæ‰¾åˆ°iä¹‹åçš„ä¸º0çš„ä¸‹æ ‡ï¼Œäº¤æ¢nums[i],nums[j]ã€‚æ³¨æ„iã€jä¸èƒ½è¶Šç•Œã€‚ 1234567891011121314public static void moveZeroes1(int[] nums) &#123; int j = 0; for (int i = 0; i &lt; nums.length; i++) &#123; if (nums[i] == 0) &#123; j = i; while (j &lt; nums.length &amp;&amp; nums[j] == 0) &#123; j++; &#125; if (j &lt; nums.length) &#123; swap(nums, i, j); &#125; &#125; &#125;&#125; è¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ç†æƒ³ï¼Œæœ€åæƒ…å†µä¸‹æ˜¯ Oï¼ˆN^2ï¼‰ è§£äºŒå‚è€ƒå†’æ³¡çš„æ€æƒ³ï¼Œä¸¤ä¸ªä¹‹é—´é€ä¸ªæ¯”è¾ƒï¼Œå¦‚æœæœ‰å‰é¢çš„é‚£ä¸ªä¸º0ï¼Œå°±äº¤æ¢ä½ç½®ã€‚åˆ©ç”¨å…¶ç¨³å®šæ€§ï¼Œå¯ä»¥ä¿è¯ä¸ä¸º0å…ƒç´ çš„é¡ºåºã€‚ 123456789public static void moveZeroes2(int[] nums) &#123; for (int i = 0; i &lt; nums.length - 1; i++) &#123; for (int j = 0; j &lt; nums.length - i - 1; j++) &#123; if (nums[j] == 0) &#123; swap(nums, j, j + 1); &#125; &#125; &#125;&#125; æŒ‰ç…§å†’æ³¡æ€æƒ³å¯ä»¥ä¼˜åŒ–ï¼Œä¼˜åŒ–åçš„æœ€å¥½æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆNï¼‰ï¼Œæœ€åè¿˜æ˜¯ Oï¼ˆN^2ï¼‰ è§£ä¸‰å¯¹è§£ä¸€çš„ä¼˜åŒ–ï¼Œé¿å…å¤šä½™çš„æ¯”è¾ƒå’ŒæŸ¥æ‰¾ã€‚åˆ©ç”¨åŒæŒ‡é’ˆçš„ä¼˜åŠ¿ï¼Œå°†æ—¶é—´å¤æ‚åº¦å‹ç¼©åˆ°Oï¼ˆNï¼‰ï¼Œæ€è·¯å¦‚ä¸‹ï¼š è®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆiã€jï¼Œç”¨iæŒ‡å‘ä¸ä¸º0çš„æ•°å­—ï¼Œç”¨jæŒ‡å‘ä¸º0çš„æ•°å­—ã€‚åªæœ‰å½“i&gt;jçš„æ—¶å€™ï¼Œæ‰éœ€è¦äº¤æ¢nums[i],nums[j]ã€‚iã€jåˆ†åˆ«ä»0å¼€å§‹ï¼Œå¦‚æœnums[i]==0,i++ï¼›å¦‚æœnums[j]!=0,j++ï¼›å¦‚æœi&gt;jå¹¶ä¸”nums[i] != 0ï¼Œäº¤æ¢i,jçš„å€¼ï¼Œå¹¶ä¸”åŒæ—¶åŠ ä¸€ï¼Œå¦åˆ™i++;æ³¨æ„è¾¹ç•Œä¸è¶…è¿‡lenã€‚ 123456789101112131415161718public static void moveZeroes3(int[] nums) &#123; int i = 0; int j = 0; while (i &lt; nums.length &amp;&amp; j &lt; nums.length) &#123; if (nums[i] == 0) &#123; i++; &#125; if (nums[j] != 0) &#123; j++; &#125; if (i &gt; j &amp;&amp; i &lt; nums.length &amp;&amp; nums[i] != 0) &#123; swap(nums, i++, j++); &#125; else &#123; i++; &#125; &#125;&#125; è¯¥ç¨‹åºæ³¨æ„æ­»å¾ªç¯é—®é¢˜ï¼Œä¸ºäº†é¿å…æ­»å¾ªç¯ï¼Œæ‰éœ€è¦i++ã€‚è¯¥ç¨‹åºæœ€åè¦èµ°2Néƒ¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚å¦å¤–æˆ‘ä»¬swapä¹Ÿèƒ½è¿›è¡Œä¼˜åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“nums[j] = 0 nums[j] = nums[i];nums[i] = 0; å‚è€ƒå‚ä¸€ç»Ÿè®¡å‡ºä¸ä¸º0çš„ä¸ªæ•°ï¼Œå°†ä¸ä¸º0çš„èµ‹å€¼ç»™æ•°ç»„å‰å‡ ä½ï¼Œåç»­çš„ç”¨0è¡¥å…… 12345678910111213// å‚è€ƒpublic static void moveZeroes4(int[] nums) &#123; int tmp = 0; for (int i = 0; i &lt; nums.length; i++) &#123; if (nums[i] != 0) &#123; nums[tmp++] = nums[i]; &#125; &#125; for (int i = tmp; i &lt; nums.length; i++) &#123; nums[i] = 0; &#125;&#125; æ—¶é—´å¤æ‚åº¦Oï¼ˆNï¼‰ å‚äºŒå¿«æ…¢æŒ‡é’ˆæ€æƒ³ï¼Œjæ˜¯æ…¢æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸º0çš„å…ƒç´ ï¼Œiæ˜¯å¿«æŒ‡é’ˆä¸ºä¸ä¸º0å…ƒç´ ã€‚å¿«æŒ‡é’ˆå°†æ‰€æœ‰ä¸ä¸º0çš„å…ƒç´ ï¼Œèµ‹å€¼ç»™å‰é¢ä¸º0çš„å…ƒç´ ï¼Œç›´åˆ°å…¨ä¸º0ã€‚ 123456789101112public static void moveZeroes5(int[] nums) &#123; int j = 0; for (int i = 0; i &lt; nums.length; i++) &#123; if (nums[i] != 0) &#123; nums[j] = nums[i]; if (i != j) &#123; nums[i] = 0; &#125; j++; &#125; &#125;&#125; æ—¶é—´å¤æ‚åº¦Oï¼ˆNï¼‰ githubä»£ç åœ°å€å¯¹åº”çš„æ˜¯æäº¤è®°å½•ï¼Œæ–¹ä¾¿å‚çœ‹å½“æ—¶è¸©è¿‡çš„å‘ã€‚]]></content>
      <categories>
        <category>algorithm</category>
        <category>leetcodeç³»åˆ—</category>
      </categories>
      <tags>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¯¦è§£ClassåŠ è½½è¿‡ç¨‹]]></title>
    <url>%2F2020%2F07%2F11%2Fjvm%2Fclassloader%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹åœ¨æ¢æ¢å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†classæ–‡ä»¶ä½œä¸ºä¸€ä¸ªäºŒè¿›åˆ¶å­—èŠ‚æµï¼Œæ˜¯å¦‚ä½•é€šè¿‡äºŒè¿›åˆ¶çš„æ–¹å¼è¡¨è¾¾ç¼–ç¨‹æ€æƒ³çš„ã€‚é‚£ä¹ˆï¼Œclassæ–‡ä»¶æ˜¯ç”±ç¼–è¯‘å™¨ç¼–è¯‘å¾—åˆ°çš„ï¼Œé»˜é»˜çš„æ”¾åœ¨ç¡¬ç›˜é‡Œé¢ï¼Œå½“æˆ‘ä»¬éœ€è¦è¿è¡Œç¨‹åºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»å°†classæ–‡ä»¶åŠ è½½è¿›å†…å­˜ä¸­ã€‚é‚£ä¹ˆï¼Œclassæ–‡ä»¶éœ€è¦ç»è¿‡ä¸€ä¸ªä»€ä¹ˆæ ·çš„è¿‡ç¨‹æ‰èƒ½åˆ°å†…å­˜é‡Œå‡†å¤‡å¥½å‘¢ï¼Ÿ æœ¬ç¯‡æ–‡ç« ï¼šæˆ‘ä»¬å°†è®¨è®ºclassæ–‡ä»¶ä½œä¸ºä¸€ä¸ªäºŒè¿›åˆ¶å­—èŠ‚æµæ–‡ä»¶ï¼ŒJVMè™šæ‹Ÿæœºæ˜¯å¦‚ä½•å¯¹è¿™ä¸ªæ–‡ä»¶åŠ è½½å¹¶ä¸”å‡†å¤‡ã€æ‰§è¡Œçš„ã€‚ classåŠ è½½è¿›å†…å­˜ï¼Œå‡†å¤‡ã€æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ€»å…±åˆ†ä¸‰å¤§æ­¥ã€‚ç¬¬ä¸€æ­¥æ˜¯Loadingï¼Œç¬¬äºŒæ­¥æ˜¯Linkingï¼Œç¬¬ä¸‰æ­¥æ˜¯Intializingã€‚å…¶ä¸­Linkingåˆåˆ†æˆä¸‰å°æ­¥ï¼Œç¬¬ä¸€å°æ­¥æ˜¯Verification (éªŒè¯)ï¼Œç¬¬äºŒå°æ­¥æ˜¯Preparation (å‡†å¤‡)ï¼Œç¬¬ä¸‰å°æ­¥æ˜¯Resolution (è§£æ)ã€‚ Loadingç±»åŠ è½½å™¨Loadingæ˜¯æŠŠä¸€ä¸ªclassæ–‡ä»¶loadè£…è¿›å†…å­˜çš„ï¼Œåœ¨JVMä¸­æœ‰ä¸€å¥—è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨çš„å±‚æ¬¡ï¼Œjvmæ‰€æœ‰çš„classéƒ½æ˜¯è¢«ç±»åŠ è½½å™¨åŠ è½½åˆ°å†…å­˜çš„ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨ä¹Ÿå«åšClassLoaderã€‚æ¯ä¸ªç±»åŠ è½½å™¨æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„classæ–‡ä»¶ï¼Œæœ€ç»ˆç”±æœ€é«˜å±‚æ¬¡çš„åŠ è½½å™¨åŠ è½½è¿›JVMä¸­ã€‚ å¦‚æœï¼Œæˆ‘æƒ³çŸ¥é“ç±»æ˜¯ç”±å“ªä¸ªåŠ è½½å™¨åŠ è½½è¿›å†…å­˜é‡Œçš„ï¼Œæˆ‘ä»¬åªéœ€æ‰“å°ä¸€ä¸‹è¿™ä¸ªåŠ è½½å™¨ï¼Œå¦‚ä¸‹é¢ä»£ç ï¼š 123456789101112131415161718192021222324252627282930public class ClassLoaderT02 &#123; // Launcher$AppClassLoaderç±»å’ŒLauncher$ExtClassLoaderéƒ½æ˜¯åœ¨rt.jaræ–‡ä»¶ä¸‹ï¼Œè¢«BoostrapåŠ è½½å™¨åŠ è½½ public static void main(String[] args) &#123; // BoostrapåŠ è½½å™¨ä¸»è¦åŠ è½½jre/lib/rt.jaråŒ…ä¸‹çš„ç±» System.out.println(System.class.getClassLoader()); System.out.println(java.lang.Object.class.getClassLoader()); // Translator å±äºjre/lib/ext/*.jarç›®å½•ä¸‹ System.out.println(Translator.class.getClassLoader()); System.out.println(Translator.class.getClassLoader().getClass().getClassLoader()); System.out.println(ClassLoaderT02.class.getClassLoader()); System.out.println(ClassLoaderT02.class.getClassLoader().getParent()); System.out.println(ClassLoaderT02.class.getClassLoader().getParent().getParent()); System.out.println(ClassLoaderT02.class.getClassLoader().getClass().getClassLoader()); &#125; /*output null null sun.misc.Launcher$ExtClassLoader@1cd072a9 null sun.misc.Launcher$AppClassLoader@18b4aac2 sun.misc.Launcher$ExtClassLoader@1cd072a9 null null */&#125; è¿™é‡Œä¸ºä»€ä¹ˆä¼šæ‰“å°ç©ºå‘¢ï¼ŸåŸå› ä¸ºï¼šBoostrapåŠ è½½ç±»ï¼Œæ˜¯ç”±C++å®ç°çš„ï¼Œjavaé‡Œæ²¡æœ‰å¯¹åº”å®ç°ï¼Œæ‰€ä»¥ä¸ºç©ºã€‚ ç”±ç¨‹åºå¯ä»¥è¯æ˜ AppClassLoaderã€ExtClassLoaderæ˜¯sun.misc.Launcherçš„å†…éƒ¨ç±»ã€‚ AppClassLoaderã€ExtClassLoaderéƒ½æ˜¯ç”±BoostrapåŠ è½½å™¨åŠ è½½çš„ã€‚ AppClassLoaderçš„çˆ¶åŠ è½½å™¨æ˜¯ExtClassLoaderï¼ŒExtClassLoaderçš„çˆ¶åŠ è½½å™¨æ˜¯BoostrapClassLoaderã€‚ Launcheræ˜¯ClassLoaderä¸€ä¸ªåŒ…è£…å¯åŠ¨ç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªç±»åŠ è½½å™¨çš„èŒƒå›´ 123456// BoostrapClassLoaderprivate static String bootClassPath = System.getProperty("sun.boot.class.path");// ExtClassLoaderString var0 = System.getProperty("java.ext.dirs");// AppClassLoaderfinal String var1 = System.getProperty("java.class.path"); æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹ 12345678910111213141516171819202122public class ClassLoaderT03 &#123; // æ£€æŸ¥jdkè‡ªå¸¦çš„ä¸‰ç§åŠ è½½å™¨åˆ†åˆ«è´Ÿè´£åŠ è½½å“ªäº›jaråŒ… public static void main(String[] args) &#123; System.out.println("====================== boostrap ClassLoder ======================")ï¼› String boostrapPath = System.getProperty("sun.boot.class.path"); // System.lineSeparator()ä¸ºç³»ç»Ÿæ¢è¡Œç¬¦ boostrapPath = boostrapPath.replaceAll(":", System.lineSeparator()); System.out.println(boostrapPath); System.out.println("====================== extention ClassLoder ======================"); String extensionPath = System.getProperty("java.ext.dirs"); extensionPath = extensionPath.replaceAll(":", System.lineSeparator()); System.out.println(extensionPath); System.out.println("====================== application ClassLoder ======================"); String applicationPath = System.getProperty("java.class.path"); applicationPath = applicationPath.replaceAll(":", System.lineSeparator()); System.out.println(applicationPath); &#125;&#125; è¾“å‡ºä¸ºï¼š åŒäº²å§”æ´¾åŒäº²å§”æ´¾æ˜¯ä¸€ä¸ªå­©å­å‘çˆ¶äº²æ–¹å‘ï¼Œç„¶åçˆ¶äº²å‘å­©å­æ–¹å‘çš„åŒäº²å§”æ´¾è¿‡ç¨‹ã€‚åŒäº²å§”æ´¾ï¼Œä¸»è¦å‡ºäºå®‰å…¨æ¥è€ƒè™‘ã€‚ åŠ è½½çš„è¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š æŸ¥æ‰¾çš„åŠ è½½å™¨è·¯çº¿æ˜¯ï¼š è‡ªå®šä¹‰çš„ClassLoaderâ€”&gt; AppClassLoaderâ€”&gt;ExtClassLoaderâ€”&gt; BoostrapClassLoader é‡å¤çš„åŠ¨ä½œæ˜¯ï¼šfindInCache -&gt; parent.loadClass -&gt; findClass() å§”æ´¾çš„æ–¹å‘åˆšå¥½ç›¸åï¼š BoostrapClassLoaderâ€”&gt;ExtClassLoaderâ€”&gt;AppClassLoaderâ€”&gt;è‡ªå®šä¹‰çš„ClassLoader å…¶å®ï¼Œè¿™ä¸ªå¯ä»¥çœ‹ClassLoaderçš„æºç  12345678910111213141516171819202122232425262728293031323334353637protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException&#123; synchronized (getClassLoadingLock(name)) &#123; // First, check if the class has already been loaded Class&lt;?&gt; c = findLoadedClass(name); // findInCache if (c == null) &#123; long t0 = System.nanoTime(); try &#123; if (parent != null) &#123; c = parent.loadClass(name, false); // parent.loadClass &#125; else &#123; c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. long t1 = System.nanoTime(); c = findClass(name); // findClass // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; if (resolve) &#123; resolveClass(c); &#125; return c; &#125;&#125; ä»»ä½•ä¸€ä¸ªclassï¼Œéƒ½ä¼šå…ˆä»è‡ªå®šä¹‰çš„classLoaderå¼€å§‹ï¼Œå› ä¸ºå†…éƒ¨ç»´æŠ¤äº†ç¼“å­˜ï¼Œå…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨ï¼Œçˆ¶åŠ è½½å™¨ä¹Ÿæ˜¯é‡å¤åŒæ ·çš„åŠ¨ä½œï¼Œç›´åˆ°æœ€é¡¶å±‚çš„BoostrapClassLoaderã€‚å¦‚æœçˆ¶åŠ è½½å™¨ç¼“å­˜æ²¡æœ‰ï¼Œclassæ–‡ä»¶ä¹Ÿä¸åœ¨è‡ªå·±è´Ÿè´£çš„æ–‡ä»¶èŒƒå›´å†…ï¼Œå°±é‡æ–°å§”æ‰˜ç»™å½“å‰åŠ è½½å™¨ã€‚ 123protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; throw new ClassNotFoundException(name);&#125; å½“å‰åŠ è½½å™¨ä¼šä»è‡ªå·±è´Ÿè´£åŠ è½½çš„æ–‡ä»¶å¤¹æŸ¥æ‰¾ï¼Œå¦‚æœæœ‰ï¼Œå°±åŠ è½½ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±æŠ›å‡ºClassNotFoundExceptionã€‚ æ•´ä¸ªåŠ è½½è¿‡ç¨‹å¦‚å›¾ é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆç±»çš„åŠ è½½æœºåˆ¶è¦æä¸€å¥—åŒäº²å§”æ´¾æ¨¡å‹å‡ºæ¥å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥å‡è®¾ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªclasså¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„ClassLoaderè®°è½½è¿›å†…å­˜é‡Œï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠjava.lang.Stringäº¤ç»™è‡ªå®šä¹‰çš„åŠ è½½å™¨åŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ‰‹è„šï¼Œé€šè¿‡å°†ç¨‹åºæ‰“åŒ…ç»™å®¢æˆ·ï¼Œç”¨æˆ·ä½¿ç”¨åå¯ä»¥æŠŠå¯†ç å‘ç»™æˆ‘è‡ªå·±ã€‚ å¦‚æœæœ‰äº†åŒäº²å§”æ´¾ï¼Œå°±ä¼šå…ˆå»ä¸Šé¢æŸ¥æœ‰æ²¡æœ‰åŠ è½½è¿‡ï¼Œä¸Šé¢æœ‰åŠ è½½è¿‡å°±ç›´æ¥è¿”å›ï¼Œä¸ä¼šè®©è‡ªå®šä¹‰åŠ è½½å™¨åŠ è½½ã€‚ è‡ªå®šä¹‰åŠ è½½å™¨é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“çš„çŸ¥é“è‡ªå®šä¹‰åŠ è½½å™¨åªéœ€è¦ ç»§æ‰¿ClassLoaderçˆ¶ç±» é‡å†™æ¨¡ç‰ˆæ–¹æ³•findClass è°ƒç”¨defineClass ä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243public class T006_MSBClassLoader extends ClassLoader &#123; @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123;// File f = new File("c:/test/", name.replace(".", "/").concat(".class")); File f = new File("/Users/alongso_pro/Desktop/class/Hello.class"); try &#123; FileInputStream fis = new FileInputStream(f); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int b = 0; while ((b=fis.read()) !=0) &#123; baos.write(b); &#125; byte[] bytes = baos.toByteArray(); baos.close(); fis.close();//å¯ä»¥å†™çš„æ›´åŠ ä¸¥è°¨ return defineClass(name, bytes, 0, bytes.length); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return super.findClass(name); //throws ClassNotFoundException &#125; public static void main(String[] args) throws Exception &#123; ClassLoader l = new T006_MSBClassLoader(); Class clazz = l.loadClass("com.mashibing.jvm.Hello"); Class clazz1 = l.loadClass("com.mashibing.jvm.Hello"); System.out.println(clazz == clazz1);//// Hello h = (Hello)clazz.newInstance();// h.m();// System.out.println(h.getClass().getClassLoader());// System.out.println(h.getClass().getClassLoader().getParent()); System.out.println(getSystemClassLoader()); &#125;&#125; LinkingVerificationéªŒè¯æ–‡ä»¶æ˜¯å¦ç¬¦åˆJVMè§„å®šã€‚å¦‚æœåŠ è½½è¿›æ¥çš„æ–‡ä»¶é¦–4ä¸ªå­—èŠ‚ä¸æ˜¯CAFE BABEå¼€å¤´ï¼Œåœ¨è¿™ä¸ªæ­¥éª¤å°±è¢«æ‹’ç»æ‰äº†ã€‚ PreparationæŠŠclassæ–‡ä»¶ä¸­çš„é™æ€æˆå‘˜å˜é‡èµ‹é»˜è®¤å€¼ï¼Œä¸æ˜¯åˆå§‹å€¼ã€‚æ¯”å¦‚static int i=8ï¼Œæ³¨æ„åœ¨è¿™ä¸ªæ­¥éª¤å¹¶ä¸æ˜¯ç›´æ¥æŠŠièµ‹æˆ8ï¼Œè€Œæ˜¯å…ˆèµ‹å€¼æˆ0ã€‚ Resolutionå°†ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨ã€‚classæ–‡ä»¶å¸¸é‡æ± é‡Œé¢ç”¨åˆ°çš„ç¬¦å·å¼•ç”¨ï¼Œè¦ç»™å®ƒè½¬æ¢ä¸ºç›´æ¥å†…å­˜åœ°å€ï¼Œç›´æ¥å¯ä»¥è®¿é—®åˆ°çš„å†…å®¹ã€‚ Initializingè°ƒç”¨ç±»åˆå§‹åŒ–ä»£ç  &lt;clinit&gt;ï¼Œç»™é™æ€æˆå‘˜å˜é‡èµ‹åˆå§‹å€¼ã€‚ LazyLoadingæ‡’åŠ è½½ï¼Œä¸¥æ ¼ä¸Šå«åšæ‡’åˆå§‹åŒ–ï¼Œä¹Ÿå«å»¶è¿Ÿåˆå§‹åŒ–ã€‚jvmè§„èŒƒæ²¡æœ‰ä¸¥æ ¼å®šä¹‰ä½•æ—¶åŠ è½½ï¼Œä½†è™šæ‹Ÿæœºçš„å®ç°æ˜¯æ‡’åŠ è½½ï¼Œå°±æ˜¯æˆ‘ä»€ä¹ˆæ—¶å€™éœ€è¦è¿™ä¸ªç±»çš„æ—¶å€™æ‰ä¼šå»åŠ è½½è¿™ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯æˆ‘ç”¨åˆ°jaråŒ…é‡Œçš„ä¸€ä¸ªç±»ï¼Œå°±å°†jaråŒ…æ‰€æœ‰çš„ç±»éƒ½åŠ è½½è¿›æ¥ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ 12345678910111213141516171819public class ClassLoadingProcedureT00 &#123; public static void main(String[] args) &#123; // å½“å¼•ç”¨é™æ€å˜é‡æ—¶ï¼Œå¯¹Tåˆå§‹åŒ– System.out.println(T.count); &#125;&#125;// åˆå§‹åŒ–æ—¶ï¼Œå…ˆå¯¹staticå˜é‡èµ‹é»˜è®¤å€¼ï¼Œå†æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œç½®åˆå§‹å€¼ã€‚class T &#123; //public static T t = new T(); public static int count = 2; private int m = 8; private T() &#123; count++; System.out.println("T Construct !!,count=" + count); &#125;&#125; è¯¥ç¨‹åºè¾“å‡ºçš„ç»“æœä¸º 1/*output 2 */ ç”±è¯¥ç¨‹åºå¯å¾— å¼•ç”¨é™æ€å˜é‡æ—¶ï¼Œä¼šå¯¹Tåˆå§‹åŒ–ï¼Œèµ‹åˆå§‹å€¼ã€‚ æ³¨æ„ï¼šåˆå§‹åŒ–æŒ‡çš„æ˜¯æ˜¯å¦ä¼šè°ƒç”¨ç±»åˆå§‹åŒ–ä»£ç &lt;clinit&gt;ï¼Œç»™é™æ€æˆå‘˜å˜é‡èµ‹åˆå§‹å€¼ï¼Œä¸è¦å’Œå®ä¾‹æ„é€ å‡½æ•°&lt;init&gt;æ··æ·†äº†ã€‚ æ€è€ƒï¼šå¦‚æœæŠŠ11è¡Œæ”¾å¼€ï¼Œä¼šè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæŠŠ12è¡Œæ”¾åœ¨11è¡Œå‰é¢ï¼Œåˆä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ åˆå§‹åŒ–çš„äº”ç§æƒ…å†µåœ¨å‘¨è€å¸ˆçš„ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹æ˜ç¡®æŒ‡å‡ºï¼Œæ‡’åˆå§‹åŒ– åœ¨ä¸‹é¢äº”ç§æƒ…å†µä¸‹æ‰èƒ½è§¦å‘ï¼š new getstatic putstatic invokestaticæŒ‡ä»¤ï¼Œè®¿é—®finalå˜é‡é™¤å¤–ã€‚ java.lang.reflectå¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨æ—¶ã€‚ åˆå§‹åŒ–å­ç±»çš„æ—¶å€™ï¼Œçˆ¶ç±»é¦–å…ˆåˆå§‹åŒ–ã€‚ è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œè¢«æ‰§è¡Œçš„ä¸»ç±»å¿…é¡»åˆå§‹åŒ–ã€‚ åŠ¨æ€è¯­è¨€æ”¯æŒjava.lang.invoke.MethodHandleè§£æçš„ç»“æœä¸ºREF_getstatic REF_putstatic REF_invokestaticçš„æ–¹æ³•å¥æŸ„æ—¶ï¼Œè¯¥ç±»å¿…é¡»åˆå§‹åŒ–ã€‚ æ€è€ƒï¼šæˆ‘ä»¬å¯ä»¥é€æ­¥æ³¨é‡Šä»¥ä¸‹ä»£ç ï¼Œçœ‹çœ‹ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ 12345678910111213141516171819202122232425262728293031public class T008_LazyLoading &#123; public static void main(String[] args) throws Exception &#123;// P p; X x = new X();// System.out.println(P.i); //å¸¸é‡æ”¾åœ¨mataspace// System.out.println(X.j); //åˆå§‹åŒ– new getstatic putstatic invokestatic// Class clazz=Class.forName("com.selfstudy.jvm.classloader.T008_LazyLoading$X");// clazz.newInstance(); &#125; public static class P &#123; final static int i = 8; static int j = 9; static &#123; System.out.println("P static"); &#125; P() &#123; System.out.println("P construct!"); &#125; &#125; public static class X extends P &#123; static &#123; System.out.println("X static"); &#125; X() &#123; System.out.println("X Construct!"); &#125; &#125;&#125; æ€»ç»“ classloadingæ˜¯ä½¿ç”¨åŒäº²å§”æ´¾æœºåˆ¶ï¼Œä»ä¸Šåˆ°ä¸‹å†ä»ä¸‹åˆ°ä¸Šï¼Œä»ä¸Šæ‰¾ï¼Œå‘ä¸‹å§”æ‰˜ã€‚ä¸»è¦å‡ºäºå®‰å…¨è€ƒè™‘ã€‚ LazyLoadingäº”ç§æƒ…å†µåœ¨ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹é‡Œæœ‰è¯¦ç»†çš„åˆ—å‡ºæ¥ã€‚ ClassLoaerçš„æºç ï¼šfindInCache -&gt; parent.loadClass -&gt;findClass()ã€‚ è‡ªå®šä¹‰åŠ è½½å™¨ extends ClassLoader overwrite findclass()â€”&gt;defineClass(bytes[])]]></content>
      <categories>
        <category>jvm</category>
      </categories>
      <tags>
        <tag>class</tag>
        <tag>classloder</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¢æ¢å­—èŠ‚ç æ–‡ä»¶]]></title>
    <url>%2F2020%2F07%2F03%2Fjvm%2Fclassfile-format%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹javaè¯­è¨€èƒ½å¤Ÿå®ç°è·¨å¹³å°ï¼Œå®Œå…¨ä¾èµ–äºå­—èŠ‚ç æ–‡ä»¶å’Œ JVMè™šæ‹Ÿæœºï¼Œå…¶å­—èŠ‚ç æ–‡ä»¶æ˜¯ä¸€æ®µä»£ç ä»ç¼–å†™åˆ°æ‰§è¡Œçš„ä¸­é—´äº§ç‰©ï¼Œä½†æ˜¯å¯¹äºç¼–å†™javaè¯­è¨€çš„æˆ‘ä»¬æ¥è¯´ï¼Œå¯ä»¥ä¸ç”¨å»å…³å¿ƒå®ç°ç»†èŠ‚çš„ã€‚å­—èŠ‚ç æ–‡ä»¶è§„èŒƒå…¶å®ä¹Ÿæ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œæ‰€æœ‰çš„è·¨å¹³å°è¯­è¨€éƒ½æ˜¯åŸºäºclassæ–‡ä»¶è¿›è¡Œè·¨å¹³å°ï¼Œæ‰€ä»¥ï¼Œè¿™ä¹Ÿæ˜¯æ‰©å±•çš„ä¸€ä¸ªçŸ¥è¯†é¢ã€‚ æœ¬ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†è®¨è®ºclassæ–‡ä»¶ä½œä¸ºä¸€ä¸ªäºŒè¿›åˆ¶å­—èŠ‚æµï¼Œclassæ–‡ä»¶æ˜¯å¦‚ä½•è¡¨è¾¾æºä»£ç çš„æ€æƒ³çš„ã€‚ ç»ƒä¹ æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥å­¦ä¹ ä¸€ä¸‹å­—èŠ‚ç æ–‡ä»¶ 12345package com.mashibing.jvm.c1_bytecode;public class T0100_ByteCode01 &#123;&#125; è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç±»ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œä½†æ˜¯å½“åç¼–è¯‘åï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ªæ„é€ æ–¹æ³• 123456package com.mashibing.jvm.c1_bytecode;public class T0100_ByteCode01 &#123; public T0100_ByteCode01() &#123; &#125;&#125; ç”¨javacå‘½ä»¤ç¼–è¯‘åˆ°çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸º 123456789101112131415161718192021cafe babe 0000 0034 0010 0a00 0300 0d07000e 0700 0f01 0006 3c69 6e69 743e 01000328 2956 0100 0443 6f64 6501 000f 4c696e65 4e75 6d62 6572 5461 626c 6501 00124c6f 6361 6c56 6172 6961 626c 6554 61626c65 0100 0474 6869 7301 0030 4c63 6f6d2f6d 6173 6869 6269 6e67 2f6a 766d 2f63315f 6279 7465 636f 6465 2f54 3031 30305f42 7974 6543 6f64 6530 313b 0100 0a536f75 7263 6546 696c 6501 0015 5430 3130305f 4279 7465 436f 6465 3031 2e6a 6176610c 0004 0005 0100 2e63 6f6d 2f6d 61736869 6269 6e67 2f6a 766d 2f63 315f 62797465 636f 6465 2f54 3031 3030 5f42 79746543 6f64 6530 3101 0010 6a61 7661 2f6c616e 672f 4f62 6a65 6374 0021 0002 00030000 0000 0001 0001 0004 0005 0001 00060000 002f 0001 0001 0000 0005 2ab7 0001b100 0000 0200 0700 0000 0600 0100 00000300 0800 0000 0c00 0100 0000 0500 09000a00 0000 0100 0b00 0000 0200 0c ç»“æ„æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹å­—èŠ‚ç æ–‡ä»¶ é­”æ•°ä»æ·±å…¥ç†è§£è®¡ç®—æœºä¸­æˆ‘ä»¬çŸ¥é“æ‰€æœ‰çš„æ–‡ä»¶ï¼ˆä¸ç®¡æ˜¯æ•°æ®è¿˜æ˜¯ç¨‹åºï¼‰ï¼Œåœ¨è®¡ç®—æœºé‡Œéƒ½æ˜¯ä»¥äºŒè¿›åˆ¶çš„æ ¼å¼è¿›è¡Œä¿å­˜çš„ã€‚é‚£ä¹ˆå¦‚ä½•åŒºåˆ†æ–‡ä»¶çš„æ ¼å¼å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€pngã€jpgç±»å‹å›¾ç‰‡ï¼Œå¯ä»¥å‘ç°å‰å››ä½ 12-- pngæ ¼å¼ 8950 4E47-- jpgæ ¼å¼ FFDB FFE0 åŒæ ·æ ¼å¼çš„æ–‡ä»¶å‰å››ä½éƒ½æ˜¯ä¸€æ ·çš„ã€‚åœ¨javaè¯­è¨€è§„èŒƒä¸­ï¼Œæ ‡è¯†ä¸ºclassæ–‡ä»¶çš„å‰å››ä½ä¸ºcafe babeï¼Œè¿™ä¸ªå°±å«åšé­”æ•°,å å››ä½å­—èŠ‚ã€‚ ç‰ˆæœ¬å·ä¸åŒçš„æºç ï¼Œåœ¨ä¸åŒç‰ˆæœ¬çš„jdkä¸Šç¼–è¯‘ï¼Œå¾—åˆ°çš„å­—èŠ‚ç ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™æ˜¯é€šè¿‡ç‰ˆæœ¬å·æ¥åŒºåˆ†çš„ã€‚ç‰ˆæœ¬å·å››ä¸ªå­—èŠ‚ï¼Œå‰é¢ä¸ºå‰¯ç‰ˆæœ¬å·ï¼Œæ¥ç€æ˜¯ä¸»ç‰ˆæœ¬å·ã€‚ å› æ­¤å‰¯ç‰ˆæœ¬å·ä¸º0x0000,ä¸»ç‰ˆæœ¬å·ä¸ºox0034,åè¿›åˆ¶ç»„åˆä¸º52.0ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯jdk1.8.0ã€‚ å¸¸é‡æ± å¸¸é‡æ± æ˜¯å­—èŠ‚ç è®¾è®¡æœ€å¤æ‚çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒçš„é•¿åº¦ä¸å›ºå®šï¼Œä¸åŒç±»å‹çš„å¸¸é‡ç»“æ„ä¹Ÿä¸ä¸€æ ·ã€‚å¦‚ä¸‹è¡¨ï¼š æ³¨ï¼šæ­¤è¡¨æ ¼çš„ç±»å‹çš„å•ä½ä¸å¯¹ï¼Œä¸æ˜¯bitï¼Œåº”è¯¥æ˜¯byte(å­—èŠ‚)ã€‚åé¢çš„åŒç†ã€‚ å¸¸é‡æ± è®¡æ•°å™¨è®°å½•å¸¸é‡æ± çš„é•¿åº¦ï¼Œå ä¸¤ä¸ªå­—èŠ‚ã€‚0x0010è¡¨ç¤ºå¸¸é‡æ± çš„é•¿åº¦ä¸º16ã€‚æ³¨æ„ï¼Œä¸‹æ ‡æ˜¯ä»1å¼€å§‹çš„ï¼Œä¸º0çš„ä¸‹æ ‡ä¸æŒ‡å‘å†…éƒ¨å¼•ç”¨ï¼Œæ˜¯ä¸ºåˆ«çš„å¼•ç”¨é¢„å¤‡çš„ã€‚ å¸¸é‡æ± ç±»å‹å’Œç»“æ„12345670a00 0300 0d07 000e 0700 0f01 0006 3c69 6e69 743e 0100 0328 2956 0100 0443 6f64 6501 000f 4c696e65 4e75 6d62 6572 5461 626c 6501 0012 4c6f 6361 6c56 6172 6961 626c 6554 6162 6c65 0100 0474 6869 7301 0030 4c63 6f6d 2f6d 6173 6869 6269 6e67 2f6a 766d 2f63 315f 6279 7465 636f 6465 2f54 3031 3030 5f42 7974 6543 6f64 6530 313b 0100 0a53 6f75 7263 6546 696c 6501 0015 5430 3130 305f 4279 7465 436f 6465 3031 2e6a 6176 610c 0004 0005 0100 2e63 6f6d 2f6d 61736869 6269 6e67 2f6a 766d 2f63 315f 6279 7465 636f 6465 2f54 3031 3030 5f42 7974 6543 6f64 6530 3101 0010 6a61 7661 2f6c 616e 672f 4f62 6a65 6374 è¿™éƒ¨åˆ†äºŒè¿›åˆ¶æè¿°çš„å…¨éƒ¨æ˜¯å¸¸é‡æ± çš„ä¿¡æ¯ï¼Œå¯ä»¥å¯¹é€ ä¸Šé¢è¡¨æ ¼ä¸€ä¸€æŸ¥æ‰¾ã€‚ æ¯”å¦‚ 0x0a00 0300 0dæŸ¥æ‰¾ç»“æ„ä¸º0a | 0003 | 000dï¼Œå³å¯¹åº”10ï¼ŒCONSTANT_Methodref_infoç±»å‹ï¼Œæ¥ç€æ˜¯æ–¹æ³•çš„ä¸¤ä¸ªæŒ‡é’ˆç´¢å¼•ï¼ŒæŒ‡å‘ä¸‹æ ‡ä¸º3å’Œ13çš„å¸¸é‡æ± ã€‚ è¿™ä¸€ä¸€æŸ¥æ‰¾æŒºéº»çƒ¦çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åªè¦ç”¨ 1javap -verbose T0100_ByteCode01.class å¸¸é‡æ± ç±»å‹å’Œç»“æ„å°±å…¨éƒ½å‡ºæ¥äº† 12345678910111213141516Constant pool: #1 = Methodref #3.#13 // java/lang/Object."&lt;init&gt;":()V #2 = Class #14 // com/mashibing/jvm/c1_bytecode/T0100_ByteCode01 #3 = Class #15 // java/lang/Object #4 = Utf8 &lt;init&gt; #5 = Utf8 ()V #6 = Utf8 Code #7 = Utf8 LineNumberTable #8 = Utf8 LocalVariableTable #9 = Utf8 this #10 = Utf8 Lcom/mashibing/jvm/c1_bytecode/T0100_ByteCode01; #11 = Utf8 SourceFile #12 = Utf8 T0100_ByteCode01.java #13 = NameAndType #4:#5 // "&lt;init&gt;":()V #14 = Utf8 com/mashibing/jvm/c1_bytecode/T0100_ByteCode01 #15 = Utf8 java/lang/Object è®¿é—®æ ‡å¿—å¸¸é‡æ± åé¢å°±æ˜¯è®¿é—®æ ‡å¿—ï¼Œç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œå…¶æ ‡è¯†äº†ç±»æˆ–è€…æ¥å£çš„è®¿é—®ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šè¯¥Classæ–‡ä»¶æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œæ˜¯å¦è¢«å®šä¹‰æˆpublicï¼Œæ˜¯å¦æ˜¯abstractï¼Œå¦‚æœæ˜¯ç±»ï¼Œæ˜¯å¦è¢«å£°æ˜æˆfinalç­‰ç­‰ã€‚å„ç§è®¿é—®æ ‡å¿—å¦‚ä¸‹æ‰€ç¤ºï¼š ç”±äºæ‰€æœ‰ç±»éƒ½ä¼šç»§æ‰¿Objectç±»ï¼Œæ‰€ä»¥è®¿é—®æ ‡è¯†ox0020éƒ½æ˜¯æ»¡è¶³çš„ï¼Œå› æ­¤è®¿é—®æ ‡å¿—ä¸º0x0021 å½“å‰ç±»åä¸¤ä¸ªå­—èŠ‚ï¼Œç±»ç´¢å¼•çš„å€¼ä¸ºox0002ï¼ŒæŒ‡å‘å¸¸é‡æ± ç¬¬äºŒé¡¹çš„ç´¢å¼•ã€‚ 1#2 = Class #14 // com/mashibing/jvm/c1_bytecode/T0100_ByteCode01 è¿™é‡Œæ˜¯é€šè¿‡ç±»ç´¢å¼•æˆ‘ä»¬å¯ä»¥ç¡®å®šç±»çš„å…¨é™å®šåã€‚ çˆ¶ç±»åè·Ÿå½“å‰ç±»åä¸€æ ·ï¼Œä¸¤ä¸ªå­—èŠ‚ï¼Œç±»ç´¢å¼•çš„å€¼ä¸ºox0003ï¼ŒæŒ‡å‘å¸¸é‡æ± ç¬¬ä¸‰é¡¹çš„ç´¢å¼•ã€‚ 1#3 = Class #15 // java/lang/Object ä»å­—èŠ‚ç çš„è®¾è®¡æ¥çœ‹ï¼Œè¿™é‡Œåªæœ‰ä¸¤ä¸ªå­—èŠ‚å­˜çˆ¶ç±»åçš„ç´¢å¼•ï¼Œå› æ­¤ï¼Œè¿™é‡Œåªèƒ½æŒ‡å‘ä¸€ä¸ªç±»ã€‚å³ä»è®¾è®¡ä¸Šçœ‹å‡ºï¼Œjavaè¯­è¨€ç±»åªèƒ½ä»ä¸€ä¸ªç±»ç»§æ‰¿ï¼Œä½†å¤šä¸ªç±»å¯ä»¥å¤šé‡ç»§æ‰¿ã€‚ æ¥å£æ¥å£è®¡æ•°å™¨ä¸¤ä¸ªå­—èŠ‚ï¼Œè®°å½•äº†å®ç°æ¥å£çš„ä¸ªæ•°ã€‚è¿™é‡Œä¸º0x0000,å³æ²¡æœ‰å®ç°æ¥å£ï¼Œå› æ­¤ï¼Œæ¥å£ç´¢å¼•å°±ä¸å å­—èŠ‚ã€‚ æ¥å£ç´¢å¼•ä¸€ä¸ªæ¥å£ï¼Œä¸¤ä¸ªå­—èŠ‚ã€‚é€šè¿‡ç±»ç´¢å¼•æ‰¾åˆ°å®ç°çš„æ¥å£å…¨é™å®šåã€‚ å­—æ®µè¡¨å­—æ®µè®¡æ•°å™¨ä¸¤ä¸ªå­—èŠ‚ï¼Œè®°å½•äº†å­—æ®µçš„ä¸ªæ•°ã€‚ç”±äºæ²¡æœ‰ï¼Œæ•…å­—èŠ‚ç åˆ°ox0000å°±æ²¡äº†ã€‚ å­—æ®µè¡¨ç»“æ„å­—æ®µè¡¨ä½œä¸ºä¸€ä¸ªè¡¨ï¼ŒåŒæ ·æœ‰ä»–è‡ªå·±çš„ç»“æ„ æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå­—æ®µå¯ä»¥è¢«å„ç§å…³é”®å­—å»ä¿®é¥°ï¼Œæ¯”å¦‚ï¼šä½œç”¨åŸŸä¿®é¥°ç¬¦ï¼ˆpublicã€privateã€protectedï¼‰ã€staticä¿®é¥°ç¬¦ã€finalä¿®é¥°ç¬¦ã€volatileä¿®é¥°ç¬¦ç­‰ç­‰ã€‚å› æ­¤ï¼Œå…¶å¯åƒç±»çš„è®¿é—®æ ‡å¿—é‚£æ ·ï¼Œä½¿ç”¨ä¸€äº›æ ‡å¿—æ¥æ ‡è®°å­—æ®µã€‚å­—æ®µçš„è®¿é—®æ ‡å¿—æœ‰å¦‚ä¸‹è¿™äº›ï¼š æ–¹æ³•è¡¨æ–¹æ³•è®¡æ•°å™¨ä¸¤ä¸ªå­—èŠ‚ï¼Œè®°å½•äº†æ–¹æ³•çš„ä¸ªæ•°ã€‚è¿™é‡Œä¸º0x0001ï¼Œç”±äºè¯¥ç±»æ²¡æœ‰è‡ªå®šä¹‰æ„é€ æ–¹æ³•ï¼Œç¼–è¯‘åä¼šç”Ÿæˆä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå½“åˆå§‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨Objectçš„æ„é€ æ–¹æ³•ã€‚ æ–¹æ³•è¡¨ç»“æ„æ–¹æ³•è¡¨çš„ç»“æ„å®é™…è·Ÿå­—æ®µè¡¨æ˜¯ä¸€æ ·çš„ï¼Œæ–¹æ³•è¡¨ç»“æ„å¦‚ä¸‹ï¼š è·Ÿå­—æ®µè¡¨ä¸€æ ·ï¼Œæ–¹æ³•è¡¨ä¹Ÿæœ‰è®¿é—®æ ‡å¿—ï¼Œè€Œä¸”ä»–ä»¬çš„æ ‡å¿—æœ‰éƒ¨åˆ†ç›¸åŒï¼Œéƒ¨åˆ†åˆ™ä¸åŒï¼Œæ–¹æ³•è¡¨çš„å…·ä½“è®¿é—®æ ‡å¿—å¦‚ä¸‹ï¼š å¯¹åº”å­—èŠ‚ç ä¸ºï¼š0001 0001 0004 0005 0001 0006 0000 002f 0001 0001 0000 0005 2ab7 0001 b1 1230001 || 0001 || 0004 || 0005 || 0001 || 0006 ------------------------------------------------------------------------è®¡æ•°å™¨ || public || ç´¢å¼•&lt;init&gt; || ç´¢å¼•5 || å±æ€§è®¡æ•°å™¨ || å±æ€§Codeç±»å‹ Codeå±æ€§è¡¨ç»“æ„ 123450006 0000 002f 0001 0001 0000 0005 2ab7 0001 b100 0000 02 00 0700 0000 0600 0100 0000 0300 0800 0000 0c00 0100 0000 0500 0900 0a00 00 0x0006å¯¹åº”å¸¸é‡æ± ç´¢å¼•6çš„ä¸‹æ ‡ï¼ŒæŸ¥çœ‹æ˜¯Codeç±»å‹ 0x0000002fä¸ºå±æ€§çš„é•¿åº¦ï¼Œè¿™é‡Œçš„å€¼æ˜¯47ï¼Œå³å¾€å47ä¸ªå­—èŠ‚éƒ½æ˜¯Codeçš„å†…å®¹ã€‚ max_stackçš„å€¼ä¸º0x0001ï¼Œå³æ“ä½œæ•°æ ˆæ·±åº¦çš„æœ€å¤§å€¼ä¸º1ã€‚ max_localsçš„å€¼ä¸º0x0001ï¼Œå³å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ä¸º1ï¼›max_localsçš„å•ä½æ˜¯Slotï¼ŒSlotæ˜¯è™šæ‹Ÿæœºä¸ºå±€éƒ¨å˜é‡åˆ†é…å†…å­˜æ‰€ä½¿ç”¨çš„æœ€å°å•ä½ã€‚ code_lengthçš„å€¼ä¸º0x000000005,å³å­—èŠ‚ç æŒ‡ä»¤çš„é•¿åº¦ä¸º5ã€‚ codeçš„å€¼ä¸º2ab7 0001 b1,è¿™é‡Œçš„å€¼å°±ä»£è¡¨ä¸€ç³»åˆ—çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ä¸€ä¸ªå­—èŠ‚ä»£è¡¨ä¸€ä¸ªæŒ‡ä»¤ï¼Œä¸€ä¸ªæŒ‡ä»¤å¯èƒ½æœ‰å‚æ•°ä¹Ÿå¯èƒ½æ²¡å‚æ•°ï¼Œå¦‚æœæœ‰å‚æ•°ï¼Œåˆ™å…¶åé¢å­—èŠ‚ç å°±æ˜¯ä»–çš„å‚æ•°ï¼›å¦‚æœæ²¡å‚æ•°ï¼Œåé¢çš„å­—èŠ‚ç å°±æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚ 12345672a æŒ‡ä»¤ï¼ŒæŸ¥è¡¨å¯å¾—æŒ‡ä»¤ä¸ºaload_0ï¼Œå…¶å«ä¹‰ä¸ºï¼šå°†ç¬¬0ä¸ªSlotä¸­ä¸ºreferenceç±»å‹çš„æœ¬åœ°å˜é‡æ¨é€åˆ°æ“ä½œæ•°æ ˆé¡¶ã€‚b7 æŒ‡ä»¤ï¼ŒæŸ¥è¡¨å¯å¾—æŒ‡ä»¤ä¸ºinvokespecialï¼Œå…¶å«ä¹‰ä¸ºï¼šå°†æ“ä½œæ•°æ ˆé¡¶çš„referenceç±»å‹çš„æ•°æ®æ‰€æŒ‡å‘çš„å¯¹è±¡ä½œä¸ºæ–¹æ³•æ¥å—è€…ï¼Œ è°ƒç”¨æ­¤å¯¹è±¡çš„å®ä¾‹æ„é€ å™¨æ–¹æ³•ã€privateæ–¹æ³•æˆ–è€…å®ƒçš„çˆ¶ç±»çš„æ–¹æ³•ã€‚å…¶åé¢ç´§è·Ÿç€çš„2ä¸ªå­—èŠ‚å³æŒ‡å‘å…¶å…·ä½“è¦è°ƒç”¨çš„æ–¹æ³•ã€‚ è¿™é‡ŒæŒ‡å‘çš„æ˜¯`0x0001`çš„ç´¢å¼•ï¼Œå³è°ƒç”¨çš„æ˜¯Objectçš„æ„é€ æ–¹æ³•ã€‚b1 æŒ‡ä»¤ï¼ŒæŸ¥è¡¨å¯å¾—æŒ‡ä»¤ä¸ºreturnï¼Œå…¶å«ä¹‰ä¸ºï¼šè¿”å›æ­¤æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›å€¼ä¸ºvoidã€‚è¿™æ¡æŒ‡ä»¤æ‰§è¡Œå®Œåï¼Œå½“å‰çš„æ–¹æ³•ä¹Ÿå°±ç»“æŸäº†ã€‚ exception_table_lengthçš„å€¼ä¸º0x0000ï¼Œå³å¼‚å¸¸è¡¨é•¿åº¦ä¸º0ï¼Œæ‰€ä»¥å…¶å¼‚å¸¸è¡¨ä¹Ÿæ²¡æœ‰ï¼›attributes_countçš„å€¼ä¸º0x0002ï¼Œå³codeå±æ€§è¡¨é‡Œé¢è¿˜æœ‰ä¸¤ä¸ªå…¶ä»–çš„å±æ€§è¡¨ï¼Œåˆ†åˆ«æ˜¯0x0007å’Œ0x0008çš„ç´¢å¼•ã€‚å¯¹åº”ä¸ºLineNumberTableå±æ€§å’ŒLineVariableTableå±æ€§ã€‚å…³äºè¿™ä¸¤ä¸ªå±æ€§å¯ä»¥è§ä¸‹é¢ï¼Œæœ‰ç‰¹å®šçš„ç»“æ„ã€‚ å±æ€§è¡¨åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å‰©ä¸‹çš„å­—èŠ‚ç è¿˜æœ‰00 0100 0b00 0000 0200 0c å±æ€§è®¡æ•°å™¨ä¸¤ä¸ªå­—èŠ‚ï¼Œè®°å½•äº†å±æ€§çš„ä¸ªæ•°ã€‚è¿™é‡Œæ˜¯0x0001ï¼Œå³ä¸€ä¸ªå±æ€§ã€‚ å±æ€§ç»“æ„ä½“å±æ€§è¡¨çš„ç»“æ„æ¯”è¾ƒçµæ´»ï¼Œå„ç§ä¸åŒçš„å±æ€§åªè¦æ»¡è¶³ä»¥ä¸‹ç»“æ„å³å¯ï¼š 0x000bå¯¹åº”å¸¸é‡æ± ç´¢å¼•11çš„ä¸‹æ ‡ï¼ŒæŸ¥çœ‹æ˜¯SourceFileç±»å‹ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹SourceFileç±»å‹å±æ€§çš„ç»“æ„ å±æ€§çš„é•¿åº¦ä¸º0x00000002ï¼Œå³ä¸¤ä¸ªå­—èŠ‚ï¼Œåé¢æ˜¯0x000cæŒ‡å‘ç´¢å¼•ä¸º12çš„ä¸‹æ ‡ï¼Œå³T0100_ByteCode01.javaï¼Œè¡¨ç¤ºæºæ–‡ä»¶çš„åç§° å…¶ä»–å±æ€§å…¶å®ï¼Œä¸Šé¢LineNumberTableã€LineVariableTableä¹Ÿæ˜¯ç±»ä¼¼SourceFileç±»å‹ï¼Œä¹Ÿæœ‰ç‰¹å®šçš„ç»“æ„ã€‚Javaè™šæ‹Ÿæœºä¸­é¢„å®šä¹‰çš„å±æ€§æœ‰20å¤šä¸ªï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º æ€»ç»“å­—èŠ‚ç æ–‡ä»¶çš„è®¾è®¡çœŸçš„æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œæ ¹æ®javaè¯­è¨€çš„è§„èŒƒï¼Œå°†æ ¹æ®äººçš„æ€æƒ³ç¼–å†™çš„é«˜çº§è¯­è¨€ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œé€šè¿‡äºŒè¿›åˆ¶ï¼ˆåå…­è¿›åˆ¶ï¼‰è¡¨è¾¾äº†æºä»£ç çš„æ€æƒ³ã€‚æˆ‘ä»¬åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨JClassLibâ€”IDEAæ’ä»¶ååŠ©æˆ‘ä»¬çœ‹å­—èŠ‚ç æ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸ç”¨é¢å¯¹æ¯ç‡¥çš„åå…­è¿›åˆ¶äº†ã€‚ ä½¿ç”¨å·¥å…·æŸ¥çœ‹å¾ˆæ˜¯æ–¹ä¾¿ï¼Œå¦‚å›¾]]></content>
      <categories>
        <category>jvm</category>
      </categories>
      <tags>
        <tag>class</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€åˆ‡éƒ½è¦ä»äºŒè¿›åˆ¶ã€å­—èŠ‚ç è¯´èµ·]]></title>
    <url>%2F2020%2F07%2F02%2Fjvm%2Fbytecode%2F</url>
    <content type="text"><![CDATA[äºŒè¿›åˆ¶è‡ªå¤ä»¥æ¥ï¼Œå°±æœ‰å¤ªæç”Ÿä¸¤ä»ªï¼Œä¸¤ä»ªç”Ÿå››è±¡ï¼Œå››è±¡ç”Ÿå…«å¦çš„æ–‡åŒ–ä¼ è¯´ã€‚å¤©ä¸åœ°ï¼Œæ˜ä¸æš—ï¼Œæ˜¯ä¸éï¼Œæœ‰ä¸æ— ï¼Œå®‡å®™ä¸‡ç‰©è²Œä¼¼éƒ½æ˜¯åœ¨è¿™ä¸¤ä¸ªæç«¯ä¹‹é—´å­˜åœ¨çš„ã€‚ç„¶è€Œåœ¨è®¡ç®—æœºçš„ä¸–ç•Œé‡Œï¼Œè¿™ä¸ªä¸–ç•Œåˆæ˜¯æ€æ ·å­˜åœ¨çš„å‘¢ï¼Œå¯¹çš„ï¼Œå°±æ˜¯ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºçš„ã€‚ è½¬åŒ–åè¿›åˆ¶è½¬äºŒè¿›åˆ¶ 250é™¤äºŒå–ä½™æ•°ï¼Œåé¢çš„ä½™æ•°å±…æœ€é«˜ä½ï¼Œå¾—11111010 åè¿›åˆ¶è½¬å…«è¿›åˆ¶ 250é™¤å…«å–ä½™æ•°ï¼Œåé¢çš„ä½™æ•°å±…æœ€é«˜ä½ï¼Œå¾—372 äºŒè¿›åˆ¶è½¬å…«è¿›åˆ¶ 11111010è¡¥å…¨å‰é¢çš„ä½æ•°ï¼Œ9ä½ï¼ˆ3çš„å€æ•°ï¼‰å¾—011 111 010ï¼Œå¾—372 è¡¨ç¤ºæ•°æ®åœ¨è®¡ç®—æœºä¸­æ˜¯é€šå¸¸æ˜¯ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºçš„ï¼Œä½†æ˜¯å½“åŠ å‡è¿ç®—æ—¶ï¼Œæ˜¯é€šè¿‡è¡¥ç çš„æ–¹å¼æ¥è¡¨ç¤ºçš„ï¼Œè¡¨ç¤ºæ–¹å¼æœ‰åŸç ä¸åç ï¼Œè¡¥ç ã€‚ æ­£æ•°çš„åŸç ä¸åç ï¼Œè¡¥ç éƒ½ç›¸åŒï¼Œå³å®ƒçš„äºŒè¿›åˆ¶æ•° è´Ÿæ•°çš„è¡¥ç ç¨å¾®å¤æ‚ä¸€äº›ã€‚ã€æ‰€æœ‰çš„æ•°æ®è¿ç®—éƒ½æ˜¯é‡‡ç”¨è¡¥ç è¿›è¡Œçš„ã€‘ è´Ÿæ•°è¡¥ç çš„æ¨ç®— æ–¹æ³•ä¸€ï¼šç›´æ¥æ¨ç®—æ³• åˆ©ç”¨åŸç åŠ ä¸Šè¡¥ç ç­‰äº0çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼š5çš„äºŒè¿›åˆ¶ä¸º0101+ï¼ˆ-5çš„è¡¥ç ï¼‰=0ï¼ˆåè¿›åˆ¶ï¼‰,å¾—-5çš„è¡¥ç ä¸º1111 1011 æ–¹æ³•äºŒï¼šå…¬å¼æ¨ç®—æ³• è´Ÿæ•°çš„è¡¥ç =æ­£æ•°çš„äºŒè¿›åˆ¶å–å+1, æ¯”å¦‚5çš„äºŒè¿›åˆ¶å–åä¸º11111010ï¼Œ+1ä¹‹åï¼Œå¾—1111 1011 è®¡ç®—æœºè¯­è¨€ä»‹ç»å®ŒäºŒè¿›åˆ¶åï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹æœ‰å“ªäº›è®¡ç®—è¯­è¨€ å®šä¹‰æ˜¯æŒ‡ç”¨äºäººä¸è®¡ç®—æœºä¹‹é—´é€šè®¯çš„ä¸€ç§ç‰¹æ®Šè¯­è¨€ï¼Œæ˜¯äººä¸è®¡ç®—æœºä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„åª’ä»‹ã€‚ åˆ†ç±»ä½çº§è¯­è¨€æœºå™¨è¯­è¨€ç›´æ¥ç”¨äºŒè¿›åˆ¶æŒ‡ä»¤è¡¨è¾¾ã€‚æŒ‡ä»¤æ˜¯ç”¨0å’Œ1ç»„æˆçš„ä¸€é•¿ä¸²ä»£ç ã€‚æœ‰ä¸€å®šçš„ä½æ•°ï¼Œå¹¶åˆ†æˆè‹¥å¹²æ®µï¼Œå„æ®µçš„ç¼–ç è¡¨ç¤ºä¸åŒçš„å«ä¹‰ã€‚ æ±‡ç¼–è¯­è¨€ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„ç¬¦å·ä»£æ›¿æœºå™¨è¯­è¨€çš„äºŒè¿›åˆ¶ç ï¼ˆåˆç§°ç¬¦å·è¯­è¨€ï¼‰ï¼Œè®¡ç®—æœºä¸èƒ½ç›´æ¥è¯†åˆ«ï¼Œéœ€è¦ç”¨ä¸€ç§è½¯ä»¶å°†æ±‡ç¼–è¯­è¨€ç¿»è¯‘æˆæœºå™¨è¯­è¨€ï¼Œä¾èµ–äºç¡¬ä»¶ä½“ç³»ï¼Œå¼€å‘éš¾åº¦è¾ƒå¤§ã€‚ é«˜çº§è¯­è¨€é«˜çº§è¯­è¨€æ˜¯ç›¸å¯¹äºä½çº§è¯­è¨€æ¥è¯´çš„ï¼Œé«˜çº§è¯­è¨€æ˜¯æŒ‰ç…§äººçš„æ€ç»´ç¼–å†™å‡ºæ¥çš„è¯­è¨€ï¼Œæ¯”å¦‚Cè¯­è¨€ã€C++ã€JAVAã€Pythonç­‰ï¼Œå…¶å¯è¯»æ€§é«˜ï¼Œä½†æ‰§è¡Œæ•ˆç‡è¾ƒä½çº§è¯­è¨€ä½ï¼Œç¼–å†™çš„ç¨‹åºå«ä½œæºç¨‹åºã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¯¹äºé«˜çº§è¯­è¨€ï¼Œå¦‚æœç¨‹åºæƒ³è¿è¡Œï¼Œå¿…é¡»ç¿»è¯‘æˆè®¡ç®—æœºèƒ½è¯†åˆ«çš„ä½çº§è¯­è¨€æ‰è¡Œï¼Œé‚£ä¹ˆï¼Œé«˜çº§è¯­è¨€æ˜¯æ€ä¹ˆç¿»è¯‘çš„å‘¢ï¼Ÿè¿™å°±è¦å€ŸåŠ©ç¼–è¯‘å™¨æˆ–è€…è§£æå™¨äº†ã€‚ ç¿»è¯‘è¯­è¨€åˆ†ç±»ç¼–è¯‘å‹è¯­è¨€ å¦‚å›¾æ‰€ç¤ºï¼Œç¨‹åºæ‰§è¡Œä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªå•ç‹¬çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œå°†ç¨‹åºç¿»è¯‘æˆæœºå™¨è¯­è¨€ï¼Œä»¥åæ‰§è¡Œè¿™ä¸ªç¨‹åºçš„æ—¶å€™ï¼ˆ.exeï¼‰ï¼Œå°±ä¸ç”¨å†è¿›è¡Œç¿»è¯‘äº†ã€‚è¿™ç±»è¯­è¨€ç¼–å†™çš„ç¨‹åºå¯åŠ¨ç¨æ…¢ï¼Œæ‰§è¡Œç¨å¿«ã€‚æ¯”å¦‚Cè¯­è¨€ã€C++ è§£é‡Šå‹è¯­è¨€ ä¸éœ€è¦ç¼–è¯‘ï¼Œè¿è¡Œæ—¶ä½¿ç”¨ä¸€ä¸ªä¸“ç”¨çš„è§£é‡Šå™¨å»ç¿»è¯‘ï¼Œæ¯ä¸€æ¡è¯­å¥éƒ½æ˜¯æ‰§è¡Œçš„æ—¶å€™æ‰ç¿»è¯‘ï¼Œæ‰€ä»¥è¿™ç±»ç¨‹åºæ¯æ‰§è¡Œä¸€æ¬¡å°±è¦ç¿»è¯‘ä¸€æ¬¡ï¼Œè¿™ç±»è¯­è¨€ç¼–å†™çš„ç¨‹åºå¯åŠ¨ç¨å¿«ï¼Œæ‰§è¡Œç¨æ…¢ã€‚æ¯”å¦‚Python æ··åˆå‹è¯­è¨€ æ··åˆå‹è¯­è¨€ï¼Œæ¯”å¦‚javaï¼Œå¯¹æºç è¿›è¡Œç¼–è¯‘åèƒ½å¾—åˆ°classå­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶åJVMæ‹¿åˆ°æ–‡ä»¶åä¼šè¿›è¡Œè§£é‡ŠæˆC++è¯­è¨€ï¼Œç„¶åé€šè¿‡C++ç¼–è¯‘å™¨ç¼–è¯‘æˆæ±‡ç¼–è¯­è¨€ã€‚å…·ä½“æƒ…å†µå¦‚ä¸‹å›¾ï¼š é€‚ç”¨åœºæ™¯ è¿è¡Œé€Ÿåº¦è¦æ±‚é«˜,ä¼˜é€‰ç¼–è¯‘å‹ã€‚æ¯”å¦‚Cè¯­è¨€åšæ¸¸æˆå¼€å‘ è·¨å¹³å°æ€§ï¼Œä¼˜é€‰è§£é‡Šå‹ï¼Œjavaä¸»è¦ç”¨äºåšä¼ä¸šå¹³å° å­—èŠ‚ç ç”¨IDEç¼–å†™å¥½JAVAæºä»£ç ä¹‹åï¼Œä¼šè‡ªåŠ¨ç¼–è¯‘æˆclassæ–‡ä»¶ï¼ˆå­—èŠ‚ç æ–‡ä»¶ï¼‰ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯Classç±»çš„ä¿¡æ¯ã€è¿™é‡Œå¹¶ä¸æ˜¯å°†ç¨‹åºç¼–è¯‘æˆæœºå™¨è¯­è¨€ï¼Œå¯ä»¥å°†å­—èŠ‚ç æ–‡ä»¶çœ‹ä½œä¸­é—´è¯­è¨€ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œç”±JVMå°†å­—èŠ‚ç å†ç¿»è¯‘æˆæœºå™¨è¯­è¨€ã€‘ è·¨å¹³å°æ€§æ­£æ˜¯ç”±äºæœ‰classå­—èŠ‚ç çš„å­˜åœ¨ï¼Œæ‰ä½¿å¾—ç¼–ç¨‹è¯­è¨€è¿ˆå…¥ä¸€ä¸ªæ–°çš„ä¸–çºªï¼Œjavaè¯­è¨€æˆä¸ºè·¨å¹³å°çš„è¯­è¨€ã€‚è·¨å¹³å°å°±æ˜¯ä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„æ‰§è¡Œ( Write Once ,Run Anywhere)ã€‚åªè¦æœºå™¨å®‰è£…å¥½äº†JVMï¼Œä¸€åˆ‡ç¼–è¯‘å¥½çš„classæ–‡ä»¶å°±èƒ½å¤Ÿè¿è¡Œã€‚è€ŒåƒCè¯­è¨€å°±ä¸è¡Œï¼Œå¿…é¡»åœ¨æŒ‡å®šçš„æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„ã€‚JVMåªæ˜¯ä¸€ä¸ªä¸­é—´æ¡¥æ¢ï¼Œæ“ä½œç³»ç»Ÿè¦è¿è¡Œjavaç¨‹åºï¼Œå°±å¿…é¡»å®‰è£…ä¸€ä¸ªå¯¹åº”ç‰ˆæœ¬çš„è™šæ‹Ÿæœºã€‚ç¨‹åºæ‰§è¡Œçš„æ—¶å€™ï¼ŒJVMä¼šå°†classæ–‡ä»¶loadè¿›å†…å­˜ä¸­ï¼Œç¿»è¯‘æˆæœºå™¨è¯­è¨€æ‰§è¡Œï¼Œä»æºç ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå†ç”±å­—èŠ‚ç è½¬æœºå™¨è¯­è¨€çš„è¿‡ç¨‹ï¼Œjavaè¯­è¨€è§„èŒƒèµ·äº†å¥ å®šæ€§ä½œç”¨ã€‚ å› æ­¤ è·¨å¹³å°æ€§ = javaè¯­è¨€è§„èŒƒ + classæ–‡ä»¶ + JVMè™šæ‹Ÿæœº ç›®å‰æ”¯æŒè·¨å¹³å°çš„è¯­è¨€æœ‰ è¿è¡Œæœºåˆ¶jvmä¼šåŠ è½½classæ–‡ä»¶è¿›å†…å­˜ï¼Œjavaä¸€èˆ¬é»˜è®¤æ˜¯æ··åˆæ¨¡å¼ç¼–è¯‘ï¼Œå³è§£é‡Šå™¨+çƒ­ç‚¹ä»£ç ç¼–è¯‘ï¼Œèµ·å§‹é˜¶æ®µé‡‡ç”¨è§£é‡Šæ‰§è¡Œï¼Œå¯¹äºå¤šæ¬¡è°ƒç”¨çš„æ–¹æ³•æˆ–è€…å¾ªç¯ï¼Œé‡‡ç”¨JITå³æ—¶ç¼–è¯‘ã€‚ æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨é…ç½®jvmä½¿ç”¨ä»€ä¹ˆæ¨¡å¼ï¼š -Xmixed é»˜è®¤ä¸ºæ··åˆæ¨¡å¼ï¼Œå¼€å§‹è§£é‡Šæ‰§è¡Œï¼Œå¯åŠ¨é€Ÿåº¦è¾ƒå¿«ï¼Œå¯¹çƒ­ç‚¹ä»£ç å®è¡Œæ£€æµ‹å’Œç¼–è¯‘ -Xint ä½¿ç”¨è§£é‡Šæ¨¡å¼ï¼Œå¯åŠ¨å¾ˆå¿«ï¼Œæ‰§è¡Œç¨æ…¢ -Xcomp ä½¿ç”¨çº¯ç¼–è¯‘æ¨¡å¼ï¼Œæ‰§è¡Œå¾ˆå¿«ï¼Œå¯åŠ¨å¾ˆæ…¢ Javaæ¨¡å‹ JVMï¼šJavaè™šæ‹Ÿæœºï¼ˆJava Virtual Machineï¼‰å®ƒæ˜¯è¿è¡Œæ‰€æœ‰Javaç¨‹åºçš„è™šæ‹Ÿè®¡ç®—æœºï¼Œå¥½æ¯”æ˜¯è¡—æœºæ¸¸æˆçš„æ¨¡æ‹Ÿå™¨ã€‚ JREï¼šJavaè¿è¡Œç¯å¢ƒï¼ˆJava Runtime Environmentï¼‰å¦‚æœè¦è¿è¡ŒJavaç¨‹åºï¼Œå°±éœ€è¦JREï¼ŒJREé‡ŒåŒ…å«JVMå’Œjavaç±»åº“ã€‚ JDKï¼šJavaå¼€å‘å·¥å…·ï¼ˆJava Development Kitï¼‰åŒ…å«å¼€å‘Javaç¨‹åºçš„æ‰€æœ‰å·¥å…·(javacã€java)ï¼ŒJDKé‡ŒåŒ…å«JREå’Œå¼€å‘è°ƒè¯•å·¥å…·ã€‚]]></content>
      <categories>
        <category>jvm</category>
      </categories>
      <tags>
        <tag>class</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹ä¹‹åŸåˆ™]]></title>
    <url>%2F2020%2F06%2F24%2Fpatterns%2Fagile-software-development%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹è¿™æ®µæ—¶é—´è¶ç€å­¦ä¹ ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹åˆæŠ“ç´§æ—¶é—´æŠŠä¹‹å‰å­¦ä¹ çš„ã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹å¤ä¹ äº†ä¸€ä¸‹ï¼Œä½†ä¸å¾—ä¸æ‰¿è®¤ï¼Œè¿™ä¸¤æœ¬ä¹¦å¯¹è®¾è®¡æ¨¡å¼æœ‰è¾ƒæ·±çš„æ·±å…¥ï¼Œä½†ç›¸æ¯”äºã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹ï¼Œã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹æ›´å¸å¼•æˆ‘çš„ä¸€ç‚¹æ˜¯ï¼Œè¿™æœ¬ä¹¦å¯¹å®è·µè¿™ä¸€å—åšçš„æ¯”è¾ƒå¥½ï¼Œå°†åŸåˆ™ã€æ¨¡å¼å’Œå®è·µç»“åˆå¾—æ°åˆ°å¥½å¤„ã€‚æ¯”å¦‚è¯´ï¼šç´ æ•°ã€ä¿é¾„çƒã€å†’æ³¡æ’åºå’Œè–ªæ°´æ”¯ä»˜çš„æ¡ˆä¾‹ï¼Œéƒ½æ˜¯ä¸é”™ä¾‹å­å’Œåœºæ™¯ã€‚ å›é¡¾æ•æ·å®£è¨€ã€æé™ç¼–ç¨‹ã€TDDæµ‹è¯•ã€é‡æ„ æµ‹è¯•é©±åŠ¨å¼€å‘ä¸é‡æ„çš„æ€è€ƒ æ•æ·è®¾è®¡æºä»£ç æ˜¯è½¯ä»¶ç³»ç»Ÿçš„ä¸»è¦è®¾è®¡æ–‡æ¡£ æˆ‘ä»¬ä¸åº”è¯¥è®¤ä¸ºè½¯ä»¶è®¾è®¡å°±æ˜¯ä¸€ç»„å’Œä»£ç åˆ†ç¦»çš„UMLå›¾ï¼ŒUMLå›¾åªæ˜¯æè¿°äº†è®¾è®¡çš„ä¸€éƒ¨åˆ†ã€‚ è½¯ä»¶é¡¹ç›®çš„è®¾è®¡æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µã€‚å®ƒå’Œç¨‹åºçš„æ¦‚æ‹¬å½¢çŠ¶ã€ç»“æ„ä»¥åŠæ¯ä¸€ä¸ªæ¨¡å—ã€ç±»å’Œæ–¹æ³•çš„è¯¦ç»†å½¢çŠ¶å’Œç»“æ„æœ‰å…³ã€‚ è®¾è®¡çš„æœ€ç»ˆä½“ç°åœ¨ æºä»£ç  ä¸­ã€‚ è®¾è®¡ä¸­è‡­å‘³â€”è…åŒ–è½¯ä»¶çš„æ°”å‘³ åƒµåŒ–æ€§ï¼š è€¦åˆæ€§é«˜ï¼Œæ¨¡å—ç»„ä»¶ä»¶å…³ç³»å¤ªç´§å¯†ï¼Œä¾èµ–æ€§é«˜ï¼Œä¸€åŠ¨å…¨åŠ¨ã€‚ è„†å¼±æ€§ï¼š æ”¹åŠ¨ä¸€å¤„ï¼Œå…¶ä»–ç›¸å…³è”çš„åœ°æ–¹ä¹Ÿä¼šå˜åŠ¨ï¼Œå¼•å‘æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚ ç‰¢å›ºæ€§ï¼š è®¾è®¡éš¾ä»¥é‡ç”¨ã€‚ ç²˜æ»æ€§ï¼š è¿™ä¸€ç‚¹æœ‰ç‚¹éš¾ä»¥ç†è§£ã€‚ ä¸å¿…è¦çš„å¤æ‚æ€§ï¼š å¯¼å…¥ä¸å¿…è¦çš„æ¨¡å—ï¼Œç»„ä»¶æˆ–åŒ…ã€‚ ä¸å¿…è¦çš„é‡å¤ï¼š éšæ„copyï¼Œå°†å¯ä»¥çš„æŠ½è±¡éšè—èµ·æ¥ï¼Œè€Œä¸”å¦‚æœéšå¤„copyçš„ä»£ç éœ€è¦å˜åŠ¨ï¼Œå¾—åˆ°å¤„è¿›è¡Œä¿®æ”¹ã€‚ æ™¦æ¶©æ€§ï¼š æ¨¡å—éš¾ä»¥ç†è§£ã€‚ ä¿æŒå°½å¯èƒ½å¥½çš„è®¾è®¡ éœ€æ±‚æ˜¯é¡¹ç›®ä¸­æœ€ä¸ç¨³å®šçš„è¦ç´ ã€‚ æ•æ·å›¢é˜Ÿä¾é å˜åŒ–æ¥è·å–æ´»åŠ›ã€‚ å›¢é˜Ÿå‡ ä¹ä¸è¿›è¡Œé¢„å…ˆè®¾è®¡ï¼Œå› æ­¤ä¸éœ€è¦ä¸€ä¸ªæˆç†Ÿçš„åˆå§‹è®¾è®¡ã€‚ æ•æ·å¼€å‘äººå‘˜è‡´åŠ›äºä¿æŒè®¾è®¡å°½å¯èƒ½çš„é€‚å½“ã€å¹²å‡€ã€ç®€å•ï¼Œå¹¶ä¸”ä½¿ç”¨è®¸å¤šçš„å•å…ƒæµ‹è¯•å’ŒéªŒæ”¶æµ‹è¯•æ”¯æ´ã€‚ æ•æ·è½¯ä»¶å¼€å‘çŸ¥é“è¦åšçš„äº‹æƒ…ï¼š éµå¾ªæ•æ·å®è·µå»å‘ç°é—®é¢˜ åº”ç”¨è®¾è®¡åŸåˆ™å»è¯Šæ–­é—®é¢˜ åº”ç”¨é€‚å½“çš„è®¾è®¡æ¨¡å¼å»è§£å†³é—®é¢˜ å®šä¹‰æ•æ·è®¾è®¡æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€ä¸ªäº‹ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªæŒç»­çš„åº”ç”¨åŸåˆ™ã€æ¨¡å¼ä»¥åŠå®è·µæ¥æ”¹è¿›è½¯ä»¶çš„ç»“æ„å’Œå¯è¯»æ€§çš„è¿‡ç¨‹ã€‚å®ƒè‡´åŠ›äºä¿æŒç³»ç»Ÿè®¾è®¡åœ¨ä»»ä½•æ—¶é—´éƒ½å°½å¯èƒ½çš„ç®€å•ã€å¹²å‡€ä»¥åŠå¯Œæœ‰è¡¨ç°åŠ›ã€‚ è‡­å‘³ è®¾è®¡ä¸­çš„è‡­å‘³æ˜¯ä¸€ç§ç—‡çŠ¶ï¼Œæ˜¯å¯ä»¥ä¸»è§‚è¿›è¡Œåº¦é‡çš„ã€‚è¿™äº›è‡­å‘³é€šå¸¸æ˜¯ç”±è¿åäº†è¿™äº›åŸåˆ™ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå¯¼è‡´çš„ã€‚ æ¯”å¦‚è¿åäº†å¼€é—­åŸåˆ™ï¼Œä¼šå¯¼è‡´åƒµåŒ–æ€§ã€‚ åº”ç”¨åŸåˆ™çš„ç›®çš„æ˜¯å»é™¤åƒµåŒ–æ€§ï¼Œå½“æ²¡æœ‰è‡­å‘³æ—¶å°±ä¸åº”è¯¥åº”ç”¨è¿™äº›åŸåˆ™ è®¾è®¡åŸåˆ™å•ä¸€èŒè´£åŸåˆ™ï¼ˆThe Single Responsibility Principleï¼‰å†…èšæ€§ä¸€ä¸ªæ¨¡å—çš„ç»„æˆå…ƒç´ ä¹‹é—´çš„åŠŸèƒ½ç›¸å…³æ€§ã€‚æŠŠå†…èšæ€§å’Œå¼•èµ·ä¸€ä¸ªæ¨¡å—æˆ–è€…ç±»æ”¹å˜çš„ä½œç”¨åŠ›è”ç³»èµ·æ¥ã€‚ èŒè´£å˜åŒ–çš„åŸå›  å®šä¹‰å°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥ä»…ç”¨ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚ æè¿° æ¯ä¸€ä¸ªèŒè´£éƒ½æ˜¯å˜åŒ–çš„ä¸€æ¡è½´çº¿ã€‚å½“éœ€æ±‚å˜åŒ–æ—¶ï¼Œè¯¥å˜åŒ–ååº”ä¸ºç±»çš„èŒè´£çš„å˜åŒ–ã€‚å¦‚æœä¸€ä¸ªç±»æ‰¿æ‹…äº†å¤šäºä¸€ä¸ªçš„èŒè´£ï¼Œé‚£ä¹ˆå¼•èµ·å®ƒå˜åŒ–çš„åŸå› å°±ä¼šæœ‰å¤šä¸ªã€‚ å¦‚æœä¸€ä¸ªç±»æ‰¿æ‹…çš„èŒè´£è¿‡å¤šï¼Œå°±ç­‰äºæŠŠè¿™äº›èŒè´£è€¦åˆåœ¨ä¸€èµ·ã€‚ä¸€ä¸ªèŒè´£çš„å˜åŒ–å¯èƒ½ä¼šå‰Šå¼±æˆ–è€…æŠ‘åˆ¶è¿™ä¸ªç±»å®Œæˆå…¶ä»–èŒè´£çš„èƒ½åŠ›ã€‚ è¿™ç§è€¦åˆå¯¼è‡´è„†å¼±çš„è®¾è®¡ï¼Œå½“å˜åŒ–å‘ç”Ÿæ—¶ï¼Œè®¾è®¡ä¼šé­å—æ„æƒ³ä¸åˆ°çš„ç ´åã€‚ ä¾‹å­ Employeeç±»åŒ…å«äº†ä¸šåŠ¡è§„åˆ™å’Œå¯¹äºæŒä¹…åŒ–çš„æ§åˆ¶ã€‚ ä¸šåŠ¡è§„åˆ™å¾€å¾€ä¼šé¢‘ç¹çš„å˜åŒ–ï¼Œè€ŒæŒä¹…åŒ–çš„æ–¹å¼å´ä¸ä¼šå¦‚æ­¤é¢‘ç¹çš„å˜åŒ–ã€‚ æµ‹è¯•é©±åŠ¨å¼€å‘çš„å®è·µå¸¸å¸¸ä¼šè¿œåœ¨è®¾è®¡å‡ºç°è‡­å‘³ä¹‹å‰å°±è¿«ä½¿æˆ‘ä»¬åˆ†ç¦»è¿™ä¸¤ä¸ªèŒè´£ã€‚ åº”ç”¨ SpringIOCæºç ä¸­BeanFactoryçš„è®¾è®¡ï¼ŒgetBaen()å’ŒgetBeanDefinition()ã€registerBeanDefinition()çš„åˆ†ç¦»ã€‚ å¼€æ”¾ã€å°é—­åŸåˆ™ï¼ˆThe Open-Close Principle)å®šä¹‰è½¯ä»¶å®ä½“ï¼ˆç±»ï¼Œæ¨¡å—ã€å‡½æ•°ç­‰ç­‰ï¼‰åº”è¯¥æ˜¯å¯ä»¥æ‰©å±•çš„ï¼Œä½†æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚ æè¿°å¯¹äºæ‰©å±•æ˜¯å¼€æ”¾çš„ã€å¯¹äºæ›´æ”¹æ˜¯å°é—­çš„ æœ¬è´¨æ„é€ æŠ½è±¡æ¥éš”ç¦»å¼•èµ·çš„å˜åŒ– ç»“è®ºåœ¨è®¸å¤šæ–¹é¢ï¼ŒOCPéƒ½æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„æ ¸å¿ƒæ‰€åœ¨ï¼Œéµå¾ªè¿™ä¸ªåŸåˆ™å¯ä»¥å¸¦æ¥å·¨å¤§å¥½å¤„ã€‚ æ¯”å¦‚ï¼Œçµæ´»æ€§ï¼Œå¯é‡ç”¨æ€§ä»¥åŠå¯ç»´æŠ¤æ€§ã€‚ Liskovæ›¿æ¢åŸåˆ™ï¼ˆThe Liskov Substitution Principleï¼‰å®šä¹‰å­ç±»å‹å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰å®ƒä»¬çš„åŸºç±»å‹ æè¿°è‹¥å¯¹æ¯ä¸ªç±»å‹Sçš„å¯¹è±¡o1,éƒ½å­˜åœ¨ä¸€ä¸ªç±»å‹Tçš„å¯¹è±¡o2,ä½¿å¾—åœ¨æ‰€æœ‰é’ˆå¯¹Tç¼–å†™çš„ç¨‹åºPä¸­,ç”¨o1æ›¿æ¢o2åï¼Œç¨‹åºPè¡Œä¸ºåŠŸèƒ½ä¸å˜ï¼Œåˆ™Sæ˜¯Tçš„å­ç±»å‹ã€‚ ç»“è®ºä¸€ä¸ªæ¨¡å‹ï¼Œå¦‚æœå­¤ç«‹åœ°çœ‹ï¼Œå¹¶ä¸å…·æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„æœ‰æ•ˆæ€§ã€‚åœ¨è€ƒè™‘ä¸€ä¸ªç‰¹å®šè®¾è®¡æ˜¯å¦æ°å½“æ—¶ï¼Œä¸èƒ½å®Œå…¨å­¤ç«‹åœ°æ¥çœ‹è¿™ä¸ªè§£å†³æ–¹æ¡ˆã€‚å¿…é¡»è¦æ ¹æ®è¯¥è®¾è®¡çš„ä½¿ç”¨è€…æ‰€åšå‡ºçš„åˆç†å‡è®¾æ¥å®¡è§†å®ƒã€‚ åŸºäºå¥‘çº¦å¼è®¾è®¡ çº¦å®šå¤§äºé…ç½® å¥‘çº¦ï¼šæ˜¯é€šè¿‡ä¸ºæ¯ä¸ªæ–¹æ³•å£°æ˜çš„å‰ç½®æ¡ä»¶å’Œåç½®æ¡ä»¶æ¥æŒ‡å®šçš„ã€‚ è¦ä½¿ä¸€ä¸ªæ–¹æ³•å¾—ä»¥æ‰§è¡Œï¼Œå‰ç½®æ¡ä»¶å¿…é¡»ä¸ºçœŸã€‚æ‰§è¡Œå®Œæ¯•åï¼Œè¯¥æ–¹æ³•è¦ä¿è¯åç½®æ¡ä»¶ä¸ºçœŸã€‚ æ¥å£éš”ç¦»åŸåˆ™ï¼ˆThe Interface Segregation Interfaceï¼‰å®šä¹‰ä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ä¾èµ–å®ƒä»¬ä¸ç”¨çš„æ–¹æ³• èƒ–ç±»æ„å‘³ç€é«˜è€¦åˆæ€§ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç¨‹åºè¦æ±‚è¯¥èƒ–ç±»è¿›è¡Œä¸€ä¸ªæ”¹åŠ¨æ—¶ï¼Œä¼šå½±å“åˆ°æ‰€æœ‰å…¶ä»–çš„å®¢æˆ·ç¨‹åºã€‚ åˆ†ç¦»å®¢æˆ·å°±æ˜¯åˆ†ç¦»æ¥å£ åˆ†ç¦»æ¥å£çš„ä¸¤ç§æ–¹å¼ï¼š ä½¿ç”¨å§”æ‰˜åˆ†ç¦»æ¥å£ ä½¿ç”¨å¤šé‡ç»§æ‰¿åˆ†ç¦»æ¥å£ ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆThe Dependency Inversion Principleï¼‰å®šä¹‰é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ã€‚ä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ã€‚ç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚ è®¾è®¡çš„å±‚æ¬¡åŒ– æ‰€æœ‰ç»“æ„è‰¯å¥½çš„é¢å‘å¯¹è±¡æ¶æ„éƒ½å…·æœ‰æ¸…æ™°çš„å±‚æ¬¡å®šä¹‰ï¼Œæ¯ä¸ªå±‚æ¬¡é€šè¿‡ä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„ã€å—æ§çš„æ¥å£å‘å¤–æä¾›äº†ä¸€ç»„å†…èšçš„æœåŠ¡ã€‚ è¿™é‡Œçš„å€’ç½®ä¸ä»…ä»…æ˜¯ä¾èµ–å…³ç³»çš„å€’ç½®ï¼Œå®ƒä¹Ÿæ˜¯æ¥å£æ‰€æœ‰æƒçš„å€’ç½®ã€‚ ç¨‹åºä¸­æ‰€æœ‰çš„ä¾èµ–å…³ç³»éƒ½åº”è¯¥ç»ˆæ­¢äºæŠ½è±¡ç±»æˆ–è€…æ¥å£ ä»»ä½•å˜é‡éƒ½ä¸åº”è¯¥æŒæœ‰ä¸€ä¸ªæŒ‡å‘å…·ä½“ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ã€‚ ä»»ä½•ç±»éƒ½ä¸åº”è¯¥ä»å…·ä½“ç±»æ´¾ç”Ÿã€‚ ä»»ä½•æ–¹æ³•éƒ½ä¸åº”è¯¥è¦†å†™å®ƒçš„ä»»ä½•åŸºç±»ä¸­çš„å·²ç»å®ç°äº†çš„æ–¹æ³•ã€‚]]></content>
      <categories>
        <category>patterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[çŠ¶æ€æ¨¡å¼]]></title>
    <url>%2F2020%2F06%2F20%2Fpatterns%2Fstate%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹çŠ¶æ€æ¨¡å¼ æœ‰ç‚¹ç±»ä¼¼ç­–ç•¥æ¨¡å¼ï¼ŒåŒæ ·æ˜¯å˜åŒ–ï¼Œåªæ˜¯åº”å¯¹å˜åŒ–çš„æ–¹å¼ä¸ä¸€æ ·è€Œå·²ã€‚ç­–ç•¥æ¨¡å¼é¢å¯¹å˜åŒ–ï¼Œæ˜¯é‡‡å–å°†å˜åŒ–çš„éƒ¨åˆ†ä¸ä¸å˜çš„éƒ¨åˆ†åˆ†ç¦»å¼€æ¥ï¼Œé‡‡å–å°è£…ç®—æ³•æ—çš„æ–¹å¼è¿›è¡ŒæŠ½è±¡ï¼Œå…·ä½“å®ç°åªéœ€å¯¹ä¸åŒæ¥å£è¿›è¡Œç»„åˆã€‚è€ŒçŠ¶æ€æ¨¡å¼ï¼Œå˜åŒ–çš„éƒ¨åˆ†å–å†³äºå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œé€šè¿‡å½“å‰çš„çŠ¶æ€æ¥å†³å®šæ¯ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ã€‚ æ€è·¯ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹ç»™äº†ä¸€ä¸ªç³–æœæœºçš„æ¡ˆä¾‹ï¼Œå®ƒçš„è¿è¡Œæœºåˆ¶æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆç³–æœæœºæœ‰å››ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯æ²¡æœ‰25åˆ†é’±ã€æœ‰25åˆ†é’±ã€å”®å‡ºç³–æœã€ç³–æœå”®ç½„ã€‚åŒæ—¶ï¼Œå¯¼è‡´ç³–æœæœºçŠ¶æ€å˜åŒ–ä¹Ÿå¯¹åº”ç€å››ä¸ªåŠ¨ä½œï¼Œåˆ†åˆ«æ˜¯ï¼šæŠ•å…¥25åˆ†é’±ã€é€€å›25åˆ†é’±ã€è½¬åŠ¨æ›²æŸ„ã€å‘æ”¾ç³–æœã€‚ç³–æœæœºçš„çŠ¶æ€è½¬åŒ–å…³ç³»å¦‚ä¸‹ï¼š å¦‚å›¾ï¼Œç³–æœæœºçš„å®ç°åº”è¯¥åŒ…å«å››ä¸ªæ–¹æ³•ï¼Œè€Œä¸”æ¯ä¸ªæ–¹æ³•çš„å…·ä½“è¡Œä¸ºè·Ÿç³–æœæœºå½“å‰çš„çŠ¶æ€æœ‰å…³ç³»ã€‚æ¯”å¦‚è¯´ï¼Œå½“æ²¡æœ‰25åˆ†é’±æ—¶æ˜¯ä¸èƒ½é€€å›25åˆ†é’±å’Œå”®å‡ºç³–æœçš„ã€‚å½“è½¬åŠ¨æ›²æŸ„çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç³–æœåº”è¯¥æé†’é¡¾å®¢å·²å”®ç©ºã€‚ å®ç°åœ¨ä½¿ç”¨çŠ¶æ€æ¨¡å¼ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ ä»£ç å®ç° å¯èƒ½æ˜¯è¿™æ ·çš„ 123456789101112131415161718192021222324252627282930313233343536373839404142public class GumballMachine &#123; final static int SOLD_OUT = 0; // å”®ç½„çŠ¶æ€ final static int NO_QUARTE = 1; // æ²¡æœ‰25åˆ†é’± final static int HAS_QUARTER = 2; // æœ‰25åˆ†é’± final static int SOLD = 3; // å”®å‡ºç³–æœ int state = SOLD_OUT; // é»˜è®¤ä¸ºå”®ç½„çŠ¶æ€ï¼Œå› ä¸ºæ²¡æœ‰ç³–æœ int count = 0; public GumballMachine(int count) &#123; this.count = count; if (count &gt; 0) &#123; // åˆå§‹åŒ–æ—¶å¦‚æœå¤§äº0ï¼Œä¸ºæ²¡æœ‰25åˆ†é’± state = NO_QUARTE; &#125; &#125; // æŠ•å…¥ç¡¬å¸ public void insertQuarter() &#123; if (state == HAS_QUARTER) &#123; System.out.println("You cna't insert another quarter"); &#125; else if (state == NO_QUARTE) &#123; state = HAS_QUARTER; System.out.println("You inserted a quarter"); &#125; else if (state == SOLD_OUT) &#123; System.out.println("You can't insert a quarter,the machine is sold out"); &#125; else if (state == SOLD) &#123; System.out.println("please wait,we're already giving you a guaball"); &#125; &#125; // é€€å›ç¡¬å¸ public void ejectQuater() &#123;&#125; // è½¬åŠ¨æ›²æŸ„ public void turnCrank() &#123;&#125; // å‘æ”¾ç³–æœ public void dispense() &#123;&#125; // å…¶ä»–æ–¹æ³• &#125; è¿™æ ·å­å®ç°ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡çš„å˜æ›´ï¼Œæ¯”å¦‚éœ€è¦æœ‰10%çš„å¯èƒ½ä¼šæ‰ä¸‹ä¸¤ä¸ªç³–æœï¼Œå‘ç°ä¸Šé¢çš„ä»£ç å¹¶æ²¡æœ‰éµå¾ªå¼€é—­åŸåˆ™ã€çŠ¶æ€è½¬åŒ–åŸ‹è—åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œå¹¶ä¸å¥½ç†è§£ã€‚æ›´é‡è¦çš„æ˜¯æ²¡æœ‰å°†ä¼šå˜åŒ–çš„éƒ¨åˆ†å°è£…ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œæœªæ¥å¾ˆæœ‰å¯èƒ½å¯¼è‡´éšè—çš„bugã€‚ é‡æ„åœ¨é‡æ„ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹é€»è¾‘ï¼š é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªStateæ¥å£ï¼Œåœ¨è¿™ä¸ªæ¥å£å†…ï¼Œç³–æœæœºçš„æ¯ä¸ªåŠ¨ä½œéƒ½æœ‰ä¸€ä¸ªå®ç°çš„æ–¹æ³•ã€‚ ç„¶åï¼Œä¸ºæœºå™¨çš„æ¯ä¸ªçŠ¶æ€å®ç°çŠ¶æ€ç±»ï¼Œè¿™äº›çŠ¶æ€ç±»å°†è´Ÿè´£åœ¨å¯¹åº”çš„çŠ¶æ€ä¸‹è¿›è¡Œçš„è¡Œä¸ºã€‚ æœ€åï¼Œæˆ‘ä»¬è¦æ‘†è„±æ—§çš„æ¡ä»¶ä»£ç ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå°†åŠ¨ä½œå§”æ‰˜åˆ°çŠ¶æ€ç±»ã€‚ ç±»å›¾è®¾è®¡å¦‚ä¸‹ï¼š çŠ¶æ€æ¥å£å®šä¹‰ä¸º 12345678910public interface State &#123; void insertQuater(); // æŠ•å…¥ç¡¬å¸ void ejectQuater(); // é€€å›ç¡¬å¸ void turnCrank(); // è½¬åŠ¨æ›²æŸ„ void dispense(); // å‘æ”¾ç³–æœ&#125; ç³–æœæœºçš„å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class StateGumballMachine &#123; State noQuaterState; State hasQuaterState; State soldState; State soldOutState; State state = soldState; int count = 0; public StateGumballMachine(int count) &#123; noQuaterState = new NoQuaterState(this); hasQuaterState = new HasQuaterState(this); soldState = new SoldState(this); soldOutState = new SoldOutState(this); this.count = count; if (count &gt; 0) &#123; state = noQuaterState; &#125; &#125; // æŠ•å…¥ç¡¬å¸ public void insertQuarter() &#123; state.insertQuater(); &#125; // é€€å›ç¡¬å¸ public void ejectQuater() &#123; state.ejectQuater(); &#125; // è½¬åŠ¨æ›²æŸ„ public void turnCrank() &#123; state.turnCrank(); state.dispense(); &#125; // å‘æ”¾ç³–æœ public void releaseBall() &#123; System.out.println("A gumball comes rolling out the slot..."); if (count != 0) &#123; count = count - 1; &#125; &#125;&#125; å¯¹åº”æ²¡æœ‰25åˆ†é’±çš„çŠ¶æ€ç±»å®ç°ä¸ºï¼š 1234567891011121314151617181920212223242526272829public class NoQuaterState implements State &#123; StateGumballMachine stateGumballMachine; public NoQuaterState(StateGumballMachine stateGumballMachine) &#123; this.stateGumballMachine = stateGumballMachine; &#125; @Override public void insertQuater() &#123; System.out.println("You inserted a quarter"); stateGumballMachine.setState(stateGumballMachine.getHasQuaterState()); &#125; @Override public void ejectQuater() &#123; System.out.println("You haven't inserted a quater"); &#125; @Override public void turnCrank() &#123; System.out.println("You turned,but there are no gumballs"); &#125; @Override public void dispense() &#123; System.out.println("You need to pay first"); &#125;&#125; å”®å‡ºç³–æœçš„çŠ¶æ€å®ç° 12345678910111213141516171819202122232425262728293031323334public class SoldState implements State &#123; StateGumballMachine stateGumballMachine; public SoldState(StateGumballMachine stateGumballMachine) &#123; this.stateGumballMachine = stateGumballMachine; &#125; @Override public void insertQuater() &#123; System.out.println("please wait,we're already giving you a guaball"); &#125; @Override public void ejectQuater() &#123; System.out.println("Sorry,you already turned the crank"); &#125; @Override public void turnCrank() &#123; System.out.println("Turing twice doesn't get you another gumball!"); &#125; @Override public void dispense() &#123; stateGumballMachine.releaseBall(); if (stateGumballMachine.getCount() &gt; 0) &#123; stateGumballMachine.setState(stateGumballMachine.getNoQuaterState()); &#125; else &#123; stateGumballMachine.setState(stateGumballMachine.getSoldOutState()); &#125; &#125;&#125; ä»ä¸Šé¢ ä»£ç å®ç° å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œæ¯ä¸ªçŠ¶æ€æ˜¯å¦‚ä½•è¿›è¡Œè½¬åŒ–çš„ï¼Œè€Œä¸”å¦‚æœéœ€è¦å†æ·»åŠ ä¸€ç§çŠ¶æ€çš„è¯ï¼Œä¹Ÿæ˜¯å¾ˆå®¹æ˜“è¿›è¡Œæ‰©å±•çš„ã€‚æ€»è€Œè¨€ä¹‹è¨€ä¹‹ï¼ŒçŠ¶æ€æ¨¡å¼æå‡äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯æ‰©å±•æ€§ã€‚ é‚£ä¹ˆï¼Œç°åœ¨å›åˆ°åˆšæ‰é‚£ä¸ªé—®é¢˜ï¼š éœ€è¦æ·»åŠ å¯èƒ½ä¼šä¸€ä¸‹å‡ºä¸¤é¢—ç³–æœçš„å¯èƒ½ï¼Œä»£ç åº”è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿ å®šä¹‰ä¹¦ä¸Šå®šä¹‰ä¸ºï¼š çŠ¶æ€æ¨¡å¼å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚ ç±»å…³ç³»å›¾ä¸ºï¼š]]></content>
      <categories>
        <category>patterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ¨¡æ¿æ–¹æ³•]]></title>
    <url>%2F2020%2F06%2F05%2Fpatterns%2Ftemplate%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹æ¨¡æ¿æ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸ªæ–¹æ³•ï¼Œå…¶å®è´¨æ˜¯å¯¹ç®—æ³•çš„å°è£…ã€‚é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œå°†å…¬å…±çš„ä»£ç å°è£…åœ¨çˆ¶ç±»ä¸­ï¼Œå®ç°ä»£ç çš„å¤ç”¨ï¼Œå°†å˜åŒ–çš„éƒ¨åˆ†æŠ½è±¡æˆæŠ½è±¡æ–¹æ³•ï¼Œäº¤ç»™å­ç±»å»å®ç°ã€‚é€šè¿‡æ¨¡æ¿æ–¹æ³•ï¼Œæˆ‘ä»¬å°±ç®—æ³•å°è£…æˆå…ˆå¹²ä»€ä¹ˆã€åå¹²ä»€ä¹ˆï¼Œæœ€åå¹²ä»€ä¹ˆï¼Œå­ç±»å®ç°åªéœ€æä¾›å¯¹å˜åŒ–éƒ¨åˆ†çš„å…·ä½“å®ç°ï¼Œå…·ä½“æ­¥éª¤æ— éœ€åœ¨é‡æ–°å®šä¹‰ã€‚ä¸€èˆ¬æƒ…å†µï¼Œä¸ºäº†æ›´å¥½çš„ä¿æŠ¤ç¨‹åºï¼Œä¸è¢«å­ç±»ç¯¡æ”¹ç®—æ³•ï¼Œæ¨¡æ¿æ–¹æ³•ä¼šç”¨final ä¿®é¥°ã€‚ å®ç°ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹ä¸¾äº†ä¸€ä¸ªå†²èŒ¶å’Œå†²å’–å•¡çš„ä¾‹å­ï¼Œç”±äºä»–ä»¬åŒ…å«ç›¸åŒçš„éƒ¨åˆ†ï¼ˆæ¯”å¦‚çƒ§å¼€æ°´ï¼Œè£…å…¥æ¯å­ï¼‰ï¼Œä½†æ˜¯åˆåŒ…å«ä¸åŒçš„éƒ¨åˆ†ï¼ˆæ³¡æ³•ã€åŠ å…¥é£Ÿæï¼‰ï¼Œå› æ­¤ä¸å˜çš„ä»£ç å¯ä»¥å¤ç”¨ï¼Œå˜åŒ–çš„ä»£ç äº¤ç»™å­ç±»å®šä¹‰ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920public abstract class CaffeineBeverage &#123; final void prepareRecipe() &#123; boilWater(); brew(); pourInCup(); addCondiments(); &#125; protected abstract void brew(); protected abstract void addCondiments(); private void pourInCup() &#123; System.out.println("Pouring into cup"); &#125; private void boilWater() &#123; System.out.println("Boiling water"); &#125;&#125; å­ç±»éœ€è¦ç»§æ‰¿çˆ¶ç±»ï¼Œæä¾›å…·ä½“çš„å®ç° 12345678910111213public class Tea extends CaffeineBeverage &#123; @Override protected void brew() &#123; System.out.println("Steeping the tea"); &#125; @Override protected void addCondiments() &#123; System.out.println("Adding Lemon"); &#125;&#125; å®šä¹‰ä¹¦ä¸Šå®šä¹‰ä¸ºï¼š åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•ä¸­çš„æŸäº›æ­¥éª¤ã€‚ ç±»å›¾ä¸ºï¼š æ‰©å±•é’©å­hookåœ¨å®šä¹‰çš„çˆ¶ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç©ºæ–¹æ³•ã€‚å½“å­ç±»éœ€è¦ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å»è¦†ç›–è¯¥æ–¹æ³•ï¼Œå½“æ²¡è¦†ç›–æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸å¹²ã€‚ å¥½è±ååŸåˆ™è¯¥åŸåˆ™æœ‰ç‚¹ç±»ä¼¼å‰é¢çš„ä¾èµ–å€’ç½®åŸåˆ™ åˆ«è°ƒç”¨ï¼ˆæ‰“ç”µè¯ï¼‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ï¼ˆæ‰“ç”µè¯ï¼‰ä½ ã€‚ åº”ç”¨æ¨¡æ¿æ–¹æ³•ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯å®šä¹‰æ’åºç®—æ³•ï¼Œæ¯”å¦‚å†’æ³¡æ’åºã€æ’å…¥æ’åºã€é€‰æ‹©æ’åºç­‰ç­‰ã€‚ æºç æ¡ˆä¾‹åŒäº²å§”æ´¾æ¨¡å‹ã€AQSç®—æ³•ã€springçš„refreshæ–¹æ³• å®é™…å¼€å‘è®¡ç®—å¼•æ“æ¶ˆæ¯æ¶æ„ã€æŠ¥è¡¨æ‰“å°å®ç°]]></content>
      <categories>
        <category>patterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å‘½ä»¤æ¨¡å¼]]></title>
    <url>%2F2020%2F05%2F30%2Fpatterns%2Fcommands%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹å‘½ä»¤æ¨¡å¼ï¼Œé€šè¿‡å¯¹è¯·æ±‚å‘½ä»¤çš„å°è£…ï¼Œå¯¹å‘½ä»¤çš„è¯·æ±‚æ–¹å’Œæ‰§è¡Œæ–¹è¿›è¡Œè§£å¶ï¼Œä¹¦æœ¬ä¸Šä¸¾ä¾‹äº†é¡¾å®¢ç‚¹é¤çš„è¿‡ç¨‹ï¼Œé¡¾å®¢ä¸‹å•ç‚¹é¤ï¼Œç„¶åæœåŠ¡å‘˜å°†èœå•æ‹¿ç»™å¨å¸ˆåˆ¶ä½œï¼Œé€šè¿‡èœå•å®ç°äº†é¡¾å®¢ä¸æœåŠ¡å‘˜ï¼ŒæœåŠ¡å‘˜ä¸å¨å¸ˆä¹‹é—´çš„è§£å¶ã€‚ å®ç°å®šä¹‰ä¸€ä¸ªå‘½ä»¤æ¥å£ï¼Œæ¥å£åªæœ‰executeæ–¹æ³• 1234public interface Command &#123; void execute();&#125; å¯¹å‘½ä»¤çš„ä¸€ç§å®ç°ï¼Œæ¯”å¦‚ï¼šæ‰“å¼€ç”µç¯æ³¡ï¼Œè¿™é‡Œå°è£…äº†ç¯æ³¡å¯¹è±¡ 12345678910111213public class LightOnCommand implements Command &#123; Light light; public LightOnCommand(Light light) &#123; this.light = light; &#125; @Override public void execute() &#123; light.on(); &#125;&#125; é¥æ§å™¨å¯ä»¥æ‰§è¡Œå‘½ä»¤å¯¹è±¡ï¼Œè‡³äºå‘½ä»¤å…·ä½“æ˜¯æ€ä¹ˆæ‰§è¡Œï¼Œæˆ‘ä¸éœ€è¦å…³å¿ƒï¼Œå› ä¸ºå°è£…åœ¨è¯·æ±‚é‡Œé¢äº† 12345678910111213141516public class SimpleRemoteControl &#123; Command slot; public SimpleRemoteControl() &#123; &#125; public void setCommand(Command command) &#123; this.slot = command; &#125; public void buttonWasPressed() &#123; slot.execute(); &#125;&#125; å¯¹é¥æ§å™¨è¿›è¡Œç®€å•æµ‹è¯• 12345678910111213141516171819public class SimpleRemoteControlTest extends AbstractTest &#123; SimpleRemoteControl simpleRemoteControl = null; Light light = null; Command command = null; @Before public void setUp() throws Exception &#123; simpleRemoteControl = new SimpleRemoteControl(); light = new Light(); command = new LightOnCommand(light); &#125; @Test public void buttonWasPressed() &#123; simpleRemoteControl.setCommand(command); simpleRemoteControl.buttonWasPressed(); &#125; &#125; é€šè¿‡æµ‹è¯•æˆ‘ä»¬çœ‹åˆ°ï¼Œé¥æ§å™¨å¯ä»¥setä¸åŒçš„å‘½ä»¤ï¼Œè‡³äºå‘½ä»¤çš„æ¥æ”¶è€…å°è£…åœ¨äº†å‘½ä»¤çš„å®ç°å½“ä¸­ï¼Œé¥æ§å™¨æ¼ ä¸å…³å¿ƒï¼Œåªæ˜¯æ‰§è¡Œäº†command.execute()æ–¹æ³•ï¼Œå…·ä½“å¹²å˜›äº†ä¹Ÿä¸çŸ¥é“ï¼Œè¿™æ ·å®ç°äº†å®¢æˆ·è¯·æ±‚ä¸è¯·æ±‚æ‰§è¡Œä¹‹é—´çš„è§£å¶ï¼Œæˆ‘ä»¬çš„ç±»å…³ç³»å›¾å¦‚ä¸‹ï¼š å®šä¹‰åœ¨ä¹¦ä¸Šå®šä¹‰ä¸ºï¼š å°†â€œè¯·æ±‚â€å°è£…æˆå¯¹è±¡ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒçš„è¯·æ±‚ã€é˜Ÿåˆ—æˆ–è€…æ—¥å¿—æ¥å‚æ•°åŒ–å…¶ä»–å¯¹è±¡ã€‚å‘½ä»¤æ¨¡å¼ä¹Ÿæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚ ç±»å›¾ä¸ºï¼š åº”ç”¨åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°å‘½ä»¤æ¨¡å¼çš„åœ°æ–¹æœ‰ï¼šçº¿ç¨‹æ± ã€å·¥ä½œé˜Ÿåˆ—ã€‚ å‘½ä»¤å¯ä»¥æ”¯æŒæ’¤é”€æ“ä½œï¼Œæ‰€ä»¥ä¸€ä¸ªå¸¸è§çš„ç”¨äºæ—¥å¿—è¯·æ±‚ï¼Œæ¯”å¦‚ç”µè„‘æ­»æœºæ•°æ®æ¢å¤å¤„ç†ï¼Œmysqlæ—¥å¿—å¤‡ä»½å’Œè¿˜åŸã€‚]]></content>
      <categories>
        <category>patterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å·¥å‚æ¨¡å¼]]></title>
    <url>%2F2020%2F05%2F24%2Fpatterns%2Ffactory%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹å·¥å‚æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ¶é€ å¯¹è±¡çš„å·¥å‚ã€‚åœ¨å­¦ä¹ ä¹‹å‰ï¼Œæ˜¯å­˜åœ¨å¾ˆå¤§çš„è¯¯è§£çš„ï¼Œä¹‹å‰è®¤è¯†çš„å·¥å‚æ˜¯ç®€å•å·¥å‚ï¼Œå®ƒå¹¶ä¸å±äºå·¥å‚æ¨¡å¼çš„èŒƒç•´ï¼ŒçœŸæ­£çš„å·¥å‚æ¨¡å¼æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚ å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯ä½¿ç”¨æŠ½è±¡æ–¹æ³•ï¼Œä½¿ç”¨å­ç±»ç»§æ‰¿çš„æ–¹å¼å»å®ç°ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯æŠ½è±¡å‡ºä¸€ä¸ªå·¥å‚çš„æ¥å£ï¼Œç”¨å…·ä½“çš„å·¥å‚å»å®ç°æ¥å£ï¼Œç„¶åé‡‡ç”¨ç»„åˆçš„æ–¹å¼ï¼Œå»è§£è—•ã€‚æ€»è€Œè¨€ä¹‹ï¼Œä¸¤è€…ä½¿ç”¨çš„åœºæ™¯ä¸ä¸€æ ·ï¼Œæ„Ÿè§‰å·®åˆ«æŒºå¤§ã€‚ é™æ€å·¥å‚æœ¬ç« æ¡ˆä¾‹æ˜¯åˆ¶é€ Pizzaï¼Œè®²è§£çš„æ€è·¯æ˜¯ï¼šä¸€ä¸ªåº—é¢ç»™é¡¾å®¢åˆ¶é€ ä¸åŒå£å‘³çš„æŠ«è¨ï¼Œå‘ç°æ•ˆç›Šä¸é”™ï¼Œåˆ«çš„åœ°æ–¹çš„å•†åº—æƒ³åŠ ç›Ÿï¼Œå¸Œæœ›ä¹Ÿèƒ½å¥—ç”¨ä½ çš„æ¨¡æ¿ï¼Œå†åˆ°ä¸åŒåœ°æ–¹çš„å•†åº—å¸Œæœ›åœ¨æœ¬åœ°æœ‰å¯¹åº”åŸæ–™åŠ å·¥å·¥å‚ã€‚å¯è§ï¼Œéšç€ä¸šåŠ¡çš„æ‰©å¼ ï¼Œå¸¦æ¥çš„å˜åŒ–å˜åŒ–ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªæ—¶å€™å„ä¸ªæ¨¡å¼å°±åœ¨åº”å¯¹è¿™ç§å˜åŒ–ä¸­äº§ç”Ÿäº†é™æ€å·¥å‚ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ é¦–å…ˆæ˜¯é™æ€å·¥å‚ï¼Œåœ¨ä½¿ç”¨é™æ€å·¥å‚å‰ï¼Œé¡¾å®¢ä¸‹è®¢å•çš„å®ç°åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š 12345678910111213141516171819202122public class PizzaStore &#123; Pizza orderPizza(String type) &#123; Pizza pizza = null; // å˜åŒ–çš„éƒ¨åˆ† if ("cheese".equals(type)) &#123; pizza = new CheesePizza(); &#125; else if ("peperoni".equals(type)) &#123; pizza = new PepperoniPizza(); &#125; else if ("clam".equals(type)) &#123; pizza = new ClamPizza(); &#125; // ä¸å˜çš„éƒ¨åˆ† pizza.preprae(); pizza.bake(); pizza.cut(); pizza.box(); return pizza; &#125;&#125; åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å‘ç°ifelseä»£ç æ˜¯ç»å¸¸å‘ç”Ÿæ”¹å˜çš„ï¼Œæ¯å¢åˆ ä¸€ç§å£å‘³çš„Pizzaå°±è¦ä¿®æ”¹è¿™æ®µä»£ç ï¼Œè¿™å¿…å°†é€ æˆç³»ç»Ÿéš¾ä»¥ç»´æŠ¤ã€‚åœ¨ç­–ç•¥æ¨¡å¼ä¸­å­¦åˆ°äº†åº”è¯¥å°†å˜åŒ–çš„éƒ¨åˆ†å’Œä¸å˜çš„éƒ¨åˆ†åˆ†ç¦»å‡ºæ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹è¿™éƒ¨åˆ†ä»£ç åšä¸€ä¸ªå°è£…ï¼Œè¿™å°±æ˜¯ç®€å•å·¥å‚äº†ï¼Œå•ç‹¬è´Ÿè´£Pizzaçš„åˆ›å»ºã€‚ å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718public class SimplePizzaFactory &#123; public Pizza create(String type) &#123; Pizza pizza = null; if ("cheese".equals(type)) &#123; pizza = new CheesePizza(); &#125; else if ("peperoni".equals(type)) &#123; pizza = new PepperoniPizza(); &#125; else if ("clam".equals(type)) &#123; pizza = new ClamPizza(); &#125; else if ("veggie".equals(type)) &#123; pizza = new VeggiePizza(); &#125; else &#123; System.out.println("æœ¬åº—æ²¡æœ‰è¯¥å£å‘³æŠ«è¨ï¼Œè¯·æ¢è´­å…¶ä»–ç±»å‹"); &#125; return pizza; &#125;&#125; å½“æ–°å¢æ–°å£å‘³çš„Pizzaæ—¶ï¼Œæˆ‘ä»¬åªéœ€ä¿®æ”¹è¿™é‡Œçš„ä»£ç ï¼Œcreateæ–¹æ³•å¯ä»¥å£°æ˜ä¸ºé™æ€çš„ï¼Œå½“è°ƒç”¨çš„æ—¶å€™å¯ä»¥ä¸éœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œç›´æ¥è°ƒç”¨ã€‚ä½†è¿™ç§è®¾è®¡ä¸å®¹æ˜“æ‰©å±•ï¼Œè¿è¡Œçš„æ—¶å€™ä¸èƒ½ä¿®æ”¹createçš„è¡Œä¸ºã€‚ é‚£ä¹ˆï¼Œå½“æœ‰ä¸åŒçš„åŠ ç›Ÿå•†åˆ°æ¥æ—¶ï¼Œè¿™ä¸ªæ—¶å€™createæ–¹æ³•ä¸å¾—ä¸å˜ï¼Œè¦æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š ä½†æ˜¯ï¼Œæ›´å¤§çš„å˜åŒ–å†ç­‰ç€æˆ‘ä»¬ï¼Œæœ‰äº›åŠ ç›Ÿå•†è¯´ï¼Œæƒ³è¦è‡ªå·±çš„ä¸€å¥—bakeã€cutã€boxçš„æ–¹å¼ã€‚ å·¥å‚æ–¹æ³•å·¥å‚æ–¹æ³•è¦æ±‚ä¸åŒçš„å‚å•†æä¾›è‡ªå·±çš„createæ–¹æ³•ï¼ŒåŒæ—¶å¯ä»¥æä¾›è‡ªå·±ä¸€å¥—çƒ˜çƒ¤ã€åˆ‡ç‰‡ã€åŒ…è£…çš„æ–¹å¼ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå·¥å‚æ–¹æ³•æ¥è§£æ•‘æˆ‘ä»¬ã€‚ ç®€å•å·¥å‚å°†createæ–¹æ³•è¿›è¡Œäº†æŠ½è±¡ï¼Œäº¤ç»™å­ç±»å»å®ç°ã€‚å½“å®šä¹‰çš„Pizzaæœ‰è‡ªå·±çš„çƒ˜çƒ¤ã€åˆ‡ç‰‡ã€åŒ…è£…æ–¹å¼æ—¶ï¼Œåœ¨å­ç±»å®šä¹‰çš„æ—¶å€™éœ€è¦è¿›è¡Œè¦†ç›–ã€‚ å®ç°ä¸ºï¼š 12345678910111213141516public abstract class PizzaStore &#123; Pizza orderPizza(String type) &#123; // å˜åŒ–çš„ä¸€éƒ¨åˆ† Pizza pizza = creatPizza(type); // ä¸å˜çš„ä¸€éƒ¨åˆ† pizza.preprae(); pizza.bake(); pizza.cut(); pizza.box(); return pizza; &#125; abstract Pizza creatPizza(String type);&#125; åŠ ç›Ÿå•†åªéœ€å®ç°è¯¥æ–¹æ³•ï¼Œå½“è¯¥åŠ ç›Ÿå•†æ–°å¢ä¸€ç§å£å‘³æ—¶ï¼Œåªéœ€åœ¨ä»¥ä¸‹å®ç°ä¸­åšä¸€ä¸‹ä¿®æ”¹ï¼Œç›¸æ¯”äºç®€å•å·¥å‚çš„æ–¹å¼ï¼Œæ›´åŠ æ˜“äºç»´æŠ¤ï¼Œè€Œä¸”å¯¹ç³»ç»Ÿçš„å½±å“åº¦æ›´ä½ã€‚ 12345678910111213public class NYStylePizzaStore extends PizzaStore &#123; @Override Pizza creatPizza(String type) &#123; Pizza pizza = null; if ("cheese".equals(type)) &#123; pizza = new NYStyleCheesePizza(); &#125; else if ("peperoni".equals(type)) &#123; pizza = new NYStylePepperoniPizza(); &#125; return pizza; &#125;&#125; è®²åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯å¯¹å·¥å‚æ–¹æ³•æœ‰äº†å¤§æ¦‚çš„äº†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åˆ°åº•ä»€ä¹ˆæ˜¯å·¥å‚æ–¹æ³•å§ï¼ å·¥å‚æ–¹æ³•æ¨¡å¼ ä¹¦ä¸Šå®šä¹‰ä¸ºï¼š å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±äºå­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»æ˜¯å“ªä¸€ä¸ªã€‚å·¥å‚æ–¹æ³•è®©ç±»æŠŠå®ä¾‹åŒ–æ¨è¿Ÿåˆ°äº†å­ç±»ã€‚ åˆ°è¿™é‡Œï¼Œå¯ä»¥å›é¡¾ä¸€ä¸‹ï¼Œå¦‚æœä½¿ç”¨ç®€å•å·¥å‚å»å®ç°ï¼Œä¼šæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿä¼šå‡ºç°ä¸€ä¸ªé«˜åº¦ä¾èµ–çš„å·¥å‚ç±»ï¼Œå½“æ–°å¢æˆ–åˆ å‡æ—¶ï¼Œå¯¹ç³»ç»Ÿçš„å½±å“æ˜¯å¾ˆå¤§çš„ã€‚è¿™æ ·ä½¿å¾—PizzaStoreç±»é«˜åº¦ä¾èµ–æ‰€æœ‰çš„Pizzaå¯¹è±¡ï¼Œè¿™é‡Œè¿èƒŒäº†æˆ‘ä»¬æ–°å­¦åˆ°çš„ä¸€ä¸ªè®¾è®¡åŸåˆ™ä¾èµ–å€’ç½®åŸåˆ™ï¼š è¦ä¾èµ–æŠ½è±¡ï¼Œä¸è¦ä¾èµ–å…·ä½“ç±»ã€‚ è¿™ä¸ªåŸåˆ™è¯´æ˜äº†ï¼šä¸èƒ½è®©é«˜å±‚ç»„å»ºä¾èµ–ä½å±‚ç»„ä»¶ï¼Œè€Œä¸”ï¼Œä¸ç®¡é«˜å±‚æˆ–åº•å±‚ç»„ä»¶ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚ æ‰€è°“é«˜å±‚ç»„ä»¶ï¼Œæ˜¯ç”±å…¶åº•å±‚ç»„ä»¶å®šä¹‰å…¶è¡Œä¸ºçš„ç±»ã€‚åœ¨è¿™é‡Œï¼ŒPizzaStoreæ˜¯é«˜å±‚ç»„ä»¶ï¼Œå› ä¸ºå®ƒçš„è¡Œä¸ºæ˜¯ç”±Pizzaå®šä¹‰çš„ï¼ŒPizzaStoreåˆ›å»ºæ‰€æœ‰ä¸åŒçš„Pizzaå¯¹è±¡ï¼Œå‡†å¤‡ã€çƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’ï¼›è€ŒPizzaæœ¬èº«å±äºåº•å±‚ç»„ä»¶ã€‚ æŠ½è±¡å·¥å‚åˆ°è¿™é‡Œï¼Œç³»ç»Ÿå·²ç»æœ‰äº†è‰¯å¥½çš„å¼¹æ€§æ¡†æ¶ï¼Œè€Œä¸”éµå¾ªè®¾è®¡åŸåˆ™ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„è®¾è®¡è¿œè¿œæ²¡æœ‰ç»“æŸï¼Œæ¯”è¨åº—æˆåŠŸçš„å…³é”®åœ¨äºæ–°é²œã€é«˜è´¨é‡çš„åŸæ–™ï¼Œè¦æ˜¯åœ¨å½“åœ°å»ºç«‹ä¸€ä¸ªåŸæ–™çš„å·¥å‚ï¼Œè¿˜èƒ½å®ç°æ›´å¤§çš„åˆ©æ¶¦ã€‚ æˆ‘ä»¬é¦–å…ˆå¾—å®šä¹‰åŸæ–™å·¥å‚ï¼š 1234567891011121314public interface PizzaIngredientFactory &#123; Dough createDough(); Sauce createSauce(); Cheese createCheese(); VeggiePizza createVeggiePizza(); Pepperoni createPepperoni(); Clams createClams();&#125; å°†Pizzaçš„pareparè¿›è¡ŒæŠ½è±¡ 12345678910111213141516171819public abstract class Pizza &#123; String name; // é¢å›¢ Dough dough; // é…±æ–™ Sauce sauce; // ä¸€å¥—ä½æ–™ Cheese cheese; Pepperoni pepperoni; Clams clams; abstract void preprae();&#125; å…¶å®è¿™é‡Œå°±æœ‰ç‚¹ç±»ä¼¼äºå·¥å‚æ–¹æ³•äº†ï¼Œäº¤ç»™å­ç±»å»å®ç° 12345678910111213141516public class CheesePizza extends Pizza &#123; PizzaIngredientFactory pizzaIngredientFactory; public CheesePizza(PizzaIngredientFactory pizzaIngredientFactory) &#123; this.pizzaIngredientFactory = pizzaIngredientFactory; &#125; @Override void preprae() &#123; System.out.println("Preparing " + name); dough = pizzaIngredientFactory.createDough(); sauce = pizzaIngredientFactory.createSauce(); cheese = pizzaIngredientFactory.createCheese(); &#125;&#125; æœ€åå®šä¹‰å…·ä½“çš„PizzaStore 123456789101112131415161718public class NYPizzaStore extends PizzaStore &#123; PizzaIngredientFactory ingredientFactory = new NYPizzaIngredientFactory(); @Override Pizza creatPizza(String type) &#123; Pizza pizza = null; if ("cheese".equals(type)) &#123; pizza = new CheesePizza(ingredientFactory); pizza.setName("NY Style Cheese Pizza"); &#125; else if ("clam".equals(type)) &#123; pizza = new ClamPizza(ingredientFactory); pizza.setName("NY Style Clam Pizza"); &#125; return pizza; &#125;&#125; æœ€åæµ‹è¯•ä¸€ä¸‹ï¼š 12PizzaStore pizzaStore = new NYPizzaStore();Pizza pizza = pizzaStore.orderPizza("cheese"); å¯ä»¥è·Ÿè¸ªä¸€ä¸‹ä»£ç æ‰§è¡Œ å…ˆæ˜¯åˆ›å»ºä¸€ä¸ªNYPizzaStoreå®ä¾‹ï¼šPizzaStore pizzaStore = new NYPizzaStore(); æœ‰äº†Pizzaåº—äº†ï¼Œæ¥å—è®¢å•ï¼špizzaStore.orderPizza(&quot;cheese&quot;); orderPizzaä¼šå…ˆè°ƒç”¨creatPizzaæ–¹æ³•ï¼šPizza pizza = creatPizza(type); creatPizzaæ–¹æ³•è°ƒç”¨æ—¶ï¼Œæ¶‰åŠåˆ°åŸæ–™å·¥å‚äº†ï¼špizza = new CheesePizza(ingredientFactory); æ‹¿åˆ°Pizzaåï¼Œä¼šè°ƒç”¨prepareæ–¹æ³•ï¼š 123456void preprae() &#123; System.out.println("Preparing " + name); dough = pizzaIngredientFactory.createDough(); sauce = pizzaIngredientFactory.createSauce(); cheese = pizzaIngredientFactory.createCheese();&#125; æœ€åï¼Œå¾—åˆ°å‡†å¤‡å¥½çš„Pizzaï¼ŒorderPizzaå°±ä¼šæ¥ç€çƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼åœ¨ä¹¦ä¸Šå®šä¹‰ä¸ºï¼š æä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œä¸éœ€è¦æŒ‡å®šå…·ä½“ç±»ã€‚ ä»£ç é“¾æ¥ æ¨¡å‹å¦‚å›¾æ‰€ç¤ºï¼š]]></content>
      <categories>
        <category>patterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ç­–ç•¥æ¨¡å¼]]></title>
    <url>%2F2020%2F04%2F15%2Fpatterns%2Fstrategy%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹ã€ŠHead Filst è®¾è®¡æ¨¡å¼ã€‹çš„ç¬¬ä¸€ç« ï¼Œè®²çš„å°±æ˜¯ç­–ç•¥æ¨¡å¼ï¼Œç­–ç•¥æ¨¡å¼ç®—æ˜¯ä¸€åˆ‡æ¨¡å¼çš„æ ¹æœ¬ã€‚åœ¨æˆ‘ç†è§£çœ‹æ¥ï¼Œæ‰€æœ‰çš„æ¨¡å¼éƒ½æ˜¯ç”±äºéšç€ä¸šåŠ¡çš„ä¸æ–­æ‰©å¤§ï¼Œä¸ºäº†ä½¿å¾—ç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ã€ç»´æŠ¤æ€§è€Œäº§ç”Ÿçš„ï¼Œä¸€ç§è®¾è®¡æ¨¡å¼ååº”äº†å¾ˆå¤šä¸ªç±»ä¹‹é—´çš„å…³ç³»ï¼Œä½¿å¾—ç³»ç»Ÿè€¦åˆæ€§æ›´ä½ï¼Œæ›´å®¹æ˜“æ‰©å±•å’Œç»´æŠ¤ã€‚ æ€è·¯ç­–ç•¥æ¨¡å¼è®²è§£äº†ä¸€ä¸ªå…³äºDuckçš„ç›¸å…³è®¾è®¡æ¡ˆä¾‹ï¼ŒDuckæœ‰displayã€quack(å‘±å‘±å«)ã€swimçš„è¡Œä¸ºã€‚èµ·åˆçš„æ—¶å€™ï¼Œè®¾è®¡æ˜¯ä½¿ç”¨ç»§æ‰¿ï¼Œå‘ç°éšç€å˜åŒ–ï¼Œæœ‰çš„é¸­å­ä¼šflyï¼Œéœ€è¦åœ¨çˆ¶ç±»é‡Œé¢åŠ ä¸Šflyæ–¹æ³•ï¼Œè¿™ä¸‹æƒ¨äº†ï¼Œå…¶å®æœ‰äº›é¸­å­æ˜¯ä¸ä¼šé£çš„ï¼ˆä¸å¾—ä¸è¦†ç›–ï¼Œç©ºå®ç°ï¼‰ï¼Œå¯¼è‡´å™©æ¢¦çš„äº§ç”Ÿã€‚ è¿™æ˜¯è¿èƒŒäº†åŸåˆ™3ï¼Œç”±äºç»§æ‰¿å¸¦æ¥çš„å¼ºè€¦åˆæ€§ã€‚ åæ¥è€ƒè™‘å°†quackã€flyæ˜¯å˜åŒ–çš„ï¼Œé‚£å°±æŠŠä»–ä»¬éƒ½æŠ½è±¡ä¸ºä¸€ç§è¡Œä¸ºå§ï¼ŒæŠ½è±¡å‡ºquackableã€flyableæ¥å£æ€ä¹ˆæ ·ï¼Œå­ç±»åªè¦æœ‰ä»¥ä¸Šä¸¤ç§è¡Œä¸ºï¼Œå°±å»å®ç°è¿™ä¸ªæ¥å£ã€‚ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œå¦‚æœæœ‰100ç§é¸­å­ï¼Œå°±æœ‰100ç§flyableçš„å®ç°ï¼Œå¤ªå¯æ€•äº†å§ï¼Œè¿™æ ·å°±æ²¡èƒ½ä»£ç å¤ç”¨ã€‚ ä»£ç å¤ç”¨æ‰æ˜¯æˆ‘ä»¬è®¾è®¡çš„æ ¹æœ¬å•Šã€‚ ç„¶åï¼Œè®¾è®¡æ¨¡å¼ç™»åœºäº†ã€‚ åŸåˆ™1ï¼šæ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä¹ˆç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åˆåœ¨ä¸€èµ·ã€‚ ç”±äºï¼Œåœ¨æ‰€æœ‰çš„å®ç°ä¸­ï¼Œswimçš„å®ç°æ˜¯å”¯ä¸€çš„ï¼Œè¿™æ˜¯ä¸ä¼šå˜çš„ã€‚è€Œquackã€flyæ˜¯å˜åŒ–çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†è¿™ä¸€éƒ¨åˆ†æŠ½è±¡å‡ºå»ï¼Œäº¤ç»™ä¸€ä¸ªä¸“é—¨çš„åœ°æ–¹å»å®ç°ï¼Œå½“éœ€è¦ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘åªéœ€ä½¿ç”¨ç»„åˆçš„æ–¹å¼ï¼Œè¿™æ ·å°±èƒ½é™ä½è€¦åˆåº¦äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä¸èƒ½ä½¿ç”¨å®ç°ç±»ç»„åˆçš„æ–¹å¼ï¼Œå› ä¸ºï¼Œè¿™æ ·è€¦åˆåº¦ä¹Ÿå¤ªé«˜äº†ã€‚é‚£ä¹ˆï¼Œå°±ä½¿ç”¨æ¥å£å§ï¼ åŸåˆ™2ï¼šé’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚ æœ€åï¼Œæˆ‘ä»¬çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼š Duckä¾ç„¶æ˜¯æŠ½è±¡ç±»ï¼Œé‡Œé¢æœ‰swimå®ç°æ–¹æ³•ã€displayæŠ½è±¡æ–¹æ³•ã€è¿˜ä¾èµ–äº†ä¸¤ä¸ªæ¥å£ï¼Œåˆ†åˆ«æ˜¯QuackBehavioræ¥å£ã€FlyBehavioræ¥å£ï¼Œåœ¨quackæ–¹æ³•é‡Œè°ƒç”¨QuackBehavior.quack()ã€åœ¨flyæ–¹æ³•é‡Œè°ƒç”¨FlyBehavior.fly()ï¼Œè‡³äºå®ç°æ˜¯ä»€ä¹ˆï¼Œäº¤ç»™å­ç±»å»å†³å®šã€‚ åŸåˆ™3ï¼šå¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿ã€‚ é‚£ä¹ˆï¼Œå­ç±»å†³å®šçš„æ–¹å¼æœ‰å“ªä¸¤ç§æ–¹å¼å‘¢ ç¬¬ä¸€æ˜¯ä½¿ç”¨æ„é€ å™¨ ç¬¬äºŒæ˜¯ä½¿ç”¨setæ–¹æ³• æœ€åï¼Œç±»çš„å®ç°æ˜¯è¿™æ ·çš„ï¼š æ€»ä¹‹ï¼Œç­–ç•¥æ¨¡å¼å°±æ˜¯å°†è¿™ç§å˜åŒ–å°è£…äº†èµ·æ¥ï¼Œæ”¾åœ¨å¦ä¸€ä¸ªåœ°æ–¹å®ç°ã€‚é‚£ä¹ˆï¼Œä½ è„‘å­é‡Œé¢æœ‰ç±»å›¾äº†å—ï¼Ÿæœ‰äº†ä¹‹åå°±å¯ä»¥å°†ä»£ç è½åœ°äº†ï¼Œå“ˆå“ˆï¼ å®šä¹‰åœ¨ä¹¦ä¸Šå…¶å®šä¹‰ä¸ºï¼š å®šä¹‰äº†ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…äº†èµ·æ¥ï¼Œè®©ä»–ä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚ åº”ç”¨åœ¨æˆ‘ä»¬å·¥ä½œä¸­ï¼Œç­–ç•¥æ¨¡å¼çš„å…¸å‹åº”ç”¨å°±æ˜¯ifæ¡ä»¶å¾ˆå¤šçš„æƒ…å†µï¼Œå°†è¿™éƒ¨åˆ†å˜åŒ–çš„ä»£ç æ‹¿å‡ºæ¥ï¼Œä¸è¦å°†ä¸å˜çš„ä»£ç æ··åœ¨ä¸€èµ·ï¼Œä½¿ç”¨æ¥å£çš„æ–¹å¼é™ä½è€¦åˆæ€§ï¼Œå…·ä½“å®ç°äº¤ç»™å­ç±»å»å®ç°ã€‚ è¡¥å……è¿™æ˜¯æˆ‘çš„ä»£ç å®ç°ã€ç±»å›¾ï¼Œæ¬¢è¿æ¥starğŸ˜„ ä»£ç é“¾æ¥]]></content>
      <categories>
        <category>patterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å•ä¾‹æ¨¡å¼]]></title>
    <url>%2F2020%2F04%2F12%2Fpatterns%2Fsingleton%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹å•ä¾‹æ¨¡å¼ï¼Œä¹Ÿå«å•ä»¶æ¨¡å¼ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚ä¸€èˆ¬åœ¨æˆ‘ä»¬å®é™…å·¥ä½œä¸­ï¼Œä¼šç»å¸¸é‡åˆ°è¿™ä¸ªæ¨¡å¼ï¼Œæ‰€ä»¥ï¼ŒæŒæ¡è¿™ä¸ªæ¨¡å¼æ˜¯åº”è¯¥çš„ã€‚ å®šä¹‰å•ä»¶æ–¹å¼å¯ä»¥æœ‰å¾ˆå¤šä¸­æ–¹æ³•å®šä¹‰ï¼Œå¯æ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯æ¥é€‰æ‹©æœ€åˆé€‚çš„å®šä¹‰æ–¹å¼ã€‚æ ¹æ®ç›®å‰æ‰€å­¦ä¹ çš„çŸ¥è¯†ï¼Œå¯åˆ†ä¸ºä»¥ä¸‹äº”ç§ï¼ŒæŸäº›å¯èƒ½åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹å›å‡ºç°å®‰å…¨é—®é¢˜ï¼Œéœ€è¦æ”¹è¿›ã€‚ ã€ŠHead Filst è®¾è®¡æ¨¡å¼ã€‹ä¸­å®šä¹‰ä¸ºï¼š å•ä»¶æ¨¡å¼ç¡®ä¿ç¨‹åºä¸­ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿæä¾›è®¿é—®è¿™ä¸ªå®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚ é¥¥æ±‰å¼ä¹Ÿå«é¥¿æ±‰å¼ï¼ŒäºŒè¯ä¸è¯´ ï¼Œå½“jvmåŠ è½½ç±»æ—¶ï¼Œå°±å°†ç±»çš„é™æ€å®ä¾‹åˆå§‹åŒ–ã€‚ 12345678910111213public class SingleInstanceT00 &#123; // æ„é€ å™¨ç§æœ‰åŒ– private SingleInstanceT00() &#123; &#125; public static SingleInstanceT00 instance = new SingleInstanceT00(); public static SingleInstanceT00 getInstance()&#123; return instance; &#125;&#125; åœ¨æ²¡æœ‰ç©ºé—´é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‰æ‹©è¿™æ ·ä½¿ç”¨ã€‚ä½†æ˜¯æ›´ä¼˜é›…çš„åšæ³•æ˜¯ï¼Œè°ƒç”¨çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯å»¶è¿Ÿåˆå§‹åŒ–ã€‚ å»¶è¿Ÿåˆå§‹åŒ–å»¶è¿Ÿåˆå§‹åŒ–ä¼šå¸¦æ¥çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œæ¯”å¦‚æ”¹é€ åçš„ä»£ç ä¸ºï¼š 12345678910111213141516171819202122public class SingleInstanceT01 &#123; // æ„é€ å™¨ç§æœ‰åŒ– private SingleInstanceT01() &#123; &#125; public static SingleInstanceT01 instance = null; public static SingleInstanceT01 getInstance() &#123; if (instance == null) &#123; try &#123; // æ¨¡æ‹Ÿå¤šçº¿ç¨‹ï¼Œä½¿æ•ˆæœæ›´æ˜æ˜¾ Thread.sleep(10); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; instance = new SingleInstanceT01(); &#125; return instance; &#125;&#125; ç»æµ‹è¯•åå‘ç°ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥getInstanceåï¼Œå¾—åˆ°çš„ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚ ä¸ºäº†ä½¿å¾—çº¿ç¨‹å®‰å…¨ï¼Œè§£å†³æ–¹æ¡ˆä¹Ÿåˆ†ä¸ºå¾ˆå¤šç§ï¼Œæœ‰synchronizedåŒæ­¥æ–¹æ³•ã€åŒé‡æ£€æŸ¥é”å®šå’Œé™æ€å†…éƒ¨ç±»åˆå§‹åŒ–ä¸‰ç§ã€‚ åŒæ­¥æ–¹æ³•ä½¿ç”¨synchronizedå¯¹getInstanceæ–¹æ³•è¿›è¡ŒåŒæ­¥å¤„ç†ï¼Œä½†ä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚å¦‚æœgetInstance()æ–¹æ³•è¢«å¤šä¸ªçº¿ç¨‹é¢‘ç¹è°ƒç”¨ï¼Œå°†ä¼šå¯¼è‡´ç¨‹åºæ‰§è¡Œçš„æ€§èƒ½ä¸‹é™ã€‚åªæœ‰ä¸é¢‘ç¹è°ƒç”¨çš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯ç†æƒ³çŠ¶æ€ã€‚å®ç°æ–¹å¼ä¸ºï¼š 1234567891011121314151617181920212223public class SingleInstanceT02 &#123; // æ„é€ å™¨ç§æœ‰åŒ– private SingleInstanceT02() &#123; &#125; public static SingleInstanceT02 instance = null; // åŒæ­¥æ–¹æ³•ä½œç”¨åŸŸå¤ªå¤§ï¼Œæ€§èƒ½ä½ public static synchronized SingleInstanceT02 getInstance() &#123; if (instance == null) &#123; try &#123; // æ¨¡æ‹Ÿå¤šçº¿ç¨‹ï¼Œä½¿æ•ˆæœæ›´æ˜æ˜¾ Thread.sleep(10); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; instance = new SingleInstanceT02(); &#125; return instance; &#125;&#125; ä½¿ç”¨synchronized åŒæ­¥æ–¹æ³•æ—¶å¯ä»¥ä¸ç”¨åŠ volatileï¼Œå› ä¸ºsynchronized å¯ä»¥ä¿è¯åŸå­æ€§ã€‚ åŒé‡æ£€æŸ¥é”å®šåŒé‡æ£€æŸ¥é”å®šä½¿ç”¨synchronizedåŒæ­¥ä»£ç å—çš„æ–¹å¼æˆåŠŸçš„ä¼˜åŒ–äº†æ€§èƒ½ã€‚åªæœ‰ç¬¬ä¸€æ¬¡è¿›æ¥çš„æ—¶å€™ï¼Œæ‰éœ€è¦åŠ é”ã€‚å…¶ä»–æ—¶å€™è¿›æ¥çš„æ—¶å€™å…ˆåˆ¤æ–­instanceæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œå°±ç›´æ¥è¿›è¡Œè¿”å›ã€‚ 12345678910111213141516171819202122232425262728public class SingleInstanceT03 &#123; // æ„é€ å™¨ç§æœ‰åŒ– private SingleInstanceT03() &#123; &#125; public static volatile SingleInstanceT03 instance = null; public static SingleInstanceT03 getInstance() &#123; if (instance == null) &#123; try &#123; // æ¨¡æ‹Ÿå¤šçº¿ç¨‹ï¼Œä½¿æ•ˆæœæ›´æ˜æ˜¾ Thread.sleep(10); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; // åŒæ­¥ä»£ç å— DCL synchronized (SingleInstanceT03.class) &#123; if (instance == null) &#123; instance = new SingleInstanceT03(); &#125; &#125; &#125; return instance; &#125;&#125; æ³¨æ„ï¼šåŠ volatileæ˜¯ä¸ºäº†é˜²æ­¢æŒ‡ä»¤çš„é‡æ’åºï¼Œåœ¨jvmæ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œinstance = new SingleInstanceT03() åˆ†äº†ä¸‰æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼šç»™å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´ ç¬¬äºŒæ­¥ï¼šæˆå‘˜å˜é‡åˆå§‹åŒ– ç¬¬ä¸‰æ­¥ï¼šå°†instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ï¼ˆæ­¤æ—¶è¿˜æ˜¯åŠåˆå§‹åŒ–çŠ¶æ€ï¼Œæœ‰å±æ€§çš„è¯ï¼Œå±æ€§å°šæœªèµ‹å€¼ï¼‰ å¦‚æœæ²¡æœ‰åŠ volatileï¼Œç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ä¼šäº¤æ¢é¡ºåºæ‰§è¡Œï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹æ‹¿åˆ°çš„æ˜¯åŠåˆå§‹åŒ–çš„å®ä¾‹ï¼Œæ‹¿åˆ°æœªåˆå§‹åŒ–çš„æ•°æ®ï¼ˆæ¯”å¦‚ç§’æ€ç³»ç»Ÿæ‹¿åˆ°çš„å€¼ä¸º0ï¼Œå¸¦æ¥é‡å¤§å®‰å…¨éšæ‚£ï¼‰ã€‚ ç±»åˆå§‹åŒ–è¿™ä¹Ÿæ˜¯å»¶è¿Ÿåˆå§‹åŒ–çš„ä¸€ç§ï¼ŒåŸºäºç±»åˆå§‹åŒ–å®ç°çš„ã€‚å®ç°åŸç†æ˜¯æ¯ä¸ªå¯¹è±¡å¯¹åº”æœ‰ä¸€ä¸ªåˆå§‹åŒ–é”ï¼Œåˆå§‹åŒ–æ—¶çº¿ç¨‹éœ€è¦è·å–è¯¥å¯¹è±¡å¯¹åº”çš„åˆå§‹åŒ–é”ã€‚å¦‚æœæ²¡æœ‰è·å–ï¼Œé‚£ä¹ˆçº¿ç¨‹å¿…é¡»ç­‰åˆ°åˆå§‹åŒ–é”é‡Šæ”¾äº†æ‰èƒ½è·å–ã€‚ 12345678910111213141516171819public class SingleInstanceT04 &#123; private SingleInstanceT04() &#123; &#125; private static class InnerInitialClass &#123; public static SingleInstanceT04 instance = new SingleInstanceT04(); &#125; // åŸç†ï¼šæ¯ä¸ªå¯¹è±¡å¯¹åº”æœ‰ä¸€ä¸ªåˆå§‹åŒ–é”ï¼Œåˆå§‹åŒ–æ—¶çº¿ç¨‹éœ€è¦è·å–è¯¥å¯¹è±¡å¯¹åº”çš„åˆå§‹åŒ–é” public static SingleInstanceT04 getInstance() &#123; try &#123; // æ¨¡æ‹Ÿå¤šçº¿ç¨‹ï¼Œä½¿æ•ˆæœæ›´æ˜æ˜¾ Thread.sleep(10); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; return InnerInitialClass.instance; &#125;&#125; åº”ç”¨åœ¨ã€ŠHead Filst è®¾è®¡æ¨¡å¼ã€‹æåˆ°ï¼Œä½¿ç”¨å•ä»¶æ¨¡å¼çš„åœ°æ–¹å¾ˆå¤šã€‚å¸¸è§çš„æœ‰çº¿ç¨‹æ± ã€è¿æ¥æ± ã€ç¼“å­˜ã€æ—¥å¿—å¯¹è±¡ã€‚ è¿˜ç”¨ä¸€äº›ä¸å¸¸è§çš„ï¼Œå¯¹è¯æ¡†ã€å¤„ç†åå¥½è®¾ç½®ã€æ³¨å†Œè¡¨çš„å¯¹è±¡ã€å……å½“æ‰“å°æœºã€æ˜¾å¡ç­‰è®¾å¤‡çš„é©±åŠ¨ç¨‹åºçš„å¯¹è±¡ã€‚]]></content>
      <categories>
        <category>patterns</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ˜¯æ—¶å€™æ­å¼€çº¿ç¨‹æ± è¿™å—é¢çº±äº†ï¼ˆäºŒï¼‰]]></title>
    <url>%2F2020%2F03%2F18%2Fconcurrentart%2Fthreadpool-usages2%2F</url>
    <content type="text"><![CDATA[çº¿ç¨‹æ± çŠ¶æ€å®šä¹‰åœ¨ç®€å•ä»‹ç»å®Œçº¿ç¨‹æ± çš„åŸºæœ¬æ¦‚å¿µåï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œçº¿ç¨‹æ± å®ƒå…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹çº¿ç¨‹æ± çš„çŠ¶æ€ã€‚çº¿ç¨‹æ± çš„è®¾è®¡æ˜¯è¿™æ ·å­çš„ï¼Œå®ƒå°†çº¿ç¨‹æ± çš„çŠ¶æ€å’Œç›®å‰å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ•°ç”¨ä¸€ä¸ªå˜é‡æ¥è¿›è¡Œäº†å­˜å‚¨ï¼Œå°±æ˜¯ctlå˜é‡ 1private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0)); é¦–å…ˆè¿™æ˜¯ä¸€ä¸ªåŸå­ç±»ï¼Œintç±»å‹ï¼Œ32ä½ï¼Œå‰3ä½æ˜¯ç”¨æ¥æ ‡è¯†çº¿ç¨‹æ± çš„çŠ¶æ€çš„ï¼Œå29ä½æ˜¯ç”¨æ¥è¡¨ç¤ºçº¿ç¨‹æ± å½“ä¸­å·¥ä½œçš„çº¿ç¨‹æ•°çš„ã€‚ é€šè¿‡ä½¿ç”¨åŸå­ç±»ï¼Œè¿™æ ·å°±èƒ½ä¿è¯çº¿ç¨‹æ± çš„çŠ¶æ€å’Œå·¥ä½œçº¿ç¨‹æ•°çš„åŸå­æ€§äº†ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€å¸¸é‡æ˜¯å¦‚ä½•æ ‡è¯†çš„å‘¢ï¼Œä»¥åŠå½“æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹æ•°ï¼Œæ˜¯æ€æ ·è¿ç®—çš„å‘¢ã€‚ 123456789101112131415161718private static final int COUNT_BITS = Integer.SIZE - 3; // 29ä½ç”¨æ¥å­˜å·¥ä½œçº¿ç¨‹æ•°private static final int CAPACITY = (1 &lt;&lt; COUNT_BITS) - 1; // æ‰€èƒ½å­˜æ”¾å·¥ä½œçº¿ç¨‹çš„æœ€å¤§æ•° 000 1111...// runState is stored in the high-order bitsprivate static final int RUNNING = -1 &lt;&lt; COUNT_BITS; // è¿è¡ŒçŠ¶æ€ è¡¥ç å½¢å¼ä¸ºï¼š1110 00â€¦â€¦private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS; // å…³é—­çŠ¶æ€ 0000 ....private static final int STOP = 1 &lt;&lt; COUNT_BITS; // åœæ­¢çŠ¶æ€ 0010 00â€¦â€¦private static final int TIDYING = 2 &lt;&lt; COUNT_BITS; // æ¸…ç†çŠ¶æ€ 0100 00â€¦â€¦private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS; // ç»ˆæ­¢çŠ¶æ€ 0110 00â€¦â€¦// Packing and unpacking ctlprivate static int runStateOf(int c) &#123; return c &amp; ~CAPACITY; &#125; // å28ä½å–1 æŒ‰ä½ä¸æ“ä½œprivate static int workerCountOf(int c) &#123; return c &amp; CAPACITY; &#125; // å29ä¸ºå–0 ä¸è¿ç®—private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125; // æ ¹æ®çŠ¶æ€å’Œå·¥ä½œæ•°ç”Ÿæˆctlprivate static boolean runStateLessThan(int c, int s) &#123; return c &lt; s;&#125;private static boolean runStateAtLeast(int c, int s) &#123; return c &gt;= s;&#125;private static boolean isRunning(int c) &#123; return c &lt; SHUTDOWN;&#125; çº¿ç¨‹æ± æœ‰5ç§çŠ¶æ€ï¼ŒæŒ‰å°åˆ°å¤§çš„é¡ºåºå¦‚ä¸‹ï¼šRUNNING&lt;SHUTDOWN&lt;STOP&lt;TIDYING&lt;TERMINATED ä½¿ç”¨åŸå­ç±»æ¥å­˜å‚¨ä¸¤ä¸ªå˜é‡ï¼Œä¿è¯äº†å…±äº«å˜é‡çš„åŸå­æ€§ï¼Œä»¥åŠå®ƒæŒ‰ç…§ä½æ“ä½œæå‡äº†å¾ˆå¤§çš„æ€§èƒ½ çŠ¶æ€è§£æRUNNINGï¼šin operation è¿è¡Œï¼Œå½“çº¿ç¨‹æ± åˆå§‹åŒ–çš„æ—¶å€™ï¼Œçº¿ç¨‹æ± å°±å¤„äºRUNNINGçŠ¶æ€ï¼Œå¤„äºè¯¥çŠ¶æ€æ—¶ï¼Œçº¿ç¨‹æ± å¯ä»¥æ¥å—ä»»åŠ¡ï¼Œå¹¶ä¸”å¤„ç†ç¼“å†²çš„ä»»åŠ¡ã€‚ SHUTDOWNï¼šturn off å…³é—­ï¼Œå½“è°ƒç”¨shutdown()æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹æ± ä»RUNINGè½¬åŒ–ä¸ºSHUTDOWNçŠ¶æ€ï¼Œè¯¥çŠ¶æ€çš„çº¿ç¨‹æ± ä¸æ¥å—ä»»åŠ¡ï¼Œåªå¤„ç†ç¼“å†²çš„ä»»åŠ¡ STOPï¼šstop åœæ­¢ï¼Œå½“è°ƒç”¨shutdownNow()æ–¹æ³•æ—¶ï¼Œä¼šå°†ï¼ˆRUNING/SHUTDOWNçŠ¶æ€ï¼‰è½¬æ¢æˆè¯¥çŠ¶æ€ï¼Œå¤„äºè¯¥çŠ¶æ€çš„çº¿ç¨‹æ± ä¸æ¥å—ä»»åŠ¡ï¼Œä¸å¤„ç†ç¼“å†²ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸­æ–­å…¨éƒ¨æ­£åœ¨å¤„ç†çš„ä»»åŠ¡interrupt running tasks TIDYINGï¼šæ¸…ç†ï¼Œå½“ä»»åŠ¡ä¸­æ–­äº†ï¼Œå¹¶ä¸”çº¿ç¨‹å·¥ä½œæ•°ä¸º0ï¼Œå°±ä¼šè¿›å…¥æ¸…ç†çŠ¶æ€ï¼Œæ¸…ç†ç°åœºã€‚ When the thread pool is in the SHUTDOWN state, the blocking queue is empty and the tasks executed in the thread pool are also empty, it will be SHUTDOWN - &gt; tidying. When the task executed in the thread pool is empty in the STOP state, it will be STOP - &gt; tidying. TERMINATEDï¼šç»ˆæ­¢ï¼Œç»“æŸï¼Œå½“terminated()æ–¹æ³•æ‰§è¡Œå®Œåï¼Œå°±ä¼šè¿›å…¥è¯¥çŠ¶æ€ When the thread pool terminates completely, it becomes terminated. When the thread pool is in tidying state, after executing terminated(), it will be tidying - &gt; terminated. çŠ¶æ€è½¬åŒ–1234567891011* RUNNING -&gt; SHUTDOWN* On invocation of shutdown(), perhaps implicitly in finalize()* (RUNNING or SHUTDOWN) -&gt; STOP* On invocation of shutdownNow()* SHUTDOWN -&gt; TIDYING* When both queue and pool are empty* STOP -&gt; TIDYING* When pool is empty* TIDYING -&gt; TERMINATED* When the terminated() hook method has completed* é€šè¿‡ä»‹ç»æˆ‘ä»¬çŸ¥é“ï¼Œçº¿ç¨‹æ± åˆå§‹åŒ–æ—¶å¤„äºRUNNINGçŠ¶æ€ï¼Œå½“çº¿ç¨‹æ± è°ƒç”¨shutdown()æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹æ± å°±å…³é—­äº†ï¼Œåªå¤„ç†å½“å‰å·²ç»è¿›æ¥çš„ä»»åŠ¡ã€‚å½“ä»»åŠ¡å¤„ç†å®Œä¹‹åï¼Œçº¿ç¨‹æ± ä¼šè°ƒç”¨terminated()æ–¹æ³•ï¼Œæ‰§è¡Œå®Œåçº¿ç¨‹æ± è¿›å…¥TERMINATEDçŠ¶æ€ã€‚å½“ç„¶è¿˜æœ‰å¦ä¸€ç§æ–¹å¼ï¼Œä¸ç®¡çº¿ç¨‹æ± æœ‰æ²¡æœ‰è°ƒç”¨shutdown()æ–¹æ³•ï¼Œå¦‚æœè°ƒç”¨äº†shutdownNow()ï¼Œä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± çº¿ç¨‹ä¸ºç©ºæ—¶ï¼Œçº¿ç¨‹æ± å°±ä¼šè¿›å…¥stopçŠ¶æ€ã€‚å½“æ± ä¸­çº¿ç¨‹ä¸ºç©ºæ—¶ï¼Œterminated()æ–¹æ³•æ‰§è¡Œå®Œåè¿›å…¥TERMINATEDçŠ¶æ€ã€‚ æ„é€ æ–¹æ³•123456789101112131415161718192021222324public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; if (corePoolSize &lt; 0 || maximumPoolSize &lt;= 0 || maximumPoolSize &lt; corePoolSize || keepAliveTime &lt; 0) throw new IllegalArgumentException(); // ä¸»çº¿ç¨‹ä¸èƒ½å°äº0 if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); // é˜Ÿåˆ—å’Œçº¿ç¨‹å·¥å‚ã€ç­–ç•¥ä¸èƒ½ä¸ºnull this.acc = System.getSecurityManager() == null ?null :AccessController.getContext(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime);//å°†æ—¶é—´ä¼ å…¥çš„unitå’ŒkeepAliveTimeè½¬æ¢ä¸ºns this.threadFactory = threadFactory; this.handler = handler;&#125; æäº¤æ‰§è¡Œtaskçš„è¿‡ç¨‹â€‹ è§£é‡Šå½“æäº¤ä¸€ä¸ªæ–°ä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼Œçº¿ç¨‹æ± çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š çº¿ç¨‹æ± åˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯å¦éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœæ˜¯ï¼Œåˆ™è¿›å…¥æ­¥éª¤2ã€‚ çº¿ç¨‹æ± åˆ¤æ–­å·¥ä½œé˜Ÿåˆ—æ˜¯å¦å·²æ»¡ã€‚å¦‚æœæ²¡æœ‰æ»¡ï¼Œå°†æ–°æäº¤çš„ä»»åŠ¡å­˜å‚¨åœ¨å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚å¦‚æœæ»¡äº†ï¼Œåˆ™è¿›å…¥æ­¥éª¤3ã€‚ çº¿ç¨‹æ± åˆ¤æ–­çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ˜¯å¦éƒ½å¤„äºå·¥ä½œçŠ¶æ€ï¼ˆå·²æ»¡ï¼‰ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹ã€‚å¦‚æœæ»¡äº†ï¼Œåˆ™äº¤ç»™é¥±å’Œç­–ç•¥æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚ executeæ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152/** * å¦‚æœä»»åŠ¡ä¸èƒ½æäº¤ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºå½“å‰çº¿ç¨‹æ± å…³é—­äº†ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºé˜Ÿåˆ—æ»¡äº†éœ€è¦è§¦å‘é¥±å’Œç­–ç•¥ */public void execute(Runnable command) &#123; if (command == null) throw new NullPointerException(); /* * Proceed in 3 steps: * * 1. If fewer than corePoolSize threads are running, try to * start a new thread with the given command as its first * task. The call to addWorker atomically checks runState and * workerCount, and so prevents false alarms that would add * threads when it shouldn't, by returning false. * * 2. If a task can be successfully queued, then we still need * to double-check whether we should have added a thread * (because existing ones died since last checking) or that * the pool shut down since entry into this method. So we * recheck state and if necessary roll back the enqueuing if * stopped, or start a new thread if there are none. * * 3. If we cannot queue task, then we try to add a new * thread. If it fails, we know we are shut down or saturated * and so reject the task. */ int c = ctl.get(); // workeræ•°é‡æ¯”æ ¸å¿ƒçº¿ç¨‹æ•°å°ï¼Œç›´æ¥åˆ›å»ºworkeræ‰§è¡Œä»»åŠ¡ if (workerCountOf(c) &lt; corePoolSize) &#123; if (addWorker(command, true)) return; c = ctl.get(); &#125; // workeræ•°é‡è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä»»åŠ¡ç›´æ¥è¿›å…¥é˜Ÿåˆ— if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; int recheck = ctl.get(); // çº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯RUNNINGçŠ¶æ€ï¼Œè¯´æ˜æ‰§è¡Œè¿‡shutdown,éœ€è¦å¯¹æ–°åŠ å…¥çš„ä»»åŠ¡åšrejectæ“ä½œ // è¿™å„¿ä¸ºä»€ä¹ˆéœ€è¦recheck,æ˜¯å› ä¸ºä»»åŠ¡å…¥é˜Ÿå‰åï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ä½†æ˜¯ä¸€èˆ¬æ£€æŸ¥ä¸€ä¸‹ï¼Œå¹¶æ²¡å•¥ç”¨ã€‚ if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); // è¿™å„¿ä¸ºä»€ä¹ˆéœ€è¦åˆ¤æ–­0å€¼ï¼Œæ˜¯å› ä¸ºçº¿ç¨‹æ± æ„é€ æ–¹æ³•ä¸­ï¼Œå…è®¸çº¿ç¨‹æ± çš„æ ¸å¿ƒæ•°ä¸º0ï¼Œå¦‚æœé‡ä¸ŠSynchronousQueueç±»å‹çš„é˜Ÿåˆ—ï¼Œæˆ‘ä¹Ÿèƒ½åˆ›å»ºçº¿ç¨‹å»æ¶ˆè´¹ï¼Œä¸ä¼šä¸€ç›´é˜»å¡ else if (workerCountOf(recheck) == 0) addWorker(null, false); &#125; // å¦‚æœçº¿ç¨‹æ± ä¸æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œæˆ–è€…ä»»åŠ¡è¿›å…¥é˜Ÿåˆ—å¤±è´¥ï¼Œåˆ™ä¼šå°è¯•åˆ›å»ºworkeræ‰§è¡Œä»»åŠ¡ // æ³¨æ„3ç‚¹ // 1. çº¿ç¨‹æ± ä¸æ˜¯è¿è¡ŒçŠ¶æ€æ—¶ï¼ŒaddWorkeræ–¹æ³•å†…éƒ¨ä¼šå»åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€ // 2. addWorkerçš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ // 3. addWorkeræ–¹æ³•è¿”å›falseï¼Œè¯´æ˜ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œéœ€è¦æ‰§è¡Œrejectæ“ä½œ else if (!addWorker(command, false)) reject(command);&#125; executeæ–¹æ³•æœ¬èº«æ¥è¯´å¹¶ä¸éš¾ï¼Œæˆ‘ä»¬æ¥è¿™æ ·å­åˆ†æã€‚ ç¬¬ä¸€æ­¥ï¼Œä¼ å…¥æ¥çš„commandä¸èƒ½ä¸ºç©º ç¬¬äºŒæ­¥ï¼Œå–åˆ°å½“å‰ctlï¼Œæ‹¿åˆ°å½“å‰å·¥ä½œçº¿ç¨‹æ•°ä¸æ ¸å¿ƒæ•°æ¯”è¾ƒï¼Œå¦‚æœå°äºï¼Œç›´æ¥åˆ›å»ºworkeræ‰§è¡Œä»»åŠ¡ï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚ æ³¨æ„ï¼ŒaddWorkerfæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦æ ¸å¿ƒçº¿ç¨‹ã€‚æ–¹æ³•æœ¬èº«ä¼šå»åˆ¤æ–­å½“å‰çº¿ç¨‹æ± çŠ¶æ€å’Œæ•°é‡çš„ï¼Œå¦‚æœaddWorkå¤±è´¥ï¼Œæ–¹æ³•ä¼šè¿”å›falseï¼Œè¡¨ç¤ºæ·»åŠ ä»»åŠ¡å¤±è´¥ï¼Œåœ¨é‡æ–°è·å–ä¸€ä¸‹ctlï¼Œç”¨äºä¸‹ä¸€æ­¥ ç¬¬ä¸‰æ­¥ï¼Œèµ°åˆ°è¿™ä¸€æ­¥è¯´æ˜ï¼Œä¸æ˜¯æ ¸å¿ƒæ•°æ»¡äº†ï¼Œå°±æ˜¯çº¿ç¨‹æ± shutdownäº†ã€‚çœ‹ä¸€ä¸‹å½“å‰çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æœæ˜¯è¿è¡ŒçŠ¶æ€ï¼Œå°±å°è¯•å¾€é˜Ÿåˆ—ä¸­æ”¾ä»»åŠ¡ï¼Œå¦‚æœæ”¾æˆåŠŸäº†è¿”å›trueï¼Œæ”¾ä»»åŠ¡å‰åéƒ½å¾—å»æ‹¿ä¸€ä¸‹å½“å‰çš„ctlï¼Œå†å»åˆ¤æ–­ä¸€ä¸‹çº¿ç¨‹æ± æ˜¯å¦shutdownäº†ï¼Œå¦‚æœshutdownäº†ï¼Œå°±æŠŠä»»åŠ¡ä»é˜Ÿåˆ—ä¸­removeæ‰ã€‚å¦‚æœæ²¡æœ‰shutdownï¼Œä¼šå»åˆ¤æ–­å½“å‰å·¥ä½œçº¿ç¨‹æ•°ã€‚ å¦‚æœä¸º0ï¼Œæˆ‘å°±å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”è¿™é‡Œä¼ å…¥çš„firstTaskè¿˜æ˜¯nullï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢? ç¬¬å››æ­¥ï¼Œè¿™ä¸€æ­¥ç›¸å½“é‡è¦ï¼Œèµ°åˆ°è¿™ä¸€æ­¥ï¼Œè¯´æ˜çº¿ç¨‹æ± ä¸æ˜¯è¿è¡ŒçŠ¶æ€äº†ï¼Œæˆ–è€…ä»»åŠ¡è¿›å…¥é˜Ÿåˆ—å¤±è´¥äº†ï¼Œä¸ºäº†æ¶ˆè´¹ä»»åŠ¡ï¼Œä¼šå°è¯•åˆ›å»ºï¼ˆéæ ¸å¿ƒï¼‰workeræ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœåˆ›å»ºå¤±è´¥ï¼Œåˆ™è¦é‡‡å–é¥±å’Œç­–ç•¥ï¼Œæ‰§è¡Œrejectæ“ä½œã€‚ addWorkeræºç è§£æå¹²äº†ä¸¤ä»¶äº‹æƒ… ä½¿ç”¨CASç®—æ³•å°†workerCountåŠ ä¸€ å°†ä»»åŠ¡è£…å…¥åˆ°workerä¸­ï¼Œå¹¶ä¸”å°†workæ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹é›†åˆworkersä¸­,å¼€å§‹æ‰§è¡Œä»»åŠ¡ workeræ˜¯ä¸€ä¸ªä»»åŠ¡å•å…ƒï¼Œç»§æ‰¿äº†AQSç±»ï¼Œæœ¬èº«æ˜¯æŠŠé”ï¼Œè€Œä¸”æ„é€ æ–¹æ³•æ˜¯RUNNALEä»»åŠ¡ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨startæ–¹æ³•æ‰§è¡Œçº¿ç¨‹ä¸­çš„runæ–¹æ³• å¦‚æœçº¿ç¨‹å¯åŠ¨å¤±è´¥ï¼Œå°†è¿™ä¸ªworkerä»å½“å‰çº¿ç¨‹æ± worksé›†åˆä¸­åˆ é™¤ï¼Œå¹¶ä¸”å°†workerCountå‡ä¸€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081private boolean addWorker(Runnable firstTask, boolean core) &#123; retry: // å¤–å±‚è‡ªæ—‹ for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; // å¦‚æœçŠ¶æ€&gt;SHUTDOWN,è¿”å›false ! (rs == SHUTDOWN &amp;&amp; // å¦‚æœçŠ¶æ€=SHUTDOWNï¼Œä¸”task!=null,è¿”å›false firstTask == null &amp;&amp; // å¦‚æœçŠ¶æ€=SHUTDOWNï¼Œä¸”é˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å›false ! workQueue.isEmpty())) return false; // å†…å±‚è‡ªæ—‹ for (;;) &#123; int wc = workerCountOf(c); // åˆ¤æ–­å·¥ä½œçº¿ç¨‹æ•°ï¼Œæ˜¯å¦è¶…è¿‡æœ€å¤§å€¼å’Œæ ‡å‡†å€¼ if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) return false; // ä½¿ç”¨ä¸€æ¬¡CASç®—æ³•ï¼Œä½¿å¾—c++,å°±æ˜¯wc++ if (compareAndIncrementWorkerCount(c)) // å¦‚æœæˆåŠŸï¼Œè·³å‡ºå¤–éƒ¨å¾ªç¯è¿›å…¥ç¬¬äºŒéƒ¨åˆ† break retry; // å¦‚æœå¤±è´¥ï¼Œåº”è¯¥æ˜¯æœ‰çº¿ç¨‹æŠŠctlæ”¹äº†ï¼Œæ¯”è¾ƒä¸€ä¸‹ c = ctl.get(); // Re-read ctl if (runStateOf(c) != rs) // ä¸ç­‰äºçš„è¯è¿›å…¥å¤–éƒ¨å¾ªç¯è‡ªæ—‹ï¼Œé‡æ–°è·å–ctl continue retry; // else CAS failed due to workerCount change; retry inner loopï¼ˆç­‰äºçš„è¯ï¼Œå†…éƒ¨è‡ªæ—‹ï¼‰ &#125; &#125; boolean workerStarted = false; boolean workerAdded = false; Worker w = null; try &#123; w = new Worker(firstTask); final Thread t = w.thread; if (t != null) &#123; final ReentrantLock mainLock = this.mainLock; // workerçš„æ·»åŠ å¿…é¡»æ˜¯ä¸²è¡Œçš„ï¼Œå¿…é¡»å¾—åŠ é” mainLock.lock(); try &#123; // Recheck while holding lock. // Back out on ThreadFactory failure or if // shut down before lock acquired. // é‡æ–°æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€ int rs = runStateOf(ctl.get()); // å¦‚æœå¤„äºRUNNINGçŠ¶æ€æˆ–è€…SHUTDOWNæ—¶ä¼ é€’çš„ä»»åŠ¡ä¸ºç©º if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123; // å¦‚æœworkerå·²ç»è°ƒç”¨è¿‡startæ–¹æ³•äº†ï¼Œåˆ™ä¸å†åˆ›å»ºäº† if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); // åˆ›å»ºå¹¶ä¸”åŠ å…¥åˆ°worksæˆåŠŸ workers.add(w); // æ›´æ–°largestPoolSizeå˜é‡ int s = workers.size(); if (s &gt; largestPoolSize) largestPoolSize = s; workerAdded = true; &#125; &#125; finally &#123; mainLock.unlock(); &#125; // å¯åŠ¨workerçº¿ç¨‹ if (workerAdded) &#123; t.start(); workerStarted = true; &#125; &#125; &#125; finally &#123; // workerå¯åŠ¨å¤±è´¥ï¼Œè¯´æ˜çº¿ç¨‹çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼ˆå…³é—­æ“ä½œè¢«æ‰§è¡Œï¼‰ï¼Œéœ€è¦æ‰§è¡Œshutdownç›¸å…³æ“ä½œ if (! workerStarted) addWorkerFailed(w); &#125; return workerStarted;&#125; workerä»»åŠ¡å•å…ƒworkeræ˜¯ä¸€ä¸ªä»»åŠ¡å•å…ƒï¼Œä»–é‡Œé¢åŒ…å«äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå’Œä¸€ä¸ªä»»åŠ¡ï¼Œç„¶åè¿˜è®°å½•äº†æˆ‘è¿™ä¸ªworkerå¹²è¿‡å¤šå°‘ä¸ªä»»åŠ¡ç­‰ç­‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536private final class Worker extends AbstractQueuedSynchronizer implements Runnable&#123; /** * This class will never be serialized, but we provide a * serialVersionUID to suppress a javac warning. */ private static final long serialVersionUID = 6138294804551838833L; /** Thread this worker is running in. Null if factory fails. */ final Thread thread; /** Initial task to run. Possibly null. */ Runnable firstTask; /** Per-thread task counter */ volatile long completedTasks; /** * Creates with given first task and thread from ThreadFactory. * @param firstTask the first task (null if none) */ Worker(Runnable firstTask) &#123; setState(-1); // inhibit interrupts until runWorker this.firstTask = firstTask; // è¿™é‡Œä½¿ç”¨äº†æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„çº¿ç¨‹å·¥å‚ï¼Œä¼ å…¥çš„å‚æ•°æˆ‘å½“å‰çš„worker this.thread = getThreadFactory().newThread(this); &#125; /** Delegates main run loop to outer runWorker */ public void run() &#123; // runæ–¹æ³•çš„å®ç°åœ¨runWorkeré‡Œé¢ runWorker(this); &#125; //çœç•¥ä»£ç â€¦â€¦&#125; runworkeræ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œé€»è¾‘12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152final void runWorker(Worker w) &#123; Thread wt = Thread.currentThread(); Runnable task = w.firstTask; w.firstTask = null; // for GC // å…è®¸å¤–éƒ¨ä¸­æ–­ w.unlock(); // allow interrupts // ç”¨äºåˆ¤è¯»æ˜¯å¦è¿›å…¥è¿‡è‡ªæ—‹ boolean completedAbruptly = true; try &#123; // è‡ªæ—‹ // å¦‚æœtaskä¸ä¸ºç©ºï¼Œåˆ™å¼€å§‹æ‰§è¡Œtask // å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ä»é˜Ÿåˆ—ä¸­è·å–taskå¼€å§‹æ‰§è¡Œ // é˜»å¡é˜Ÿåˆ—çš„ç‰¹æ€§ï¼šå°±æ˜¯å½“é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ while (task != null || (task = getTask()) != null) &#123; w.lock(); // If pool is stopping, ensure thread is interrupted; // if not, ensure thread is not interrupted. This // requires a recheck in second case to deal with // shutdownNow race while clearing interrupt // å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œåˆ™å¯¹å½“å‰çº¿ç¨‹ä¸­æ–­ if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try &#123; // beforeExecuteå’ŒafterExecute æ˜¯ä¸ºæ‰©å±•åŠŸèƒ½ç”¨çš„ï¼Œåœ¨å½“å‰ç±»å®ç°é»˜è®¤ä¸ºç©º beforeExecute(wt, task); Throwable thrown = null; try &#123; task.run(); &#125; catch (RuntimeException x) &#123; thrown = x; throw x; &#125; catch (Error x) &#123; thrown = x; throw x; &#125; catch (Throwable x) &#123; thrown = x; throw new Error(x); &#125; finally &#123; afterExecute(task, thrown); &#125; &#125; finally &#123; task = null; // for GC w.completedTasks++; // å·²å®Œæˆä»»åŠ¡æ•°åŠ ä¸€ w.unlock(); &#125; &#125; completedAbruptly = false; //è¡¨ç¤ºå·²ç»è‡ªæ—‹å®Œæˆ &#125; finally &#123; // è‡ªæ—‹æ“ä½œè¢«é€€å‡ºï¼Œè¯´æ˜çº¿ç¨‹æ± æ­£åœ¨ç»“æŸï¼Œè¦æŠŠwc--ï¼Œå¹¶ä¸”ä»workersåˆ é™¤å½“å‰worker processWorkerExit(w, completedAbruptly); &#125;&#125; è¿™é‡Œç›¸å½“äºç”¨åˆ°äº†ä¸€ç§è£…é¥°è€…æ¨¡å¼ï¼Œå°†ä¸€ä¸ªtaskåŒ…è£…æˆä¸€ä¸ªå¸¦æœ‰é”ç‰¹æ€§çš„æ‰§è¡Œè€…ã€‚è¿™ä¸ªæ‰§è¡Œè€…ä¸ä»…å¯ä»¥æ¶ˆè´¹å½“å‰çš„ä»»åŠ¡ï¼ŒgetTask è¿˜èƒ½ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ¶ˆè´¹ï¼Œå½“é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šè¢«é˜»å¡ä½ã€‚å½“æœ‰ä»»åŠ¡è¿‡æ¥çš„æ—¶å€™ï¼Œåˆå¯ä»¥æ‰§è¡Œäº†ã€‚å½“ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼ŒprocessWorkerExit æ–¹æ³•æ˜¯çº¿ç¨‹workerçš„å‡ºå£ã€‚ä»–ä¼šå¤„ç†wcå’Œworkersé›†åˆï¼Œå¹¶ä¸”å°è¯•å°†å½“å‰çº¿ç¨‹ä¸­æ–­ã€‚ å‚è€ƒï¼š Deep understanding of thread pool ThreadPool Executor Do you know the underlying implementation of thread pools?Thread Pool Module Summary èƒ½è¯´è¯´ä»€ä¹ˆæ˜¯çº¿ç¨‹å—ï¼Ÿçº¿ç¨‹æ¨¡å—æ€»ç»“]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>threadpool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AQSä¸ReentrantLock]]></title>
    <url>%2F2020%2F03%2F16%2Fconcurrentart%2Faqs%2F</url>
    <content type="text"><![CDATA[å®šä¹‰AQSæ˜¯å¹¶å‘ä½“ç³»ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç±»ï¼ŒReentrantLockå°±æ˜¯åŸºäºAQSå®ç°çš„ï¼ŒAQSåº•å±‚ä½¿ç”¨äº†LockSupportç±»å®ç°å¯¹çº¿ç¨‹çš„ç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼Œç›¸æ¯”äºwaitå’Œnotifyæ–¹æ³•ï¼Œä½¿ç”¨çš„æ›´åŠ çš„çµæ´»ï¼Œæ‰€ä»¥ï¼Œè¦å­¦ä¹ å¹¶å‘çº¿ç¨‹çš„åº•å±‚çŸ¥è¯†ï¼Œè¿™ä¸ªç±»ä½ å¿…é¡»è¦å­¦æ˜ç™½ã€‚ åˆå§‹åŒ–é»˜è®¤åˆå§‹åŒ–ï¼Œä¸ºéå…¬å¹³é”ï¼Œä¸ºä»€ä¹ˆï¼Ÿ 1234567891011121314151617/** * Creates an instance of &#123;@code ReentrantLock&#125;. * This is equivalent to using &#123;@code ReentrantLock(false)&#125;. */public ReentrantLock() &#123; sync = new NonfairSync();&#125;/** * Creates an instance of &#123;@code ReentrantLock&#125; with the * given fairness policy. * * @param fair &#123;@code true&#125; if this lock should use a fair ordering policy */public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; Syncç±»ä»–ä»¬éƒ½æ˜¯ç»§æ‰¿SyncæŠ½è±¡ç±»ï¼ŒSyncç»§æ‰¿äº†AQSAbstractQuenedSynchronizer æŠ½è±¡ç±»ï¼ŒAQSæ˜¯å¹¶å‘é‡Œé¢ååˆ†é‡è¦çš„ä¸€ä¸ªç±»ï¼Œjdk1.7ä¸­ConcurrentHashMapæ›¾ä½¿ç”¨è¿‡ReentranLockç”¨äºåˆ†æ®µé”ï¼Œåœ¨çº¿ç¨‹æ± ä¸­Worker(ä»»åŠ¡å•å…ƒ)ä¹Ÿæ˜¯ç”¨åˆ°äº†AQSã€‚å› æ­¤ï¼Œè¦å­¦ä¹ å¹¶å‘ï¼Œå¿…é¡»æŠŠè¿™ä¸ªç±»å­¦æ˜ç™½ã€‚ ç±»å›¾ AQSç±»123456789101112131415public abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer implements java.io.Serializable &#123; private transient volatile Node head; private transient volatile Node tail; private volatile int state; static final class Node &#123; volatile int waitStatus; volatile Node prev; volatile Node next; volatile Thread thread; Node nextWaiter; &#125;&#125; åœ¨AQSå†…éƒ¨ç»´æŠ¤äº†stateå­—æ®µï¼Œè¡¨ç¤ºå½“å‰èµ„æºæ˜¯å¦å·²ç»æœ‰çº¿ç¨‹å¯¹ä»–è¿›è¡Œäº†åŠ é”ï¼Œæ¯ä¸€æ¬¡åŠ é”ï¼Œè¯¥å€¼éƒ½ä¼šåŠ ä¸€ï¼Œæ¯æ¬¡è§£é”ï¼Œè¯¥å€¼éƒ½ä¼šå‡ä¸€ã€‚ æºç lockåœ¨lockæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒè°ƒç”¨äº†sync.lock()ï¼Œsync.lockè°ƒç”¨äº†acquire(1). 12345678910public void lock() &#123; sync.lock();&#125;static final class FairSync extends Sync &#123; private static final long serialVersionUID = -3000897897090466540L; final void lock() &#123; acquire(1); &#125;&#125; å†è·Ÿè¿›åˆ°acquire(1)é‡Œï¼Œå¯ä»¥çœ‹åˆ°AQSçš„ä¸€ä¸ªæ¨¡æ¿æ–¹æ³• 12345678public abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer implements java.io.Serializable &#123; public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))&#123; selfInterrupt(); &#125; &#125;&#125; è¿™é‡Œå¯ä»¥çŸ¥é“acquireå¹²äº†ä¸‰ä»¶äº‹æƒ… tryAcquireï¼šå½“å‰çº¿ç¨‹å°è¯•è·å¾—é”ï¼ˆstateï¼‰ï¼Œå¦‚æœè·å¾—é”æˆåŠŸï¼Œåˆ™ç»“æŸã€‚å¦‚æœè·å–å¤±è´¥ï¼Œè¿›å…¥æ­¥éª¤2 addWaiterï¼šæ·»åŠ ä¸€ä¸ªç­‰å¾…è€…ï¼Œå°†å½“å‰çº¿ç¨‹ä»¥æ’ä»–å½¢å¼æ‰”åˆ°é˜Ÿåˆ—é‡Œé¢ acquireQueuedï¼šä»¥æ’é˜Ÿçš„æ–¹å¼å°†é˜»å¡çš„çº¿ç¨‹ä¸€ä¸ªä¸€ä¸ªå”¤é†’ tryAcquireFairSyncå¯¹tryAcquireçš„å®ç° 12345678910111213141516171819202122232425262728293031static final class FairSync extends Sync &#123; private static final long serialVersionUID = -3000897897090466540L; final void lock() &#123; acquire(1); &#125; /** * Fair version of tryAcquire. Don't grant access unless * recursive call or no waiters or is first. */ protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false; &#125;&#125; é¦–å…ˆæ˜¯å…ˆæ‹¿åˆ°å½“å‰çº¿ç¨‹ï¼Œè·å–å½“å‰stateå€¼ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦ç­‰äº0ï¼Œç­‰äº0è¡¨ç¤ºæˆ‘å½“å‰å¯ä»¥å¯¹ä»–è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯å…¬å¹³é”æˆ‘éœ€è¦å»æ£€æŸ¥ä¸€ä¸‹é˜Ÿåˆ—ï¼Œçœ‹å½“å‰é˜Ÿåˆ—æ˜¯å¦æœ‰åˆ«çš„çº¿ç¨‹å·²ç»åœ¨æ’é˜Ÿäº†ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±ä¸å»CASï¼Œè¿”å›falseï¼Œå¦‚æœæ²¡æœ‰ï¼ˆå³ä¸ºç©ºæˆ–è€…å½“å‰çº¿ç¨‹æ˜¯é˜Ÿå¤´ï¼‰ï¼Œå°±å»CASè·å–é”ï¼Œè¿”å›trueï¼ŒhasQueuedPredecessorså®ç°å¦‚ä¸‹ï¼š 123456789101112131415/* @return &#123;@code true&#125; if there is a queued thread preceding the * current thread, and &#123;@code false&#125; if the current thread * is at the head of the queue or the queue is empty * @since 1.7 */public final boolean hasQueuedPredecessors() &#123; // The correctness of this depends on head being initialized // before tail and on head.next being accurate if the current // thread is first in queue. Node t = tail; // Read fields in reverse initialization order Node h = head; Node s; return h != t &amp;&amp; ((s = h.next) == null || s.thread != Thread.currentThread());&#125; æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„è¯ï¼Œå°±ç»™è‡ªå·±ä¸Šé”ï¼Œä½¿ç”¨CAS(compareAndSetState)å°†stateä»0è®¾ç½®ä¸º1ï¼Œå¦‚æœè¿™ä¸­é—´stateè¢«åˆ«çš„çº¿ç¨‹æ”¹äº†ï¼Œåˆ™åŠ é”å¤±è´¥ï¼Œè¿”å›falseã€‚ å¦‚æœstate!=0çš„è¯ï¼Œä¼šæ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯æ‹¥æœ‰é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œå°†state+1ï¼Œè¡¨ç¤ºé‡å…¥ã€‚ addWaiterå½“tryAcquireæ‹¿åˆ°é”ä»¥åå°±ç»“æŸäº†ï¼Œè¡¨ç¤ºåŠ é”æˆåŠŸã€‚å¦‚æœæ‹¿ä¸åˆ°é”ï¼Œé‚£ä¹ˆå°±å°†è°ƒç”¨addWaiteræ–¹æ³•ï¼Œå°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾ç«¯ï¼Œç›¸å½“äºæ’é˜Ÿç­‰å¾…è¢«å”¤é†’å˜›ï¼Œæ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚ 1234567891011121314151617181920212223242526272829303132/** * Creates and enqueues node for current thread and given mode. * * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared * @return the new node */private Node addWaiter(Node mode) &#123; Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; if (pred != null) &#123; node.prev = pred; if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; for (;;) &#123; Node t = tail; if (t == null) &#123; // Must initialize if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125; return node;&#125; addWaiteræ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šäº†ä¼ Node.EXCLUSIVE æ’ä»–é”æˆ–è€…æ˜¯Node.SHARED å…±äº«é”ï¼ŒaddWaiteråšäº†ä¸¤ä»¶äº‹æƒ…ï¼š ä¸€ä¸Šæ¥å°±ä½¿ç”¨ä¸€æ¬¡CASå°†è¦æ·»åŠ çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼Œè¿™æ˜¯åœ¨é˜Ÿåˆ—ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹æ“ä½œçš„ï¼Œæ‰€ä»¥å¾—å…ˆåˆ¤æ–­ä¸€ä¸‹ã€‚ å¦‚æœå¤±è´¥çš„è¯ï¼Œé‚£è¯´æ˜æœ‰ç«äº‰ï¼Œå·²ç»æœ‰çº¿ç¨‹ä¹Ÿåœ¨å¾€é˜Ÿåˆ—é‡Œé¢æ’ï¼Œé‚£ä¹ˆæˆ‘å°±ä¸æ–­çš„è¯•ï¼Œç›´åˆ°å°†çº¿ç¨‹ç»­æ¥åœ¨é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚ acquireQueuedå½“çº¿ç¨‹æ’å…¥åˆ°é˜Ÿåˆ—ä¸­åï¼Œé‚£ä¹ˆé˜Ÿåˆ—é‡Œçš„çº¿ç¨‹ä¼šæ’é˜Ÿçš„å»è·å¾—é”ï¼Œé‚£ä¹ˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿï¼ˆè¿™äº›çº¿ç¨‹æ˜¯ä¸æ˜¯å…¨é˜»å¡äº†å•Šï¼‰ 1234567891011121314151617181920212223242526272829/** * Acquires in exclusive uninterruptible mode for thread already in * queue. Used by condition wait methods as well as acquire. * * @param node the node * @param arg the acquire argument * @return &#123;@code true&#125; if interrupted while waiting */final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; é¦–å…ˆå®ƒçœ‹ä¸€çœ‹å‰ç½®èŠ‚ç‚¹æ˜¯ä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£å°±é˜»å¡parkAndCheckInterruptã€‚å¦‚æœæ˜¯ï¼Œé‚£å°±å°è¯•è·å–é”ï¼Œè¿™é‡Œä¼šå’Œå¤´èŠ‚ç‚¹äº§ç”Ÿç«äº‰ï¼Œå¦‚æœç«äº‰åˆ°é”ï¼Œè¡¨ç¤ºå¤´èŠ‚ç‚¹å·²ç»é‡Šæ”¾äº†ï¼ˆå› ä¸ºå¤´èŠ‚ç‚¹æ€»æ˜¯å…ˆè·å¾—é”ï¼Œç­‰é‡Šæ”¾åæ‰ä¼šå”¤é†’é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹ï¼‰ï¼Œç„¶åå°†å½“å‰èŠ‚ç‚¹ç½®ä¸ºå¤´èŠ‚ç‚¹ã€‚å¦‚æœæ²¡æœ‰ç«äº‰åˆ°é”ï¼Œè¯´æ˜å¤´èŠ‚ç‚¹è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œç„¶åæ£€æŸ¥ä¸€ä¸‹ï¼Œåœæ­¢å°è¯•é‡Šæ”¾é”cancelAcquire unlocké‚£ä¹ˆï¼Œç¨‹åºæ˜¯å¦‚ä½•é‡Šæ”¾é”å¹¶ä¸”é‡Šæ”¾å®Œåï¼Œæ˜¯å¦‚ä½•é€šçŸ¥åˆ°çš„åç½®èŠ‚ç‚¹çš„å‘¢ï¼Œæœ‰å¿…è¦å»çœ‹ä¸€ä¸‹unlockæ–¹æ³•äº† unlockæ–¹æ³•è°ƒç”¨äº†sync.release(1)æ–¹æ³•ï¼ŒAQSå¯¹è¯¥æ–¹æ³•å®ç°å¦‚ä¸‹ 12345678910111213141516171819/** * Releases in exclusive mode. Implemented by unblocking one or * more threads if &#123;@link #tryRelease&#125; returns true. * This method can be used to implement method &#123;@link Lock#unlock&#125;. * * @param arg the release argument. This value is conveyed to * &#123;@link #tryRelease&#125; but is otherwise uninterpreted and * can represent anything you like. * @return the value returned from &#123;@link #tryRelease&#125; */public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false;&#125; è¿™é‡Œå¹²äº†ä¸¤ä»¶äº‹æƒ…ï¼š tryReleaseï¼šé‡Šæ”¾é” unparkSuccessorï¼šå”¤é†’å¤´èŠ‚ç‚¹ tryReleaseé‡Šæ”¾é”å¾ˆç®€å•ï¼Œå°†state-1ï¼Œå¦‚æœæ˜¯0çš„è¯ï¼Œéœ€è¦å°†é”çš„å½“å‰æ‹¥æœ‰è€…ç½®ä¸ºç©ºã€‚ 123456789101112protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); return free;&#125; unparkSuccessorè¿™é‡Œå”¤é†’çš„è¯ï¼Œä¸æ˜¯å”¤é†’é˜Ÿåˆ—é‡Œçš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œæ˜¯å”¤é†’é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹ï¼Œå› æ­¤åœ¨å”¤é†’ä¹‹å‰éœ€è¦åˆ¤æ–­ä¸€ä¸‹é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚ 12345678910111213141516171819202122232425262728293031/** * Wakes up node's successor, if one exists. * * @param node the node */private void unparkSuccessor(Node node) &#123; /* * If status is negative (i.e., possibly needing signal) try * to clear in anticipation of signalling. It is OK if this * fails or if status is changed by waiting thread. */ int ws = node.waitStatus; if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); /* * Thread to unpark is held in successor, which is normally * just the next node. But if cancelled or apparently null, * traverse backwards from tail to find the actual * non-cancelled successor. */ Node s = node.next; if (s == null || s.waitStatus &gt; 0) &#123; s = null; for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) LockSupport.unpark(s.thread);&#125; å¯ä»¥çœ‹åˆ°AQSå†…éƒ¨å¯¹æ¯ä¸€ä¸ªçº¿ç¨‹NodeåŒæ—¶ç»´æŠ¤ä¸€ä¸ªwaitStatuså­—æ®µï¼Œè¿™æ˜¯å”¤é†’å…¶ä»–çº¿ç¨‹çš„æ ¸å¿ƒã€‚å¦‚æœé˜Ÿåˆ—ä¸­çº¿ç¨‹è¢«ä¸ºç©ºæˆ–è€…è¢«cancelledï¼Œå°±ä¼šé€’å½’æ‰¾åˆ°æ²¡æœ‰cancelledçš„é‚£ä¸ªèŠ‚ç‚¹ã€‚ å…¬å¹³é”ä¸éå…¬å¹³é”é‚£ä¹ˆï¼Œå­¦åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ¥å›ç­”ä¸€ä¸‹å¼€å¤´é‚£ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦é»˜è®¤ä¸ºéå…¬å¹³é”ï¼Ÿå…¬å¹³é”ä¸éå…¬å¹³é”çš„åŒºåˆ«ï¼Ÿ çœ‹è¿‡ä»£ç çŸ¥é“ï¼Œå…¬å¹³é”æ˜¯è¦æ’é˜Ÿçš„ï¼Œå½“çº¿ç¨‹ç«äº‰æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”ã€‚å…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯ç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ã€‚ç¼ºç‚¹æ˜¯æ•´ä½“ååæ•ˆç‡ç›¸å¯¹éå…¬å¹³é”è¦ä½ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­é™¤ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼ŒCPUå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§ã€‚ é‚£ä¹ˆéå…¬å¹³é”æ˜¯ä»€ä¹ˆä¸ªæ¦‚å¿µå‘¢ï¼Ÿéå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚ä½†å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”ï¼Œæ‰€ä»¥éå…¬å¹³é”æœ‰å¯èƒ½å‡ºç°åç”³è¯·é”çš„çº¿ç¨‹å…ˆè·å–é”çš„åœºæ™¯ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPUä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚ç¼ºç‚¹æ˜¯å¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”ã€‚ å¯¹æ¯”ä¸€ä¸‹ä»£ç ï¼Œä¹Ÿæ˜¯è°ƒç”¨äº†sync.lockæ–¹æ³• 123456789101112131415161718192021/** * Sync object for non-fair locks */static final class NonfairSync extends Sync &#123; private static final long serialVersionUID = 7316153563782823691L; /** * Performs lock. Try immediate barge, backing up to normal * acquire on failure. */ final void lock() &#123; if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1); &#125; protected final boolean tryAcquire(int acquires) &#123; return nonfairTryAcquire(acquires); &#125;&#125; è¿™é‡Œï¼Œä¸€æ¥å°±å»ä½¿ç”¨CASå°è¯•è·å–é”ï¼Œå¦‚æœåˆšå¥½é”é‡Šæ”¾äº†ï¼Œé˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹è¿˜æ²¡åŠ é”ï¼Œå½“å‰çº¿ç¨‹å°±æœ‰å¯èƒ½æ‹¥æœ‰è¿™æŠŠé”ã€‚å¦åˆ™çš„è¯ï¼Œè°ƒç”¨ acquire(1)æ–¹æ³• 12345public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt();&#125; acquireæ¨¡ç‰ˆæ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œåˆ†ä¸‰æ­¥ï¼šåŠ é”ã€åŠ é”ä¸è¡Œæ”¾ç­‰å¾…é˜Ÿåˆ—ï¼Œçœ‹çœ‹æ’é˜Ÿæ˜¯å¦åˆ°æˆ‘è·å–é”äº†ã€‚ å”¯ä¸€çš„åŒºåˆ«æ˜¯tryAcquireçš„å®ç°æ–¹å¼ã€‚è¿™é‡Œä¸ä¼šå»æ£€æŸ¥é˜Ÿåˆ—hasQueuedPredecessorsï¼Œå› ä¸ºéå…¬å¹³é”ï¼Œæ˜¯æ— åºçš„ï¼Œå¦‚æœstateä¸º0çš„è¯ï¼Œå°±ç›´æ¥ä½¿ç”¨ä¸€æ¬¡CASç«äº‰ï¼Œè°å…ˆæ‹¿åˆ°é”ï¼Œè°å°±å…ˆæ‰§è¡Œï¼Œå¦åˆ™å°±é˜»å¡ç­‰å¾…ã€‚ 12345678910111213141516171819202122/** * Performs non-fair tryLock. tryAcquire is implemented in * subclasses, but both need nonfair try for trylock method. */final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false;&#125; æ€»ç»“ç»¼ä¸Šï¼Œå…¬å¹³é”å°±æ˜¯é€šè¿‡åŒæ­¥é˜Ÿåˆ—æ¥å®ç°å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œä»è€Œå®ç°å…¬å¹³çš„ç‰¹æ€§ã€‚éå…¬å¹³é”åŠ é”æ—¶ä¸è€ƒè™‘æ’é˜Ÿç­‰å¾…é—®é¢˜ï¼Œç›´æ¥å°è¯•è·å–é”ï¼Œæ‰€ä»¥å­˜åœ¨åç”³è¯·å´å…ˆè·å¾—é”çš„æƒ…å†µã€‚]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>AQS</tag>
        <tag>ReentrantLock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³•]]></title>
    <url>%2F2020%2F03%2F14%2Falgorithm%2Fsortway-algorithm%2F</url>
    <content type="text"><![CDATA[ä»Šæ—¥å¤ä¹ ä»»åŠ¡ï¼šå®ç°æ•°æ®ä»å°åˆ°å¤§çš„æ’åºæ–¹å¼ï¼Œåˆ†åˆ«æœ‰å†’æ³¡ã€é€‰æ‹©ã€æ’å…¥ã€å¿«æ’ã€å½’å¹¶ å†’æ³¡æ’åºæ€æƒ³ï¼šå¤§çš„æ•°å¾€å¾€ä¸Šå†’ï¼Œæ¯éå†ä¸€æ¬¡ï¼Œåé¢çš„å‡ ä½æ˜¯æ’å¥½é¡ºåºçš„ã€‚ç¬¬ä¸€æ¬¡éå†å¾—åˆ°æœ€å¤§çš„æ•°ï¼Œåœ¨æœ«å°¾ï¼Œç¬¬äºŒæ¬¡éå†ï¼Œæ¬¡å¤§çš„æ•°åœ¨å€’æ•°ç¬¬äºŒä½ï¼Œéœ€è¦éå†n-1æ¬¡ï¼Œæ‰€æœ‰çš„æ‰èƒ½æ’å¥½é¡ºåºã€‚ 12345678910111213 /** * @Description é€‰æ‹©æ’åº * TODO æ—¶é—´å¤æ‚åº¦ O(n^2) **/public static void maoPaoSort(int[] arr) &#123; for (int i = 0; i &lt; arr.length; i++) &#123; for (int j = 0; j &lt; arr.length - i - 1; j++) &#123; if (arr[j] &gt; arr[j + 1]) &#123; swap(arr, j, j+1); &#125; &#125; &#125;&#125; ä¼˜åŒ– 123456789101112131415161718/*** @Description é€‰æ‹©æ’åº* TODO æ€§èƒ½ä¼˜åŒ– å¯¹äºå·²ç»æ’å¥½åºçš„éƒ¨åˆ†ï¼Œç›´æ¥é€€å‡ºå¤–éƒ¨å¾ªç¯ï¼Œå› ä¸ºå­˜åœ¨é‡å¤æ¯”è¾ƒã€‚**/public static void bubbleSort(int[] arr) &#123; for (int i = 0; i &lt; arr.length - 1; i++) &#123; boolean isOrder = true; for (int j = 0; j &lt; arr.length - i - 1; j++) &#123; if (arr[j] &gt; arr[j + 1]) &#123; swap(arr, j, j + 1); isOrder = false; &#125; &#125; if (isOrder) &#123; break; &#125; &#125;&#125; ç”±äºæœ‰å¤§é‡çš„é‡å¤æ¯”è¾ƒï¼Œåœ¨æ¯æ¬¡æ¯”è¾ƒçš„æ—¶å€™ï¼Œç”¨ä¸€ä¸ªå˜é‡æ ‡è¯†è¡¨ç¤ºè¿™è½®éå†æ˜¯å¦éƒ½å·²ç»æ’å¥½é¡ºåºäº†ï¼Œå¦‚æœéƒ½æ’å¥½é¡ºåºäº†ï¼Œå°±ç›´æ¥è·³å‡ºå¾ªç¯ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œå½“æ’å¥½åºçš„æƒ…å†µä¸‹ï¼Œæ˜¯æœ€å¥½çš„æƒ…å†µï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚æœ€åæƒ…å†µæ˜¯O(n^2),å¯¹äºåŒæ ·å¤§å°çš„æ•°æ˜¯ä¸éœ€è¦ç§»åŠ¨çš„ï¼Œå¯ä»¥ä¿è¯ä¹‹å‰çš„é¡ºåºï¼Œæ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚ é€‰æ‹©æ’åºæ€æƒ³ï¼šæœ‰ç‚¹ç±»ä¼¼å†’æ³¡ï¼Œæ¯æ¬¡ä¹Ÿæ˜¯å¾—åˆ°ä¸€ä¸ªæ’å¥½é¡ºåºçš„ä½ç½®ã€‚é€‰æ‹©ä¸€ä¸ªæ•°ï¼Œé€ä¸ªè·Ÿå…¶ä»–çš„æ¯”è¾ƒå¤§å°ã€‚æ¯”å¦‚ï¼Œå–ç¬¬ä¸€ä¸ªï¼Œå¦‚æœæœ‰æ¯”å®ƒå°çš„æ•°ï¼Œåˆ™äº¤æ¢ä½ç½®ã€‚ 12345678910111213/** * @Description é€‰æ‹©æ’åº * TODO æœ€å¥½,æœ€åï¼Œå¹³å‡çš„æƒ…å†µ éƒ½æ˜¯ n^2 ã€ä¸ç¨³å®šã€‘ **/public static void selectSort(int[] arr) &#123; for (int i = 0; i &lt; arr.length - 1; i++) &#123; for (int j = i + 1; j &lt; arr.length; j++) &#123; if (arr[i] &gt; arr[j]) &#123; swap(arr, i, j); &#125; &#125; &#125;&#125; é€‰æ‹©æ’åºä¸ç®¡æ˜¯æœ‰åºæ— åºéƒ½ä¼šè¿›è¡Œé€‰æ‹©æ¯”è¾ƒï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n^2)ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯ç¨³å®šçš„ï¼Ÿ å› ä¸ºæ¯æ¬¡æ¯”è¾ƒéƒ½å¯èƒ½ä¼šäº¤æ¢é—®é¢˜ï¼Œæ¯”å¦‚3ï¼Œ2ï¼Œ2ï¼Œ1ï¼Œ1ï¼Œç›¸é‚»çš„ä¸¤ä¸ª2åœ¨ç¬¬ä¸€è½®éå†çš„æ—¶å€™é¡ºåºå°±æ‰“ä¹±äº†ã€‚ æ’å…¥æ’åºæ€æƒ³ï¼šæŠŠå…ƒç´ åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå‰éƒ¨åˆ†æ˜¯æ’å¥½é˜Ÿçš„éƒ¨åˆ†ï¼Œåéƒ¨åˆ†æ˜¯è¿˜æ²¡æœ‰æ’å¥½é˜Ÿçš„ï¼Œå½“ç¬¬ä¸€æ¬¡éå†æ—¶ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ’å¥½é˜Ÿçš„ï¼Œç¬¬äºŒä¸ªåŠä¹‹åçš„å…ƒç´ æ˜¯éœ€è¦æ’å…¥åˆ°å‰é¢çš„ï¼Œæ‰€ä»¥æ¯æ¬¡éå†çš„æ—¶å€™ï¼Œæ‹¿ç¬¬i+1ä¸ªå…ƒç´ ä¸å‰é¢çš„å…ƒç´ é€ä¸ªæ¯”è¾ƒï¼Œå¦‚æœå°äºï¼Œäº¤æ¢å…ƒç´ ã€‚æŒ‡é’ˆjç»§ç»­å¾€å‰ç§»åŠ¨ï¼Œç›´åˆ°arr[i]å¤§äºarr[j]æˆ–è€…j&lt;=0 1234567891011/** * @Description æ’å…¥æ’åº * TODO æ—¶é—´å¤æ‚åº¦ O(n^2) æœ€åO(n^2) æœ€å¥½ O(n) ç¨³å®š **/ public static void chaRuSort(int arr[]) &#123; for (int i = 0; i &lt; arr.length - 1; i++) &#123; for (int j = i + 1; j &gt; 0 &amp;&amp; arr[j - 1] &gt; arr[j]; j--) &#123; swap(arr, j - 1, j); &#125; &#125;&#125; ä¼˜åŒ– 123456789101112/** * @Description æ’å…¥æ’åº * TODO æœ€å¥½çš„æƒ…å†µ n^2,æœ€åçš„æƒ…å†µï¼Œn^2,å¹³å‡æƒ…å†µ n^2 ã€ç¨³å®šã€‘ **/public static void insertSort(int[] arr) &#123; for (int i = 1; i &lt; arr.length; i++) &#123; int key = arr[i]; for (int j = i - 1; j &gt;= 0 &amp;&amp; key &lt; arr[j]; j--) &#123; swap(arr, j + 1, j); &#125; &#125;&#125; åŸç†æ˜¯ä¸€æ ·çš„ï¼Œæ›´åŠ å®¹æ˜“ç†è§£ä¸€äº›ï¼Œå¹¶ä¸”æ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºæ¯æ¬¡æ¯”è¾ƒçš„æ—¶å€™å¯ä»¥åˆ©ç”¨å±€éƒ¨æ€§ç¼“å­˜åŸç†ã€‚ ä¼˜åŒ– 1234567891011121314/** * @Description æ’å…¥æ’åº * TODO å¯¹swapæ–¹æ³•çš„ä¼˜åŒ–ï¼Œé¿å…å¤šæ¬¡æ•°æ®çš„èµ‹å€¼äº¤æ¢ **/public static void insertSort_improve(int[] arr) &#123; for (int i = 1; i &lt; arr.length; i++) &#123; int key = arr[i]; int j; for (j = i - 1; j &gt;= 0 &amp;&amp; arr[j] &gt; key; j--) &#123; arr[j + 1] = arr[j]; &#125; arr[j + 1] = key; &#125;&#125; è·Ÿå‰ä¸€ç§æ€æƒ³ä¸€æ ·ï¼Œåªæ˜¯æ²¡æœ‰ä½¿ç”¨swapæ–¹æ³•äº†ï¼Œå‰é¢éå†ï¼Œç§»åŠ¨ä½ç½®ï¼Œæœ€åæ‰¾åˆ°keyåº”è¯¥æ’å…¥çš„ä½ç½®ï¼Œèµ‹å€¼å°±OKã€‚ ä¼˜åŒ– 12345678910111213141516/** * @Description æ’å…¥æ’åº * TODO é¿å…ä¸å¿…è¦çš„é‡å¤ï¼Œæœ€å¥½æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦ä¸º n(o) **/public static void insertSortImprove(int[] arr) &#123; for (int i = 1; i &lt; arr.length; i++) &#123; int key = arr[i]; for (int j = i - 1; j &gt;= 0; j--) &#123; if (key &lt; arr[j]) &#123; swap(arr, j + 1, j); &#125; else &#123; break; &#125; &#125; &#125;&#125; é¿å…ä¸å¿…è¦çš„é‡å¤æ¯”è¾ƒï¼Œå¦‚æœä¸€å¼€å§‹æ¯”è¾ƒæ¯”å‰é¢çš„æ•°å°ï¼Œé‚£ç›´æ¥è·³å‡ºæœ¬æ¬¡å†…éƒ¨å¾ªç¯ã€‚ å¿«é€Ÿæ’åºæ€æƒ³ï¼šé€‰æ‹©ä¸€ä¸ªå“¨å…µï¼Œä»¥è¿™ä¸ªä¸ºåŸºå‡†ï¼Œå¯¹å‰©ä½™çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå°çš„æ’å·¦è¾¹ï¼Œå¤§çš„æ’å³è¾¹ã€‚å½“è¿›è¡Œå®Œä¸€æ¬¡éå†åï¼Œæ‰¾åˆ°äº†å½“å‰å“¨å…µæ‰€åº”è¯¥åœ¨çš„ä½ç½®ã€‚ç„¶åå¯¹å·¦å³ä¸¤éƒ¨åˆ†é€’å½’ï¼Œé€‰æ‹©å„è‡ªçš„å“¨å…µï¼Œè¿›è¡Œæ’åºï¼Œå½“æ’å®Œä¹‹åï¼Œå°±æ˜¯æœ‰åºçš„äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940/** * @Description å¿«é€Ÿæ’åº * TODO ä½¿ç”¨åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³,å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(nlgn) ä¸ç¨³å®šï¼Œäº¤æ¢æœ‰ç‚¹ç±»ä¼¼é€‰æ’ * æœ€åçš„æƒ…å†µæ˜¯é€‰åˆ°çš„å“¨å…µä¸¤ä¸ªæç«¯ï¼ˆæœ€å¤§å€¼/æœ€å°å€¼ï¼‰ï¼Œå¯¼è‡´O(n^2) **/public static void quick_sort(int[] arr) &#123; quick_Sort(arr, 0, arr.length - 1);&#125;private static void quick_Sort(int[] arr, int min, int max) &#123; if (max &gt; min) &#123; int partIndex = partition(arr, min, max); quick_Sort(arr, min, partIndex - 1); quick_Sort(arr, partIndex + 1, max); &#125;&#125;private static int partition(int[] arr, int min, int max) &#123; int key = arr[min]; while (max &gt; min) &#123; while (max &gt; min &amp;&amp; arr[max] &gt;= key) &#123; max--; &#125; // å°†ä»å³å¾€å·¦æ•°æ¯”å“¨å…µç¬¬ä¸€å°çš„æ•°èµ‹å€¼ç»™å·¦ä¾§ç¬¬ä¸€ä¸ªæ•° arr[min] = arr[max]; while (max &gt; min &amp;&amp; arr[min] &lt;= key) &#123; min++; &#125; // å°†ä»å·¦å¾€å³æ•°ç¬¬ä¸€ä¸ªæ¯”å“¨å…µå¤§çš„æ•°ï¼Œèµ‹å€¼ç»™maxå¤„çš„ä¸‹æ ‡ï¼Œå†æ¯”è¾ƒminä¸maxçš„å¤§å° // è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œç›´åˆ°min=max arr[max] = arr[min]; &#125; arr[max] = key; return max;&#125; ç¨‹åºæœ‰ä¸¤å¤„å®¹æ˜“çŠ¯é”™çš„åœ°æ–¹ï¼Œç¬¬ä¸€å¤„æ˜¯quick_Sort()æ–¹æ³•çš„é€’å½’è°ƒç”¨ï¼Œè°ƒç”¨å¤–éƒ¨é€’å½’æ˜¯å› ä¸ºï¼Œæ¯æ¬¡è¦ä½¿çš„å·¦å³ä¸¤è¾¹æœ‰åºã€‚ç¬¬äºŒå¤„æ˜¯partition()æ–¹æ³•æœ‰ä¸¤å¤„whileå¾ªç¯ï¼Œå½“å†…éƒ¨å¾ªç¯ä¹‹åï¼Œä¸¤å¤„çš„äº¤æ¢èµ‹å€¼ï¼Œéœ€è¦æ³¨æ„ã€‚ å¿«æ’çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ï¼Œå¯¹äºæ’å¥½åºï¼ˆå‡åºæˆ–è€…å€’åºï¼‰çš„æ•°ç»„ï¼Œè¡¨ç°çš„æ€§èƒ½æœ€å·®ï¼Œå› ä¸ºæ¯æ¬¡éå†ï¼Œé€‰æ‹©åˆ°çš„å“¨å…µæ˜¯æœ€å¤§çš„æˆ–è€…æœ€å°çš„ï¼Œå¯¼è‡´æ¯æ¬¡éå†å®Œï¼Œå·¦ä¾§çš„è¦ä¹ˆå…¨æ˜¯æœ€å¤§çš„æˆ–æ˜¯æœ€å°çš„ï¼Œå¯¼è‡´æ²¡æœ‰äºŒåˆ†çš„æ•ˆæœï¼Œæ—¶é—´å¤æ‚åº¦æ¥è¿‘äºO(n^2)ã€‚ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œé‡ç‚¹åœ¨äºé€‰æ‹©å“¨å…µçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ•°ç»„çš„ä¸­é—´çš„é‚£ä¸ªæ•°åšå“¨å…µï¼Œä¹Ÿèƒ½ä½¿ç”¨éšæœºæ•°é€‰æ‹©ï¼Œé¿å…å‡ºç°æœ€å¿«çš„æƒ…å†µã€‚ ä¸‰ä½æ•°å–ä¸­ 12int index = (min + max) / 2;int key = arr[index]; éšæœºé€‰æ‹©å“¨å…µ 123Random random = new Random(47);int index = random.nextInt(max - min) + min;int key = arr[index]; å½’å¹¶æ’åºæ€æƒ³ï¼šä½¿ç”¨åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ï¼Œå¯¹ä¸€ä¸ªå¤§çš„ä»»åŠ¡åˆ†è§£æˆå¤šä¸ªå­ä»»åŠ¡ï¼Œè¿›è¡Œå¤„ç†ï¼Œå°†å­ä»»åŠ¡å¤„ç†å®Œå¾—åˆ°çš„è§£åˆå¹¶ï¼Œå°±æ˜¯æ‰€æ±‚é—®é¢˜çš„è§£ã€‚åœ¨å½’å¹¶æ’åºä¸­ï¼Œå°†å¸¦æ’åºçš„å…ƒç´ åˆ†æˆå¤§å°å¤§è‡´ç›¸åŒçš„ä¸¤ä¸ªå­é›†åˆï¼Œåˆ†åˆ«å¯¹å­é›†åˆè¿›è¡Œæ’åºï¼ˆå…¶å®å¯¹å­é›†åˆæ’åºå¾ˆç®€å•ï¼Œå†å¯¹å­é›†åˆè¿›è¡Œåˆ†ï¼Œåˆ†ï¼Œåˆ†ï¼Œç›´åˆ°åˆ†æˆå•ä¸ªå…ƒç´ ï¼Œç„¶åå°†å•ä¸ªå…ƒç´ è¿›è¡Œä»å°åˆ°å¤§åˆå¹¶ï¼Œå¾—åˆ°çš„å°±æ˜¯æœ‰åºçš„å­é›†åˆï¼‰ï¼Œæœ€ç»ˆå°†æ’å¥½åºçš„å­é›†åˆåˆå¹¶æˆæ‰€è¦æ’å¥½åºçš„é›†åˆã€‚ å…¶åˆ†è€Œæ²»ä¹‹æ€æƒ³å®ç°ä¸ºï¼š 123456789101112131415/** * @return void * @Author chenjianrong-lhq * @Description å¹³å‡æ—¶é—´å¤æ‚åº¦ nlogn ç¨³å®š * @Date 2020-04-05 18:26 * @Param [arr, left, right] **/public static void mergeSort(int[] arr, int left, int right) &#123; if (left &lt; right) &#123; int middle = (left + right) &gt;&gt; 1; mergeSort(arr, left, middle); // åˆ† mergeSort(arr, middle + 1, right); merge(arr, left, middle, right); // æ²»ã€åˆ &#125;&#125; ä¸Šé¢ä¸€æ­¥å¾ˆå®¹æ˜“ç†è§£ï¼Œä¹Ÿæœ‰ç‚¹ç±»ä¼¼å¿«æ’ã€‚å…¶é‡è¦çš„å®ç°åœ¨äºå°†å•ä¸ªå…ƒç´ è¿›è¡Œä»å°åˆ°å¤§åˆå¹¶ï¼Œå…¶ä¸­é—´çš„è¿‡ç¨‹ä¼šäº§ç”Ÿå¤šä¸ªæœ‰åºçš„å­é›†åˆï¼Œå› ä¸ºæ¶‰åŠåˆ°é€’å½’ï¼Œå¿…ä¼šå¼€è¾Ÿå¤šä¸ªæ ˆç©ºé—´è¿›è¡Œæ–¹æ³•çš„è¿ç®—å’Œå­˜å‚¨ï¼Œæ‰€ä»¥ç›¸æ¯”äºéé€’å½’ï¼Œé€’å½’ç®—æ³•çš„è¿ç®—æ•ˆç‡è¾ƒä½ï¼Œåœ¨è®¡ç®—æ—¶é—´ä¸Šå’Œå ç”¨ç©ºé—´ä¸Šéƒ½å·®äºéé€’å½’å®ç°ã€‚å½“ç„¶ï¼Œå¯ä»¥æƒ³ä¸€æƒ³å¦‚ä½•æ¶ˆé™¤é€’å½’ï¼Œç”¨éé€’å½’æ–¹æ³•å®ç°å½’å¹¶æ’åºï¼Ÿ å°†å•ä¸ªå…ƒç´ è¿›è¡Œä»å°åˆ°å¤§åˆå¹¶å®ç°ï¼Œå¯ä»¥ç®€å•çš„æŠ½è±¡ä¸ºæœ‰ä¸¤ä¸ªæ’å¥½åºçš„é•¿åº¦ä¸ºn/2æ•°ç»„ï¼Œç°åœ¨è¦æŒ‰ç…§ä»å°åˆ°å¤§ç»„åˆæˆé•¿åº¦ä¸ºnçš„æ•°ç»„ï¼Œè¿™ç»„åˆçš„è¿‡ç¨‹ä¸­è¦è€ƒè™‘å¤šä¸ªä¸åŒçš„æƒ…å†µï¼Œå…±ä»¥ä¸‹ä¸‰ ç§ï¼š å·¦è¾¹çš„æ•°å…¨éƒ¨æ¯”å³è¾¹å° å³è¾¹çš„æ•°å…¨éƒ¨æ¯”å·¦è¾¹çš„å° å·¦è¾¹çš„æ•°æœ‰æ¯”å³è¾¹çš„å°ï¼Œä¹Ÿæœ‰æ¯”å³è¾¹çš„å¤§çš„ï¼ˆè¿™ä¸ªæ—¶å€™å…ˆå–å°çš„ï¼Œå†éå†æ¯”è¾ƒï¼‰ å…·ä½“ å®ç°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940private static void merge(int[] arr, int low, int middle, int high) &#123; // å®šä¹‰ç»„åˆåçš„æ•°ç»„ int[] temp = new int[arr.length]; // ç»„åˆæ•°ç»„çš„ä¸‹æ ‡æ ‡è¯† int k = low; // å·¦éƒ¨åˆ†çš„å¼€å§‹ä¸‹æ ‡ int i = low; // å³éƒ¨åˆ†çš„å¼€å§‹ä¸‹æ ‡ int j = middle + 1; // ä»å·¦è‡³å³å¼€å§‹éå† for (int m = low; m &lt; high; m++) &#123; if (m &gt; middle) &#123; // è¡¨ç¤ºå·¦è¾¹å…ƒç´ å·²ç»å¤„ç† temp[k] = arr[j]; k++; j++; &#125; else if (j &gt; high) &#123; // è¡¨ç¤ºå³è¾¹çš„å…ƒç´ å·²ç»å¤„ç† temp[k] = arr[i]; k++; i++; &#125; else if (arr[i] &gt; arr[j]) &#123; // è¡¨ç¤ºå·¦è¾¹çš„æ•°å¤§äºå³è¾¹ï¼Œå–å³è¾¹ temp[k] = arr[j]; k++; j++; &#125; else &#123; // è¡¨ç¤ºå·¦è¾¹çš„æ•°å°äºå³è¾¹ï¼Œå–å·¦è¾¹ temp[k] = arr[i]; k++; i++; &#125; &#125; // æ•°ç»„çš„æ‹·è´ for (int n = 0; n &lt; temp.length; n++) &#123; arr[n] = temp[n]; &#125;&#125; æ€»ç»“ä»¥ä¸Šå‡ ç§æ’åºæ˜¯æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„æ’åºï¼Œä¹Ÿæ˜¯é¢è¯•æ—¶å€™ç»å¸¸ä¼šé—®åˆ°çš„æ’åºï¼Œç†è§£æ¯ç§æ’åºçš„æ€æƒ³è¿œè¿œæ¯”è®°ä½ä»£ç æ›´é‡è¦ã€‚ æœ€åæˆ‘ä»¬æ€»ç»“å½’çº³ï¼š ç¨³å®šçš„æ’åºæœ‰ä¸‰ç§ï¼šå†’æ³¡ã€æ’å…¥ã€å½’å¹¶ åœ¨å·²ç»æ’å¥½åºçš„æƒ…å†µä¸‹ ï¼Œåº”è¯¥é€‰æ‹©å“ªå‡ ç§æ’åºï¼šä¼˜åŒ–çš„å†’æ³¡ã€æ’å…¥]]></content>
      <categories>
        <category>algorithm</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åŒå‘é“¾è¡¨LinkedList]]></title>
    <url>%2F2020%2F03%2F13%2Fcollection%2Flinkedlist%2F</url>
    <content type="text"><![CDATA[å®šä¹‰LinkedListçš„æœ¬è´¨æ˜¯åŒå‘é“¾è¡¨ï¼Œä¸ArrayListç›¸æ¯”ï¼ŒLinkedListçš„æ’å…¥å’Œåˆ é™¤é€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯éšæœºè®¿é—®é€Ÿåº¦åˆ™å¾ˆæ…¢ã€‚LinkedListé™¤äº†å®ç°AbstractLIstæŠ½è±¡ç±»å¤–ï¼Œè¿˜å®ç°äº†å¦ä¸€ä¸ªæ¥å£Dequeï¼Œå³double-ended queueï¼Œè¿™ä¸ªæ¥å£åŒæ—¶å…·æœ‰é˜Ÿåˆ—å’Œæ ˆçš„æ€§è´¨ã€‚ 123456789101112131415public class LinkedList&lt;E&gt; extends AbstractSequentialList&lt;E&gt; implements List&lt;E&gt;, Deque&lt;E&gt;, Cloneable, java.io.Serializable&#123; transient int size = 0; transient Node&lt;E&gt; first; transient Node&lt;E&gt; last; public LinkedList() &#123; &#125; public LinkedList(Collection&lt;? extends E&gt; c) &#123; this(); addAll(c); &#125;&#125; ç”±äºé“¾è¡¨æ˜¯ä½¿ç”¨èŠ‚ç‚¹çš„æ–¹å¼ï¼Œå°†å†…å­˜å•å…ƒé€šè¿‡é™„åŠ å¼•ç”¨çš„æ–¹å¼å…³è”çš„ï¼Œæ‰€ä»¥åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ˜¯ä¸éœ€è¦æŒ‡å®šå®¹é‡çš„ï¼Œä¹Ÿä¸å­˜åœ¨æ‰©å®¹ä¸€è¯´ã€‚ å¢æ·»LinkedListé»˜è®¤åœ¨å°¾éƒ¨å¢æ·»èŠ‚ç‚¹ï¼Œæ‰€ä»¥addæ–¹æ³•æ•ˆç‡æœ‰å¯èƒ½é«˜äºArrayListï¼Œå› ä¸ºæœ‰å¯èƒ½æ‰©å®¹ï¼Œæ¶‰åŠåˆ°æ•°ç»„çš„å¤åˆ¶ add(ele)12345678910111213141516public boolean add(E e) &#123; linkLast(e); return true;&#125;void linkLast(E e) &#123; final Node&lt;E&gt; l = last; final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); last = newNode; if (l == null) first = newNode; else l.next = newNode; size++; modCount++; &#125; add(index,ele)12345678public void add(int index, E element) &#123; checkPositionIndex(index); if (index == size) linkLast(element); else linkBefore(element, node(index));&#125; å½“æ’å…¥ä¸‹æ ‡ç­‰äºå°¾èŠ‚ç‚¹æ—¶ï¼Œæ’å…¥å°¾éƒ¨ï¼Œå¦åˆ™ï¼Œè°ƒç”¨ linkBeforeæ–¹æ³•ï¼Œæ’å…¥ä¸‹æ ‡å¤„ 123456789101112void linkBefore(E e, Node&lt;E&gt; succ) &#123; // assert succ != null; final Node&lt;E&gt; pred = succ.prev; final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ); succ.prev = newNode; if (pred == null) first = newNode; else pred.next = newNode; size++; modCount++;&#125; è¿™é‡Œç”¨åˆ°äº†nodeæ–¹æ³•ï¼Œå¯»æ‰¾ä¸‹æ ‡çš„ä½ç½®å…ƒç´  123456789101112131415Node&lt;E&gt; node(int index) &#123; // assert isElementIndex(index); if (index &lt; (size &gt;&gt; 1)) &#123; Node&lt;E&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123; Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œnodeæ–¹æ³•è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œä¸æ˜¯å…¨éƒ¨éå†çš„ï¼Œè€Œæ˜¯æ ¹æ®é è¿‘å¤´èŠ‚ç‚¹è¿˜æ˜¯å°¾èŠ‚ç‚¹è¿›è¡Œéå†ï¼ˆç›¸æ¯”äºå…¨éƒ¨éå†é€Ÿåº¦æå‡äº†ä¸€å€ï¼‰ åˆ é™¤remove(index)123456789101112131415161718192021222324252627282930public E remove(int index) &#123; checkElementIndex(index); return unlink(node(index));&#125;E unlink(Node&lt;E&gt; x) &#123; //ä½¿èŠ‚ç‚¹å¤±æ•ˆï¼Œæ–­æ‰é“¾æ¥ // assert x != null; final E element = x.item; final Node&lt;E&gt; next = x.next; final Node&lt;E&gt; prev = x.prev; if (prev == null) &#123; first = next; &#125; else &#123; prev.next = next; x.prev = null; &#125; if (next == null) &#123; last = prev; &#125; else &#123; next.prev = prev; x.next = null; &#125; x.item = null; size--; modCount++; return element; &#125; remove(obj)123456789101112131415161718public boolean remove(Object o) &#123; if (o == null) &#123; for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (x.item == null) &#123; unlink(x); return true; &#125; &#125; &#125; else &#123; for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (o.equals(x.item)) &#123; unlink(x); return true; &#125; &#125; &#125; return false;&#125; remove(obj)æ–¹æ³•æ˜¯å’ŒArrayListä¸€æ ·çš„ï¼Œä»å¤´å¼€å§‹éå†ï¼Œæ²¡ä»€ä¹ˆåŒºåˆ«ï¼ clear()12345678910111213141516public void clear() &#123; // Clearing all of the links between nodes is "unnecessary", but: // - helps a generational GC if the discarded nodes inhabit // more than one generation // - is sure to free memory even if there is a reachable Iterator for (Node&lt;E&gt; x = first; x != null; ) &#123; Node&lt;E&gt; next = x.next; x.item = null; x.next = null; x.prev = null; x = next; &#125; first = last = null; size = 0; modCount++;&#125; éå†1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798private class ListItr implements ListIterator&lt;E&gt; &#123; private Node&lt;E&gt; lastReturned; private Node&lt;E&gt; next; private int nextIndex; private int expectedModCount = modCount; ListItr(int index) &#123; // assert isPositionIndex(index); next = (index == size) ? null : node(index); nextIndex = index; &#125; public boolean hasNext() &#123; return nextIndex &lt; size; &#125; public E next() &#123; checkForComodification(); if (!hasNext()) throw new NoSuchElementException(); lastReturned = next; next = next.next; nextIndex++; return lastReturned.item; &#125; public boolean hasPrevious() &#123; return nextIndex &gt; 0; &#125; public E previous() &#123; checkForComodification(); if (!hasPrevious()) throw new NoSuchElementException(); lastReturned = next = (next == null) ? last : next.prev; nextIndex--; return lastReturned.item; &#125; public int nextIndex() &#123; return nextIndex; &#125; public int previousIndex() &#123; return nextIndex - 1; &#125; public void remove() &#123; checkForComodification(); if (lastReturned == null) throw new IllegalStateException(); Node&lt;E&gt; lastNext = lastReturned.next; unlink(lastReturned); if (next == lastReturned) next = lastNext; else nextIndex--; lastReturned = null; expectedModCount++; &#125; public void set(E e) &#123; if (lastReturned == null) throw new IllegalStateException(); checkForComodification(); lastReturned.item = e; &#125; public void add(E e) &#123; checkForComodification(); lastReturned = null; if (next == null) linkLast(e); else linkBefore(e, next); nextIndex++; expectedModCount++; &#125; public void forEachRemaining(Consumer&lt;? super E&gt; action) &#123; Objects.requireNonNull(action); while (modCount == expectedModCount &amp;&amp; nextIndex &lt; size) &#123; action.accept(next.item); lastReturned = next; next = next.next; nextIndex++; &#125; checkForComodification(); &#125; final void checkForComodification() &#123; if (modCount != expectedModCount) throw new ConcurrentModificationException(); &#125;&#125;]]></content>
      <categories>
        <category>collection</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArrayListé¡ºåºè¡¨]]></title>
    <url>%2F2020%2F03%2F11%2Fcollection%2Farraylist%2F</url>
    <content type="text"><![CDATA[å®šä¹‰ArrayListçš„æœ¬è´¨æ˜¯é¡ºåºè¡¨ï¼Œå†…éƒ¨å®ç°æ˜¯ä½¿ç”¨æ•°ç»„å­˜å‚¨çš„ï¼Œé›†åˆæ‰©å®¹æ—¶ä¼šåˆ›å»ºæ›´å¤§çš„æ•°ç»„ç©ºé—´ï¼ŒæŠŠåŸæ¥çš„æ•°æ®å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ã€‚ArrayListæ”¯æŒå¯¹å…ƒç´ çš„å¿«é€Ÿéšæœºè®¿é—®ï¼Œä½†æ˜¯æ’å…¥å’Œåˆ é™¤æ—¶é€Ÿåº¦ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹å¯èƒ½è¦ç§»åŠ¨å…¶ä»–çš„å…ƒç´ ã€‚ é»˜è®¤å¤§å°1234/** * Default initial capacity. */ private static final int DEFAULT_CAPACITY = 10; åˆå§‹åŒ–123456789101112131415private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;; //ç”¨äºé»˜è®¤åˆå§‹åŒ–çŠ¶æ€çš„æ ¡éªŒpublic ArrayList() &#123; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; //æŒ‡å®šä¸ºç©ºï¼Œå½“addæ—¶æ‰ä¼šæ‰©å®¹&#125; public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; this.elementData = new Object[initialCapacity]; &#125; else if (initialCapacity == 0) &#123; this.elementData = EMPTY_ELEMENTDATA; &#125; else &#123; throw new IllegalArgumentException("Illegal Capacity: "+initialCapacity); &#125; &#125; å½“æ²¡æœ‰æŒ‡å®šå®¹é‡æ—¶ï¼Œå†…éƒ¨æ•°ç»„æŒ‡å®šä¸ºç©ºæ•°ç»„ï¼Œå½“addçš„æ—¶å€™æ‰ä¼šæ‰©å®¹ã€‚ ä¸€èˆ¬æ˜ç¡®é›†åˆæ•°æ®é‡èŒƒå›´çš„è¯ï¼Œæˆ‘ä»¬å¿…é¡»åˆå§‹åŒ–å®¹é‡ï¼Œä¸ç„¶é‡åˆ°å¤§æ•°æ®é‡æ—¶ï¼Œä¼šè¿›è¡Œå¤šæ¬¡çš„æ‰©å®¹ï¼Œè¿›è¡Œæ•°ç»„çš„å¤åˆ¶ï¼Œé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚é‚£ä¹ˆï¼Œæ•°ç»„æ˜¯å¦‚ä½•æ‰©å®¹çš„å‘¢ï¼Ÿ æ‰©å®¹12345678910111213141516171819202122232425262728293031323334353637// å½“size+1å¤§äºlengthçš„æ—¶å€™ï¼Œå¯¹å®¹å™¨è¿›è¡Œ1.5å€æ‰©å®¹public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // Increments modCount!! elementData[size++] = e; return true;&#125;private void ensureCapacityInternal(int minCapacity) &#123; ensureExplicitCapacity(calculateCapacity(elementData, minCapacity)); &#125;private static int calculateCapacity(Object[] elementData, int minCapacity) &#123; if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; //å¢åŠ åˆå§‹åŒ–åˆ¤æ–­ return Math.max(DEFAULT_CAPACITY, minCapacity); &#125; return minCapacity; &#125; private void ensureExplicitCapacity(int minCapacity) &#123; modCount++; // overflow-conscious code if (minCapacity - elementData.length &gt; 0) //å½“æœ€å¤šèƒ½æ”¾çš„æ•°å¤§äºlengthï¼Œè¿›è¡Œæ‰©å®¹ grow(minCapacity); &#125;private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); //1.5é™ªæ‰©å®¹ if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity); &#125; å½“æ·»åŠ 100ä¸ªå…ƒç´ æ—¶ï¼Œå®¹å™¨çš„æ‰©å®¹è·Ÿè¸ªä¸ºï¼š 1ï¼ˆnewï¼‰0â€”â€”(add first)10â€”â€” (add 11)15 --ï¼ˆadd 16ï¼‰22â€”â€”ï¼ˆadd 23ï¼‰33â€”â€”ï¼ˆadd 34ï¼‰49...... è¿™é‡Œå¦‚æœä¼°é‡ä¸€ä¸‹ï¼Œå¦‚æœæœ‰1000ä¸ªå…ƒç´ ï¼Œä¼šè¿›è¡Œå¤šå°‘æ¬¡æ‰©å®¹å‘¢ï¼Ÿ 73â€”â€”109â€”â€”163â€”â€”244â€”â€”366â€”â€”549â€”â€”823â€”â€”ï¼ˆadd 824ï¼‰1234ã€‚ æ•…éœ€è¦13æ¬¡æ‰©å®¹ Arrays.copyOfæ–¹æ³•å®ç° 123456789101112public static &lt;T&gt; T[] copyOf(T[] original, int newLength) &#123; return (T[]) copyOf(original, newLength, original.getClass());&#125;public static &lt;T,U&gt; T[] copyOf(U[] original, int newLength, Class&lt;? extends T[]&gt; newType) &#123; T[] copy = ((Object)newType == (Object)Object[].class) ? (T[]) new Object[newLength] : (T[]) Array.newInstance(newType.getComponentType(), newLength); System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength)); //è°ƒç”¨æœ¬åœ°æ–¹æ³•æ‰©å®¹ return copy; &#125; æœ€å¤§å®¹é‡123456789private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; //å»æ‰ä½ä¸‰ä½private static int hugeCapacity(int minCapacity) &#123; if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); return (minCapacity &gt; MAX_ARRAY_SIZE) ? //è¿”å›èƒ½å¤Ÿæ‰©å®¹çš„æœ€å¤§å€¼ Integer.MAX_VALUE : MAX_ARRAY_SIZE; &#125; å¢æ·»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * Appends the specified element to the end of this list. * * @param e element to be appended to this list * @return &lt;tt&gt;true&lt;/tt&gt; (as specified by &#123;@link Collection#add&#125;) */ public boolean add(E e) &#123; //é»˜è®¤åŠ åœ¨æœ€åé¢ ensureCapacityInternal(size + 1); elementData[size++] = e; return true; &#125;/** * Inserts the specified element at the specified position in this * list. Shifts the element currently at that position (if any) and * any subsequent elements to the right (adds one to their indices). * * @param index index at which the specified element is to be inserted * @param element element to be inserted * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */ public void add(int index, E element) &#123; rangeCheckForAdd(index); //æ ¡éªŒindexæ˜¯å¦è¶Šç•Œ ensureCapacityInternal(size + 1); // Increments modCountå’Œè‡ªåŠ¨æ‰©å®¹ System.arraycopy(elementData, index, elementData, index + 1, size - index); elementData[index] = element; size++; &#125;/* * @param src the source array. * @param srcPos starting position in the source array. * @param dest the destination array. * @param destPos starting position in the destination data. * @param length the number of array elements to be copied. * @exception IndexOutOfBoundsException if copying would cause * access of data outside array bounds. * @exception ArrayStoreException if an element in the &lt;code&gt;src&lt;/code&gt; * array could not be stored into the &lt;code&gt;dest&lt;/code&gt; array * because of a type mismatch. * @exception NullPointerException if either &lt;code&gt;src&lt;/code&gt; or * &lt;code&gt;dest&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;. */ public static native void arraycopy(Object src, int srcPos, Object dest, int destPos, int length); System.arraycopyæœ¬åœ°æ–¹æ³•å‚æ•°è¯´æ˜ srcï¼šåŸæ•°ç»„ srcPosï¼šåŸæ•°ç»„å¼€å§‹å¤åˆ¶çš„ä¸‹æ ‡ destï¼šç›®æ ‡æ•°ç»„ destPosï¼šç›®æ ‡æ•°ç»„å¼€å§‹ä¸‹æ ‡ lengthï¼šè¦å¤åˆ¶çš„å…ƒç´ ä¸ªæ•° åˆ é™¤æ™®é€šremove1234567891011121314151617181920212223/** * Removes the element at the specified position in this list. * Shifts any subsequent elements to the left (subtracts one from their * indices). * * @param index the index of the element to be removed * @return the element that was removed from the list * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */public E remove(int index) &#123; //æŒ‰ä¸‹æ ‡remove rangeCheck(index); modCount++; E oldValue = elementData(index); int numMoved = size - index - 1; if (numMoved &gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work return oldValue;&#125; å¿«é€Ÿremove123456789101112131415161718192021222324252627282930313233343536373839404142/** * Removes the first occurrence of the specified element from this list, * if it is present. If the list does not contain the element, it is * unchanged. More formally, removes the element with the lowest index * &lt;tt&gt;i&lt;/tt&gt; such that * &lt;tt&gt;(o==null&amp;nbsp;?&amp;nbsp;get(i)==null&amp;nbsp;:&amp;nbsp;o.equals(get(i)))&lt;/tt&gt; * (if such an element exists). Returns &lt;tt&gt;true&lt;/tt&gt; if this list * contained the specified element (or equivalently, if this list * changed as a result of the call). * * @param o element to be removed from this list, if present * @return &lt;tt&gt;true&lt;/tt&gt; if this list contained the specified element */public boolean remove(Object o) &#123; if (o == null) &#123; for (int index = 0; index &lt; size; index++) if (elementData[index] == null) &#123; fastRemove(index); return true; &#125; &#125; else &#123; for (int index = 0; index &lt; size; index++) if (o.equals(elementData[index])) &#123; fastRemove(index); return true; &#125; &#125; return false;&#125;/* * Private remove method that skips bounds checking and does not * return the value removed. */private void fastRemove(int index) &#123; // å»æ‰æ ¡éªŒå’Œè¿”å›å€¼ modCount++; int numMoved = size - index - 1; if (numMoved &gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work&#125; éå†ä¸ºä»€ä¹ˆéå†åˆ é™¤æŒ‡å®šå¯¹è±¡æ—¶ï¼Œä¸èƒ½è¾¹éå†ï¼Œè¾¹ä½¿ç”¨list.remove()å’Œlist.add()åšåˆ é™¤å’Œå¢åŠ æ“ä½œï¼Ÿ éªŒè¯1234567891011121314// output:Exception in thread "main" java.util.ConcurrentModificationExceptionprivate static void testArrayList() &#123; ArrayList arrayList = new ArrayList(); arrayList.add("123"); arrayList.add("345"); arrayList.add("1"); arrayList.add("23"); for (Object ele : arrayList) &#123; if ("123".equals(ele)) &#123; arrayList.remove(ele); //é™¤éè¿™é‡Œbreak;æˆ–è€…returnï¼› &#125; &#125; System.out.println(arrayList);&#125; å› ä¸ºforEachéå†ï¼Œç¼–è¯‘åæ˜¯ä½¿ç”¨å†…éƒ¨è¿­ä»£å™¨Iteratorçš„nextæ–¹æ³•éå†çš„ï¼Œåœ¨Listä¸­ç»´æŠ¤äº†ä¸€ä¸ªmodCountå­—æ®µï¼Œè¡¨ç¤ºä¿®æ”¹çš„æ¬¡æ•°ï¼Œè€ŒIteratorå†…éƒ¨ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªå­—æ®µexpectedModCountï¼Œæ¯æ¬¡éå†çš„æ—¶å€™ï¼Œä¼šå»æ¯”è¾ƒè¿™ä¸¤ä¸ªå­—æ®µçš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå°±æ˜¯checkForComodification()æ–¹æ³•ï¼Œå¦‚æœä¸ç­‰ï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ è€Œä½¿ç”¨foriéå†åšåˆ é™¤ï¼Œaddçš„è¯ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œå¦‚ä¸‹ä¾‹ï¼Œä¸ºå®‰å…¨èµ·è§ä¸€èˆ¬ä¸å»ºè®®è¿™ä¹ˆç”¨ã€‚ 123456789101112131415161718192021//output:[Student&#123;name='male'&#125;, Student&#123;name='female'&#125;, Student&#123;name='female'&#125;]public static void main(String[] args) &#123; //å‡†å¤‡æ•°æ® List&lt;Student&gt; list = new ArrayList&lt;&gt;(); list.add(new Student("male")); list.add(new Student("male")); list.add(new Student("female")); list.add(new Student("female")); list.add(new Student("male")); //æ™®é€šforå¾ªç¯éå†åˆ é™¤ for (int i = 0; i &lt; list.size(); i++) &#123; Student student = list.get(i); if ("male".equals(student.getName())) &#123; list.remove(i); //ä½¿ç”¨é›†åˆçš„åˆ é™¤æ–¹æ³•åˆ é™¤// i--; //åˆ å®Œä¹‹åiä¸å‡ä¸€ï¼Œå›åˆ°ä¹‹å‰çš„å€¼å¼€å§‹éå† &#125; &#125; System.out.println(list.toString()); &#125; Iteratoréå†1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public Iterator&lt;E&gt; iterator() &#123; return new Itr();&#125;/** * An optimized version of AbstractList.Itr */private class Itr implements Iterator&lt;E&gt; &#123; int cursor; // index of next element to return int lastRet = -1; // index of last element returned; -1 if no such int expectedModCount = modCount; Itr() &#123;&#125; public boolean hasNext() &#123; return cursor != size; &#125; public E next() &#123; checkForComodification(); int i = cursor; if (i &gt;= size) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) throw new ConcurrentModificationException(); cursor = i + 1; return (E) elementData[lastRet = i]; &#125; public void remove() &#123; if (lastRet &lt; 0) throw new IllegalStateException(); checkForComodification(); //æ£€æŸ¥modcount try &#123; ArrayList.this.remove(lastRet); cursor = lastRet; lastRet = -1; expectedModCount = modCount; &#125; catch (IndexOutOfBoundsException ex) &#123; throw new ConcurrentModificationException(); &#125; &#125; final void checkForComodification() &#123; if (modCount != expectedModCount) // fail-fastæœºåˆ¶ï¼Œå¤šå¤„ä¼šä½¿ç”¨è¿™ä¸ªåˆ¤æ–­ throw new ConcurrentModificationException(); &#125;&#125; å®ä¾‹12345Iterator iterator = branchList.iterator();while (iterator.hasNext()) &#123; Object ele = iterator.next(); System.out.println(ele);&#125; fail-faståœ¨ArrayListè®¾è®¡äº†ä¸€ä¸ªå†…éƒ¨Listç±»ï¼Œä¸ºä»€ä¹ˆè¦è®¾è®¡è¿™ä¸ªç±»? 12345678910111213141516171819202122232425262728293031public List&lt;E&gt; subList(int fromIndex, int toIndex) &#123; subListRangeCheck(fromIndex, toIndex, size); return new SubList(this, 0, fromIndex, toIndex);&#125;private class SubList extends AbstractList&lt;E&gt; implements RandomAccess &#123; private final AbstractList&lt;E&gt; parent; private final int parentOffset; private final int offset; int size; SubList(AbstractList&lt;E&gt; parent, int offset, int fromIndex, int toIndex) &#123; this.parent = parent; this.parentOffset = fromIndex; this.offset = offset + fromIndex; this.size = toIndex - fromIndex; this.modCount = ArrayList.this.modCount; &#125; public E set(int index, E e) &#123;...&#125; public E get(int index) &#123;...&#125; public int size() &#123;...&#125; public void add(int index, E e) &#123;...&#125; public E remove(int index) &#123;...&#125; protected void removeRange(int fromIndex, int toIndex) &#123;...&#125; public boolean addAll(Collection&lt;? extends E&gt; c) &#123;...&#125; public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; ...&#125; public Iterator&lt;E&gt; iterator() &#123;...&#125; public ListIterator&lt;E&gt; listIterator(final int index) &#123;...&#125;&#125; ç”±äºSubListæä¾›äº†add()ã€remove()ã€addAll()æ–¹æ³•çš„å®ç°ï¼Œå‡åŠ äº†checkForComodification() æ–¹æ³•çš„æ ¡éªŒï¼Œä¸”å¯¹ä»–ä»¬çš„æ“ä½œä¼šå½±å“å¤–éƒ¨ç±»ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™ç‰¹åˆ«æ³¨æ„ã€‚è¿™æ ·ä¸€ç§è®¾è®¡ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ï¼Œå½“æˆ‘ä»¬å¯¹å­é›†åˆè¿›è¡Œä¿®æ”¹ã€æ’å…¥ã€åˆ é™¤æ“ä½œæ—¶ï¼Œå¯ä»¥æ“æ§çˆ¶é›†åˆçš„å…ƒç´ ã€‚ä½†ä¸€å®šè¦æ³¨æ„ï¼Œå½“æˆ‘ä»¬å¯¹å£°æ˜å­é›†åˆåï¼Œå†å¯¹çˆ¶é›†åˆè¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå­é›†åˆçš„éå†ä¸ä¿®æ”¹éƒ½ä¼šæŠ¥fail-fastå¼‚å¸¸ã€‚ 1234567891011121314151617181920212223private static void testFailfast() &#123; List&lt;String&gt; masterList = new ArrayList&lt;&gt;(); masterList.add("one"); masterList.add("two"); masterList.add("three"); masterList.add("four"); masterList.add("five"); List&lt;String&gt; branchList = masterList.subList(0, 2); //masterList.remove(0); // æ‰“å¼€åå¯¹branchListåšéå†ã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œä¼šæŠ¥ConcurrentModificationException branchList.clear(); branchList.add("six"); branchList.add("seven"); System.out.println(masterList); branchList.remove(0); //output:[six, seven, three, four, five] System.out.println(branchList); //output:[seven] System.out.println(masterList); //output:[seven, three, four, five] &#125; è¿™ä¸ªæ¡ˆä¾‹å‘Šè¯‰æˆ‘ä»¬ å½“å–å®Œå­å¯¹è±¡åï¼Œçˆ¶å¯¹è±¡ä¸å­å¯¹è±¡æœ‰äº†è”ç³»ï¼Œå°±ä¸èƒ½éšæ„çš„æ”¹å˜äº†ï¼Œå½“çˆ¶å¯¹è±¡æ›´æ”¹æ—¶ï¼Œå†å¯¹å­å¯¹è±¡æ“ä½œï¼Œå°±ä¼šæŠ¥fail-fasté”™è¯¯ã€‚ å½“å»ºç«‹è”ç³»åï¼Œå­å¯¹è±¡çš„æ›´æ”¹ä¼šå½±å“åˆ°çˆ¶å¯¹è±¡ï¼Œå½¼æ­¤å½±å“ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸€å®šä¸è¦åŒæ—¶å¯¹ä¸¤ä¸ªå¯¹è±¡åšä¿®æ”¹æ“ä½œã€‚ asList &amp; toArrayç”±äºArrayListåº•å±‚æ˜¯ç”±æ•°ç»„å®ç°çš„ï¼Œé‚£ä¹ˆï¼Œè‚¯å®šæ˜¯å­˜åœ¨æ•°ç»„è½¬é›†åˆå’Œé›†åˆè½¬æ•°ç»„çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¸¸ä½¿ç”¨Arrays.asList(T [])å°†æ•°ç»„è½¬æ¢ä¸ºListé›†åˆï¼Œæ³¨æ„ä½¿ç”¨è¯¥æ–¹æ³•æ—¶ï¼Œä¸èƒ½å¯¹å­é›†åˆè¿›è¡Œaddã€removeã€clearç­‰æ“ä½œï¼Œå› ä¸ºï¼Œè¿”å›çš„ArrayListæ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œæ²¡æœ‰æä¾›ä»¥ä¸Šæ–¹æ³•çš„å®ç°ã€‚ 123public static &lt;T&gt; List&lt;T&gt; asList(T... a) &#123; return new ArrayList&lt;&gt;(a);&#125; å¦‚æœä½¿ç”¨äº†ï¼Œå°±ä¼šæŠ¥fail-fasté”™è¯¯ã€‚å¦‚æœä¸€å®šè¦ä½¿ç”¨ä¿®æ”¹çš„è¯ï¼Œä¸€èˆ¬æˆ‘ä»¬æ˜¯è¿™ä¹ˆå£°æ˜çš„ã€‚ 12String[] strs = new String[2];ArrayList list=new ArrayList(Arrays.asList(strs)); ArrayListé›†åˆæœ¬èº«æä¾›äº†ä¸€ä¸ªé›†åˆè½¬æ•°ç»„çš„æ–¹æ³•ï¼Œå°±æ˜¯toArrayæ–¹æ³•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„ä¸€äº›å°å‘ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼ŒçŒœæµ‹ä¸€ä¸‹ä¼šæ‰“å°ä»€ä¹ˆï¼Ÿ 12345678910111213141516171819private static void testArrayList() &#123; ArrayList arrayList = new ArrayList(); arrayList.add("male"); arrayList.add("male"); arrayList.add("female"); arrayList.add("female");// String[] objs = (String[]) arrayList.toArray(); Object[] objs = arrayList.toArray(); String[] strs = new String[2]; String[] strs1 = new String[5]; arrayList.toArray(objs); arrayList.toArray(strs); arrayList.toArray(strs1); System.out.println(Arrays.asList(objs)); System.out.println(Arrays.asList(strs)); System.out.println(Arrays.asList(strs1)); &#125; æœ€ç»ˆçš„æ‰“å°ç»“æœä¸ºï¼š [male, male, female, female][null, null][male, male, female, female, null] åˆ†æä¸€ä¸‹ï¼Œç¬¬ä¸€æ¡ç»“æœå¾ˆæ˜ç¡®ï¼Œèƒ½å®Œæˆå¤åˆ¶ï¼Œå½“æˆ‘ä½¿ç”¨æ— å‚çš„æ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•è¿”å›çš„æ˜¯Object[]ï¼Œä¸èƒ½è½¬åŒ–ä¸ºString[]ï¼Œä¼šæŠ¥ClassCastExceptionå¼‚å¸¸ã€‚ç¬¬äºŒæ¡å½“æ•°ç»„å£°æ˜çš„é•¿åº¦æ¯”é›†åˆå°çš„æ—¶å€™ï¼Œè¿”å›å…¨æ˜¯ç©ºã€‚å½“å¤§äºçš„æ—¶å€™ï¼Œèƒ½è¿›è¡Œå¤åˆ¶ï¼Œå…¶ä½™çš„é»˜è®¤ä¸ºnullï¼Œè¿™æ˜¯ä»€ä¹ˆå¯¼è‡´çš„å‘¢ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æºç ã€‚ æ— å‚æ–¹æ³•å®ç° 123public Object[] toArray() &#123; return Arrays.copyOf(elementData, size);&#125; æ— å‚æ–¹æ³•è¿”å›Objectæ•°ç»„ æœ‰å‚æ–¹æ³•å®ç° 123456789public &lt;T&gt; T[] toArray(T[] a) &#123; if (a.length &lt; size) // Make a new array of a's runtime type, but my contents: return (T[]) Arrays.copyOf(elementData, size, a.getClass()); System.arraycopy(elementData, 0, a, 0, size); if (a.length &gt; size) a[size] = null; return a;&#125; å½“å°äºé›†åˆå¤§å°æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œè¿”å›äº†ä¸€ä¸ªå¤åˆ¶å¥½çš„æ•°ç»„ï¼Œä½†æ˜¯å…¥å‚æ•°ç»„aè¢«å¿½ç•¥äº†ï¼Œæ‰€ä»¥aè¿˜æ˜¯ç©ºï¼Œå¦‚æœå£°æ˜å¦ä¸€ä¸ªæ•°ç»„è¦æ¥å—çš„è¯ï¼Œæ˜¯æœ‰å€¼çš„ã€‚ æˆ‘ä»¬çœ‹çœ‹Arrays.copyOf()æ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„ 123456789public static &lt;T,U&gt; T[] copyOf(U[] original, int newLength, Class&lt;? extends T[]&gt; newType) &#123; @SuppressWarnings("unchecked") T[] copy = ((Object)newType == (Object)Object[].class) ? (T[]) new Object[newLength] : (T[]) Array.newInstance(newType.getComponentType(), newLength); System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength)); return copy;&#125; å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œcopy newäº†ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œé•¿åº¦ä¸ºnewLength,ç„¶åè°ƒç”¨æœ¬åœ°æ–¹æ³•è¿›è¡Œäº†å¤åˆ¶ï¼Œè¿”å›ã€‚ å½“æˆ‘ä»¬é›†åˆè½¬æ•°ç»„çš„æ—¶å€™ï¼Œè¦æ³¨æ„ï¼Œå°†æ•°ç»„çš„é•¿åº¦å£°æ˜ä¸ºlist.size()ï¼Œè¿™æ€§èƒ½å¾€å¾€é«˜äºå¤§äºæ—¶å€™çš„é•¿åº¦ã€‚]]></content>
      <categories>
        <category>collection</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ˜¯æ—¶å€™æ­å¼€çº¿ç¨‹æ± è¿™å—é¢çº±äº†ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2020%2F03%2F04%2Fconcurrentart%2Fthreadpool-usages%2F</url>
    <content type="text"><![CDATA[å¼•è¨€ ä»Šå¤©åœ¨ä¸Šç­çš„è·¯ä¸Šï¼Œæƒ³åˆ°ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯ä¸€ä¸ªç—…äººæ„ŸæŸ“ä¸Šäº†æ–°å† ç—…æ¯’è¦ä¸ŠåŒ»é™¢å»ä½é™¢éš”ç¦»æ²»ç–—ï¼Œæ–¹èˆ±åŒ»é™¢å¦‚æœåºŠä½ä¸å¤Ÿï¼Œå°±ä¼šå¯¼è‡´åŒ»é™¢å“åº”ä¸äº†ç—…äººçš„è¯·æ±‚ï¼Œåªèƒ½æ‹’ç»ã€‚ä½†æ˜¯è¦èƒ½å¤Ÿå“åº”åˆå¾—ä¸´æ—¶æœé›†èµ„æºã€ç»„å»ºææ–™æ­å»ºç—…æˆ¿å’ŒåºŠä½ï¼Œè¿™å¿…ç„¶ä¼šæ¶ˆè€—å¤§é‡çš„æ—¶é—´ï¼Œä¹Ÿä¼šè€½æäº†ç—…äººçš„ç—…æƒ…ã€‚é‚£ä¹ˆï¼Œè¦æ˜¯å®ç°äº†åºŠè¶³å¤Ÿå¤šï¼Œè¾¾åˆ°åºŠç­‰äººçš„è¯ï¼Œå°±èƒ½å¤Ÿè¿…é€Ÿçš„æ¥å¾…ç—…äººï¼Œè¿›è¡Œéš”ç¦»æ²»ç–—ï¼Œä½¿ç—…æƒ…å¾—åˆ°åŠæ—¶çš„æ§åˆ¶ã€‚ è¿™ä¸ªä¾‹å­è®©æˆ‘æƒ³åˆ°äº†çº¿ç¨‹æ± ï¼Œå‡è®¾å¯¹æœåŠ¡å™¨çš„æ¯ä¸€ä¸ªè¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªä»»åŠ¡è°ƒåº¦ï¼Œå½“å¤§é‡çš„è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œå¿…ç„¶ç”±äºæœåŠ¡å™¨ç©ºé—´èµ„æºé™åˆ¶ï¼Œå¯¼è‡´æœåŠ¡å™¨å“åº”ç¼“æ…¢ï¼Œæ›´å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚å½“å¤§é‡çš„è¯·æ±‚å¤„ç†å®Œä¹‹åï¼Œçº¿ç¨‹ä¹Ÿå°±ä¼šé”€æ¯æ‰ï¼Œå½“ä¸‹æ¬¡è¯·æ±‚å†æ¥çš„æ—¶å€™ï¼Œåˆå¾—å»åˆ›å»ºçº¿ç¨‹ï¼Œå¯¼è‡´ä¸å¿…è¦çš„ç³»ç»Ÿå¼€é”€ï¼ŒåŒæ—¶é™ä½äº†ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚å¦‚æœï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨æœåŠ¡å™¨é¢„å¤‡ä¸€ä¸ªä¸“é—¨å“åº”çš„çº¿ç¨‹æ± ï¼Œå½“è¯·æ±‚æ¥çš„æ—¶å€™æˆ‘åªè¦å–ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼Œå¤„ç†å®Œä¹‹åï¼Œæˆ‘ä¸é”€æ¯åˆæ”¾å›åˆ°æ± å­ä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘å°±èƒ½éšåˆ°éšå–ã€‚æˆ‘è¿˜æƒ³ä½¿è¿™ä¸ªæ± å­æœ‰ä¸€å®šçš„å¯å¡‘æ€§ï¼Œå½“å¤§é‡çš„è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œæˆ‘æƒ³ä½¿æ›´å¤šçš„çº¿ç¨‹å»å“åº”ï¼Œä½†å½“å¤„ç†å®Œä¹‹åï¼Œè¯¥é”€æ¯çš„é”€æ¯ï¼Œä¸è¯¥é”€æ¯çš„è¿˜ç•™åœ¨æ± å­ä¸­ï¼Œè¿™æ ·èƒ½åŒæ—¶å“åº”çš„è¯·æ±‚å°±æ›´å¤šäº†ã€‚å½“ç„¶ï¼Œå½“æœåŠ¡å™¨è¯·æ±‚å¤„ç†ä¸è¿‡æ¥ï¼Œæˆ‘ä¹Ÿå¯èƒ½ä¸æƒ³æŠŠè¿™ä¸ªè¯·æ±‚ç»™æ‰”æ‰ï¼Œæˆ‘æƒ³æˆ‘å¤„ç†å®Œåï¼Œå†æ¥å¤„ç†ä¹‹åçš„è¯·æ±‚ï¼Œåªæ˜¯å¯èƒ½éœ€è¦ä½ ç­‰ä¸€ç­‰ï¼ å¥½å§ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®²çš„çº¿ç¨‹æ± äº†ã€‚ å¥½å¤„ é™ä½èµ„æºæ¶ˆè€—ã€‚é¿å…åå¤åˆ›å»ºçº¿ç¨‹è€Œä¸å¿…è¦çš„èµ„æºå¼€é”€ã€‚ æé«˜å“åº”é€Ÿåº¦ã€‚éšæ¥éšç”¨ï¼Œå½“ä»»åŠ¡åˆ°æ¥æ— éœ€åˆ›å»ºçº¿ç¨‹å°±èƒ½ç«‹å³å“åº”ã€‚ æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚æ§åˆ¶ç³»ç»Ÿçš„æœ€å¤§å¹¶å‘æ•°ï¼Œé¿å…çº¿ç¨‹åˆ›å»ºè¿‡å¤šå¯¼è‡´ç³»ç»Ÿè¿è¡Œç¼“æ…¢ç”šè‡³å´©æºƒçš„æƒ…å†µå‘ç”Ÿï¼ŒåŒæ—¶å¯ä»¥å¯¹çº¿ç¨‹æ± ç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ã€‚ æ€è€ƒ çº¿ç¨‹æ± å¦‚ä½•å®šä¹‰ï¼Ÿçº¿ç¨‹æ± çš„ç§ç±»ï¼Ÿç¼“å†²é˜Ÿåˆ—æœ‰å“ªå‡ ç§ï¼Ÿé¥±å’Œç­–ç•¥æœ‰å“ªäº›ï¼Ÿè¿™å‡ ç§çº¿ç¨‹æ± è¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿ å½“çº¿ç¨‹æ± åˆšåˆšåˆ›ç«‹è¿˜æ²¡æœ‰Taskåˆ°æ¥çš„æ—¶å€™ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Ÿ å½“Taskåˆ°æ¥çš„æ—¶å€™ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦‚ä½•å¾—åˆ°é€šçŸ¥çš„ï¼Ÿ å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å®Œæˆå·¥ä½œï¼Œå¦‚ä½•å›åˆ°æ± å­é‡Œï¼Ÿ Taskæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ åŸºæœ¬æ¦‚å¿µçº¿ç¨‹æ± æ¥å£çº¿ç¨‹æ± ä¸­å®šä¹‰äº†å‡ ä¸ªé‡è¦çš„æ¥å£ï¼Œåˆ†åˆ«æ˜¯Executorã€ExecuterServiceã€‚ Executorå«åšæ‰§è¡Œè€…ï¼Œæœ‰execute(Runnable command)æ–¹æ³•ã€‚ 1234567891011121314public interface Executor &#123; /** * Executes the given command at some time in the future. The command * may execute in a new thread, in a pooled thread, or in the calling * thread, at the discretion of the &#123;@code Executor&#125; implementation. * * @param command the runnable task * @throws RejectedExecutionException if this task cannot be * accepted for execution * @throws NullPointerException if command is null */ void execute(Runnable command);&#125; è€ŒExecuterServiceç»§æ‰¿äº†Executerï¼Œå®šä¹‰äº†çº¿ç¨‹æ± å¯¹çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†æ–¹æ³•ï¼Œé‡è¦çš„æ˜¯å®ƒè¿˜æä¾›äº†ä¸€å¥—submitæäº¤ä»»åŠ¡çš„æœºåˆ¶ã€‚submitè¡¨ç¤ºå°†ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± ï¼Œè‡³äºä»€ä¹ˆæ—¶å€™æ‰§è¡Œæˆ‘å°±ä¸ç®¡äº†ï¼Œæ‰€ä»¥ä»»åŠ¡æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ã€‚ 123456789101112public interface ExecutorService extends Executor &#123; void shutdown(); //ç»“æŸ List&lt;Runnable&gt; shutdownNow(); //é©¬ä¸Šç»“æŸ boolean isShutdown(); //æ˜¯å¦ç»“æŸäº† boolean isTerminated(); //æ˜¯ä¸æ˜¯ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº† boolean awaitTermination(long timeout, TimeUnit unit); //ç­‰å¾…ç»“æŸï¼Œæ—¶é—´åˆ°äº†è¿˜ä¸ç»“æŸçš„è¯ï¼Œå°±ç»™è¿”å›false &lt;!--submit ç›¸å…³æ–¹æ³•--&gt; &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task); &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result); Future&lt;?&gt; submit(Runnable task);&#125; æˆ‘ä»¬çŸ¥é“Runnableæ²¡æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯å½“æˆ‘éœ€è¦è¿”å›å€¼çš„è¯ï¼Œé‚£å°±åº”è¯¥ä½¿ç”¨Callableæ¥å£ã€‚ 12345678910@FunctionalInterfacepublic interface Callable&lt;V&gt; &#123; /** * Computes a result, or throws an exception if unable to do so. * * @return computed result * @throws Exception if unable to compute a result */ V call() throws Exception;&#125; å½“ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œå®Œå ï¼Œæˆ‘è¯¥å¦‚ä½•é€šçŸ¥ç»™è°ƒç”¨æ–¹å‘¢ï¼Œè¿™å°±ç‰µæ‰¯å‡ºä¸€å¥—Futureã€RunnableFutureå’ŒFutureTaskç›¸å…³æ¦‚å¿µäº†ã€‚ submitæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªFutureæ¥å£ï¼Œå¯ç†è§£ä¸ºæœªæ¥æ‰§è¡Œå®Œçš„ä¸€ä¸ªç»“æœï¼Œè¿™ä¸ªæ¥å£é‡Œé¢å®šä¹‰äº†getæ–¹æ³•ï¼Œä¸»çº¿ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨get()æ–¹æ³•æ‹¿åˆ°ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚æ‰€ä»¥Callableä¸€èˆ¬æ˜¯é…åˆçº¿ç¨‹æ± å’ŒFutureæ¥ç”¨çš„ã€‚ ä½†æ˜¯ï¼Œæ›´åŠ çµæ´»çš„ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠCallableå’ŒFutureè¿›è¡Œå°è£…åˆ°ä¸€ä¸ªç±»é‡Œé¢ï¼Œè¿™ä¸ªç±»å°±æ˜¯FutureTask,ä»£è¡¨çš„æ˜¯æˆ‘å³æ˜¯ä¸€ä¸ªTaskä¹Ÿèƒ½æ˜¯ä¸€ä¸ªç”¨æ¥å­˜è¿™ä¸ªä»»åŠ¡çš„ç»“æœçš„å¯¹è±¡ï¼Œå› æ­¤ï¼Œæˆ‘å°±å¾—æœ‰ä»»åŠ¡å¯æ‰§è¡Œçš„å±æ€§ã€‚å› ä¸ºFutureTaskå®ç°äº†RunableFuture,è€ŒRunnableFutureå³å®ç°äº†Runnableåˆå®ç°äº†Futureã€‚ ç±»å›¾å¦‚ä¸‹ï¼š 123456789101112131415161718public class T05_Callable &#123; static class MyCall implements Callable&lt;String&gt; &#123; @Override public String call() throws Exception &#123; System.out.println("Hello MyCall"); TimeUnit.SECONDS.sleep(3); return "Success"; &#125; &#125; public static void main(String[] args) throws Exception&#123; // å®ç°callableæ¥å£ FutureTask futureTask = new FutureTask&lt;String&gt;(new MyCall()); Thread thread = new Thread(futureTask); thread.start(); System.out.println(futureTask.get()); &#125;&#125; æ³¨æ„ï¼šä¸»çº¿ç¨‹è°ƒç”¨getæ–¹æ³•ï¼Œä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæ—¶ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆ–è€…æŠ›å¼‚å¸¸ç»“æŸã€‚å½“ç„¶ï¼Œå¯ä»¥æŒ‡å®šæœ€å¤§é˜»å¡æ—¶é—´V get(long timeout, TimeUnit unit)ï¼Œå½“æ—¶é—´åˆ°äº†å°±ä¸ç»§ç»­ç­‰å¾…äº†ï¼Œä½†æ˜¯ä¼šæŠ›å‡ºTimeoutExceptionå¼‚å¸¸ã€‚ çº¿ç¨‹æ± å®šä¹‰ç›®å‰jdkå®šä¹‰çš„çº¿ç¨‹æ± æœ‰ä¸¤ç§ç±»å‹ï¼Œç¬¬ä¸€ç§æ˜¯æ˜¯æ™®é€šçš„çº¿ç¨‹æ± ThreadPoolExecutorï¼Œç¬¬äºŒç§æ˜¯ForkJoinPoolï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬å…ˆåˆ†æä¸€ä¸‹ThreadPoolExecutorç›¸å…³çš„çº¿ç¨‹æ± ã€‚ ThreadPoolExecutorçš„çˆ¶ç±»æ˜¯AbstractExecutorServiceï¼Œè€ŒAbstractExecutorServiceæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸»è¦å®ç°äº†ExecutorServiceçš„submitæ–¹æ³•ï¼Œä¸Šé¢çŸ¥é“ï¼ŒExecutorServiceä¹Ÿç»§æ‰¿äº†Executorã€‚æ‰€ä»¥ï¼ŒThreadPoolExecutorç›¸å½“äºçº¿ç¨‹æ± çš„æ‰§è¡Œå™¨ï¼Œå¯ä»¥å¾€è¿™ä¸ªæ± å­é‡Œé¢æ‰”è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š é‚£ä¹ˆï¼ŒThreadPoolExecutoræ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Œå®ƒçš„æ ¸å¿ƒå‚æ•°å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** * Creates a new &#123;@code ThreadPoolExecutor&#125; with the given initial * parameters. * * @param corePoolSize the number of threads to keep in the pool, even * if they are idle, unless &#123;@code allowCoreThreadTimeOut&#125; is set * @param maximumPoolSize the maximum number of threads to allow in the * pool * @param keepAliveTime when the number of threads is greater than * the core, this is the maximum time that excess idle threads * will wait for new tasks before terminating. * @param unit the time unit for the &#123;@code keepAliveTime&#125; argument * @param workQueue the queue to use for holding tasks before they are * executed. This queue will hold only the &#123;@code Runnable&#125; * tasks submitted by the &#123;@code execute&#125; method. * @param threadFactory the factory to use when the executor * creates a new thread * @param handler the handler to use when execution is blocked * because the thread bounds and queue capacities are reached * @throws IllegalArgumentException if one of the following holds:&lt;br&gt; * &#123;@code corePoolSize &lt; 0&#125;&lt;br&gt; * &#123;@code keepAliveTime &lt; 0&#125;&lt;br&gt; * &#123;@code maximumPoolSize &lt;= 0&#125;&lt;br&gt; * &#123;@code maximumPoolSize &lt; corePoolSize&#125; * @throws NullPointerException if &#123;@code workQueue&#125; * or &#123;@code threadFactory&#125; or &#123;@code handler&#125; is null */ public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; if (corePoolSize &lt; 0 || maximumPoolSize &lt;= 0 || maximumPoolSize &lt; corePoolSize || keepAliveTime &lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.acc = System.getSecurityManager() == null ? null : AccessController.getContext(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler; &#125; corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•° maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•° keepAliveTimeï¼šçº¿ç¨‹çš„ç©ºé—²æ—¶é—´ï¼Œè¶…å‡ºè¿™ä¸ªæ—¶é—´ï¼Œéæ ¸å¿ƒçº¿ç¨‹å°±ä¼šé”€æ¯ã€‚ unitï¼šç©ºé—²æ—¶é—´å•ä½ workQueueï¼šä»»åŠ¡é˜Ÿåˆ— threadFactory: çº¿ç¨‹å·¥å‚ handlerï¼šæ‹’ç»ç­–ç•¥ã€‚ç›®å‰jdkæä¾›å››ç§æ‹’ç»ç­–ç•¥ï¼Œä¸€èˆ¬é»˜è®¤çš„æ˜¯æŠ›å‡ºå¼‚å¸¸Abortè¿™ç§ï¼Œä¸€èˆ¬æˆ‘ä»¬éœ€è¦è‡ªå·±å®šä¹‰ç­–ç•¥ï¼Œæ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œæ¯”å¦‚æ‰“å°é”™è¯¯æ—¥å¿—ã€å°†ä»»åŠ¡ä¿å­˜åˆ°kafkaæˆ–è€…MQã€ä¹Ÿå¯ä»¥å°†æ•°æ®ä¿å­˜åˆ°redisæˆ–è€…æ•°æ®åº“ã€‚å››ç§æ‹’ç»ç­–ç•¥åˆ†åˆ«æ˜¯ Abortï¼šæŠ›å¼‚å¸¸ Discardï¼šæ‰”æ‰ï¼Œä¸æŠ›å¼‚å¸¸ DiscardOldestï¼šæ‰”æ‰æ’é˜Ÿæ—¶é—´æœ€ä¹…çš„ CallerRunsï¼šè°ƒç”¨è€…å¤„ç†æœåŠ¡ æ³¨æ„ï¼šçº¿ç¨‹æ± åœ¨é˜¿é‡Œçš„å¼€å‘è§„èŒƒä¸Šå»ºè®®ä¸ä½¿ç”¨jdkè‡ªå®šä¹‰çš„å››ç§ThreadPoolExecutorï¼Œå»ºè®®è‡ªå·±æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯è‡ªå®šä¹‰çº¿ç¨‹æ± ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®ç°ThreadFactoryæ¥å£ï¼Œè‡ªå®šä¹‰newThreadæ–¹æ³•ï¼Œæ–¹ä¾¿çº¿ç¨‹çš„ç®¡ç†ä»¥åŠé—®é¢˜çš„å›æº¯ã€‚ çº¿ç¨‹æ± çš„ç§ç±»åœ¨jdkä¸­æä¾›äº†ä¸€äº›é»˜è®¤çš„çº¿ç¨‹æ± å®ç°ï¼Œä¸»è¦æœ‰å››ç§ã€‚å®ƒä»¬çš„ç”Ÿæˆæ–¹å¼æ˜¯å°è£…åœ¨ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ± å·¥å…·ç±»ä¸­ï¼Œå«åšExecutorsï¼Œå®ƒå¯ä»¥çœ‹ä½œçº¿ç¨‹æ± çš„å·¥å‚ã€‚ SingleThreadPoolå•çº¿ç¨‹çº¿ç¨‹æ± ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å·¥ä½œï¼Œä¿è¯æ‰”è¿›å»çš„ä»»åŠ¡æ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰å•çº¿ç¨‹çº¿ç¨‹æ± å‘¢ï¼Ÿç¬¬ä¸€æ˜¯æœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¿è¯ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œã€‚ç¬¬äºŒæ˜¯å¯é€šè¿‡çº¿ç¨‹æ± ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ 123456public static ExecutorService newSingleThreadExecutor() &#123; return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;())); &#125; CachedThreadPoolå¯ç¼“å†²çº¿ç¨‹æ± ï¼Œcachepoolæ ¸å¿ƒæ•°æ˜¯0ï¼Œæœ€å¤§æ˜¯Integer.MAX_VALUEï¼Œé˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯SynchronousQueueï¼ˆè¿™æ˜¯ä¸€ä¸ªé˜»å¡è°ƒç”¨è€…çš„é˜Ÿåˆ—ï¼‰ï¼ŒkeepAliveTime=60sï¼Œå·¥ä½œåŸç†ä¸ºå½“æ¥ç¬¬ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œä¼šnew Threadï¼Œä¹‹åçš„ä»»åŠ¡ä¼šæ ¡éªŒæ˜¯å¦æœ‰çº¿ç¨‹æ²¡åœ¨å¿™ï¼Œæ²¡æœ‰çš„è¯å°±æ¥ä»–å¤„ç†ï¼Œå¦åˆ™å†new ä¸€ä¸ªï¼Œå¤„ç†å®Œä¹‹å60sé”€æ¯ã€‚ 12345public static ExecutorService newCachedThreadPool() &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;()); &#125; FixedThreadPoolå›ºå®šçº¿ç¨‹æ± ï¼Œfixedpoolæ ¸å¿ƒæ•°å’Œæœ€å¤§çº¿ç¨‹æ•°æ˜¯ç›¸ç­‰çš„ï¼Œé€šè¿‡ä¼ å‚ä¼ å…¥ï¼Œé˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯æ— ç•Œé˜Ÿåˆ—ï¼ŒkeepAliveTime=0sã€‚å·¥ä½œåŸç†ä¸ºæˆ‘å°±æŒ‡å®šäº†æœ€å¤šå·¥ä½œçš„çº¿ç¨‹æ•°ä¸ºè¿™ä¹ˆå¤šã€‚ 12345public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()); &#125; é‚£ä¹ˆï¼ŒCachedThreadPoolå’ŒFixedThreadPoolåº”è¯¥æ€æ ·ä½¿ç”¨å‘¢ï¼Ÿæ ¹æ®å½“å‰ä¸šåŠ¡åœºæ™¯è¯„ä¼°ä»»åŠ¡é‡ä»¥åŠå¹³ç¨³åº¦ï¼Œå¦‚æœæ˜¯å¿½é«˜å¿½ä½ï¼Œåœ¨ä¿è¯ä»»åŠ¡è¿›æ¥ä¹‹åä¼šé©¬ä¸Šå¤„ç†ï¼Œä¸ä¼šå †ç§¯çš„æƒ…å†µä¸‹ï¼Œå¯ä½¿ç”¨CachedThreadPoolã€‚å¦‚æœè¯„ä¼°ä»»åŠ¡æ¥çš„æ˜¯å¹³ç¨³çš„ï¼Œæ•°é‡ä¹Ÿæœ‰ä¸€å®šçš„èŒƒå›´ï¼Œå¯ä½¿ç”¨FixedThreadPoolã€‚ ScheduledThreadPoolå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼Œæ ¸å¿ƒæ•°è‡ªå·±å®šä¹‰ï¼Œæœ€å¤§æ•°ä¸ºInteger.MAX_VALUEï¼Œé˜Ÿåˆ—ä¸ºDelayedWorkQueueã€‚ä»–æä¾›äº†å®šæ—¶ä»»åŠ¡çš„å®ç°æœºåˆ¶. 1234public ScheduledThreadPoolExecutor(int corePoolSize) &#123; super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue()); &#125; å¯é€šè¿‡è°ƒç”¨scheduleAtFixedRateæ–¹æ³•é—´éš”å¤šé•¿æ—¶é—´åœ¨ä¸€å›ºå®šçš„é¢‘ç‡ä¸Šæ‰§è¡Œä¸€æ¬¡è¿™ä¸ªä»»åŠ¡ã€‚è¯¥æ–¹æ³•æœ‰å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä»»åŠ¡ï¼ŒinitialDelayè¡¨ç¤ºå¼€å§‹æ‰§è¡Œæ˜¯å»¶è¿Ÿçš„æ—¶é—´ï¼Œperiodè¡¨ç¤ºé—´éš”æ—¶é—´ï¼Œunitè¡¨ç¤ºé—´éš”æ—¶é—´çš„å•ä½ã€‚ 1234public ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit); æ€»ç»“è‡³æ­¤ï¼Œçº¿ç¨‹æ± çš„åŸºæœ¬æ¦‚å¿µå°±å°±è®²å®Œäº†ï¼Œç¨å¾®æ€»ç»“ä¸€ä¸‹ï¼š Callableç±»ä¼¼äºRunnableï¼Œä½†æ˜¯æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”callæ–¹æ³•è¿˜æœ‰å¯èƒ½æŠ›å¼‚å¸¸ Futureæ˜¯ç”¨æ¥å‚¨å­˜ä»»åŠ¡æ‰§è¡Œå®Œçš„ç»“æœçš„ FutureTaskçš„æœ¬è´¨æ˜¯FutureåŠ ä¸ŠRunnableï¼Œå³å¯ä»¥æ‰§è¡Œåˆèƒ½å­˜ç»“æœï¼Œå¯ä»¥ä½¿ç”¨CompletableFutureç®¡ç†å¤šä¸ªçº¿ç¨‹çš„ç»“æœã€‚ SingleThreadPoolåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ±  CachedThreadPoolæœ‰å¼¹æ€§çš„çº¿ç¨‹æ± ï¼Œåªè¦æ²¡é—²ç€çš„ï¼Œå°±æ¥ä¸€ä¸ªå¯åŠ¨ä¸€ä¸ª FixedThreadPoolå›ºå®šäº†çº¿ç¨‹æ± çš„çº¿ç¨‹æ•° ScheduledThreadPoolçº¿ç¨‹æ± ä¸»è¦ä¸ºäº†æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„ åœ¨æˆ‘ä»¬å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œä½†æ˜¯å¦‚æœä¸äº†è§£åŸç†çš„è¯ï¼Œå¾ˆå®¹æ˜“æ»¥ç”¨ï¼Œå¯¼è‡´ä¸€äº›ç³»ç»Ÿè¿è¡Œç¼“æ…¢ç”šè‡³å´©æºƒçš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œåˆ†ææºç çš„æ–‡ç« å°±ç•™ç€ä¸‹ç¯‡äº†ã€‚]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>threadpool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CASå®ç°ä¸åŸå­ç±»actomic]]></title>
    <url>%2F2020%2F03%2F03%2Fconcurrentart%2Fcas-implement%2F</url>
    <content type="text"><![CDATA[æ‚²è§‚é”ä¸ä¹è§‚é”æ‚²è§‚é”å®šä¹‰ï¼šå¯¹äºåŒä¸€æ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”è®¤ä¸ºå½“æˆ‘åœ¨ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¸€å®šæœ‰å…¶ä»–çº¿ç¨‹ä¹Ÿä¼šæ¥è®¿é—®å’Œä¿®æ”¹æ•°æ®ï¼Œå› æ­¤åœ¨è·å–æ•°æ®çš„æ—¶å€™ä¼šåŠ é”ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹ã€‚ åº”ç”¨ï¼šJavaä¸­ï¼Œsynchronizedå…³é”®å­—å’ŒLockçš„å®ç°ç±»éƒ½æ˜¯æ‚²è§‚é”ã€‚ ä¹è§‚é”å®šä¹‰ï¼šä¹è§‚é”è®¤ä¸ºåœ¨å¯¹è®¿é—®æ•°æ®è¿›è¡Œæ—¶ï¼Œæ²¡æœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸éœ€è¦åŠ é”ã€‚ä½†æ˜¯ä¸ºäº†ç¡®ä¿åªæœ‰è‡ªå·±åœ¨å¯¹æ•°æ®è¿›è¡Œäº†æ“ä½œï¼Œè‡ªå·±åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ä¼šå»åˆ¤æ–­ä»¥å‰æœ‰æ²¡æœ‰åˆ«çš„çº¿ç¨‹å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ã€‚å¦‚æœæ•°æ®æ²¡æœ‰æ›´æ–°ï¼Œå½“å‰çº¿ç¨‹ä¼šå°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®æˆåŠŸå†™å…¥ï¼›å¦‚æœæ•°æ®è¢«æ›´æ–°äº†ï¼Œåˆ™æ ¹æ®ä¸åŒçš„å®ç°æ–¹å¼æ‰§è¡Œä¸åŒçš„æ“ä½œï¼ˆä¾‹å¦‚æŠ¥é”™å’Œå¾ªç¯é‡è¯•ï¼‰ åº”ç”¨ï¼šjavaçš„åŸå­ç±»çš„è‡ªå¢æ“ä½œå°±æ˜¯é€šè¿‡CASè‡ªæ—‹ç®—æ³•å®ç°çš„ã€‚ åº”ç”¨åœºæ™¯ æ‚²è§‚é”é€‚åˆå†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œå…ˆåŠ é”å¯ä»¥ä¿è¯æ•°æ®æ­£ç¡®æ€§ã€‚ ä¹è§‚é”é€‚åˆè¯»æ“ä½œå¤šçš„åœºæ™¯ï¼Œä¸åŠ é”ç‰¹æ€§å¯ä»¥æé«˜è¯»æ“ä½œçš„æ€§èƒ½ã€‚ CASå®šä¹‰ï¼šCASå…¨ç§°æ˜¯Compare And Swap (cmpxchgæŒ‡ä»¤)ï¼Œå®ƒæ˜¯ä¸€ç§æ— é”çš„ç®—æ³•ï¼Œåœ¨ä¸ä½¿ç”¨é”ï¼ˆæ²¡æœ‰çº¿ç¨‹é˜»å¡ï¼‰çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹é—´çš„å˜é‡åŒæ­¥ã€‚ç”±äºå®ƒå®ç°çš„ç‰¹æ€§ï¼Œä¹Ÿå«åšè‡ªæ—‹é”ã€ä¹è§‚é”ã€‚ æºç åˆ†æ1count.incrementAndGet(); // æ›¿ä»£count++ AtomicInteger.incrementAndGetæ–¹æ³•è°ƒç”¨äº†unsafe.getAndAddIntæ–¹æ³• 123public final int incrementAndGet() &#123; return unsafe.getAndAddInt(this, valueOffset, 1) + 1; &#125; çœ‹ä¸€ä¸‹AtomicIntegerçš„å®šä¹‰ 1234567891011public class AtomicInteger extends Number implements java.io.Serializable &#123; private static final long serialVersionUID = 6214790243416807050L; // setup to use Unsafe.compareAndSwapInt for updates private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static &#123; try &#123; valueOffset = unsafe.objectFieldOffset(AtomicInteger.class.getDeclaredField("value")); &#125; catch (Exception ex) &#123; throw new Error(ex); &#125; &#125; private volatile int value; æ ¹æ®å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå„å±æ€§çš„ä½œç”¨ï¼š unsafeï¼š è·å–å¹¶æ“ä½œå†…å­˜çš„æ•°æ®ã€‚ valueOffsetï¼š å­˜å‚¨valueåœ¨AtomicIntegerä¸­çš„åç§»é‡ã€‚ valueï¼š å­˜å‚¨AtomicIntegerçš„intå€¼ï¼Œè¯¥å±æ€§éœ€è¦å€ŸåŠ©volatileå…³é”®å­—ä¿è¯å…¶åœ¨çº¿ç¨‹é—´æ˜¯å¯è§çš„ã€‚ æ¥ä¸‹æ¥æŸ¥çœ‹Unsafe.getAndAddIntæ–¹æ³•çš„å®ç° 1234567public final int getAndAddInt(Object var1, long var2, int var4) &#123; int var5; do &#123; var5 = this.getIntVolatile(var1, var2); &#125; while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4)); return var5; &#125; åˆ†ææºç å¯ä»¥çœ‹åˆ°ï¼š getIntVolatileæ–¹æ³•è·å–ç»™å®šå¯¹è±¡oä¸­çš„åç§»é‡å¤„çš„å€¼var5 ç„¶åè°ƒç”¨compareAndSwapIntæ–¹æ³•ï¼Œæ¯”è¾ƒ+æ›´æ–° æ˜¯ä¸ªåŸå­æ“ä½œï¼Œè¿™æ˜¯é€šè¿‡CPUçš„ cmpxchgæŒ‡ä»¤å»å®ç°çš„ compareAndSwapIntå°±æ˜¯casæ“ä½œï¼Œå¯çœ‹ä½œcas(Vï¼ŒExceptedï¼ŒNewValue)ï¼ŒVå°±æ˜¯è¦ä¿®æ”¹çš„å€¼ï¼ŒExceptedæ˜¯å½“å‰çš„æœŸæœ›å€¼ï¼ŒNewValueæ˜¯ä¿®æ”¹åçš„å€¼ã€‚ å½“V==Exceptedæ—¶ï¼Œå°†Væ›´æ–°ä¸ºNewValueï¼Œå¦åˆ™ï¼Œè¿”å›flaseï¼Œç»§ç»­whileå¾ªç¯å†æ¬¡è°ƒç”¨cmpxchgæŒ‡ä»¤è¿›è¡Œé‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚ CASå¸¦æ¥çš„é—®é¢˜ABAé—®é¢˜æè¿°ï¼šå› ä¸ºCASéœ€è¦åœ¨æ“ä½œå€¼æ—¶å€™ï¼Œæ£€æŸ¥å€¼æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå€¼åŸæ¥æ˜¯Aï¼Œå˜æˆäº†åŸæ¥çš„Bï¼Œåˆå˜æˆäº†Aï¼Œä½†æ˜¯ç”¨CASæ£€æŸ¥å‡ºæ¥å®ƒæ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯å˜åŒ–äº†çš„ã€‚ å½±å“ï¼šå¦‚æœæ˜¯åŸºç¡€ç±»å‹ï¼Œä¸äº§ç”Ÿå½±å“ã€‚å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸€äº›å½±å“ï¼Œè¿™ä¸ªå½±å“å¯¹ä¸šåŠ¡æ¥è¯´å¯èƒ½ä¸å¯å¿½ç•¥ã€‚ è§£å†³æ€è·¯ï¼šåœ¨å˜é‡å‰é¢æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™éƒ½æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œè¿™æ ·å˜åŒ–è¿‡ç¨‹å°±ä»â€œAï¼Bï¼Aâ€å˜æˆäº†â€œ1Aï¼2Bï¼3Aâ€ JDKä»1.5å¼€å§‹æä¾›äº†AtomicStampedReferenceç±»æ¥è§£å†³ABAé—®é¢˜ï¼Œå…·ä½“æ“ä½œå°è£…åœ¨compareAndSet()ä¸­ã€‚compareAndSet()é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨å’Œå½“å‰æ ‡å¿—ä¸é¢„æœŸå¼•ç”¨å’Œé¢„æœŸæ ‡å¿—æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœéƒ½ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†å¼•ç”¨å€¼å’Œæ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ AtomicStampedReference.compareAndSetæ–¹æ³•çš„å®ç° 123456789101112public boolean compareAndSet(V expectedReference, V newReference, int expectedStamp, int newStamp) &#123; Pair&lt;V&gt; current = pair; return expectedReference == current.reference &amp;&amp; expectedStamp == current.stamp &amp;&amp; ((newReference == current.reference &amp;&amp; newStamp == current.stamp) || casPair(current, Pair.of(newReference, newStamp))); &#125; å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§æè¿°ï¼šCASæ“ä½œå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå¯¼è‡´å…¶ä¸€ç›´è‡ªæ—‹ï¼Œç»™CPUå¸¦æ¥éå¸¸å¤§çš„å¼€é”€ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œæè¿°ï¼šå¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼ŒCASèƒ½å¤Ÿä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼ŒCASæ˜¯æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§çš„ã€‚ Javaä»1.5å¼€å§‹JDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œå¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚ AtomicReferenceç±»çš„å®šä¹‰ï¼Œä½¿ç”¨äº†æ³›å‹ 123456789101112public class AtomicReference&lt;V&gt; implements java.io.Serializable &#123; private static final long serialVersionUID = -1848883965231344442L; private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static &#123; try &#123; valueOffset = unsafe.objectFieldOffset (AtomicReference.class.getDeclaredField("value")); &#125; catch (Exception ex) &#123; throw new Error(ex); &#125; &#125; private volatile V value; public AtomicReference(V initialValue) &#123; value = initialValue;&#125; //ä¼ é€’å¯¹è±¡ How CAS (Compare And Swap) in Java works]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>CAS</tag>
        <tag>actomic</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[synchronizedåº•å±‚å®ç°åŸç†]]></title>
    <url>%2F2020%2F02%2F28%2Fconcurrentart%2Fsynchronized-implement-prinpiple%2F</url>
    <content type="text"><![CDATA[synchronizedå®šä¹‰ Multi-threaded programs may often come to a situation where multiple threads try to access the same resources and finally produce erroneous and unforeseen results.So it needs to be made sure by some synchronization method that only one thread can access the resource at a given point of time. åº”ç”¨æ–¹å¼ å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯synchronizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ åŸç† JVMåŸºäºè¿›å…¥å’Œé€€å‡ºMonitorå¯¹è±¡æ¥å®ç°æ–¹æ³•ã€ä»£ç å—åŒæ­¥çš„ï¼Œä¸¤è€…å®ç°çš„ç»†èŠ‚ä¸ä¸€æ ·ï¼Œä½†éƒ½æ˜¯ä½¿ç”¨monitorenterå’ŒmonitorexitæŒ‡ä»¤æ¥å®ç°çš„ã€‚monitorenter æŒ‡ä»¤æ˜¯åœ¨ç¼–è¯‘åæ’å…¥åˆ°åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œè€Œ monitorexit æ˜¯æ’å…¥åˆ°æ–¹æ³•çš„ç»“æŸå¤„å’Œå¼‚å¸¸å¤„ï¼ŒJVMè¦ä¿è¯æ¯ä¸ªmonitorenterå¿…é¡»æœ‰å¯¹åº”çš„monitorexitä¸ä¹‹é…å¯¹ã€‚ ä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªMonitorä¸ä¹‹ å…³è”ï¼Œå½“ä¸”ä¸€ä¸ªMonitorè¢«æŒæœ‰åï¼Œå®ƒå°†å¤„äºé”å®šçŠ¶æ€ã€‚ çº¿ç¨‹æ‰§è¡Œåˆ°monitorenteræŒ‡ä»¤æ—¶ï¼Œå°†ä¼šå°è¯•è·å–å¯¹è±¡çš„é”ã€‚ è€Œå¯¹äºæ²¡æœ‰è·å–åˆ°å¯¹è±¡é”çš„çº¿ç¨‹ä¼šé˜»å¡åœ¨æ–¹æ³•çš„å…¥å£ï¼Œç›´åˆ°è·å–é”çš„çº¿ç¨‹æ‰§è¡Œ monitorexitä¹‹åæ‰èƒ½å°è¯•ç»§ç»­è·å–é”ã€‚ æµç¨‹å¦‚ä¸‹ï¼š éªŒè¯æºç  123Object o = new Object();synchronized (o) &#123;&#125; ä½¿ç”¨jclasslibæŸ¥çœ‹æ±‡ç¼–æŒ‡ä»¤ å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨ ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šmarkwordï¼ˆ8ä¸ªå­—èŠ‚ï¼‰ã€class pointerï¼ˆ4ä¸ªå­—èŠ‚ï¼‰ã€instance data å†…å­˜å¯¹é½ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­å çš„å­—èŠ‚æ•°å¿…é¡»æ˜¯8çš„å€æ•°ï¼Œå³%8=0ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œåˆ™ä¼šè¡¥é½è‡³8çš„å€æ•°ã€‚ å¯¹è±¡å¤´ åœ¨64ä½è™šæ‹Ÿæœºä¸‹ï¼Œmarkwordæ˜¯64ä½ ç”¨markwordä¸­æœ€ä½çš„ä¸‰ä½ä»£è¡¨é”çŠ¶æ€ï¼Œå…¶ä¸­1ä½æ˜¯åå‘é”ä½ï¼šæ— é”â€”0 01ã€åå‘é”â€”1 01 åé¢ä¸¤ä½æ˜¯æ™®é€šé”ä½ï¼šè½»é‡çº§é”â€”00ã€é‡é‡çº§é”â€”01 å‚è€ƒï¼šsynchronized å…³é”®å­—åŸç† é”å‡çº§æè¿°JDKè¾ƒæ—©çš„ç‰ˆæœ¬ï¼Œéƒ½æ˜¯ä½¿ç”¨synchronized,å¾ˆå¤šäººç§°ä¸ºé‡é‡é”ï¼Œ é‡é‡é” æ•ˆç‡æ¯”è¾ƒä½ï¼Œå› ä¸ºå®ƒè¦å‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºã€‚jdk1.6å¯¹synchronizedè¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¸ºäº†å‡å°‘è·å–å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ¶ˆè€—ï¼Œå¼•å…¥äº†è½»é‡çº§é”å’Œåå‘é” çš„æ¦‚å¿µã€‚é”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜åˆ†åˆ«æ˜¯æ— é” - åå‘é” - è½»é‡çº§é”ï¼ˆè‡ªæ—‹é”ï¼‰-é‡é‡çº§é” æ— é”Object o = new Object() é”çš„çŠ¶æ€ä¸ºï¼š0 01 æ— é”æ€ 100000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001 æ‰§è¡Œo.hashCode()åï¼Œå¯¹è±¡å¤´å˜ä¸ºhashcode+0 01 100000000 00000000 00000000 00000111 10000000 11001011 01110111 00000001 åå‘é”åœ¨JDK 6åŠä»¥åçš„JVMé‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚å¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:-UseBiasedLocking=falseï¼Œå…³é—­ä¹‹åç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚ å…³é—­åå‘é” -XX:+UseBiasedLocking -client -Xmx512m -Xms512m é—®é¢˜ï¼šæ–°å®ä¾‹åŒ–å¯¹è±¡oæ˜¯æ— é”ï¼Œå½“å¯¹è±¡ä½¿ç”¨sync(o)ä¹‹åï¼Œä¸ºä»€ä¹ˆå¯¹è±¡æ˜¯è½»é‡çº§é”çŠ¶æ€è€Œä¸æ˜¯åå‘é”çŠ¶æ€å‘¢ï¼Ÿ å› ä¸ºåå‘é”çš„å¯åŠ¨æœ‰4sçš„æ—¶å»¶ï¼Œä¸ºä»€ä¹ˆè¦æœ‰æ—¶å»¶å‘¢ï¼ŸJVMè™šæ‹Ÿæœºè‡ªå·±æœ‰ä¸€äº›é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹ï¼Œé‡Œé¢æœ‰å¥½å¤šsyncä»£ç ï¼Œè¿™äº›syncä»£ç å¯åŠ¨æ—¶å°±çŸ¥é“è‚¯å®šä¼šæœ‰ç«äº‰ï¼Œå¦‚æœä½¿ç”¨åå‘é”ï¼Œå°±ä¼šé€ æˆåå‘é”ä¸æ–­çš„è¿›è¡Œé”æ’¤é”€å’Œé”å‡çº§çš„æ“ä½œï¼Œæ•ˆç‡è¾ƒä½ã€‚ å¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…³é—­æ—¶å»¶ -XX:+UseBiasedLocking -XX:BiasedLockingStartupDelay=0 -client -Xmx1024m -Xms1024m åå‘é”åå‘é”ï¼Œåå‘åŠ é”çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ã€‚ é€‚ç”¨äºé”ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œå¹¶ä¸”åº”ç”±ä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å¾—é”ã€‚markword ä¸Šè®°å½•å½“å‰çº¿ç¨‹æŒ‡é’ˆï¼Œä¸‹æ¬¡åŒä¸€ä¸ªçº¿ç¨‹åŠ é”çš„æ—¶å€™ï¼Œä¸éœ€è¦äº‰ç”¨ï¼Œåªéœ€è¦åˆ¤æ–­çº¿ç¨‹æŒ‡é’ˆæ˜¯å¦åŒä¸€ä¸ªã€‚ è·å¾—é”å½“çº¿ç¨‹è®¿é—®åŒæ­¥å—æ—¶ï¼Œä¼šä½¿ç”¨ CAS å°†çº¿ç¨‹ ID æ›´æ–°åˆ°é”å¯¹è±¡çš„ Mark Word ä¸­ï¼Œå¦‚æœæ›´æ–°æˆåŠŸåˆ™è·å¾—åå‘é”ï¼Œä»¥åè¯¥çº¿ç¨‹è¿›å…¥æˆ–è€…é€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡Œ CAS æ“ä½œæ¥åŠ é”å’Œé‡Šæ”¾é”ã€‚åªéœ€æ£€æŸ¥ä¸€ä¸‹é”å¯¹è±¡çš„ Mark Word ä¸­æ˜¯å¦å­˜å‚¨äº†å½“å‰çº¿ç¨‹çš„IDï¼Œå¦‚æœæ˜¯ï¼Œè¡¨ç¤ºå½“å‰å·²ç»è·å¾—åå‘é”ï¼Œå¦åˆ™å†å»æ£€æŸ¥ä¸€ä¸‹ Mark Word ä¸­åå‘é”ä½æ˜¯å¦æ˜¯1ï¼Œå¦‚æœä¸æ˜¯ï¼Œä½¿ç”¨ CASç«äº‰é”ï¼Œå¦‚æœæ˜¯ï¼Œä½¿ç”¨ CAS å°†å¯¹è±¡å¤´çš„åå‘é”æŒ‡å‘å½“å‰çº¿ç¨‹ã€‚ é‡Šæ”¾é”å½“å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œåå‘é”çš„æ’¤é”€éœ€è¦ç­‰åˆ°å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç ï¼‰ï¼Œæ¥ç€ä¼šæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œæ ¹æ®é”å¯¹è±¡ç›®å‰æ˜¯å¦è¢«é”ï¼Œæ¥åˆ¤å®šå°†å¯¹è±¡å¤´ä¸­çš„ Mark Word è®¾ç½®ä¸ºæ— é”æˆ–è€…æ˜¯è½»é‡é”çŠ¶æ€ã€‚ åå‘é”å¯ä»¥æé«˜å¸¦æœ‰åŒæ­¥å´æ²¡æœ‰ç«äº‰çš„ç¨‹åºæ€§èƒ½ï¼Œä½†å¦‚æœç¨‹åºä¸­å¤§å¤šæ•°é”éƒ½å­˜åœ¨ç«äº‰æ—¶ï¼Œé‚£åå‘é”å°±èµ·ä¸åˆ°å¤ªå¤§ä½œç”¨ã€‚è¿™æ—¶åº”è¯¥å…³é—­åå‘é”ï¼Œä½¿ç¨‹åºç›´æ¥è¿›å…¥è½»é‡é”çŠ¶æ€ã€‚ è½»é‡çº§é”é”å‡çº§ä¸ºè½»é‡çº§é” - æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„LockRecordåœ¨è‡ªå·±çš„çº¿ç¨‹æ ˆä¸Šï¼Œç”¨CASå»äº‰ç”¨markwordçš„LRçš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘å“ªä¸ªçº¿ç¨‹çš„LRï¼Œå“ªä¸ªçº¿ç¨‹å°±æ‹¥æœ‰é”ã€‚ åŠ é”çº¿ç¨‹åœ¨è¿›å…¥åŒæ­¥å—ä¹‹å‰ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡ä¸ºæ— é”çŠ¶æ€æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šåœ¨æ ˆå¸§ä¸­åˆ›å»ºä¸€ä¸ªé”è®°å½•(Lock Record)åŒºåŸŸï¼ŒåŒæ—¶å°†é”å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ Mark Word æ‹·è´åˆ°é”è®°å½•ä¸­ï¼Œå†å°è¯•ä½¿ç”¨ CAS å°† Mark Word æ›´æ–°ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚ å¦‚æœæ›´æ–°æˆåŠŸï¼Œå½“å‰çº¿ç¨‹å°±è·å¾—äº†é”ã€‚ å¦‚æœæ›´æ–°å¤±è´¥ JVM ä¼šå…ˆæ£€æŸ¥é”å¯¹è±¡çš„ Mark Word æ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„é”è®°å½•ã€‚ å¦‚æœæ˜¯åˆ™è¯´æ˜å½“å‰çº¿ç¨‹æ‹¥æœ‰é”å¯¹è±¡çš„é”ï¼Œå¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ã€‚ ä¸æ˜¯åˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹æŠ¢å äº†é”ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶ç«äº‰ä¸€æŠŠé”ï¼Œè½»é‡é”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡é”ã€‚ è§£é”è½»é‡é”çš„è§£é”è¿‡ç¨‹ä¹Ÿæ˜¯åˆ©ç”¨ CAS æ¥å®ç°çš„ï¼Œä¼šå°è¯•é”è®°å½•æ›¿æ¢å›é”å¯¹è±¡çš„ Mark Word ã€‚å¦‚æœæ›¿æ¢æˆåŠŸåˆ™è¯´æ˜æ•´ä¸ªåŒæ­¥æ“ä½œå®Œæˆï¼Œå¤±è´¥åˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è·å–é”ï¼Œè¿™æ—¶å°±ä¼šå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹(æ­¤æ—¶å·²ç»è†¨èƒ€ä¸ºé‡é‡é”) è½»é‡é”èƒ½æå‡æ€§èƒ½çš„åŸå› ï¼š è®¤ä¸ºå¤§å¤šæ•°é”åœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸéƒ½ä¸å­˜åœ¨ç«äº‰ï¼Œæ‰€ä»¥ä½¿ç”¨ CAS æ¯”ä½¿ç”¨äº’æ–¥å¼€é”€æ›´å°‘ã€‚ä½†å¦‚æœé”ç«äº‰æ¿€çƒˆï¼Œè½»é‡é”å°±ä¸ä½†æœ‰äº’æ–¥çš„å¼€é”€ï¼Œè¿˜æœ‰ CAS çš„å¼€é”€ï¼Œç”šè‡³æ¯”é‡é‡é”æ›´æ…¢ã€‚ é‡é‡çº§é”è‡ªæ—‹è¶…è¿‡10æ¬¡ï¼Œå‡çº§ä¸ºé‡é‡çº§é”ï¼ˆå¦‚æœå¤ªå¤šçº¿ç¨‹è‡ªæ—‹ CPUæ¶ˆè€—è¿‡å¤§ï¼Œä¸å¦‚å‡çº§ä¸ºé‡é‡çº§é”ï¼‰ã€‚å½“å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œå…¶ä»–çº¿ç¨‹è¯•å›¾è·å–é”æ—¶ï¼Œä¼šé˜»å¡è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ˆä¸æ¶ˆè€—CPUï¼‰ï¼Œç›´åˆ°æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åä¼šå”¤é†’è¿™äº›çº¿ç¨‹ï¼Œè¢«å”¤é†’çš„çº¿ç¨‹ä¼šå†æ¬¡ä¸€èµ·ç«äº‰é”ã€‚ å…¶ä»–ä¼˜åŒ–é€‚åº”æ€§è‡ªæ—‹åœ¨ä½¿ç”¨ CAS æ—¶ï¼Œå¦‚æœæ“ä½œå¤±è´¥ï¼ŒCAS ä¼šè‡ªæ—‹å†æ¬¡å°è¯•ã€‚ç”±äºè‡ªæ—‹æ˜¯éœ€è¦æ¶ˆè€— CPU èµ„æºçš„ï¼Œæ‰€ä»¥å¦‚æœé•¿æœŸè‡ªæ—‹å°±ç™½ç™½æµªè´¹äº† CPUã€‚JDK1.6åŠ å…¥äº†é€‚åº”æ€§è‡ªæ—‹: å¦‚æœæŸä¸ªé”è‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å°±ä¼šå‡å°‘è‡ªæ—‹ã€‚ æ€»ç»“ç»¼ä¸Šï¼Œåå‘é”é€šè¿‡å¯¹æ¯”Mark Wordè§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…æ‰§è¡ŒCASæ“ä½œã€‚è€Œè½»é‡çº§é”æ˜¯é€šè¿‡ç”¨CASæ“ä½œå’Œè‡ªæ—‹æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’è€Œå½±å“æ€§èƒ½ã€‚é‡é‡çº§é”æ˜¯å°†é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚ å‚è€ƒï¼šç¾å›¢ ä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>synchronized</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[volatileåº•å±‚å®ç°åŸç†]]></title>
    <url>%2F2020%2F02%2F27%2Fconcurrentart%2Fvolatile-implement-prinpiple%2F</url>
    <content type="text"><![CDATA[volatileå®šä¹‰ Javaç¼–ç¨‹è¯­è¨€å…è®¸çº¿ç¨‹è®¿é—®å…±äº«å˜é‡ï¼Œä¸ºäº†ç¡®ä¿å…±äº«å˜é‡èƒ½è¢«å‡†ç¡®å’Œä¸€è‡´åœ°æ›´æ–°ï¼Œçº¿ç¨‹åº”è¯¥ç¡®ä¿é€šè¿‡æ’å®ƒé”å•ç‹¬è·å–è¿™ä¸ªå˜é‡ã€‚ çº¿ç¨‹çš„å¯è§æ€§123456789101112131415161718192021222324public class VolatileApplication &#123; // å½“ä½¿ç”¨volatileæ—¶ï¼Œä¸»çº¿ç¨‹ä¿®æ”¹å®Œå†…å­˜ä¸­çš„flagåï¼Œå¯¹ç­‰çº¿ç¨‹ä¼šä»å†…å­˜ä¸­è¯»å–åˆ°flagè¢«ä¿®æ”¹åçš„å€¼ï¼Œæ­£å¸¸ç»“æŸï¼ private static /*volatile*/ boolean flag = true; public static void main(String[] args) throws InterruptedException &#123; new Thread() &#123; @Override public void run() &#123; while (flag) &#123; &#125; System.out.println("å¯¹ç­‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•"); &#125; &#125;.start(); Thread.sleep(1000); flag = false; System.out.println("ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•"); &#125;&#125; åŸç†javaæºç ï¼š 1instance = new Singleton(); //instanceæ˜¯volatileå˜é‡ æ±‡ç¼–ï¼š 10x01a3deld:movb $0âœ–ï¸0,0âœ–ï¸1104800(%esi);oxo1a3de24:lock addl $0âœ–ï¸0,(%esp); lockæŒ‡ä»¤å¹²äº†ä¸¤ä»¶äº‹æƒ…ï¼š å°†å½“å‰å¤„ç†å™¨ç¼“å­˜è¡Œçš„æ•°æ®å†™ä¼šåˆ°ç³»ç»Ÿå†…å­˜ è¿™ä¸ªå†™å›å†…å­˜çš„æ“ä½œä¼šä½¿åœ¨å…¶ä»–CPUé‡Œç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆ ç¼“å­˜ä¸€è‡´æ€§ ç”±äºCPUçš„è¿è¡Œé€Ÿåº¦è¿œè¿œå¤§äºå‘å†…å­˜è¯»å–çš„é€Ÿåº¦ï¼Œæ‰€ä»¥ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒåŠ å…¥äº†é«˜é€Ÿç¼“å­˜æœºåˆ¶ï¼Œå³å¤„ç†å™¨ä¸ä¼šç›´æ¥å’Œå†…å­˜è¿›è¡Œé€šä¿¡ï¼Œè€Œæ˜¯å…ˆå°†ç‰©ç†å†…å­˜çš„æ•°æ®è¯»åˆ°å†…éƒ¨ç¼“å­˜ï¼ˆL1ï¼ŒL2ï¼ŒL3æˆ–å…¶ä»–ï¼‰ï¼Œå†è¿›è¡Œæ“ä½œ ã€‚ä¿å­˜çš„ä¸€è‡´æ€§å°±æ˜¯ä¿è¯å¤šä¸ªç¼“å­˜ä¸­å…±äº«æ•°æ®çš„ä¸€è‡´æ€§ï¼Œç›®å‰ä¸»è¦æ˜¯é€šè¿‡MESIåè®®æ¥ä¿è¯çš„ã€‚ MESI åè®® Modifiedã€Exclusiveã€ Share or InvalidçŠ¶æ€è€Œå‘½åçš„ï¼Œç”¨æ¥æ ‡è¯†æ¯ä¸ªç¼“å­˜è¡Œçš„çŠ¶æ€ï¼ˆç”±ä¸¤ä¸ªçŠ¶æ€ä½è¡¨ç¤ºï¼‰ï¼Œæ¯ä¸ªç¼“å­˜è¡Œï¼ˆç¼“å­˜çš„æ•°æ®åŸºæœ¬å•ä½ï¼‰éƒ½å¤„äºMã€Eã€Så’ŒIè¿™å››ç§çŠ¶æ€ä¹‹ä¸€ã€‚ ä¼ªå…±äº« å½“å¤šçº¿ç¨‹ä¿®æ”¹äº’ç›¸ç‹¬ç«‹çš„å˜é‡æ—¶ï¼Œå¦‚æœè¿™äº›å˜é‡å…±äº«åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œå°±ä¼šæ— æ„ä¸­å½±å“å½¼æ­¤çš„æ€§èƒ½ï¼Œè¿™å°±æ˜¯ä¼ªå…±äº«ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public class T02_CacheLinePadding &#123; // ä¸å¯¹é½çš„ç»“æœè€—æ—¶ï¼š227msï¼Œå¯¹é½çš„ç»“æœè€—æ—¶ï¼š79ms private static class Padding &#123; /*volatile*/ long p0, p1, p2, p3, p4, p5, p6; &#125; private static class T extends Padding &#123; volatile long x = 0L; &#125; public static T[] arr = new T[2]; static &#123; arr[0] = new T(); arr[1] = new T(); &#125; public static void main(String[] args) &#123; Thread thread1 = new Thread(new Runnable() &#123; @Override public void run() &#123; for (int i = 0; i &lt; 10000000L; i++) &#123; arr[0].x = i; &#125; &#125; &#125;); Thread thread2 = new Thread(new Runnable() &#123; @Override public void run() &#123; for (int i = 0; i &lt; 10000000L; i++) &#123; arr[1].x = i; &#125; &#125; &#125;); long startTime = System.currentTimeMillis(); thread1.start(); thread2.start(); try &#123; thread1.join(); thread2.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("æ€»è€—æ—¶ï¼š" + (System.currentTimeMillis() - startTime) + "ms"); &#125;&#125; é¿å…ä¼ªå…±äº« ç¼“å­˜è¡Œéš”ç¦» åˆ©ç”¨ç¼“å­˜è¡Œåœ¨ç°ä»£è®¡ç®—æœºä¸­å 8å­—64å­—èŠ‚çš„ç‰¹æ€§ï¼Œä¸ºé¿å…å¤šçº¿ç¨‹ç¼“å­˜ä¸€è‡´æ€§å¸¦æ¥çš„æ€§èƒ½å½±å“ï¼Œå¼•å…¥äº†ç¼“å­˜è¡Œå¯¹é½ï¼Œåœ¨å®šä¹‰å¯¹è±¡æ—¶ï¼Œå¦‚æœå¯¹è±¡åœ¨å†…å­˜ä¸­ä¸å 64å­—èŠ‚ï¼Œå°±è¡¥é½64å­—èŠ‚ï¼Œä¿è¯å¯¹è±¡ä¸­çš„æ•°æ®ç¼“å­˜åœ¨ä¸åŒçš„ç¼“å­˜è¡Œä¸­ã€‚ ç¼“å­˜è¡Œ64ä¸ªå­—èŠ‚æ˜¯CPUåŒæ­¥çš„åŸºæœ¬å•ä½ï¼Œç¼“å­˜è¡Œéš”ç¦»ä¼šæ¯”ä¼ªå…±äº«æ•ˆç‡è¦é«˜ å‚è€ƒï¼šæ‚è°ˆ ä»€ä¹ˆæ˜¯ä¼ªå…±äº«ï¼ˆfalse sharingï¼‰ Concurrency with LMAX Disruptor â€“ An Introduction æŒ‡ä»¤é‡æ’åºå®šä¹‰ CPUå†…éƒ¨çš„ä¸€ä¸ªä¼˜åŒ–ï¼Œå½“CPUåŒæ—¶å…ˆåæ‰§è¡Œä¸¤æ¡æŒ‡ä»¤ï¼Œä¸€æ¡æ˜¯ä»å†…å­˜ä¸­è¯»æŒ‡ä»¤ï¼Œä¸€æ¡æ˜¯æ‰§è¡Œæ“ä½œæ•°æ®æŒ‡ä»¤ï¼ŒCPUç”±äºè¯»æŒ‡ä»¤æ›´è€—æ—¶ï¼Œä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ–°æ’åºï¼Œå…ˆæ‰§è¡Œæ“ä½œæ•°æ®çš„æŒ‡ä»¤ï¼Œå†æ‰§è¡Œè¯»æŒ‡ä»¤ï¼Œå½“ç„¶æ˜¯è¿™ä¸¤æ¡æŒ‡ä»¤çš„å˜é‡å¿…é¡»æ˜¯æ²¡æœ‰å…³è”ï¼Œä¸ä¼šäº’ç›¸å½±å“çš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public class T04_Disorder &#123; private static int x = 0, y = 0; private static int a = 0, b = 0; public static void main(String[] args) throws InterruptedException &#123; int i = 0; for (; ; ) &#123; i++; x = 0; y = 0; a = 0; b = 0; Thread one = new Thread(new Runnable() &#123; @Override public void run() &#123; shortWait(100L); a = 1; x = b; &#125; &#125;); Thread two = new Thread(new Runnable() &#123; @Override public void run() &#123; b = 1; y = a; &#125; &#125;); one.start(); two.start(); one.join(); two.join(); String result = "ç¬¬" + i + "æ¬¡ (" + x + "," + y + "ï¼‰"; if (x == 0 &amp;&amp; y == 0) &#123; System.err.println(result); break; &#125; else &#123;// System.out.println(result); &#125; &#125; &#125; private static void shortWait(long interval) &#123; long startTime = System.currentTimeMillis(); long endTime; do &#123; endTime = System.currentTimeMillis(); &#125; while (endTime - startTime &lt;= interval); &#125;&#125; é—®é¢˜ å¯¹è±¡çš„åŠåˆå§‹åŒ– 1234567public class T &#123; int m = 8; public static void main(String[] args) &#123; T t = new T(); &#125;&#125; DCLå•ä¾‹åˆ°åº•éœ€ä¸éœ€è¦åŠ volatileä¿®é¥°ç¬¦ è¿™é‡Œçš„ volatile å…³é”®å­—ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æŒ‡ä»¤é‡æ’ã€‚åŸç†å¦‚ä¸‹ï¼š singleton = new Singleton();è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥ï¼š åˆ†é…å†…å­˜ç©ºé—´ï¼Œt.m=0 åˆå§‹åŒ–å¯¹è±¡ï¼Œæ‰§è¡Œæ„é€ å‡½æ•°ï¼Œt.m=8 å°† singleton å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ åŠ ä¸Š volatile æ˜¯ä¸ºäº†è®©ä»¥ä¸Šçš„ä¸‰æ­¥æ“ä½œé¡ºåºæ‰§è¡Œï¼Œåä¹‹æœ‰å¯èƒ½ç¬¬äºŒæ­¥åœ¨ç¬¬ä¸‰æ­¥ä¹‹å‰è¢«æ‰§è¡Œå°±æœ‰å¯èƒ½æŸä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å•ä¾‹å¯¹è±¡æ˜¯è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œä»¥è‡´äºæŠ¥é”™ã€‚ JSRå†…å­˜å±éšœ ä¸¤æ¡æŒ‡ä»¤é—´å¦‚æœåŠ äº†å†…å­˜å±éšœï¼ŒCPUè¿è¡Œçš„æ—¶å€™å°±ä¸èƒ½å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºã€‚ volitileå¦‚ä½•è§£å†³æŒ‡ä»¤é‡æ’åº volatile i ACC_VOLATILE JVMçš„å†…å­˜å±éšœ hotspotå®ç° æŸ¥çœ‹è™šæ‹Ÿæœºä¸­çš„C++æºç æ–‡ä»¶å¦‚ä¸‹ï¼š bytecodeinterpreter.cpp 12345int field_offset = cache-&gt;f2_as_index(); if (cache-&gt;is_volatile()) &#123; if (support_IRIW_for_not_multiple_copy_atomic_cpu) &#123; OrderAccess::fence(); &#125; orderaccess_linux_x86.inline.hpp 12345678910inline void OrderAccess::fence() &#123; if (os::is_MP()) &#123; // always use locked addl since mfence is sometimes expensive#ifdef AMD64 __asm__ volatile ("lock; addl $0,0(%%rsp)" : : : "cc", "memory");#else __asm__ volatile ("lock; addl $0,0(%%esp)" : : : "cc", "memory");#endif &#125;&#125; å‚è€ƒï¼šä½ åº”è¯¥çŸ¥é“çš„ volatile å…³é”®å­—]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>volatile</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜]]></title>
    <url>%2F2020%2F02%2F26%2Fconcurrentart%2Fchallenge-concurrency-progrramming%2F</url>
    <content type="text"><![CDATA[ä¸Šä¸‹æ–‡åˆ‡æ¢å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ–¹æ³• æ— é”å¹¶å‘ç¼–ç¨‹ CASç®—æ³• ä½¿ç”¨æœ€å°‘çº¿ç¨‹ åç¨‹(åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å®ç°å¤šä»»åŠ¡è°ƒåº¦) ç›‘æ§ç¨‹åºæŸ¥çœ‹è¿›ç¨‹ä¸­çš„çº¿ç¨‹ jstack 30587 &gt; /app/sssc-soa-starindex/dump1 åˆ†æçº¿ç¨‹ä¿¡æ¯æ–‡ä»¶ grep java.lang.Thread.State dump1 | awk â€˜{print $2$3$4$5}â€™ | sort | uniq -c æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ï¼Œæ˜¯å¦å µå¡æˆ–è¿›è¡Œå¤šæ¬¡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢é‡æ–°é…ç½®çº¿ç¨‹æ± ä¿¡æ¯ï¼Œé‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹çº¿ç¨‹è¿è¡Œæ•ˆæœï¼Œæ˜¯å¦è¿›è¡Œäº†å¤šæ¬¡çº¿ç¨‹åˆ‡æ¢æ­»é”å¯¼è‡´æ­»é”çš„åŸå›  ç¬¬ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…ç¬¬äºŒä¸ªçº¿ç¨‹é‡Šæ”¾èµ„æºï¼Œè€Œç¬¬äºŒçº¿ç¨‹åœ¨ç­‰å¾…ç¬¬ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾èµ„æºã€‚ äº§ç”Ÿæ­»é”çš„æ¡ä»¶ äº’æ–¥ç­‰å¾…ï¼ˆåŒæ­¥çš„åŸç†ï¼‰ Hold and Wait å¾ªç¯ç­‰å¾… æ— æ³•å‰¥å¤ºçš„ç­‰å¾… é¿å…æ­»é”çš„æ–¹æ³• ä¸€æ¬¡æ€§è·å–fromå’Œ toé”ï¼Œæ— æ³•å®ç° æŒ‰é¡ºåºè·å–é” åŠ å…¥è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œå°±é‡Šæ”¾é”ï¼ˆä¸æ¨èï¼‰ èµ„æºé™åˆ¶çš„æŒ‘æˆ˜ä»€ä¹ˆæ˜¯èµ„æºé™åˆ¶ åœ¨è¿›è¡Œå¹¶å‘ç¼–ç¨‹æ—¶ï¼Œç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦å—é™äºè®¡ç®—æœºç¡¬ä»¶èµ„æºæˆ–è½¯ä»¶èµ„æºã€‚æ¯”å¦‚ç¡¬ä»¶èµ„æºé™åˆ¶æœ‰å®½å¸¦çš„ä¸Šä¼ /ä¸‹è½½é€Ÿåº¦ã€ç¡¬ä»¶è¯»å†™é€Ÿåº¦å’ŒCPUçš„å¤„ç†é€Ÿåº¦ã€‚è½¯ä»¶èµ„æºé™åˆ¶æœ‰æ•°æ®åº“çš„è¿æ¥æ•°å’Œsocketè¿æ¥æ•°ç­‰ã€‚ èµ„æºé™åˆ¶å¼•å‘çš„é—®é¢˜ å¹¶å‘ç¨‹åºåœ¨èµ„æºé™åˆ¶çš„æƒ…å†µä¸‹ï¼Œè¿è¡Œèµ·æ¥æ¯”ä¸²è¡Œè¿˜æ…¢ã€‚ è§£å†³èµ„æºé™åˆ¶å¼•å‘çš„é—®é¢˜ ä½¿ç”¨é›†ç¾¤ï¼Œå¤šæœºéƒ¨ç½² è½¯ä»¶èµ„æºï¼šçº¿ç¨‹æ± ã€è¿æ¥æ± å¤ç”¨]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹åŸºæœ¬æ¦‚å¿µ]]></title>
    <url>%2F2020%2F02%2F25%2Fconcurrentart%2Fthread-base-knowledges%2F</url>
    <content type="text"><![CDATA[è¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ ä¸€ä¸ªç¨‹åºå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œç»å…¸å®šä¹‰æ˜¯ï¼šä¸€ä¸ªæ‰§è¡Œä¸­ç¨‹åºçš„å®ä¾‹ã€‚ çº¿ç¨‹ çº¿ç¨‹æ˜¯è¿›ç¨‹æ‰§è¡Œçš„æœ€å°æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ã€‚ ä»€ä¹ˆæ˜¯çº¿ç¨‹12345678910111213141516171819202122232425262728293031323334public class T01_whatisThread &#123; // ç›´æ¥æ‰§è¡Œrunæ–¹æ³•,ç¨‹åºé¡ºåºæ‰§è¡Œï¼Œæ‰§è¡Œstartæ–¹æ³•ï¼Œä¸»çº¿ç¨‹ä¸å¯¹ç­‰çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œäº¤å‰æ‰“å°ï¼ public static void main(String[] args) &#123;// new T1().run(); new T1().start(); for (int i = 0; i &lt; 10; i++) &#123; try &#123; TimeUnit.MICROSECONDS.sleep(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("Main"); &#125; &#125; private static class T1 extends Thread &#123; @Override public void run() &#123; for (int i = 0; i &lt; 10; i++) &#123; try &#123; TimeUnit.MICROSECONDS.sleep(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("T1"); &#125; &#125; &#125;&#125; çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566public class T02_HowToCreateThread &#123; public static void main(String[] args) &#123; // 1.ç»§æ‰¿Threadæ–¹å¼ new MyThread().start(); // 2.å®ç°Runnableæ¥å£ new Thread(new MyRun()).start(); // 3.ä½¿ç”¨åŒ¿åç±» new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println("Hello,My Anonymous"); &#125; &#125;).start(); // 3.ä½¿ç”¨Lambdaè¡¨è¾¾å¼// new Thread(()-&gt;&#123;// System.out.println("Hello Lambda!");// &#125;).start(); // 4.å®ç°callableæ¥å£ Thread thread = new Thread(new FutureTask&lt;String&gt;(new MyCall())); thread.start(); // 5.ä½¿ç”¨çº¿ç¨‹æ±  ExecutorService executorService = Executors.newCachedThreadPool(); executorService.execute(new Runnable() &#123; @Override public void run() &#123; System.out.println("Hello ThreadPool!"); &#125; &#125;); executorService.shutdown(); &#125; private static class MyThread extends Thread &#123; @Override public void run() &#123; System.out.println("Hello MyThread!"); &#125; &#125; private static class MyRun implements Runnable &#123; @Override public void run() &#123; System.out.println("Hello MyRun!"); &#125; &#125; static class MyCall implements Callable&lt;String&gt; &#123; @Override public String call() throws Exception &#123; System.out.println("Hello MyCall"); return "Success"; &#125; &#125;&#125; çº¿ç¨‹çš„å¸¸è§æ–¹æ³• sleep causes the thread to definitely stop executing for a given amount of time; if no other thread or process needs to be run, the CPU will be idle (and probably enter a power saving mode). yield basically means that the thread is not doing anything particularly important and if any other threads or processes need to be run, they should run. Otherwise, the current thread will continue to run. join The join() method of a Thread instance is used to join the start of a threadâ€™s execution to end of other threadâ€™s execution such that a thread does not start running until another thread ends. If join() is called on a Thread instance, the currently running thread will block until the Thread instance has finished executing. join(n):It will put the current thread on wait until the thread on which it is called is dead or wait for specified time (milliseconds). å‚è€ƒï¼šJava Concurrency â€“ yield(), sleep() and join() methods 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public class T03_YieldJoin &#123; private static class YieldThread extends Thread &#123; @Override public void run() &#123; for (int i = 0; i &lt; 5; i++) &#123; System.out.println(Thread.currentThread().getName() + " in Control"); &#125; &#125; &#125; private static class JoinThread extends Thread &#123; @Override public void run() &#123; Thread t = Thread.currentThread(); System.out.println("Current thread: " + t.getName()); // checks if current thread is alive System.out.println("Is Alive? " + t.isAlive()); &#125; &#125; public static void main(String[] args) &#123; // æŠŠå½“å‰ä»»åŠ¡æ”¾å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œè®©åˆ«çš„çº¿ç¨‹ä¼˜å…ˆæ‰§è¡Œï¼ˆä½†æœ‰å¯èƒ½è¿˜æ˜¯æ‹¿åˆ°å½“å‰çš„ä»»åŠ¡æ‰§è¡Œï¼Œæ¯”å¦‚ç­‰å¾…é˜Ÿåˆ—æ²¡æœ‰ä»»åŠ¡æ—¶ï¼‰// testYield(); // å½“å‰çº¿ç¨‹è°ƒç”¨äº†åˆ«çš„çº¿ç¨‹ï¼Œè°ƒç”¨join()æ—¶è®©å½“å‰çº¿ç¨‹ç­‰å¾…ï¼ˆå µå¡ï¼‰ï¼Œå½“è°ƒç”¨çº¿ç¨‹æ‰§è¡Œå®Œäº†ï¼Œè‡ªå·±å†æ‰§è¡Œã€‚ testJoin(); &#125; private static void testJoin() &#123; Thread t = new Thread(new JoinThread()); t.start(); // Waits for 1000ms this thread to die.If thread is deadï¼Œexecute next instruction try &#123; t.join(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("\nJoining after 1000"+ " mili seconds: \n"); System.out.println("Current thread: " + t.getName()); // Checks if this thread is alive System.out.println("Is alive? " + t.isAlive()); &#125; private static void testYield() &#123; Thread thread = new YieldThread(); thread.start(); for (int i = 0; i &lt; 5; i++) &#123; Thread.yield(); System.out.println(Thread.currentThread().getName() + " in Control"); &#125; &#125;&#125; çº¿ç¨‹çŠ¶æ€ æ–°å»ºçŠ¶æ€â€”â€”new Thread()ï¼Œå¯¹è±¡å®ä¾‹åŒ–åå°±æ˜¯æ–°å»ºçŠ¶æ€äº†ã€‚ RunnableçŠ¶æ€ Readyå°±ç»ªçŠ¶æ€â€”â€”thread.start()ï¼Œä»»åŠ¡è¢«æ‰”åˆ°CPUç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«è¿è¡Œã€‚ RunningçŠ¶æ€â€”â€”è¢«CPUè°ƒåº¦å™¨é€‰ä¸­ï¼Œå¼€å§‹æ‰§è¡Œï¼Œå½“é¡ºåˆ©æ‰§è¡Œå®Œåï¼Œè¿›å…¥Teminatedç»“æŸçŠ¶æ€ï¼Œå¦‚æœæ‰§è¡Œäº†yield()ï¼Œå½“å‰çº¿ç¨‹ä¼šè¿›å…¥Readyå°±ç»ªçŠ¶æ€ï¼Œç­‰CPUè°ƒåº¦å™¨é€‰ä¸­æ—¶ï¼Œåˆè¿›å…¥RunningçŠ¶æ€ã€‚ Teminatedç»“æŸçŠ¶æ€â€”â€”é¡ºåˆ©æ‰§è¡Œï¼Œä»»åŠ¡è¿›å…¥Teminatedç»“æŸçŠ¶æ€åï¼Œä¸èƒ½é‡æ–°start()ã€‚ Bolckedé˜»å¡ â€”â€”åœ¨æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶æ²¡æœ‰è·å–é”èµ„æºï¼Œç­‰è·å–é”äº†è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ Waitingç­‰å¾…â€”â€”åœ¨è¿è¡ŒçŠ¶æ€æ—¶è°ƒç”¨o.wait()ã€t.join()ã€LockSupport.park()è¿›å…¥WaitingçŠ¶æ€ï¼Œè°ƒç”¨o.notify()ã€o.notifyAll()ã€LockSupport.unpack()åˆå›åˆ°RunningçŠ¶æ€ã€‚ TimedWaitingç­‰å¾…â€”â€”åœ¨è¿è¡ŒçŠ¶æ€æ—¶è°ƒç”¨o.wait(n)ã€t.join(n)ã€Thread.sleep(n)è¿›å…¥TimedWaitingçŠ¶æ€ï¼Œä¸Waitingç›¸ä¼¼ï¼Œåªæ˜¯æŒ‰ç…§æ—¶é—´ç­‰å¾…ï¼Œå¦‚æœæ—¶é—´åˆ°äº†ï¼Œæˆ–è€…çº¿ç¨‹ç»“æŸåˆ™ç»§ç»­æ‰§è¡Œã€‚ å‚è€ƒï¼šLifecycle and States of a Thread in Java 123456789101112131415161718192021222324252627282930313233343536373839404142public class T04_ThredState &#123; private static class MyThread extends Thread &#123; @Override public void run() &#123; System.out.println(this.getState()); for (int i = 0; i &lt; 10; i++) &#123; try &#123; Thread.sleep(500); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(i); &#125; &#125; &#125; public static void main(String[] args) &#123; Thread t = new MyThread(); System.out.println(t.getState()); t.start(); // å°±ç»ªçŠ¶æ€å’Œè¿è¡ŒçŠ¶æ€ç»Ÿç§°ä¸ºRunnableçŠ¶æ€ System.out.println(t.getState()); try &#123; t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(t.getState()); // çº¿ç¨‹æ‰§è¡Œå®Œä¹‹åï¼Œä¸èƒ½é‡æ–°startï¼ŒæŠ¥IllegalThreadStateExceptionå¼‚å¸¸ï¼Œstartæ–¹æ³•ä¸­æœ‰çŠ¶æ€æ ¡éªŒï¼Œå¿…é¡»ä¸ºæ–°å»ºçŠ¶æ€ï¼Œè§æºç ï¼ // t.start(); &#125;&#125;]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>thread base</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£è®¡ç®—æœºï¼šå¹¶å‘ç¼–ç¨‹]]></title>
    <url>%2F2020%2F01%2F06%2Fcsapp%2Fconcurrent-programmings%2F</url>
    <content type="text"><![CDATA[å¹¶å‘ç¼–ç¨‹ç®€ä»‹ å¹¶å‘ å¦‚æœé€»è¾‘æ§åˆ¶æµï¼Œåœ¨æ—¶é—´ä¸Šé‡å ï¼Œé‚£ä¹ˆå®ƒä»¬å°±æ˜¯å¹¶å‘çš„ åº”ç”¨çº§å¹¶å‘çš„ä½œç”¨ è®¿é—®æ…¢é€ŸI/Oè®¾å¤‡ ä¸äººäº¤äº’ é€šè¿‡æ¨è¿Ÿå·¥ä½œä»¥é™ä½å»¶è¿Ÿ æœåŠ¡å¤šä¸ªç½‘ç»œæœåŠ¡ åœ¨å¤šæ ¸æœºå™¨ä¸Šè¿›è¡Œå¹¶è¡Œè®¡ç®— ä¸‰ç§æ„é€ å¹¶å‘ç¨‹åºçš„æ–¹æ³• è¿›ç¨‹ With this approach, each logical control ï¬‚ow is a process that is scheduled and maintained by the kernel. Since processes have separate virtual address spaces, ï¬‚ows that want to communicate with each other must use some kind of explicit interprocess communication (IPC) mechanism. I/Oå¤šè·¯å¤ç”¨ This is a form of concurrent programming where applications explicitly schedule their own logical ï¬‚ows in the context of a single process. Logical ï¬‚ows are modeled as state machines that the main program explicitly transitions from state to state as a result of data arriving on ï¬le descriptors. Since the program is a single process, all ï¬‚ows share the same address space. çº¿ç¨‹ Threads are logical ï¬‚ows that run in the context of a single process and are scheduled by the kernel. You can think of threads as a hybrid of the other two approaches, scheduled by the kernel like process ï¬‚ows and sharing the same virtual address space like I/O multiplexing ï¬‚ows. åŸºäºè¿›ç¨‹çš„å¹¶å‘ç¼–ç¨‹ base knowldge çº¿ç¨‹æ˜¯æœ€å°æ‰§è¡Œçš„å•ä½ï¼Œè¿›ç¨‹æ˜¯æœ€å°èµ„æºåˆ†é…çš„å•ä½ æ¦‚å¿µ ä½¿ç”¨fork()ã€exec()ã€waitpid()ç­‰å‡½æ•°ï¼Œå¯¹è¿›ç¨‹è¿›è¡Œæ§åˆ¶ ä¸€ä¸ªæ„é€ å¹¶å‘æœåŠ¡å™¨çš„è‡ªç„¶æ–¹æ³•æ˜¯ï¼Œåœ¨çˆ¶è¿›ç¨‹ä¸­æ¥å—å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹æ¥ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡ è¿‡ç¨‹ ç¬¬ä¸€æ­¥ï¼šæœåŠ¡å™¨æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ ç¬¬äºŒæ­¥ï¼šæœåŠ¡å™¨æ´¾ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ä¸ºè¿™ä¸ªå®¢æˆ·ç«¯æœåŠ¡ ç¬¬ä¸‰æ­¥ï¼šæœåŠ¡å™¨æ¥å—å¦ä¸€ä¸ªè¿æ¥è¯·æ±‚ ä¼˜åŠ£ è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œä¸ä¼šè¦†ç›–å¦ä¸€è¿›ç¨‹çš„è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œé¿å…è®¸å¤šä»¤äººè¿·æƒ‘çš„é”™è¯¯ã€‚ ç‹¬ç«‹çš„åœ°å€ç©ºé—´ä½¿å¾—è¿›ç¨‹å…±äº«çŠ¶æ€ä¿¡æ¯å˜å¾—æ›´åŠ çš„å›°éš¾ï¼Œä¸ºäº†å…±äº«ä¿¡æ¯ï¼Œå¿…é¡»ä½¿ç”¨æ˜¾ç¤ºçš„IPC(è¿›ç¨‹é—´é€šä¿¡)æœºåˆ¶ã€‚ å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œå› ä¸ºè¿›ç¨‹æ§åˆ¶å’ŒIPCçš„å¼€é”€å¾ˆé«˜ã€‚ åŸºäºI/Oå¤šè·¯å¤ç”¨çš„å¹¶å‘ç¼–ç¨‹ æè¿° åˆ›å»ºè‡ªå·±çš„é€»è¾‘æµï¼Œå¹¶åˆ©ç”¨I/Oå¤šè·¯å¤ç”¨æ¥æ˜¾ç¤ºåœ°è°ƒåº¦æµï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œæ‰€æœ‰çš„æµå…±äº«æ•´ä¸ªåœ°å€ç©ºé—´ã€‚ ä½¿ç”¨selectå‡½æ•°ï¼Œè¦æ±‚å†…æ ¸æŒ‚èµ·è¿›ç¨‹ï¼Œåªæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªI/Oäº‹ä»¶å‘ç”Ÿåï¼Œæ‰å°†æ§åˆ¶è¿”å›ç»™åº”ç”¨ç¨‹åºã€‚ åŸºäºçº¿ç¨‹çš„å¹¶å‘ç¼–ç¨‹ çº¿ç¨‹ å°±æ˜¯è¿è¡Œåœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„é€»è¾‘æµ ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ çº¿ç¨‹ç”±å†…æ ¸è°ƒåº¦ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°çº¿ç¨‹IDã€æ ˆã€æ ˆæŒ‡é’ˆã€ç¨‹åºè®¡æ•°å™¨ã€é€šç”¨ç›®çš„å¯„å­˜å™¨å’Œæ¡ä»¶ç  æ‰€æœ‰è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œçš„çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„æ•´ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ çº¿ç¨‹æ‰§è¡Œæ¨¡å‹ ä¸»çº¿ç¨‹ã€å¯¹ç­‰çº¿ç¨‹ã€å¯¹ç­‰æ± (çº¿ç¨‹æ± ) ä¸€ä¸ªçº¿ç¨‹çš„ä¸Šä¸‹æ–‡æ¯”è¿›ç¨‹çš„ä¸Šä¸‹æ–‡å°å¾—å¤šï¼Œä¹Ÿæ¯”è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¿«å¾—å¤š å’Œä¸€ä¸ªè¿›ç¨‹ç›¸å…³çš„çº¿ç¨‹ç»„æˆä¸€ä¸ªå¯¹ç­‰æ± ï¼Œç‹¬ç«‹äºå…¶ä»–çº¿ç¨‹åˆ›å»ºçš„çº¿ç¨‹ ä¸»çº¿ç¨‹å’Œå…¶ä»–çº¿ç¨‹çš„åŒºåˆ«ä»…ä»…åœ¨äºå®ƒæ€»æ˜¯è¿›ç¨‹ä¸­ç¬¬ä¸€ä¸ªè¿è¡Œçš„çº¿ç¨‹ ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ€æ­»å®ƒçš„ä»»ä½•å¯¹ç­‰çº¿ç¨‹ï¼Œæˆ–è€…ç­‰å¾…å®ƒçš„ä»»ä½•å¯¹ç­‰çº¿ç¨‹ç»ˆæ­¢ æ¯ä¸ªå¯¹ç­‰çº¿ç¨‹è¯»å†™ç›¸åŒçš„å…±äº«æ•°æ® Posixçº¿ç¨‹ åˆ›å»ºçº¿ç¨‹ ç»ˆæ­¢çº¿ç¨‹ å›æ”¶å·²ç»ˆæ­¢çš„çº¿ç¨‹ åˆ†ç¦»çº¿ç¨‹ åˆå§‹åŒ–çº¿ç¨‹ å…±äº«å˜é‡ä¿¡å·é‡å¹¶è¡Œæ€§ç«äº‰ä¸æ­»é”]]></content>
      <categories>
        <category>csapp</category>
      </categories>
      <tags>
        <tag>csapp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£è®¡ç®—æœºï¼šWebæœåŠ¡å™¨]]></title>
    <url>%2F2019%2F12%2F08%2Fcsapp%2Fnetwork-programming-two%2F</url>
    <content type="text"><![CDATA[WebæœåŠ¡å™¨ WebåŸºç¡€ HTTPåè®®â€”â€”è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHypertext Transfer Protocolï¼‰ å®šä¹‰ Webå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’ç”¨çš„ä¸€ä¸ªåŸºäºæ–‡æœ¬çš„åº”ç”¨çº§åè®®ã€‚ ä¸€ä¸ªå®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ªåˆ°æœåŠ¡å™¨çš„å› ç‰¹ç½‘è¿æ¥ï¼Œå¹¶ä¸”è¯·æ±‚æŸäº›å†…å®¹ã€‚æœåŠ¡å™¨å“åº”æ‰€è¯·æ±‚çš„å†…å®¹ï¼Œç„¶åå…³é—­è¿æ¥ã€‚æµè§ˆå™¨è¯»å–è¿™äº›å†…å®¹ï¼Œå¹¶æŠŠå®ƒæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ HTMLè¯­è¨€â€”â€”è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼ˆHypertext Markuo Languageï¼‰ å®šä¹‰ åŒºåˆ«äºå¸¸è§„çš„æ–‡ä»¶æ£€ç´¢æœåŠ¡ï¼Œä¸€ä¸ªHTMLç¨‹åºåŒ…å«æŒ‡ä»¤ï¼Œå®ƒä»¬å‘Šè¯‰æµè§ˆå™¨å¦‚ä½•æ˜¾ç¤ºè¿™é¡µä¸­çš„å„ç§æ–‡æœ¬å’Œå›¾å½¢å¯¹è±¡ã€‚ Webå†…å®¹ å®šä¹‰ å†…å®¹æ˜¯ä¸ä¸€ä¸ªMIMEï¼ˆMultipurpose Internet Mail Extensionï¼Œå¤šç”¨é€”çš„ç½‘é™…é‚®ä»¶æ‰©å……åè®®ï¼‰ç±»å‹ç›¸å…³å­—èŠ‚åºåˆ— å¸¸ç”¨çš„MIMEç±»å‹ text/html text/plain application/json image/gif image/jpeg ä¸¤ç§æ–¹å¼æä¾›å†…å®¹ é™æ€å†…å®¹ å–å‡ºä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œå¹¶å°†å®ƒçš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç£ç›˜æ–‡ä»¶ä¸ºé™æ€å†…å®¹ï¼Œè¿‡ç¨‹å«åšæœåŠ¡é™æ€å†…å®¹ã€‚ åŠ¨æ€å†…å®¹ è¿è¡Œä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å°†å®ƒçš„è¾“å‡ºè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ‰§è¡Œæ–‡ä»¶è¾“å‡ºçš„æ˜¯åŠ¨æ€å†…å®¹ï¼Œè¿‡ç¨‹ç§°ä¸ºæœåŠ¡åŠ¨æ€å†…å®¹ã€‚ URLâ€”â€”é€šç”¨èµ„æºå®šä½ç¬¦ï¼ˆUnivwesal Resource Locatorï¼‰ ä¾‹å¦‚ http://www.google.com:80/index.html http://bluefish.ics.cs.cmu.edu:8000/cgi-bin/adder?15000&amp;213 HTTPäº‹åŠ¡ é™æ€å†…å®¹çš„äº‹åŠ¡å›¾ HTTPè¯·æ±‚ ç»„æˆï¼šä¸€ä¸ªè¯·æ±‚è¡Œï¼ˆç¬¬5è¡Œï¼‰+é›¶ä¸ªæˆ–å¤šä¸ªè¯·æ±‚æŠ¥å¤´ï¼ˆç¬¬6è¡Œï¼‰+ç©ºçš„æ–‡æœ¬è¡Œï¼ˆç¬¬7è¡Œæ ‡è¯†ç»ˆæ­¢æŠ¥å¤´ï¼‰ è¯·æ±‚è¡Œçš„æ ¼å¼ï¼šmethod URI version HTTPè¯·æ±‚æ”¯æŒçš„æ–¹æ³•ï¼šGETã€POSTã€OPTIONSã€HEADã€PUTã€DELETEå’ŒTRACE URIï¼šç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifierï¼‰æ˜¯ç›¸åº”URLçš„åç¼€ï¼ŒåŒ…æ‹¬æ–‡ä»¶åå’Œå¯é€‰çš„å‚æ•° HTTPå“åº” ç»„æˆï¼šä¸€ä¸ªå“åº”è¡Œï¼ˆç¬¬8è¡Œï¼‰+é›¶ä¸ªæˆ–å¤šä¸ªå“åº”æŠ¥å¤´ï¼ˆç¬¬9ï½13è¡Œï¼‰+ç©ºè¡Œï¼ˆç¬¬14è¡Œæ ‡è¯†ç»ˆæ­¢æŠ¥å¤´ï¼‰+å“åº”ä¸»ä½“ï¼ˆç¬¬15ï½17è¡Œï¼‰ HTTPçŠ¶æ€ç å›¾ æœåŠ¡åŠ¨æ€å†…å®¹ å®¢æˆ·ç«¯å¦‚ä½•å°†ç¨‹åºå‚æ•°ç»™æœåŠ¡å™¨ï¼Ÿ GETè¯·æ±‚é€šè¿‡URIä¸­ä¼ é€’ï¼Œç”¨ï¼Ÿåˆ†éš”æ–‡ä»¶åå’Œå‚æ•°ï¼Œç”¨&amp;åˆ†éš”å‚æ•° POStè¯·æ±‚çš„å‚æ•°æ”¾åœ¨ä¸»ä½“ä¸­ æœåŠ¡å™¨å¦‚ä½•å°†å‚æ•°ä¼ é€’ç»™å­è¿›ç¨‹ï¼Ÿ it calls fork to create a child process and calls execve to run the /cgi-bin/adder program in the context of the child. Programs like the adder program are often referred to as CGI programs because they obey the rules of the CGI standard. Before the call to execve, the child process sets the CGI environment variable QUERY_STRING to 15000&amp;213, which the adder program can reference at run time using the Linux getenv function. æœåŠ¡å™¨å¦‚ä½•å°†å…¶ä»–ä¿¡æ¯ä¼ é€’ç»™å­è¿›ç¨‹ï¼Ÿ CGI deï¬nes a number of other environment variables that a CGI program can expect to be set when it runs. Figure 11.26 shows a subset. å­è¿›ç¨‹å°†å®ƒçš„è¾“å‡ºå‘é€åˆ°å“ªé‡Œï¼Ÿ A CGI program sends its dynamic content to the standard output. Before the child process loads and runs the CGI program, it uses the Linux dup2 function to redirect standard output to the connected descriptor that is associated with the client. Thus, anything that the CGI program writes to standard output goes directly to the client. Notice that since the parent does not know the type or size of the content that the child generates, the child is responsible for generating the Content-type and Content-length response headers, as well as the empty line that terminates the headers. CGIç¨‹åºç¤ºä¾‹ å®¢æˆ·ç«¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465/** * @author chenjianrong-lhq 2019å¹´12æœˆ08æ—¥ 21:22:16 * @Description: ç½‘ç»œç¼–ç¨‹å®¢æˆ·ç«¯ * @ClassName: ClientApplication */public class ClientApplication &#123; public static String IP = &quot;www.baidu.com&quot;; public static Integer PORT = 80; public static void main(String[] args) &#123; String param = &quot;æä¾›åŠ¨æ€å†…å®¹ï¼Œéœ€è¦æ´¾ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶åœ¨å­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œä¸€ä¸ªCGIç¨‹åºï¼Œæ¥æä¾›å„ç§ç±»å‹çš„åŠ¨æ€å†…å®¹ã€‚å­è¿›ç¨‹é€šè¿‡è¯·æ±‚URIè·å–çš„CGIå‚æ•°åˆå§‹åŒ–QUERYâ€”â€”STRINGç¯å¢ƒå˜é‡ã€‚ç„¶åå­è¿›ç¨‹é‡å®šå‘å®ƒçš„æ ‡å‡†è¾“å‡ºåˆ°å·²è¿æ¥æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶ååŠ è½½å¹¶è¿è¡ŒCGIç¨‹åºã€‚CGIè¿è¡Œçš„ç»“æœä¼šç›´æ¥æ˜¾ç¤ºåœ¨æœåŠ¡å™¨ç«¯ã€‚&quot;; /**step1 å®šä¹‰ Socket å¯¹è±¡ã€OutputStream å¯¹è±¡å’Œä¸€ä¸ª InputStream å¯¹è±¡å¹¶å®Œæˆåˆå§‹åŒ–**/ Socket socket = null; OutputStream os = null; InputStream is = null; try &#123; socket = new Socket(IP, PORT); /**step2.å»ºç«‹ä¸æœåŠ¡å™¨ç«¯çš„è¿æ¥å¹¶å°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ç«¯**/ socket.setSoTimeout(60 * 1000); os = socket.getOutputStream(); os.write(param.getBytes(&quot;utf-8&quot;)); Thread.sleep(1000);// ByteArrayOutputStream bos = new ByteArrayOutputStream(); /**step3.ä»è¾“å…¥æµä¸­è¯»å‡ºæœåŠ¡å™¨çš„åé¦ˆä¿¡æ¯å¹¶è¾“å‡ºåˆ°æ§åˆ¶å°**/ byte[] buffer = new byte[1024]; is = socket.getInputStream(); int count = 0;// do &#123;// count = is.read(buffer);// bos.write(buffer, 0, count);// &#125; while (is.available() != 0); count = is.read(buffer); System.out.println(&quot;æœåŠ¡ç«¯åé¦ˆçš„æ•°æ®æ˜¯ï¼š&quot; + new String(buffer, 0, count)); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; /**step4 å…³é—­æµåŠ Socket å¯¹è±¡**/ try &#123; if (os != null) &#123; os.close(); &#125; if (is != null) &#123; is.close(); &#125; if (socket != null) &#123; socket.close(); &#125; &#125; catch (Exception ex) &#123; ex.printStackTrace(); &#125; &#125; &#125;&#125; æœåŠ¡ç«¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * @author chenjianrong-lhq 2019å¹´12æœˆ08æ—¥ 21:56:09 * @Description: ç½‘ç»œç¼–ç¨‹æœåŠ¡ç«¯ * @ClassName: ServerApplication */public class ServerApplication &#123; public static String IP = &quot;www.baidu.com&quot;; public static Integer PORT = 80; public static void main(String[] args) &#123; /**step5 åˆ›å»ºServerSocketã€Socketã€OutputStreamã€InputStreamä»¥åŠç«¯å£å·å¹¶åˆå§‹åŒ–**/ ServerSocket serverSocket = null; Socket socket = null; OutputStream os = null; InputStream is = null; try &#123; /**step6 å¼€å¯æœåŠ¡å™¨å¹¶æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®**/ serverSocket = new ServerSocket(PORT); System.out.println(&quot;æœåŠ¡å™¨å¼€å¯ï¼Œç­‰å¾…è¿æ¥...&quot;); socket = serverSocket.accept(); is = socket.getInputStream(); byte[] buffer = new byte[1024]; int len = is.read(buffer); System.out.println(&quot;å®¢æˆ·ç«¯å‘é€çš„å†…å®¹ä¸ºï¼š&quot; + new String(buffer, 0, len)); /**step7 ä½¿ç”¨è¾“å‡ºæµå¯¹è±¡å°†ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯**/ os = socket.getOutputStream(); os.write(&quot;æˆ‘æ˜¯æœåŠ¡å™¨ç«¯&quot;.getBytes()); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; /**step8 å…³é—­æµå¯¹è±¡ã€ServerSocketå¯¹è±¡ä»¥åŠSocketå¯¹è±¡**/ try &#123; os.close(); is.close(); serverSocket.close(); socket.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; TINY WebæœåŠ¡å™¨å‚è€ƒåšå®¢ï¼šç½‘ç»œç¼–ç¨‹]]></content>
      <categories>
        <category>csapp</category>
      </categories>
      <tags>
        <tag>csapp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£è®¡ç®—æœºï¼šç½‘ç»œç¼–ç¨‹ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2019%2F12%2F01%2Fcsapp%2Fnetwork-programming%2F</url>
    <content type="text"><![CDATA[å®¢æˆ·ç«¯â€”â€”æœåŠ¡ç«¯ç¼–ç¨‹æ¨¡å‹ ç®€ä»‹ å®šä¹‰ ä¸€ä¸ªç½‘ç»œåº”ç”¨æ˜¯ç”±ä¸€ä¸ªæœåŠ¡å™¨è¿›ç¨‹å’Œä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¢æˆ·ç«¯è¿›ç¨‹ç»„æˆï¼ŒæœåŠ¡ç«¯ç®¡ç†æŸç§èµ„æºï¼Œå¹¶ä¸”é€šè¿‡æ“ä½œè¿™ç§èµ„æºæ¥ä¸ºå®ƒçš„å®¢æˆ·ç«¯æä¾›æŸç§æœåŠ¡ã€‚ ä¸¾ä¾‹ a Web server manages a set of disk ï¬les that it retrieves and executes on behalf of clients. An FTP server manages a set of disk ï¬les that it stores and retrieves for clients. An email server manages a spool ï¬le that it reads and updates for clients. åŸºæœ¬æ“ä½œ å®¢æˆ·ç«¯â€”â€”æœåŠ¡å™¨æ¨¡å‹ä¸­åŸºæœ¬æ“ä½œæ˜¯äº‹åŠ¡ã€‚ å®¢æˆ·ç«¯â€”â€”æœåŠ¡ç«¯äº‹åŠ¡ äº‹åŠ¡æ¨¡å‹å›¾ æ­¥éª¤ When a client needs service, it initiates a transaction by sending a request to the server. For example, when a Web browser needs a ï¬le, it sends a request to a Web server. The server receives the request, interprets it, and manipulates its resources in the appropriate way. For example, when a Web server receives a request from a browser, it reads a disk ï¬le. The server sends a response to the client and then waits for the next request.For example, a Web server sends the ï¬le back to a client. The client receives the response and manipulates it. For example, after a Web browser receives a page from the server, it displays it on the screen. æ³¨æ„ è¿›ç¨‹ç‚¹å¯¹ç‚¹ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ˜¯è¿›ç¨‹ï¼Œè€Œä¸æ˜¯å¸¸å¸¸æåˆ°çš„æœºå™¨æˆ–è€…ä¸»æœº äº‹åŠ¡å¯ä»¥è·¨ä¸»æœº ä¸€å°ä¸»æœºå¯ä»¥åŒæ—¶è¿è¡Œåœ¨ä¸åŒçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œè€Œä¸”ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„äº‹åŠ¡å¯ä»¥åœ¨åŒä¸€å°æˆ–æ˜¯ä¸åŒçš„ä¸»æœºä¸Šè¿è¡Œã€‚ ç½‘ç»œ I/Oè®¾å¤‡â€”â€”ç½‘ç»œ ç®€ä»‹ å¯¹äºä¸€ä¸ªä¸»æœºè€Œè¨€ï¼Œç½‘ç»œåªæ˜¯åˆä¸€ç§I/Oè®¾å¤‡ï¼Œä½œä¸ºæ•°æ®æºå’Œæ•°æ®æ¥æ”¶æ–¹ã€‚ ç½‘ç»œä¸»æœºçš„ç¡¬ä»¶å›¾ ä»¥å¤ªç½‘æ®µ ç»„æˆ ç”±ç”µç¼†ï¼ˆé€šå¸¸æ˜¯åŒç»çº¿ï¼‰å’Œä¸€ä¸ªå«åšé›†çº¿å™¨çš„å°ç›’å­ç»„æˆ æ¦‚å¿µå›¾ æ¡¥æ¥ä»¥å¤ªç½‘ ç»„æˆ ä½¿ç”¨ç”µç¼†å’Œå«åšç½‘æ¡¥ï¼ˆbridgeï¼‰çš„å°ç›’å­ï¼Œå¤šä¸ªä»¥å¤ªç½‘æ®µå¯ä»¥è¿æ¥æˆè¾ƒå¤§çš„å±€åŸŸç½‘ï¼Œç§°ä¸ºæ¡¥æ¥ä»¥å¤ªç½‘ã€‚ æ¦‚å¿µå›¾ è·¯ç”±å™¨ã€äº’è”ç½‘â€”â€”å±€åŸŸç½‘ä¸å¹¿åŸŸç½‘äº’è” å±€åŸŸç½‘ é›†çº¿å™¨+ç½‘æ¡¥+ç”µç¼† å±€åŸŸç½‘æ¦‚å¿µå›¾ äº’è”ç½‘ç»œ åœ¨å±‚æ¬¡çš„æ›´é«˜çº§åˆ«ä¸­ï¼Œå¤šä¸ªä¸å…¼å®¹çš„å±€åŸŸç½‘å¯ä»¥é€šè¿‡å«åšè·¯ç”±å™¨çš„ç‰¹æ®Šè®¡ç®—æœºè¿æ¥èµ·æ¥ï¼Œç»„æˆä¸€ä¸ªäº’è”ç½‘ç»œï¼ˆinternetï¼‰ äº’è”ç½‘æ¦‚å¿µå›¾ ä¸åŒä¸»æœºé—´ç½‘ç»œé€šä¿¡ é€šä¿¡å›¾ æ­¥éª¤ The client on host A invokes a system call that copies the data from the clientâ€™s virtual address space into a kernel buffer. The protocol software on host A creates a LAN1 frame by appending an internet header and a LAN1 frame header to the data. The internet header is addressed to internet host B. The LAN1 frame header is addressed to the router. It then passes the frame to the adapter. Notice that the payload of the LAN1 frame is an internet packet, whose payload is the actual user data. This kind of encapsulation is one of the fundamental insights of internetworking. The LAN1 adapter copies the frame to the network. When the frame reaches the router, the routerâ€™s LAN1 adapter reads it from the wire and passes it to the protocol software. The router fetches the destination internet address from the internet packet header and uses this as an index into a routing table to determine where to forward the packet, which in this case is LAN2. The router then strips off the old LAN1 frame header, prepends a new LAN2 frame header addressed to host B, and passes the resulting frame to the adapter. The routerâ€™s LAN2 adapter copies the frame to the network. When the frame reaches host B, its adapter reads the frame from the wire and passes it to the protocol software. Finally, the protocol software on host B strips off the packet header and frame header. The protocol software will eventually copy the resulting data into the serverâ€™s virtual address space when the server invokes a system call that reads the data. å…¨çƒIPå› ç‰¹ç½‘ IPåœ°å€ å› ç‰¹ç½‘å®¢æˆ·ç«¯â€”â€”æœåŠ¡ç«¯åº”ç”¨ç¨‹åºçš„åŸºæœ¬ç¡¬ä»¶å’Œè½¯ä»¶ç»„ç»‡ å› ç‰¹ç½‘ï¼ˆç‰¹æ€§ï¼‰â€”â€”ä¸€ä¸ªä¸–ç•ŒèŒƒå›´çš„ä¸»æœºé›†åˆ ä¸»æœºé›†åˆæ˜ å°„ä¸ºä¸€ç»„32ä½çš„IPåœ°å€ è¿™ç»„IPåœ°å€è¢«æ˜ å°„ä¸ºä¸€ç»„ç§°ä¸ºå› ç‰¹ç½‘åŸŸåï¼ˆInternet domain nameï¼‰çš„æ ‡è¯†ç¬¦ å› ç‰¹ç½‘ä¸»æœºä¸Šçš„è¿›ç¨‹èƒ½å¤Ÿé€šè¿‡è¿æ¥ï¼ˆconnectionï¼‰å’Œä»»ä½•å…¶ä»–å› ç‰¹ç½‘ä¸»æœºä¸Šçš„è¿›ç¨‹é€šä¿¡ IPåœ°å€ ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´æ•° IPåœ°å€é€šå¸¸ç”¨ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºæ³•æ¥è¡¨ç¤º ä¾‹å¦‚ï¼š128.2.194.242 å°±æ˜¯åœ°å€0x8002c2f2çš„ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤º inet_aton å‡½æ•°å°†ä¸€ä¸ªç‚¹åˆ†åè¿›åˆ¶ï¼ˆcpï¼‰è½¬åŒ–ä¸ºä¸€ä¸ªç½‘ç»œå­—èŠ‚é¡ºåºçš„IPåœ°å€ï¼ˆinpï¼‰ inet_ntoa å‡½æ•°å°†ä¸€ä¸ªä¸ªç½‘ç»œå­—èŠ‚é¡ºåºçš„IPåœ°å€è½¬åŒ–ä¸ºå®ƒæ‰€å¯¹åº”çš„ç‚¹åˆ†åè¿›åˆ¶ä¸² å› ç‰¹ç½‘åŸŸå äº§ç”ŸåŸå›  IPåœ°å€ï¼ˆå¤§æ•´æ•°ï¼‰å¾ˆéš¾è®°å¿†ï¼Œå¦å®šä¹‰äº†ä¸€ç»„æ›´åŠ äººæ€§åŒ–çš„åŸŸåï¼Œä»¥åŠä¸€ç§å°†åŸŸåæ˜ å°„åˆ°IPåœ°å€çš„æœºåˆ¶ã€‚ åŸŸåæ˜¯ä¸€ä¸²ç”¨å¥ç‚¹åˆ†éš”çš„å•è¯ï¼ˆå­—æ¯ã€æ•°å­—å’Œç ´æŠ˜å·ï¼‰ï¼Œä¾‹å¦‚ kittyhawk.cmcl.cs.cmu.edu åŸŸåçš„å±‚çº§ å¸¸è§çš„ä¸€çº§åŸŸåæœ‰comã€eduã€govã€orgå’Œnet ä¸€æ—¦ä¸€ä¸ªç»„ç»‡å¾—åˆ°äº†ä¸€ä¸ªäºŒçº§åŸŸåï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥åœ¨è¿™ä¸ªå­åŸŸä¸­åˆ›å»ºä»»ä½•æ–°çš„åŸŸåäº† DNSåŸŸåç³»ç»Ÿ ç”±ä¸Šç™¾ä¸‡çš„ä¸»æœºæ¡ç›®ç»“æ„ç»„æˆï¼Œå…¶ä¸­æ¯æ¡å®šä¹‰äº†ä¸€ç»„åŸŸåå’Œä¸€ç»„IPåœ°å€ä¹‹é—´çš„æ˜ å°„ å› ç‰¹ç½‘è¿æ¥ å¥—æ¥å­—åœ°å€ ä¸€ä¸ªå¥—æ¥å­—æ˜¯è¿æ¥çš„ä¸€ä¸ªç«¯ç‚¹ï¼Œæ¯ä¸ªå¥—æ¥å­—éƒ½æœ‰ç›¸åº”çš„å¥—æ¥å­—åœ°å€ï¼Œæ˜¯ç”±ä¸€ä¸ªå› ç‰¹ç½‘åœ°å€å’Œä¸€ä¸ª16ä½çš„æ•´æ•°ç«¯å£ç»„æˆçš„ï¼Œç”¨â€åœ°å€ï¼šç«¯å£â€æ¥è¡¨ç¤º å½“å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¿æ¥è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯å¥—æ¥å­—åœ°å€ä¸­çš„ç«¯å£æ˜¯ç”±å†…æ ¸è‡ªåŠ¨åˆ†é…çš„ï¼Œç§°ä¸ºä¸´æ—¶ç«¯å£ã€‚ç„¶è€Œï¼ŒæœåŠ¡å™¨å¥—æ¥å­—åœ°å€ä¸­çš„ç«¯å£é€šå¸¸æ˜¯æŸä¸ªçŸ¥åçš„ç«¯å£ï¼Œæ˜¯å’Œè¿™ä¸ªæœåŠ¡å¯¹åº”çš„ã€‚ è¿æ¥ ä¸€ä¸ªè¿æ¥æ˜¯å®ƒä¸¤ç«¯çš„å¥—æ¥å­—åœ°å€æ˜¯å”¯ä¸€ç¡®å®šçš„ï¼Œè¿™å¯¹å¥—æ¥å­—åœ°å€å«åšå¥—æ¥å­—å¯¹ï¼Œç”±ä¸‹åˆ—å…ƒç»„æ¥è¡¨ç¤ºï¼ˆcliaddr:cliport,servaddr:servportï¼‰ å…¶ä¸­cliaddræ˜¯å®¢æˆ·ç«¯çš„IPåœ°å€ï¼Œcliportæ˜¯å®¢æˆ·ç«¯çš„ç«¯å£ï¼Œservaddræ˜¯æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè€Œservportæ˜¯æœåŠ¡å™¨çš„ç«¯å£ã€‚ ä¾‹å¦‚ Webå®¢æˆ·ç«¯çš„å¥—æ¥å­—åœ°å€æ˜¯128.2.194.242:51213ï¼Œå…¶ä¸­ç«¯å£å·51213æ˜¯å†…æ ¸åˆ†é…çš„ä¸´æ—¶ç«¯å£å· WebæœåŠ¡ç«¯çš„å¥—æ¥å­—åœ°å€æ˜¯208.216.181.15:80ï¼Œå…¶ä¸­ç«¯å£æ˜¯å’ŒWebæœåŠ¡ç›¸å…³è”çš„çŸ¥åç«¯å£å·]]></content>
      <categories>
        <category>csapp</category>
      </categories>
      <tags>
        <tag>csapp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£è®¡ç®—æœºï¼šåœ°å€ç¿»è¯‘]]></title>
    <url>%2F2019%2F11%2F25%2Fcsapp%2Faddress-translation%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹ å®šä¹‰ï¼š address translation is a mapping between the elements of an N- element virtual address space (VAS) and an M-element physical address space (PAS) MAP: VAS â†’ PAS âˆª âˆ…MAP(A) =Aâ€™ (if data at virtual addr. A are present at physical addr. A_ in PAS)MAP(A) = âˆ… (if data at virtual addr. A are not present in physical memory) ä½¿ç”¨é¡µè¡¨çš„åœ°å€ç¿»è¯‘å›¾ Figure 9.12 shows how the MMU uses the page table to perform this mapping. A control register in the CPU, the page table base register (PTBR) points to the current page table. The n-bit virtual address has two components: a p-bit virtual page offset (VPO) and an (n âˆ’ p)-bit virtual page number (VPN). The MMU uses the VPN to select the appropriate PTE. For example, VPN 0 selects PTE 0, VPN 1 selects PTE 1, and so on. The corresponding physical address is the concatenation of the physical page number (PPN) from the page table entry and the VPO from the virtual address. Notice that since the physical and virtual pages are both P bytes, the physical page offset (PPO) is identical to the VPO. é¡µé¢å‘½ä¸­ Figure 9.13(a) shows the steps that the CPU hardware performs when there is a page hit.(æ³¨ï¼šVAâ€”â€”è™šæ‹Ÿåœ°å€ï¼ŒPTEAâ€”â€”é¡µè¡¨æ¡ç›®åœ°å€ï¼ŒPTEâ€”â€”é¡µè¡¨æ¡ç›®ï¼ŒPAâ€”â€”ç‰©ç†åœ°å€)Step 1. The processor generates a virtual address and sends it to the MMU.Step 2. The MMU generates the PTE address and requests it from the cache/main memory.Step 3. The cache/main memory returns the PTE to the MMU.Step 4. The MMU constructs the physical address and sends it to the cache/main memory.Step 5. The cache/main memory returns the requested data word to the pro-cessor. é¡µé¢ä¸å‘½ä¸­ Unlike a page hit, which is handled entirely by hardware, handling a page fault requires cooperation between hardware and the operating system kernel (Figure 9.13(b)).Steps 1 to 3. The same as steps 1 to 3 in Figure 9.13(a).Step 4. The valid bit in the PTE is zero, so the MMU triggers an exception,which transfers control in the CPU to a page fault exception handler in the operating system kernel.Step 5. The fault handler identiï¬es a victim page in physical memory, and if that page has been modiï¬ed, pages it out to disk.Step 6. The fault handler pages in the new page and updates the PTE in memory.Step 7. The fault handler returns to the original process, causing the faulting instruction to be restarted. The CPU resends the offending virtual address to the MMU. Because the virtual page is now cached in physical memory, there is a hit, and after the MMU performs the steps in Figure 9.13(a), the main memory returns the requested word to the processor. åœ°å€ç¿»è¯‘çš„ä¼˜åŒ–æ–¹å¼ ç»“åˆé«˜é€Ÿç¼“å­˜å’Œè™šæ‹Ÿå­˜å‚¨å™¨åˆ©ç”¨TLBåŠ é€Ÿåœ°å€ç¿»è¯‘å¤šçº§é¡µè¡¨ç»¼åˆï¼šç«¯åˆ°ç«¯çš„åœ°å€ç¿»è¯‘]]></content>
      <categories>
        <category>csapp</category>
      </categories>
      <tags>
        <tag>csapp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£è®¡ç®—æœºï¼šç³»ç»Ÿçº§I/O]]></title>
    <url>%2F2019%2F11%2F25%2Fcsapp%2Fsystem-level-IO%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹ I/O(è¾“å…¥ä¸è¾“å‡º) å®šä¹‰:æ˜¯åœ¨ä¸»å­˜å’Œå¤–éƒ¨è®¾å¤‡ï¼ˆå¦‚ç£ç›˜é©±åŠ¨å™¨ã€ç»ˆç«¯å’Œç½‘ç»œï¼‰ä¹‹é—´æ‹·è´æ•°æ®çš„è¿‡ç¨‹ã€‚ å­¦ä¹ Unix I/Oçš„å¥½å¤„ äº†è§£Unix I/Oå°†å¸®åŠ©ä½ ç†è§£å…¶ä»–çš„ç³»ç»Ÿæ¦‚å¿µã€‚ æœ‰æ—¶ä½ é™¤äº†ä½¿ç”¨Unix I/Oä»¥å¤–ï¼Œä½ åˆ«æ— é€‰æ‹©ã€‚ Unix I/O Unixæ–‡ä»¶ï¼š å®šä¹‰ï¼šä¸€ä¸ªUnixæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªå„å­—èŠ‚çš„åºåˆ—ï¼šB0ï¼ŒB1ï¼ŒB2ï¼Œâ€¦ï¼ŒBk,â€¦ï¼ŒBm-1 æ–‡ä»¶ï¼š å®šä¹‰ï¼šæ‰€æœ‰çš„I/Oè®¾å¤‡ï¼Œå¦‚ç½‘ç»œï¼Œç£ç›˜å’Œç»ˆç«¯ï¼Œéƒ½è¢«æ¨¡å‹åŒ–ä¸ºæ–‡ä»¶ï¼Œè€Œæ‰€æœ‰çš„è¾“å…¥è¾“å‡ºéƒ½è¢«å½“ä½œå¯¹ç›¸åº”çš„æ–‡ä»¶è¯»å’Œå†™æ¥æ‰§è¡Œï¼Œè¿™ç§å°†è®¾å¤‡ä¼˜é›…åœ°æ˜ å°„æˆæ–‡ä»¶çš„æ–¹å¼ï¼Œå…è®¸Unixå†…æ ¸å¼•å‡ºä¸€ä¸ªç®€å•ã€ä½çº§çš„åº”ç”¨æ¥å£ï¼Œç§°ä¸ºUnix I/Oã€‚ ä¸€äº›åŸºç¡€çš„æ“ä½œï¼š æ‰“å¼€æ–‡ä»¶ æ”¹å˜æ–‡ä»¶çš„ä½ç½® è¯»å†™æ–‡ä»¶ å…³é—­æ–‡ä»¶ æ‰“å¼€å’Œå…³é—­æ–‡ä»¶è¯»å’Œå†™æ–‡ä»¶ç”¨RIOåŒ…å¥å£®çš„è¯»å†™è¯»å–æ–‡ä»¶å…ƒæ•°æ®å…±äº«æ–‡ä»¶]]></content>
      <categories>
        <category>csapp</category>
      </categories>
      <tags>
        <tag>csapp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£è®¡ç®—æœºï¼šè™šæ‹Ÿå­˜å‚¨å™¨]]></title>
    <url>%2F2019%2F11%2F14%2Fcsapp%2Fvirtual-memory%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹ å®šä¹‰ è™šæ‹Ÿå­˜å‚¨å™¨æ˜¯å¯¹I/Oè®¾å¤‡ä¸ä¸»å­˜çš„æŠ½è±¡ã€‚ è™šæ‹Ÿå­˜å‚¨å™¨æ˜¯ç¡¬ä»¶å¼‚å¸¸ã€ç¡¬ä»¶åœ°å€ç¿»è¯‘ã€ä¸»å­˜ã€ç£ç›˜æ–‡ä»¶å’Œå†…æ ¸è½¯ä»¶çš„å®Œç¾äº¤äº’ï¼Œå®ƒä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›äº†ä¸€ä¸ªå¤§çš„ï¼Œä¸€è‡´çš„å’Œç§æœ‰çš„åœ°å€ç©ºé—´ã€‚ è™šæ‹Ÿå­˜å‚¨å™¨çš„ç›®æ ‡ é«˜é€Ÿç¼“å­˜ å­˜å‚¨å™¨ç®¡ç†å·¥å…· å­˜å‚¨å™¨ä¿æŠ¤å·¥å…· ç†è§£è™šæ‹Ÿå­˜å‚¨å™¨çš„åŸå›  ä¸­å¿ƒçš„ å¼ºå¤§çš„ å±é™©çš„ è®²è§£æ€è·¯ å‰ä¸€éƒ¨åˆ†æè¿°è™šæ‹Ÿå­˜å‚¨å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ åä¸€éƒ¨åˆ†æè¿°åº”ç”¨ç¨‹åºå¦‚ä½•ä½¿ç”¨å’Œç®¡ç†è™šæ‹Ÿå­˜å‚¨å™¨ ç‰©ç†å’Œè™šæ‹Ÿå¯»å€ ä¸»å­˜å®šä¹‰ è®¡ç®—æœºç³»ç»Ÿè¢«ç»„ç»‡æˆä¸€ä¸ªç”±Mä¸ªè¿ç»­çš„å­—èŠ‚å¤§å°çš„å•å…ƒç»„æˆçš„æ•°ç»„ ç‰©ç†å¯»å€å›¾ è™šæ‹Ÿå¯»å€å›¾ åœ°å€ç¿»è¯‘ å°†ä¸€ä¸ªè™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€çš„ä»»åŠ¡å«åšåœ°å€ç¿»è¯‘ MMUï¼ˆå­˜å‚¨å™¨ç®¡ç†å•å…ƒï¼‰ å±äºCPUä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥ç¡¬ä»¶åˆ©ç”¨å­˜æ”¾åœ¨ä¸»å­˜ä¸­çš„æŸ¥è¯¢è¡¨æ¥åŠ¨æ€ç¿»è¯‘è™šæ‹Ÿåœ°å€ï¼Œè¯¥è¡¨çš„å†…å®¹æ˜¯ç”±æ“ä½œç³»ç»Ÿç®¡ç† åœ°å€ç©ºé—´ å®šä¹‰ åœ°å€ç©ºé—´æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°åœ°å€çš„æœ‰åºé›†åˆï¼š{0,1,2,â€¦},å¦‚æœåœ°å€ç©ºé—´ä¸­çš„æ•´æ•°æ˜¯è¿ç»­çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´å®ƒæ˜¯ä¸€ä¸ªçº¿æ€§åœ°å€ç©ºé—´ã€‚ è™šæ‹Ÿåœ°å€ç©ºé—´ åœ¨ä¸€ä¸ªå¸¦è™šæ‹Ÿå­˜å‚¨å™¨çš„åœ°å€ç©ºé—´ä¸­ï¼ŒCPUä»ä¸€ä¸ªæœ‰N=2nä¸ªåœ°å€ç©ºé—´ä¸­ç”Ÿæˆè™šæ‹Ÿåœ°å€ï¼Œè¿™ä¸ªåœ°å€ç©ºé—´ç§°ä¸ºè™šæ‹Ÿåœ°å€ç©ºé—´ï¼š{0,1,2,â€¦,N-1} ä¸€ä¸ªåœ°å€ç©ºé—´çš„å¤§å°æ˜¯ç”±è¡¨ç¤ºæœ€å¤§åœ°å€æ‰€éœ€è¦çš„ä½æ•°æ¥æè¿°çš„ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªåŒ…å«äº†N=2nä¸ªåœ°å€çš„è™šæ‹Ÿåœ°å€ç©ºé—´å°±å«åšä¸€ä¸ªnä½åœ°å€ç©ºé—´ã€‚ æ€è€ƒï¼š32ä½æˆ–è€…64ä½è™šæ‹Ÿåœ°å€ç©ºé—´çš„ç³»ç»Ÿï¼Œå…¶è™šæ‹Ÿåœ°å€æ•°åˆ†åˆ«æ˜¯å¤šå°‘ï¼Œæœ€å¤§å¯èƒ½çš„è™šæ‹Ÿåœ°å€æ˜¯å¤šå°‘ï¼Ÿ ç‰©ç†åœ°å€ç©ºé—´ å®ƒä¸ç³»ç»Ÿä¸­ç‰©ç†å­˜å‚¨çš„Mä¸ªå­—èŠ‚ç›¸å¯¹åº”ï¼š{0,1,2,â€¦,M-1} è™šæ‹Ÿå­˜å‚¨å™¨çš„æ€æƒ³ ä¸»å­˜ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªé€‰è‡ªè™šæ‹Ÿåœ°å€ç©ºé—´çš„è™šæ‹Ÿåœ°å€å’Œä¸€ä¸ªé€‰è‡ªç‰©ç†åœ°å€ç©ºé—´çš„ç‰©ç†åœ°å€ã€‚ å°ç»“ åœ°å€ç©ºé—´çš„æ¦‚å¿µå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒæ¸…æ¥šçš„åŒºåˆ†äº†æ•°æ®å¯¹è±¡ï¼ˆå­—èŠ‚ï¼‰å’Œå®ƒä»¬çš„å±æ€§ï¼ˆåœ°å€ï¼‰ ä½œä¸ºç¼“å­˜å·¥å…· è™šæ‹Ÿé¡µ å®šä¹‰ï¼šAs with any other cache in the memory hierarchy, the data on disk (the lower level) is partitioned into blocks that serve as the transfer units between the disk and the main memory (the upper level). VM systems handle this by partitioning the virtual memory into ï¬xed-size blocks called virtual pages (VPs). Each virtual page is P = 2p bytes in size. ç‰©ç†é¡µ å®šä¹‰ï¼šSimilarly, physical memory is partitioned into physical pages (PPs), also P bytes in size. (Physical pages are also referred to as page frames.) ç‰©ç†é¡µçš„çŠ¶æ€ æœªåˆ†é… Pages that have not yet been allocated (or created) by the VM system. Unallocated blocks do not have any data associated with them,and thus do not occupy any space on disk. å·²ç¼“å­˜ Allocated pages that are currently cached in physical memory. æœªç¼“å­˜ Allocated pages that are not cached in physical memory. ä¸€ä¸ªVMç³»ç»Ÿæ˜¯å¦‚ä½•ä½¿ç”¨ä¸»å­˜ä½œä¸ºç¼“å­˜ é¡µè¡¨ é¡µè¡¨ç»“æ„ é¡µå‘½ä¸­ VMé¡µå‘½ä¸­ ç¼ºé¡µ VMç¼ºé¡µ åˆ†é… åˆ†é…ä¸€ä¸ªæ–°çš„è™šæ‹Ÿé¡µé¢ ä½œä¸ºå­˜å‚¨å™¨ç®¡ç†å·¥å…· ç®€ä»‹ æ“ä½œç³»ç»Ÿä¸ºç³»ç»Ÿä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„é¡µè¡¨ æŒ‰éœ€é¡µé¢è°ƒåº¦å’Œç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„ç»“åˆï¼Œå¯¹ç³»ç»Ÿä¸­å­˜å‚¨å™¨çš„ä½¿ç”¨å’Œç®¡ç†é€ æˆäº†æ·±è¿œçš„å½±å“ã€‚ VMå¦‚ä½•ä¸ºè¿›ç¨‹æä¾›ç‹¬ç«‹çš„åœ°å€ç©ºé—´ ç®€åŒ–é“¾æ¥ æ¯ä¸ªè¿›ç¨‹çš„å­˜å‚¨å™¨å½±åƒä½¿ç”¨ç›¸åŒçš„åŸºæœ¬æ ¼å¼ï¼Œæ–‡æœ¬èŠ‚ï¼Œæ•°æ®å’ŒbssèŠ‚ï¼Œæ ˆ è¿™æ ·çš„ä¸€è‡´æ€§ï¼Œæå¤§çš„ç®€åŒ–äº†é“¾æ¥å™¨çš„è®¾è®¡å’Œå®ç°ï¼Œå…è®¸é“¾æ¥å™¨ç”Ÿæˆå…¨é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ ç®€åŒ–åŠ è½½ åŠ è½½å™¨ä»ä¸å®é™…ä»ç£ç›˜æ‹·è´æ•°æ®åˆ°å­˜å‚¨å™¨ åœ¨æ¯ä¸ªé¡µè¢«åˆæ¬¡å¼•ç”¨æ—¶ï¼Œè¦ä¹ˆæ˜¯CPUå–æŒ‡ä»¤æ—¶å¼•ç”¨çš„ï¼Œè¦ä¹ˆæ˜¯ä¸€æ¡æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤è¢«å¼•ç”¨ä¸€ä¸ªå­˜å‚¨å™¨ä½ç½®æ—¶å¼•ç”¨çš„ï¼Œè™šæ‹Ÿå­˜å‚¨å™¨ç³»ç»Ÿä¼šæŒ‰éœ€è¦è‡ªåŠ¨è°ƒå…¥æ•°æ®é¡µã€‚ ç®€åŒ–å…±äº« è¿›ç¨‹ä¹‹é—´éœ€è¦å…±äº«ä»£ç å’Œæ•°æ®ï¼Œå¯ä»¥é€šè¿‡è™šæ‹Ÿå­˜å‚¨å™¨å®ç° æ“ä½œç³»ç»Ÿé€šè¿‡å°†ä¸åŒè¿›ç¨‹ä¸­é€‚å½“çš„è™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†é¡µé¢ï¼Œä»è€Œå®‰æ’å¤šä¸ªè¿›ç¨‹å…±äº«è¿™éƒ¨åˆ†ä»£ç çš„ä¸€ä¸ªæ‹·è´ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­éƒ½åŒ…æ‹¬å•ç‹¬çš„å†…æ ¸å’ŒCæ ‡å‡†åº“çš„æ‹·è´ã€‚ ç®€åŒ–å­˜å‚¨å™¨çš„åˆ†é…ä½œä¸ºå­˜å‚¨å™¨ä¿æŠ¤å·¥å…· ä¸ºæ“ä½œç³»ç»Ÿæä¾›æ‰‹æ®µæ¥æ§åˆ¶å¯¹å­˜å‚¨å™¨ç³»ç»Ÿçš„è®¿é—®ï¼Œä¸å…è®¸ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ä¿®æ”¹å®ƒçš„åªè¯»æ–‡æœ¬æ®µã€‚ æ¯ä¸ªPTEä¸­å·²ç»æ·»åŠ äº†3ä¸ªè®¸å¯ä½ï¼ŒSUPä½è¡¨ç¤ºè¿›ç¨‹è¡¨ç¤ºè¿›ç¨‹æ˜¯å¦å¿…é¡»è¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ä¸‹æ‰èƒ½è®¿é—®è¯¥é¡µã€‚ READå’ŒWRITEä½æ§åˆ¶å¯¹é¡µé¢çš„è¯»å’Œå†™è®¿é—®ã€‚ ç”¨è™šæ‹Ÿå­˜å‚¨å™¨æ¥æä¾›é¡µé¢çº§åˆ«çš„å­˜å‚¨å™¨ä¿æŠ¤]]></content>
      <categories>
        <category>csapp</category>
      </categories>
      <tags>
        <tag>csapp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£è®¡ç®—æœºï¼šå¼‚å¸¸æ§åˆ¶æµä¸è¿›ç¨‹]]></title>
    <url>%2F2019%2F11%2F03%2Fcsapp%2Fexceptions-processes%2F</url>
    <content type="text"><![CDATA[æœ¬ç« ç®€ä»‹ å¼‚å¸¸æ§åˆ¶æµ å®šä¹‰ ç°ä»£ç³»ç»Ÿé€šè¿‡ä½¿ç”¨æ§åˆ¶æµå‘ç”Ÿçªå˜å¯¹ç³»ç»Ÿå„ç§çŠ¶æ€çš„å˜åŒ–ä½œå‡ºååº”ï¼Œæˆ‘ä»¬æŠŠè¿™äº›çªå˜ç§°ä¸ºå¼‚å¸¸æ§åˆ¶æµï¼ˆExceptional Control Flowï¼‰ ç†è§£å¼‚å¸¸æ§åˆ¶æµçš„å¥½å¤„ ç†è§£é‡è¦çš„ç³»ç»Ÿæ¦‚å¿µ ç†è§£åº”ç”¨ç¨‹åºæ˜¯å¦‚ä½•ä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„ ç¼–å†™æœ‰è¶£çš„æ–°åº”ç”¨ç¨‹åº ç†è§£å¹¶å‘ ç†è§£è½¯ä»¶å¼‚å¸¸å¦‚ä½•å·¥ä½œ æœ¬ç« è®²è§£æ€è·¯ ä¸æ“ä½œç³»ç»Ÿäº¤äº’ è¿™ä¸€ç« çš„é‡è¦æ€§åœ¨äºå­¦ä¹ åº”ç”¨æ˜¯å¦‚ä½•ä¸æ“ä½œç³»ç»Ÿäº¤äº’ï¼Œäº¤äº’æ˜¯å›´ç»•ECFçš„ï¼Œå°†ä»ä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿä¸­æ‰€æœ‰å±‚æ¬¡ä¸Šå„ç§å½¢å¼çš„ECFå±•å¼€ ä»å¼‚å¸¸å¼€å§‹ï¼Œå¼‚å¸¸ä½äºç¡¬ä»¶ä¸æ“ä½œç³»ç»Ÿäº¤ç•Œçš„éƒ¨åˆ† è®¨è®ºç³»ç»Ÿè°ƒç”¨ï¼Œä»–ä»¬æ˜¯åº”ç”¨ç¨‹åºæä¾›åˆ°æ“ä½œç³»ç»Ÿçš„å…¥å£ç‚¹çš„å¼‚å¸¸ æå‡æŠ½è±¡çš„å±‚æ¬¡ï¼Œæè¿°è¿›ç¨‹å·ï¼Œä»–ä»¬ä½äºåº”ç”¨å’Œæ“ä½œç³»ç»Ÿçš„äº¤ç•Œä¹‹å¤„ æœ€åï¼Œè®¨è®ºéæœ¬åœ°è·³è½¬ï¼Œè¿™æ˜¯ECFçš„ä¸€ç§åº”ç”¨å½¢å¼ å¼‚å¸¸ å¼‚å¸¸å¤„ç† å¼‚å¸¸ å¼‚å¸¸å°±æ˜¯æ§åˆ¶æµä¸­çš„çªå˜ï¼Œç”¨æ¥å“åº”å¤„ç†å™¨çŠ¶æ€ä¸­çš„æŸäº›å˜åŒ– äº‹ä»¶ çŠ¶æ€å˜åŒ–ç§°ä¸ºäº‹ä»¶ï¼Œäº‹ä»¶å¯èƒ½å’Œå½“å‰æŒ‡ä»¤çš„æ‰§è¡Œç›´æ¥ç›¸å…³ å¼‚å¸¸è¡¨ åœ¨ä»»ä½•æƒ…å†µï¼Œå½“å¤„ç†å™¨æ£€æµ‹åˆ°æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå®ƒå°±ä¼šé€šè¿‡ä¸€å¼ å«åšå¼‚å¸¸è¡¨çš„è·³è½¬è¡¨ï¼Œè¿›è¡Œä¸€ä¸ªé—´æ¥è¿‡ç¨‹è°ƒç”¨ï¼Œåˆ°ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨æ¥å¤„ç†è¿™ç±»äº‹ä»¶çš„æ“ä½œç³»ç»Ÿå­ç¨‹åºï¼ˆç§°ä¸ºå¼‚å¸¸å¤„ç†ç¨‹åºï¼‰ å¼‚å¸¸çš„å‰–æ å¼‚å¸¸è·³è½¬ å¤„ç†ç¨‹åºå°†æ§åˆ¶è¿”å›ç»™å½“å‰æŒ‡ä»¤Icurrï¼Œå³å½“å‰äº‹ä»¶æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ å¤„ç†ç¨‹åºå°†æ§åˆ¶è¿”å›ç»™Inext,å³å¦‚æœæ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œå°†ä¼šæ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚ å¤„ç†ç¨‹åºç»ˆæ­¢è¢«ä¸­æ–­çš„ç¨‹åºã€‚ å¼‚å¸¸å· ç³»ç»Ÿä¸­å¯èƒ½çš„æ¯ç§ç±»å‹çš„å¼‚å¸¸éƒ½åˆ†é…äº†ä¸€ä¸ªå”¯ä¸€çš„éè´Ÿæ•´æ•°çš„å¼‚å¸¸å·ï¼Œè¿™äº›å·ç æ˜¯ç”±å¤„ç†å™¨çš„è®¾è®¡è€…æˆ–è€…æ“ä½œç³»ç»Ÿå†…æ ¸åˆ†é…çš„ã€‚ å¼‚å¸¸è¡¨ åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæ“ä½œç³»ç»Ÿåˆ†é…å’Œåˆå§‹åŒ–ä¸€å¼ ç§°ä¸ºå¼‚å¸¸è¡¨çš„è·³è½¬è¡¨ï¼Œä½¿å¾—æ¡ç›®kåŒ…å«å¼‚å¸¸kçš„å¤„ç†ç¨‹åºåœ°å€ã€‚ å¼‚å¸¸çš„ç±»åˆ«å¼‚æ­¥å¼‚å¸¸ ä¸­æ–­ ä¸­æ–­æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ï¼Œæ¥è‡ªå¤„ç†å™¨å¤–éƒ¨I/Oè®¾å¤‡ä¿¡å· è¿”å›ç»“æœåï¼Œç¨‹åºç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œå°±åƒæ²¡æœ‰å‘ç”Ÿä¸­æ–­ä¸€æ · ç¡¬ä»¶ä¸­æ–­çš„å¼‚å¸¸å¤„ç†ç¨‹åºç§°ä¸ºä¸­æ–­å¤„ç†ç¨‹åº åŒæ­¥å¼‚å¸¸ï¼ˆæ•…éšœæŒ‡ä»¤ï¼‰ é™·é˜± æœ‰æ„çš„å¼‚å¸¸ï¼Œæ‰§è¡Œä¸€æ¡æŒ‡ä»¤çš„ç»“æœï¼Œæœ€å¸¸ç”¨é€”â€”â€”ç³»ç»Ÿè°ƒç”¨ åœ¨ç”¨æˆ·ç¨‹åºå’Œå†…æ ¸ä¹‹é—´æä¾›ä¸€ä¸ªåƒè¿‡ç¨‹ä¸€æ ·çš„æ¥å£ ç³»ç»Ÿè°ƒç”¨ä¸æ™®é€šå‡½æ•°è°ƒç”¨çš„åŒºåˆ« æ™®é€šçš„å‡½æ•°è°ƒç”¨è¿è¡Œåœ¨ç”¨æˆ·æ¨¡å—ä¸­ï¼Œç”¨æˆ·æ¨¡å¼é™åˆ¶äº†å‡½æ•°å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ç±»å‹ï¼Œè€Œä¸”å®ƒä»¬åªèƒ½è®¿é—®ä¸è°ƒç”¨å‡½æ•°ç›¸åŒçš„æ ˆã€‚ ç³»ç»Ÿè°ƒç”¨è¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ä¸­ï¼Œå†…æ ¸æ¨¡å¼å…è®¸ç³»ç»Ÿè°ƒç”¨æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¹¶è®¿é—®å®šä¹‰åœ¨å†…æ ¸ä¸­çš„æ ˆã€‚ æ•…éšœ æ•…éšœç”±é”™è¯¯æƒ…å†µå¼•èµ·ï¼Œä¸€èˆ¬æ˜¯æ½œåœ¨å¯æ¢å¤çš„é”™è¯¯,å®ƒèƒ½å¤Ÿè¢«æ•…éšœå¤„ç†ç¨‹åºä¿®æ­£ã€‚ å¸¸è§çš„æ˜¯ç¼ºé¡µå¼‚å¸¸ ç»ˆæ­¢ ä¸å¯ä¿®å¤çš„é”™è¯¯å¼•èµ·ï¼Œä¾‹å¦‚ï¼šDRAMä¸SRAMè¢«æŸåæ—¶å‘ç”Ÿçš„å¥‡å¶é”™è¯¯ã€‚ ç»ˆæ­¢å¤„ç† ç»ˆæ­¢å¤„ç†ç¨‹åºå°†æ§åˆ¶ä¼ é€’ç»™ä¸€ä¸ªå†…æ ¸abortä¾‹ç¨‹ï¼Œè¯¥ä¾‹ç¨‹ç»ˆæ­¢è¿™ä¸ªåº”ç”¨ç¨‹åº Linux/IA32ç³»ç»Ÿå®šä¹‰å¼‚å¸¸ å¸¸è§çš„å¼‚å¸¸ é™¤æ³•é”™è¯¯ ä¸€èˆ¬ä¿æŠ¤æ•…éšœ ç¼ºé¡µ æœºå™¨æ£€æŸ¥ IA32å¼‚å¸¸ç¤ºä¾‹å›¾ è¿›ç¨‹ è¿›ç¨‹ å¼‚å¸¸æ˜¯å…è®¸æ“ä½œç³»ç»Ÿæä¾›è¿›ç¨‹çš„æ¦‚å¿µæ‰€éœ€è¦çš„åŸºæœ¬æ„é€ å— è¿›ç¨‹çš„ç»å…¸å®šä¹‰æ˜¯ä¸€ä¸ªæ‰§è¡Œä¸­çš„ç¨‹åºçš„å®ä¾‹ ä¸Šä¸‹æ–‡ ç³»ç»Ÿä¸­çš„æ¯ä¸ªç¨‹åºéƒ½æ˜¯è¿è¡Œåœ¨æŸä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸Šä¸‹æ–‡æ˜¯ç”±ç¨‹åºæ­£ç¡®è¿è¡Œæ‰€éœ€çš„çŠ¶æ€ç»„æˆçš„ã€‚ è¿™ä¸ªçŠ¶æ€åŒ…æ‹¬å­˜æ”¾åœ¨å­˜å‚¨å™¨ä¸­çš„ç¨‹åºçš„ä»£ç å’Œæ•°æ®ï¼Œå®ƒçš„æ ˆï¼Œé€šç”¨çš„å¯„å­˜å™¨çš„å†…å®¹ã€ç¨‹åºè®¡æ•°å™¨ã€ç¯å¢ƒå˜é‡ä»¥åŠæ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„é›†åˆã€‚ è¿›ç¨‹æ˜¯å¯¹åº”ç”¨ç¨‹åºçš„å…³é”®æŠ½è±¡ ä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘æ§åˆ¶æµï¼Œå®ƒæä¾›ä¸€ä¸ªå‡è±¡ï¼Œå¥½åƒæˆ‘ä»¬çš„ç¨‹åºç‹¬å çš„ä½¿ç”¨å¤„ç†å™¨ã€‚ ä¸€ä¸ªç§æœ‰çš„åœ°å€ç©ºé—´ï¼Œå®ƒæä¾›ä¸€ä¸ªå‡è±¡ï¼Œå¥½åƒæˆ‘ä»¬çš„ç¨‹åºç‹¬å åœ°ä½¿ç”¨å­˜å‚¨å™¨ç³»ç»Ÿã€‚ é€»è¾‘æ§åˆ¶æµ å®šä¹‰ ç¨‹åºè®¡æ•°å™¨PCçš„å€¼å«åšé€»è¾‘æ§åˆ¶æµ é€»è¾‘æ§åˆ¶æµå›¾ æ¡ˆä¾‹ è€ƒè™‘ä¸€ä¸ªè¿è¡Œä¸‰ä¸ªè¿›ç¨‹çš„ç³»ç»Ÿï¼Œå¤„ç†å™¨çš„ä¸€ä¸ªç‰©ç†æ§åˆ¶æµåˆ†å‘æˆäº†ä¸‰ä¸ªé€»è¾‘æµã€‚æ¯ä¸ªè¿›ç¨‹ä¸€ä¸ªï¼Œä¸‰ä¸ªé€»è¾‘æµçš„æ‰§è¡Œæ˜¯äº¤é”™çš„ã€‚ è¿›ç¨‹Aè¿è¡Œäº†ä¸€ä¼šå„¿ï¼Œç„¶åæ˜¯è¿›ç¨‹Bå¼€å§‹è¿è¡Œå®Œæˆã€‚ç„¶åï¼Œè¿›ç¨‹Cè¿è¡Œäº†ä¸€ä¼šï¼Œè¿›ç¨‹Aæ¥ç€è¿è¡Œç›´åˆ°å®Œæˆã€‚æœ€åï¼Œè¿›ç¨‹Cå¯ä»¥è¿è¡Œåˆ°ç»“æŸäº†ã€‚ å›¾çš„å…³é”®ç‚¹åœ¨äºè¿›ç¨‹æ˜¯è½®æµä½¿ç”¨å¤„ç†å™¨çš„ï¼Œæ¯ä¸ªè¿›ç¨‹æ‰§è¡Œå®ƒçš„æµçš„ä¸€éƒ¨åˆ†ï¼Œç„¶åè¢«æŠ¢å å…¶ä»–è¿›ç¨‹ã€‚å¯¹äºä¸€ä¸ªè¿è¡Œåœ¨è¿™äº›è¿›ç¨‹ä¹‹ä¸€çš„ä¸Šä¸‹æ–‡ä¸­çš„ç¨‹åºï¼Œå®ƒçœ‹ä¸Šå»å°±åƒæ˜¯åœ¨ç‹¬å åœ°ä½¿ç”¨å¤„ç†å™¨ã€‚ é€»è¾‘æµå½¢å¼ å¼‚å¸¸å¤„ç†ç¨‹åºã€è¿›ç¨‹ã€ä¿¡å·å¤„ç†ç¨‹åº çº¿ç¨‹å’Œjavaè¿›ç¨‹ å¹¶å‘æµ å¹¶å‘æµ å¤šä¸ªæµå¹¶å‘åœ°æ‰§è¡Œçš„ä¸€èˆ¬ç°è±¡ç§°ä¸ºå¹¶å‘ï¼Œå¹¶å‘ä½¿è®¡ç®—æœºè¿è¡Œå¾—æ›´å¿« å¹¶å‘çš„æ€æƒ³ä¸æµè¿è¡Œçš„å¤„ç†å™¨æ ¸æ•°æˆ–è€…è®¡ç®—æœºæ•°æ— å…³ã€‚å¦‚æœæ¯ä¸ªæµåœ¨æ—¶é—´ä¸Šé‡å ï¼Œé‚£ä¹ˆå®ƒä»¬å°±æ˜¯å¹¶å‘ã€‚ å¹¶è¡Œæµ å¹¶è¡Œæµæ˜¯å¹¶å‘æµçš„ä¸€ä¸ªçœŸå­é›†ï¼Œå¦‚æœä¸¤ä¸ªæµå¹¶å‘çš„è¿è¡Œåœ¨ä¸åŒçš„å¤„ç†å™¨æˆ–è€…è®¡ç®—æœºä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬ç¨‹å®ƒä»¬ä¸ºå¹¶è¡Œæµã€‚ å¹¶è¡Œä½¿è®¡ç®—æœºèƒ½åšçš„æ›´å¤šï¼Œå®ƒä»¬å¹¶è¡Œçš„è¿è¡Œï¼Œä¸”å¹¶è¡Œåœ°æ‰§è¡Œã€‚ ç§æœ‰åœ°å€ç©ºé—´ å®šä¹‰ ä¸€ä¸ªè¿›ç¨‹ä¸ºæ¯ä¸ªç¨‹åºæä¾›å®ƒè‡ªå·±çš„ç§æœ‰åœ°å€ç©ºé—´ ç»„æˆ åœ°å€ç©ºé—´åº•éƒ¨æ˜¯ä¿ç•™ç»™ç”¨æˆ·ç¨‹åºçš„ï¼ŒåŒ…æ‹¬é€šå¸¸çš„æ–‡æœ¬ã€æ•°æ®ã€å †å’Œæ ˆæ®µã€‚ è¿›ç¨‹åœ°å€ç©ºé—´å›¾ ç”¨æˆ·æ¨¡å¼å’Œå†…æ ¸æ¨¡å¼ æ¨¡å¼ä½ å¤„ç†å™¨é€šè¿‡ä½¿ç”¨æŸä¸ªæ§åˆ¶å¯„å­˜å™¨ä¸­çš„ä¸€ä¸ªæ¨¡å¼ä½ï¼Œæ¥é™åˆ¶ä¸€ä¸ªåº”ç”¨å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ä»¥åŠå®ƒå¯ä»¥è®¿é—®çš„åœ°å€ç©ºé—´èŒƒå›´ã€‚ å½“è®¾ç½®æ¨¡å¼ä½æ—¶ï¼Œè¿›ç¨‹å°±è¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªè¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ä¸­çš„è¿›ç¨‹å¯ä»¥æ‰§è¡ŒæŒ‡ä»¤é›†ä¸­çš„ä»»ä½•æŒ‡ä»¤ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®ç³»ç»Ÿä¸­ä»»ä½•å­˜å‚¨å™¨ä½ç½®ã€‚ æ²¡æœ‰æ¨¡å¼ä½æ—¶ï¼Œè¿›ç¨‹å°±æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ¨¡å¼ä¸­ã€‚ç”¨æˆ·æ¨¡å¼ä¸­çš„è¿›ç¨‹ä¸å…è®¸æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œæ¯”å¦‚åœæ­¢å¤„ç†å™¨ï¼Œæ”¹å˜ä½æ¨¡å¼ï¼Œæˆ–è€…å‘èµ·ä¸€ä¸ªI/Oæ“ä½œã€‚ æ¨¡å¼è½¬åŒ– åˆå§‹æ—¶ è¿è¡Œåº”ç”¨ç¨‹åºä»£ç çš„è¿›ç¨‹åˆå§‹æ—¶æ˜¯åœ¨ç”¨æˆ·æ¨¡å¼ä¸­ã€‚ ç”¨æˆ·æ¨¡å¼è½¬å†…æ ¸æ¨¡å¼ å”¯ä¸€æ–¹æ³•ï¼Œè°ƒç”¨ä¸­æ–­ã€æ•…éšœã€æˆ–è€…é™·å…¥ç³»ç»Ÿè°ƒç”¨çš„å¼‚å¸¸ å†…æ ¸æ¨¡å¼è½¬ç”¨æˆ·æ¨¡å¼ å¤„ç†ç¨‹åºè¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ä¸­ï¼Œå½“å®ƒè¿”å›åˆ°åº”ç”¨ç¨‹åºä»£ç æ—¶ï¼Œå¤„ç†å™¨å°±æŠŠå†…æ ¸æ¨¡å¼æ”¹å›ä¸ºç”¨æˆ·æ¨¡å¼ ä¸Šä¸‹æ–‡åˆ‡æ¢ å®šä¹‰ ä¸Šä¸‹æ–‡å°±æ˜¯å†…æ ¸é‡æ–°å¯åŠ¨ä¸€ä¸ªè¢«æŠ¢å çš„è¿›ç¨‹æ‰€éœ€çš„çŠ¶æ€ æ“ä½œç³»ç»Ÿå†…æ ¸ä½¿ç”¨ä¸€ç§ç§°ä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢çš„è¾ƒé«˜å±‚å½¢å¼çš„å¼‚å¸¸æ§åˆ¶æµæ¥å®ç°å¤šä»»åŠ¡ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢å›¾ ä¸Šä¸‹æ–‡åˆ‡æ¢ ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ æ¢å¤æŸä¸ªå…ˆå‰è¢«æŠ¢å çš„è¿›ç¨‹è¢«ä¿å­˜çš„ä¸Šä¸‹æ–‡ å°†æ§åˆ¶ä¼ é€’ç»™è¿™ä¸ªæ–°æ¢å¤çš„è¿›ç¨‹]]></content>
      <categories>
        <category>csapp</category>
      </categories>
      <tags>
        <tag>csapp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£è®¡ç®—æœºï¼šå­˜å‚¨å™¨å±‚æ¬¡ç»“æ„]]></title>
    <url>%2F2019%2F10%2F20%2Fcsapp%2Fstorage-technologies%2F</url>
    <content type="text"><![CDATA[å­˜å‚¨æŠ€æœ¯ éšæœºè®¿é—®å­˜å‚¨å™¨ SRAM ç”¨ä½œé«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨ DRAM ä½œä¸ºä¸»å­˜ä»¥åŠå›¾å½¢ç³»ç»Ÿçš„å¸§ç¼“å†²åŒº å¯¹æ¯” SRAMå…·æœ‰å¤šä¸ªæ™¶ä½“ç®¡ï¼Œè®¿é—®å¿«ï¼Œä¸æ•æ„Ÿï¼Œé€ ä»·é«˜ï¼Œåº”ç”¨äºé«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨ã€‚ ç£ç›˜ ç£ç›˜æ„é€  ç£ç›˜ ç£ç›˜æ˜¯ç”±ç›˜ç‰‡æ„æˆï¼Œæ¯ä¸ªç›˜ç‰‡æœ‰ä¸¤é¢ç§°ä¸ºè¡¨é¢ï¼Œè¡¨é¢è¦†ç›–ç€ç£æ€§è®°å½•ææ–™ã€‚ç›˜ç‰‡ä¸­å¤®æœ‰ä¸€ä¸ªå¯ä»¥æ—‹è½¬çš„ä¸»è½´ï¼Œå®ƒä½¿å¾—ç›˜ç‰‡ä»¥å›ºå®šçš„æ—‹è½¬é€Ÿç‡æ—‹è½¬ï¼ˆå•ä½ï¼šRPMï¼‰ã€‚ç£ç›˜é€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè¿™æ ·çš„ç›˜ç‰‡ï¼Œå¹¶å°è£…åœ¨ä¸€ä¸ªå¯†å°çš„å®¹å™¨å†…ã€‚ æ‰‡åŒº æ¯ä¸ªè¡¨é¢ç”±ä¸€ç»„ç§°ä¸ºç£é“çš„åŒå¿ƒåœ†ç»„çš„ã€‚æ¯ä¸ªç£é“è¢«åˆ’åˆ†ä¸ºä¸€ç»„æ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒºåŒ…å«ç›¸ç­‰æ•°æ®ä½ï¼ˆé€šå¸¸æ˜¯512å­—èŠ‚ï¼‰ã€‚æ‰‡åŒºä¹‹é—´ç”±ä¸€äº›é—´éš™åˆ†éš”å¼€ï¼Œè¿™äº›é—´éš™ä¸­ä¸å­˜å‚¨æ•°æ®ä½ï¼Œç”¨æ¥æ ‡è¯†æ‰‡åŒºçš„æ ¼å¼åŒ–ä½ã€‚ ç£ç›˜æ„é€  ç›˜ç‰‡ï¼Œç›˜é¢ï¼Œä¸»è½´ï¼Œç£é“ï¼Œæ‰‡åŒºï¼ŒæŸ±é¢ ç£ç›˜å®¹é‡ ç£ç›˜å®¹é‡ï¼å­—èŠ‚æ•°/æ‰‡åŒº * å¹³å‡æ‰‡åŒº/ç£é“ * ç£é“æ•°/è¡¨é¢ * è¡¨é¢æ•°/ç›˜ç‰‡ *ç›˜ç‰‡æ•°/ç£ç›˜ è®¿é—®æ—¶é—´ è®¿é—®æ—¶é—´=å¯»é“æ—¶é—´+æ—‹è½¬æ—¶é—´+ä¼ é€æ—¶é—´ ä¼ é€æ—¶é—´ä¸å¯»é“æ—¶é—´ã€æ—‹è½¬æ—¶é—´æ¯”è¾ƒï¼Œå¾ˆå°‘ å¯»é“æ—¶é—´å’Œæ—‹è½¬æ—¶é—´å¤§è‡´ç›¸ç­‰ å°†å¯»é“æ—¶é—´ä¹˜ä»¥2ï¼Œçœ‹ä½œæ˜¯ç£ç›˜è®¿é—®æ—¶é—´çš„ä¼°è®¡å€¼ ç£ç›˜çš„åŠ¨æ€ç‰¹æ€§ å¯»é“æ—¶é—´ ä¸ºäº†è¯»å–æŸä¸ªç›®æ ‡æ‰‡åŒºçš„å†…å®¹ï¼Œä¼ åŠ¨è‡‚é¦–å…ˆå°†è¯»/å†™å¤´å®šä½åˆ°åŒ…å«ç›®æ ‡æ‰‡åŒºçš„ç£é“ä¸Šã€‚ä¾èµ–äºè¯»/å†™å¤´ä»¥å‰çš„ä½ç½®å’Œä¼ åŠ¨è‡‚åœ¨ç›˜é¢ä¸Šç§»åŠ¨çš„é€Ÿåº¦ã€‚ æ—‹è½¬æ—¶é—´ ä¸€æ—¦è¯»/å†™å¤´å®šä½åˆ°äº†æœŸæœ›çš„ç£é“ï¼Œé©±åŠ¨å™¨ç­‰å¾…ç›®æ ‡æ‰‡åŒºçš„ç¬¬ä¸€ä¸ªbitæ—‹è½¬åˆ°è¯»/å†™å¤´ä¸‹ã€‚ä¾èµ–äºå½“è¯»/å†™å¤´åˆ°è¾¾ç›®æ ‡æ‰‡åŒºæ—¶ç›˜é¢çš„ä½ç½®å’Œç£ç›˜çš„æ—‹è½¬é€Ÿåº¦ã€‚ ä¼ é€æ—¶é—´ å½“ç›®æ ‡æ‰‡åŒºçš„ç¬¬ä¸€ä¸ªbitä½äºè¯»/å†™å¤´ä¸‹æ—¶ï¼Œé©±åŠ¨å™¨å°±å¯ä»¥å¼€å§‹è¯»æˆ–è€…å†™è¯¥æ‰‡åŒºçš„å†…å®¹äº†ã€‚ä¸€ä¸ªæ‰‡åŒºçš„ä¼ é€æ—¶é—´ä¾èµ–äºæ—‹è½¬é€Ÿåº¦å’Œæ¯æ¡ç£é“çš„æ‰‡åŒºæ•°ç›®ã€‚ é€»è¾‘ç£ç›˜å— å¯å°†ç£ç›˜åˆ†ä¸ºBä¸ªæ‰‡åŒºå¤§å°çš„é€»è¾‘å—çš„åºåˆ—ï¼Œç¼–å·ä¸º0ï¼Œ1ï¼Œâ€¦ï¼ŒB-1ã€‚ç£ç›˜ä¸­æœ‰ä¸€ä¸ªå°çš„ç¡¬ä»¶/å›ºä»¶è®¾å¤‡ï¼Œç§°ä¸ºç£ç›˜æ§åˆ¶å™¨ï¼Œç»´æŠ¤ç€é€»è¾‘å—å·å’Œç‰©ç†ç£ç›˜æ‰‡åŒºï¼ˆç›˜é¢ã€ç£é“ã€æ‰‡åŒºï¼‰ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ å›ºæ€ç¡¬ç›˜ å›ºæ€ç¡¬ç›˜ å›ºæ€ç¡¬ç›˜(SSD)çš„å­˜å‚¨ä»‹è´¨åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é‡‡ç”¨é—ªå­˜ï¼ˆFLASHèŠ¯ç‰‡ï¼‰ä½œä¸ºå­˜å‚¨ä»‹è´¨(å¦‚ç¬”è®°æœ¬ç¡¬ç›˜ã€å­˜å‚¨å¡ã€ä¼˜ç›˜ç­‰)ï¼Œå¦å¤–ä¸€ç§æ˜¯é‡‡ç”¨DRAMä½œä¸ºå­˜å‚¨ä»‹è´¨(ç›®å‰åº”ç”¨èŒƒå›´è¾ƒçª„)ã€‚è€Œä¼ ç»Ÿæ—‹è½¬ç¡¬ç›˜æ˜¯ä½¿ç”¨æœºæ¢°é©±åŠ¨å™¨ä½œä¸ºå­˜å‚¨ä»‹è´¨ã€‚SSDæ’åˆ°I/Oæ€»çº¿ä¸Šæ ‡å‡†ç¡¬ç›˜æ’æ§½ï¼ˆé€šå¸¸æ˜¯USBï¼‰ä¸­ï¼Œè¡Œä¸ºå°±å’Œæ—‹è½¬ç¡¬ç›˜ä¸€æ ·ã€‚ å¯¹æ¯” SSDç›¸æ¯”æ—‹è½¬ç¡¬ç›˜ï¼Œéšæœºè®¿é—®æ—¶é—´æ›´å¿«ï¼Œèƒ½è€—æ›´ä½ï¼ŒåŒæ—¶ä¹Ÿæ›´ç»“å®ï¼Œä½†ä»·æ ¼è¾ƒè´µã€‚ å±€éƒ¨æ€§ å±€éƒ¨æ€§åŸç† åœ¨æ•°æ®è®¿é—®æ—¶ï¼Œå…·æœ‰â€œå¼•ç”¨é‚»è¿‘äºå…¶ä»–å¼•ç”¨è¿‡çš„æ•°æ®é¡¹çš„æ•°æ®é¡¹ï¼Œæˆ–è€…æœ€è¿‘å¼•ç”¨è¿‡çš„æ•°æ®é¡¹æœ¬èº«â€çš„è¿™ç§å€¾å‘ï¼Œå«ä½œå±€éƒ¨æ€§åŸç†ã€‚ å±€éƒ¨æ€§åŸç†å¯¹ç¡¬ä»¶å’Œè½¯ä»¶ç³»ç»Ÿçš„è®¾è®¡å’Œæ€§èƒ½éƒ½æœ‰ç€æå¤§çš„å½±å“ã€‚ å¯¹ç¨‹åºæ•°æ®å¼•ç”¨çš„å±€éƒ¨æ€§ æ—¶é—´å±€éƒ¨æ€§ åœ¨ä¸€ä¸ªå…·æœ‰è‰¯å¥½æ—¶é—´å±€éƒ¨æ€§çš„ç¨‹åºä¸­ï¼Œè¢«å¼•ç”¨è¿‡ä¸€æ¬¡çš„å­˜å‚¨å™¨ä½ç½®å¾ˆå¯èƒ½åœ¨ä¸è¿œçš„å°†æ¥å†è¢«å¤šæ¬¡å¼•ç”¨ã€‚ å–æŒ‡ä»¤çš„å±€éƒ¨æ€§ ç©ºé—´å±€éƒ¨æ€§ åœ¨ä¸€ä¸ªå…·æœ‰è‰¯å¥½ç©ºé—´å±€éƒ¨æ€§çš„ç¨‹åºä¸­ï¼Œå¦‚æœä¸€ä¸ªå­˜å‚¨å™¨ä½ç½®è¢«å¼•ç”¨äº†ä¸€æ¬¡ï¼Œé‚£ä¹ˆç¨‹åºå¾ˆå¯èƒ½åœ¨ä¸è¿œçš„å°†æ¥å¼•ç”¨é™„è¿‘çš„ä¸€ä¸ªå­˜å‚¨å™¨ä½ç½®ã€‚ å±€éƒ¨æ€§å°ç»“ é‡å¤å¼•ç”¨åŒä¸€ä¸ªå˜é‡çš„ç¨‹åºæœ‰è‰¯å¥½çš„æ—¶é—´å±€éƒ¨æ€§ å¯¹äºå…·æœ‰æ­¥é•¿ä¸ºkçš„å¼•ç”¨æ¨¡å¼çš„ç¨‹åºï¼Œæ­¥é•¿è¶Šå°ï¼Œç©ºé—´å±€éƒ¨æ€§è¶Šå¥½ã€‚å…·æœ‰æ­¥é•¿ä¸º1çš„å¼•ç”¨æ¨¡å¼çš„ç¨‹åºæœ‰å¾ˆå¥½çš„ç©ºé—´å±€éƒ¨æ€§ã€‚åœ¨å­˜å‚¨å™¨ä¸­ä»¥å¤§æ­¥é•¿è·³æ¥è·³å»çš„ç¨‹åºç©ºé—´å±€éƒ¨æ€§å¾ˆå·®ã€‚ å¯¹äºå–æŒ‡ä»¤æ¥è¯´ï¼Œå¾ªç¯æœ‰å¾ˆå¥½çš„æ—¶é—´å’Œç©ºé—´å±€éƒ¨æ€§ã€‚å¾ªç¯ä½“è¶Šå°ï¼Œå¾ªç¯è¿­ä»£æ¬¡æ•°è¶Šå¤šï¼Œå±€éƒ¨æ€§è¶Šå¥½ã€‚ å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ å±‚æ¬¡ç»“æ„å›¾ L0å±‚å¯„å­˜å™¨ ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸçš„è®¿é—®æ—¶é—´ï¼Œç¼“å­˜çš„æ˜¯å­—ï¼Œå¤§å°4å­—èŠ‚æˆ–è€…8å­—èŠ‚ã€‚ L1ï½L3å±‚é«˜é€Ÿç¼“å­˜ï¼ˆSRAMï¼‰ å‡ ä¸ªæ—¶é’Ÿå‘¨æœŸçš„è®¿é—®æ—¶é—´ï¼Œç¼“å­˜çš„è¡Œï¼Œ64å­—èŠ‚å—ã€‚ ä¸»å­˜ï¼ˆDRAMï¼‰ å‡ ååˆ°å‡ ç™¾ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œéƒ¨åˆ†æ–‡ä»¶ã€‚ æœ¬åœ°ç£ç›˜ ç£ç›˜æ‰‡åŒºï¼Œæ•°ä¸‡ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ ç½‘ç»œä¼ è¾“ï¼Œä¼ è¾“æ›´æ…¢ã€‚ ç¼“å­˜çš„æ¦‚å¿µ ç¼“å­˜ é«˜é€Ÿç¼“å­˜æ˜¯ä¸€ä¸ªå°è€Œå¿«é€Ÿçš„å­˜å‚¨è®¾å¤‡ï¼Œå®ƒä½œä¸ºå­˜å‚¨åœ¨æ›´å¤§ã€ä¹Ÿæ›´æ…¢çš„è®¾å¤‡ä¸­çš„æ•°æ®å¯¹è±¡çš„ç¼“å†²åŒºåŸŸã€‚ä½¿ç”¨é«˜é€Ÿç¼“å­˜çš„è¿‡ç¨‹ç§°ä¸ºç¼“å­˜ã€‚ å— ç¬¬k+1å±‚çš„å­˜å‚¨å™¨è¢«åˆ’åˆ†æˆè¿ç»­çš„æ•°æ®å¯¹è±¡ç‰‡ï¼Œç§°ä¸ºå—ã€‚æ¯ä¸ªå—éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€æˆ–åå­—ï¼Œä½¿ä¹‹åŒºåˆ«äºå…¶ä»–çš„å—ã€‚ å¤§å—å¯ä»¥å‡å°‘è®¿é—®æ¬¡æ•°ã€‚ å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ä¸­åŸºæœ¬çš„ç¼“å­˜åŸç† ç¼“å­˜å‘½ä¸­ å½“ç¨‹åºéœ€è¦ç¬¬k+1å±‚çš„æŸä¸ªæ•°æ®å¯¹è±¡dæ—¶ï¼Œå®ƒé¦–å…ˆåœ¨å½“å‰å­˜å‚¨åœ¨ç¬¬kå±‚çš„ä¸€ä¸ªå—ä¸­æŸ¥æ‰¾dã€‚å¦‚æœdåˆšå¥½ç¼“å­˜åœ¨ç¬¬kå±‚ä¸­ï¼Œé‚£ä¹ˆå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç¼“å­˜å‘½ä¸­ã€‚ ç»“æ„å±‚æ¬¡å°ç»“ åˆ©ç”¨æ—¶é—´å±€éƒ¨æ€§ ç”±äºæ—¶é—´å±€éƒ¨æ€§ï¼ŒåŒä¸€æ•°æ®å¯¹è±¡å¯èƒ½ä¼šè¢«å¤šæ¬¡ä½¿ç”¨ã€‚ä¸€æ—¦ä¸€ä¸ªæ•°æ®å¯¹è±¡åœ¨ç¬¬ä¸€æ¬¡ä¸å‘½ä¸­æ—¶è¢«æ‹·è´åˆ°ç¼“å­˜ä¸­ï¼Œæˆ‘ä»¬å°±ä¼šæœŸæœ›åé¢å¯¹è¯¥ç›®æ ‡æœ‰ä¸€ç³»åˆ—çš„è®¿é—®å‘½ä¸­ã€‚å› ä¸ºç¼“å­˜æ¯”ä½ä¸€å±‚çš„å­˜å‚¨è®¾å¤‡æ›´å¿«ï¼Œå¯¹åé¢çš„å‘½ä¸­çš„æœåŠ¡ä¼šæ¯”æœ€å¼€å§‹çš„ä¸å‘½ä¸­å¿«å¾ˆå¤šã€‚ åˆ©ç”¨ç©ºé—´å±€éƒ¨æ€§ å—é€šå¸¸åŒ…å«æœ‰å¤šä¸ªæ•°æ®å¯¹è±¡ã€‚ç”±äºç©ºé—´å±€éƒ¨æ€§ï¼Œæˆ‘ä»¬ä¼šæœŸæœ›åé¢å¯¹è¯¥å—ä¸­å…¶ä»–å¯¹è±¡çš„è®¿é—®èƒ½å¤Ÿè¡¥å¿ä¸å‘½ä¸­åæ‹·è´è¯¥å—çš„èŠ±è´¹ã€‚ â€‹]]></content>
      <categories>
        <category>csapp</category>
      </categories>
      <tags>
        <tag>csapp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ ¡æ‹›é¢è¯•é¢˜ä¸ªäººæ•´ç†]]></title>
    <url>%2F2019%2F09%2F26%2Fschool-inter-questions%2F</url>
    <content type="text"><![CDATA[javaåŸºç¡€1. Objectç±»ä¸­æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œè®²ä¸€è®²å„ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼Ÿ ç­”ï¼š toString() æ‰“å°å¯¹è±¡å®ä¾‹çš„ä¿¡æ¯å†…å®¹ï¼ˆæè¿°æˆ‘æ˜¯è°ï¼‰ getClass() è·å–ç±»ä¿¡æ¯Classå¯¹è±¡ï¼ˆéª¨å­é‡Œç‰¹æ€§ï¼‰ equals() åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„åœ°å€å¼•ç”¨æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœæ–¹æ³•è¢«è¦†ç›–çš„è¯ï¼Œæ¯”è¾ƒçš„æ˜¯å†…å®¹ï¼ˆè°ä¼šä¸æˆ‘å…±é¸£å‘¢ï¼‰ã€‚ hashCode() è·å–å¯¹è±¡çš„hashCodeå€¼,ç”¨äºåŒºåˆ†å¯¹è±¡å®ä¾‹çš„å”¯ä¸€æ€§ï¼ˆæ¯ä¸ªäººéƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼‰ã€‚ wait() å½“çº¿ç¨‹æ‰§è¡Œwaitæ–¹æ³•æ—¶ï¼Œä¼šä½¿è¯¥å¯¹è±¡è¿›å…¥ç­‰å¾…æ± ï¼Œé‡Šæ”¾é”èµ„æºï¼Œè®©å…¶ä»–çº¿ç¨‹æ‰§è¡Œã€‚ notify() å½“çº¿ç¨‹æ‰§è¡Œnotifyæ—¶ï¼Œä¼šå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚ clone() å¯¹è±¡çš„æµ…æ‹·è´ï¼ˆæè¿°æˆ‘æ˜¯ä»å“ªæ¥ï¼‰ finalize() åƒåœ¾å›æ”¶ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜(æè¿°æˆ‘è¦åˆ°å“ªå»)ã€‚ 2. sleep()ä¸wait()æ–¹æ³•çš„åŒºåˆ«ï¼Ÿ ç­”ï¼š sleepæ˜¯Threadçš„é™æ€æ–¹æ³•ï¼Œä½¿å¾—è°ƒç”¨çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œä¼‘çœ çš„æ—¶å€™ä¾ç„¶å æ®å¯¹è±¡é”ï¼Œå…¶ä»–çº¿ç¨‹æ‹¿ä¸åˆ°é”ä¼šé˜»å¡ï¼Œä½†æ˜¯ä¼šè®©å‡ºCPUèµ„æºç»™å…¶ä»–çº¿ç¨‹ï¼Œç­‰åˆ°ä¼‘çœ æ—¶é—´ç»“æŸï¼Œçº¿ç¨‹å°±è¿›å…¥åˆ°å°±ç»ªçŠ¶æ€ï¼Œå’Œå…¶ä»–çº¿ç¨‹ä¸€èµ·ç«äº‰CPUã€‚ è€Œwaitæ˜¯Objectç±»ä¸­çš„æ–¹æ³•ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°waitæ–¹æ³•æ—¶ï¼Œå®ƒå°±è¿›å…¥ä¸€ä¸ªå’Œè¯¥å¯¹è±¡ç›¸å…³çš„ç­‰å¾…æ± ï¼ŒåŒæ—¶é‡Šæ”¾å¯¹è±¡çš„é”ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿè®¿é—®ï¼Œå¯ä»¥é€šè¿‡notifyï¼ŒnotifyAll()æ–¹æ³•æ¥å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚ 3. è¯´ä¸€ä¸‹â€œ==â€ä¸equals()çš„åŒºåˆ«ï¼Ÿ ç­”ï¼š â€œ==â€å¯¹äºåŸºæœ¬ç±»å‹æ¥è¯´ï¼Œæ¯”è¾ƒçš„æ˜¯å†…å®¹ï¼ˆæ¯”å¦‚intç±»å‹ï¼Œæ¯”è¾ƒçš„æ˜¯æ•°å€¼å¤§å°ï¼‰ã€‚å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚ equalsæ˜¯ObjectåŸºç±»ä¸­çš„æ–¹æ³•ï¼Œå®ç°æ˜¯æ¯”è¾ƒå¼•ç”¨åœ°å€ï¼ˆ==ï¼‰ï¼Œå¦‚æœè¢«è¦†ç›–ï¼Œåˆ™æ¯”è¾ƒçš„æ˜¯å†…å®¹ã€‚ 4. equalsä¸hashcodeçš„åŒºåˆ«ï¼Ÿ ç­”ï¼š è¿™ä¸¤ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºSet,HashTableä¸­ï¼Œå¦‚æœå¯¹è±¡è¦ç”¨Set(å»é‡)ï¼ŒHashTableå­˜å‚¨(æ•£åˆ—)ï¼Œåˆ™åº”è¯¥è€ƒè™‘é‡å†™hashCodeæ–¹æ³•ã€‚ å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„equalsæ–¹æ³•ç›¸ç­‰ï¼Œåˆ™è°ƒç”¨hashCOdeè¿”å›çš„å“ˆå¸Œç å€¼ä¹Ÿç›¸ç­‰ã€‚ ä½†æ˜¯ï¼ŒhashCodeç›¸ç­‰ï¼Œä¸ä¸€å®šequalsæ–¹æ³•ç›¸ç­‰ã€‚ æ³¨æ„ï¼Œé€šå¸¸éœ€è¦åœ¨é‡å†™hashCode()æ–¹æ³•æ—¶é‡å†™equalsæ–¹æ³•ï¼Œä»¥ä¾¿ç»´æŠ¤hashCodeæ–¹æ³•çš„ general contractï¼Œè¯¥æ–¹æ³•å£°æ˜equalsç›¸ç­‰çš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸ç­‰çš„æ•£åˆ—ä»£ç ã€‚(çœ‹Objectå¯¹è±¡çš„æºç ) 5. æŠ½è±¡ç±»ä¸æ¥å£çš„åŒºåˆ«ï¼Œæœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šæŠ½è±¡ç±»æ˜¯ä¸ºäº†å®ç°ä»£ç çš„é‡ç”¨ï¼ˆå¤ç”¨ï¼‰ï¼Œè€Œæ¥å£æ˜¯ä¸ºäº†é™ä½ä»£ç çš„è€¦åˆåº¦ã€‚ 6. javaä¸­æ‰“å°HelloWorldçš„æ‰§è¡Œæµç¨‹ï¼Ÿ ç­”ï¼š javacç¼–è¯‘HelloWorld.java,å¾—åˆ°HelloWorld.classå­—èŠ‚ç æ–‡ä»¶ã€‚ JVMå°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½è¿›å†…å­˜ä¸­(å³æ–¹æ³•åŒºçš„ç±»ä»£ç åŒºä¸­)ã€‚ JVMæ‰¾åˆ°HelloWorldçš„mainæ–¹æ³•ï¼Œä¼ é€’Stringç±»å‹å‚æ•°çš„åœ°å€åˆ°ä¸»æ–¹æ³•çš„argsä¸­å»ï¼Œå¹¶åœ¨æ ˆåŒºä¸ºargså¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œè¿”å›ä¸€ä¸ªvoidçš„è¿”å›å€¼ã€‚ åˆ›å»ºä¸€ä¸ªâ€œHelloWorldâ€å¯¹è±¡ï¼Œå¯¹è±¡åœ¨æ–¹æ³•åŒºçš„å¸¸é‡æ•°æ®åŒºå¼€è¾Ÿç©ºé—´ï¼Œå…¶å±æ€§å€¼ä¸ºâ€œHelloWorldâ€ã€‚ å®šä¹‰ä¸€ä¸ªStringç±»å‹çš„å˜é‡s(åœ¨æ ˆåŒºå¼€è¾Ÿç©ºé—´)ï¼Œå˜é‡så­˜æ”¾å¯¹è±¡â€œHelloWorldâ€çš„åœ°å€ã€‚ JVMæ‰¾åˆ°æ ‡å‡†ç±»åº“ä¸­çš„System.classç±»å¹¶åŠ è½½åˆ°å†…å­˜ä¸­(å³æ–¹æ³•åŒºçš„ç±»ä»£ç åŒºä¸­),Systemåˆå§‹åŒ–æ—¶ä¼šåˆ›å»ºPrintStreamæ ‡å‡†å­—èŠ‚è¾“å‡ºæµå¯¹è±¡ï¼Œè°ƒç”¨println()æ–¹æ³•å°†å˜é‡sçš„å€¼æ‰“å°åˆ°å±å¹•ä¸Šã€‚ æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º 7. linuxç†Ÿæ‚‰çš„å‘½ä»¤ ç­”ï¼š å¦‚æœè‡ªå·±éƒ¨ç½²è¿‡æœåŠ¡å™¨ï¼Œé‚£è¿™ä¸ªé—®é¢˜è¿˜ä¸æ˜¯so easy.å¯ä»¥å‚è€ƒè¿™ç¯‡ ç»ˆç«¯å‘½ä»¤å°å…¥é—¨ pwd æ‰“å°å½“å‰æ‰€åœ¨ç›®å½• cat æ‰“å°æ–‡æœ¬æ–‡ä»¶å†…å®¹ vim ç¼–è¾‘æ–‡æœ¬ tar å‹ç¼©æ–‡ä»¶ ssh ç™»å½•æœåŠ¡å™¨ sudo ä»¥ç³»ç»Ÿç®¡ç†è€…çš„èº«ä»½æ‰§è¡ŒæŒ‡ä»¤ chmod ä¿®æ”¹æ–‡ä»¶æƒé™ mkdir åˆ›å»ºæ–‡ä»¶å¤¹ mv ç§»åŠ¨ cp æ‹·è´ rm -rf å¼ºåˆ¶åˆ é™¤ æŸ¥çœ‹æœåŠ¡å™¨ä¸Šè·‘çš„æœåŠ¡ ps -ef|grep sssc|grep jar æ¨¡ç³Šæœç´¢æ—¥å¿— cat sssc-soa-app_applicationLog_2019-07-25-3.log | grep â€œstartupâ€ 8. ä¸ºä»€ä¹ˆç»„åˆä¼˜å…ˆäºç»§æ‰¿ï¼Ÿ ç­”ï¼š ç»§æ‰¿è€¦åˆåº¦é«˜ï¼Œç»„åˆä½¿ç”¨javaå¤šæ€çš„ç‰¹æ€§é™ä½è€¦åˆåº¦ã€‚ æ¯”å¦‚ï¼Œé‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼ï¼Œå½“çˆ¶ç±»éœ€è¦å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œè€Œå…¶æ‰€æœ‰çš„å­ç±»éƒ½ä¼šåæ˜ å‡ºè¿™ç§å˜åŠ¨ã€‚è€Œç»„åˆå´å¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ªå…±æœ‰çš„æ¥å£ï¼Œç„¶åä¼ å…¥æŒ‡å®šçš„å®ç°ç±»ï¼Œè®©å…¶ä»–ä¸ç›¸å…³ç±»é¿å…å—å½±å“ã€‚ æ•°æ®ç»“æ„1. Listå…ƒç´ å®ç°åˆ é™¤æœ‰å“ªäº›æ³¨æ„çš„ï¼Ÿ ç­”ï¼šCollectioné›†åˆç›¸å…³ç±»åšåˆ é™¤æ“ä½œæ—¶ï¼Œä¸èƒ½è¾¹éå†è¾¹åˆ é™¤ï¼Œå› ä¸ºå†…éƒ¨ç»´æŒäº†expectedModCountè¿™ä¹ˆä¸€ä¸ªå­—æ®µï¼Œå¦‚æœmodCount != expectedModCountå¹¶ä¸ç­‰äºï¼Œåˆ™ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ã€‚ 2. è®²ä¸€ä¸‹HashMapä¸HashTableçš„åŒºåˆ«ï¼ŸHashMapçš„æ‰©å®¹æ–¹å¼ï¼Œget()æ–¹æ³•å’Œput()æ–¹æ³•ï¼Œæœ€å¥½èƒ½å†™å‡ºä»£ç ã€‚ConCurrentHashMapçš„å®ç°åŸç†ï¼Ÿ ç­”ï¼š 3. æ•°ç»„å’Œé“¾è¡¨çš„åŒºåˆ«ï¼ŒArrayListçš„æ‰©å®¹æ–¹å¼ï¼Ÿ ç­”ï¼š 4. é˜Ÿåˆ—ä¸æ ˆçš„åŒºåˆ«ï¼Œä»‹ç»å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ ç­”ï¼š 5. æ‰‹å†™ä¸€ä¸ªHashmapçš„éå†ï¼Ÿ ç­”ï¼š 6. HashSetæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ ç­”ï¼š 7. æ‰‹å†™äºŒå‰æ ‘çš„éå†ã€‚ ç­”ï¼š ç®—æ³•1. å¿«æ’ä¸å†’æ³¡çš„åŒºåˆ«ï¼Ÿæ‰‹å†™ä¸€ä¸ªè¯•è¯•ï¼Ÿ ç­”ï¼š 2. æ‰‹å†™ä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾å’Œå½’å¹¶æ’åºï¼Ÿ ç­”ï¼š 3. å•é“¾è¡¨çš„åè½¬ï¼Ÿè¿­ä»£ä¸é€’å½’çš„å®ç°æ–¹å¼ï¼Ÿ ç­”ï¼š JVM1. æŒ‰ç…§ä½ çš„ç†è§£ï¼Œè®²è®²JVMå†…å­˜ç»“æ„ï¼Ÿ ç­”ï¼š 2. è®²è®²åƒåœ¾å›æ”¶ï¼Œå¸¸è§çš„åƒåœ¾å›æ”¶ç®—æ³•æœ‰ä»€ä¹ˆï¼Ÿ ç­”ï¼š 3. ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘FULL GC?ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘Mini GCï¼Ÿ ç­”ï¼š ç½‘ç»œ1. è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ç­”ï¼š 2. è®²ä¸€è®²TCPä¸‰æ¬¡æ¡æ‰‹,å››æ¬¡æŒ¥æ‰‹ï¼Œç”»ä¸€ä¸‹ ç­”ï¼š 3. æ‚²è§‚é”ä¸ä¹è§‚é”çš„åŒºåˆ«ï¼Ÿ ç­”ï¼š 4. servlet APIä¸­forward()ä¸redirect()çš„åŒºåˆ«ï¼Ÿ ç­”ï¼š 5. è®²ä¸€ä¸‹getä¸postçš„åŒºåˆ«ï¼Ÿ ç­”ï¼š 6. å¸¸è§httpçš„åè®®çŠ¶æ€æœ‰å“ªäº›ï¼Ÿ ç­”ï¼š 7. TCPä¸UDPçš„åŒºåˆ«ï¼Ÿ ç­”ï¼š 8. è®²è®²åºåˆ—åŒ–çš„åº•å±‚å®ç°åŸç†ã€‚ ç­”ï¼š æ•°æ®åº“1. è®²ä¸€è®²æ•°æ®åº“çš„ä¼˜åŒ–æœ‰å“ªäº›ï¼Ÿ ç­”ï¼š ä¸»ä»åŒæ­¥ï¼Œè¯»å†™åˆ†ç¦» åˆ†åº“åˆ†è¡¨ æ°´å¹³åˆ†è¡¨ å‚ç›´åˆ†è¡¨ å»ºç«‹ç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ ç¼“å­˜ï¼Œå‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—® 2. æ•°æ®åº“æ€ä¹ˆå»ºç«‹ç´¢å¼•ï¼Œç´¢å¼•æœ‰å“ªå‡ ç§ï¼Ÿ ç­”ï¼šå‚è€ƒæ–‡ç« Mysqlåˆ›å»ºç´¢å¼• åœ¨æ‰§è¡ŒCREATE TABLEè¯­å¥æ—¶å¯ä»¥åˆ›å»ºç´¢å¼•ï¼Œä¹Ÿå¯ä»¥å•ç‹¬ç”¨CREATE INDEXæˆ–ALTER TABLEæ¥ä¸ºè¡¨å¢åŠ ç´¢å¼•ã€‚ ä¸»é”®ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼• ALTER TABLEï¼ˆç”¨æ¥åˆ›å»ºæ™®é€šç´¢å¼•ã€UNIQUEç´¢å¼•æˆ–PRIMARY KEYç´¢å¼•ï¼‰ ALTER TABLE table_name ADD INDEX index_name (column_list) ALTER TABLE table_name ADD UNIQUE (column_list) ALTER TABLE table_name ADD PRIMARY KEY (column_list) CREATE INDEX ï¼ˆå¯¹è¡¨å¢åŠ æ™®é€šç´¢å¼•æˆ–UNIQUEç´¢å¼•ï¼‰ CREATE INDEX index_name ON table_name (column_list) CREATE UNIQUE INDEX index_name ON table_name (column_list) æ³¨ï¼šä¸èƒ½ç”¨CREATE INDEXè¯­å¥åˆ›å»ºPRIMARY KEYç´¢å¼• æ³¨ï¼šPRIMARY KEYç´¢å¼•ä»…æ˜¯ä¸€ä¸ªå…·æœ‰åç§°PRIMARYçš„UNIQUEç´¢å¼• åˆ é™¤ç´¢å¼• DROP INDEX index_name ON talbe_name ALTER TABLE table_name DROP INDEX index_name ALTER TABLE table_name DROP PRIMARY KEY æ³¨ï¼šå¦‚æœæ²¡æœ‰åˆ›å»ºPRIMARY KEYç´¢å¼•ï¼Œä½†è¡¨å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªUNIQUEç´¢å¼•ï¼Œåˆ™MySQLå°†åˆ é™¤ç¬¬ä¸€ä¸ªUNIQUEç´¢å¼•ã€‚ æ³¨ï¼šå¦‚æœä»è¡¨ä¸­åˆ é™¤äº†æŸåˆ—ï¼Œåˆ™ç´¢å¼•ä¼šå—åˆ°å½±å“ã€‚å¯¹äºå¤šåˆ—ç»„åˆçš„ç´¢å¼•ï¼Œå¦‚æœåˆ é™¤å…¶ä¸­çš„æŸåˆ—ï¼Œåˆ™è¯¥åˆ—ä¹Ÿä¼šä»ç´¢å¼•ä¸­åˆ é™¤ã€‚å¦‚æœåˆ é™¤ç»„æˆç´¢å¼•çš„æ‰€æœ‰åˆ—ï¼Œåˆ™æ•´ä¸ªç´¢å¼•å°†è¢«åˆ é™¤ã€‚ æŸ¥çœ‹ç´¢å¼• show index from tblname å­—æ®µè§£æ Non_unique å¦‚æœç´¢å¼•ä¸èƒ½åŒ…æ‹¬é‡å¤è¯ï¼Œåˆ™ä¸º0ã€‚å¦‚æœå¯ä»¥ï¼Œåˆ™ä¸º1ã€‚ Index_type ç”¨è¿‡çš„ç´¢å¼•æ–¹æ³•ï¼ˆBTREE, FULLTEXT, HASH, RTREEï¼‰ Seq_in_index ç´¢å¼•ä¸­çš„åˆ—åºåˆ—å·ï¼Œä»1å¼€å§‹ã€‚ Collation åˆ—ä»¥ä»€ä¹ˆæ–¹å¼å­˜å‚¨åœ¨ç´¢å¼•ä¸­ã€‚åœ¨MySQLä¸­ï¼Œæœ‰å€¼â€˜Aâ€™ï¼ˆå‡åºï¼‰æˆ–NULLï¼ˆæ— åˆ†ç±»ï¼‰ã€‚ Cardinality ç´¢å¼•ä¸­å”¯ä¸€å€¼çš„æ•°ç›®çš„ä¼°è®¡å€¼ã€‚ ä½¿ç”¨ç´¢å¼•æ³¨æ„äº‹é¡¹ æŸ¥è¯¢è¾ƒå¤šï¼Œä¿®æ”¹è¾ƒå°‘é€‚åˆåˆ›å»ºç´¢å¼•ï¼Œç»å¸¸æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹çš„è¡¨ä¸é€‚åˆ å»ºç«‹ç´¢å¼•ä¼šæœ‰ç›¸åº”çš„å­˜å‚¨æ¶ˆè€— å¤åˆç´¢å¼•æ•ˆç‡æ›´é«˜ 3. å¯¹redisäº†è§£å—ï¼ŸRedisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿä½¿ç”¨åœºæ™¯ï¼Ÿ ç­”ï¼š Redisæ”¯æŒäº”ç§æ•°æ®ç±»å‹ï¼šstringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œhashï¼ˆå“ˆå¸Œï¼‰ï¼Œlistï¼ˆåˆ—è¡¨ï¼‰ï¼Œsetï¼ˆé›†åˆï¼‰åŠzset(sorted setï¼šæœ‰åºé›†åˆ) Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šsetä¸get Hash(å“ˆå¸Œ)ï¼šhmsetä¸hgetall listï¼ˆåˆ—è¡¨) : lpushä¸lrange setï¼ˆé›†åˆï¼‰ï¼šsaddä¸smembers zset(sorted setï¼šæœ‰åºé›†åˆ):zaddä¸zrangbyscore 4. æ‰‹å†™åˆ›å»ºè¡¨ï¼Œç»™è¡¨æ·»åŠ å­—æ®µï¼Œä¿®æ”¹å­—æ®µçš„sqlè¯­å¥ ç­”ï¼š ç»™è¡¨æ·»åŠ å­—æ®µ alter table t_cloud_user add salemoney DECIMAL(12,2) DEFAULT â€˜0â€™ COMMENT â€˜é”€å”®é¢â€™; ä¿®æ”¹å­—æ®µ alter table t_cloud_user change m1 button VARCHAR(200) DEFAULT NULL COMMENT â€˜buttonæŒ‰é’®â€™; æ–°å»ºç´¢å¼• alter table t_sssc_salary add index Code_WAGENO(code,WAGENO); create index Code_WAGENO on t_sssc_salary(code,WAGENO); åˆ é™¤ç´¢å¼• DROP INDEX index_name ON talbe_name; ALTER TABLE table_name DROP INDEX index_name; 5. ä¸»ä»åŒæ­¥å»¶æ—¶çš„è§£å†³æ–¹æ¡ˆ ç¼©å°å»¶æ—¶æ—¶é—´ ä¿®æ”¹ä¸»ä»åº“çš„é…ç½®å‚æ•°ï¼Œæé«˜sqlçš„æ‰§è¡Œæ•ˆç‡ æ•°æ®åº“çš„ç‰ˆæœ¬ï¼ˆ5.6.3ä¹‹åé‡‡å–å¤šçº¿ç¨‹åŒæ­¥ï¼‰ æé«˜ä»æœåŠ¡å™¨çš„ç¡¬ä»¶æ€§èƒ½ï¼ˆCPUï¼Œå†…å­˜ï¼ŒSSDç£ç›˜ï¼‰ ç½‘ç»œï¼ˆå±€åŸŸç½‘ç¼©å°åŒæ­¥å»¶æ—¶æ—¶é—´ï¼‰ ä¸é€‰æ‹©èµ°ä»åº“ å¯¹äºä¸ç»å¸¸æ›´æ–°çš„è¡¨ï¼ŒæŸ¥è¯¢çš„æ—¶å€™é…ç½®ç›´æ¥èµ°ä»åº“ã€‚ å¯¹äºå¸¸æ›´æ–°çš„è¡¨ï¼ˆæ¯”å¦‚è–ªèµ„è¡¨ï¼‰ï¼Œæ›´æ–°ä¹‹åæ”¾å…¥ç¼“å­˜ï¼ŒæŸ¥è¯¢çš„æ—¶å€™æŸ¥ç¼“å­˜ â€‹ å¤šçº¿ç¨‹1. å¹¶å‘ä¸å¹¶è¡Œï¼ŒåŒæ­¥ä¸å¼‚æ­¥ï¼Œçº¿ç¨‹ä¸è¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ ç­”ï¼š 2. è°ˆä¸€è°ˆçº¿ç¨‹æ± ï¼Œå¸¸ç”¨çš„çº¿ç¨‹æ± æœ‰å“ªå‡ ç§ï¼Ÿçº¿ç¨‹æ± æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ç­”ï¼š 3. çº¿ç¨‹æ± æ€ä¹ˆä½¿ç”¨ï¼Ÿå¦‚ä½•è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé˜Ÿåˆ—é•¿åº¦ï¼Œä»¥åŠæœ€å¤§çº¿ç¨‹æ•°ã€‚ ç­”ï¼š 4. åˆ›å»ºçº¿ç¨‹æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ ç­”ï¼š 5. çº¿ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€ï¼Œå¦‚ä½•è¿›è¡Œè½¬æ¢çš„ï¼Ÿ ç­”ï¼š 6. synchronizedçš„åº•å±‚æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ ç­”ï¼š 7. æ‰‹å†™ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…ä»£ç  ç­”ï¼š 8. å¦‚ä½•é¿å…æ­»é”ï¼Ÿ ç­”ï¼š æ¡†æ¶ä¸æ¨¡å¼1. è®²ä¸€ä¸‹ç†Ÿæ‚‰çš„è®¾è®¡æ¨¡å¼ï¼Ÿå•ä¾‹æ¨¡å¼æœ‰å“ªå‡ ç§ï¼Ÿæ‰‹å†™ä¸€ä¸ªå•ä¾‹æ¨¡å¼ ç­”ï¼š 2. å•ä¾‹æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„æœ¬è´¨åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ ç­”ï¼š 3. ç®€å•ä»‹ç»ä¸€ä¸‹springMVCçš„æ‰§è¡Œæµç¨‹ï¼Ÿ ç­”ï¼š 4. ç®€å•ä»‹ç»ä¸€ä¸‹Springçš„ä¸¤å¤§æ ¸å¿ƒï¼Ÿ ç­”ï¼š 5. çœ‹è¿‡springçš„æºç å—ï¼Ÿè¯´è¯´åº•å±‚æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ ç­”ï¼š â€“]]></content>
      <categories>
        <category>interview</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£è®¡ç®—æœºï¼šè®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸]]></title>
    <url>%2F2019%2F09%2F01%2Fcsapp%2Fcs-tour%2F</url>
    <content type="text"><![CDATA[ä¸€ä¸ªCè¯­è¨€ç¨‹åºçš„äº§ç”Ÿ ä¹‹å‰åœ¨ èµ°è¿‘è®¡ç®—æœºï¼Œèµ°è¿›äºŒè¿›åˆ¶ï¼Œçˆªå“‡å›½çš„è¯ç”Ÿè®²åˆ°ä¸€ä¸ªjavaç¨‹åºæ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œç„¶è€Œä¾ç„¶æ˜¯çŸ¥å…¶ç„¶ï¼Œè€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ä»Šå¤©ç‰¹æ„æ¥ç”¨Cè¯­è¨€å†™ä¸€ä¸ªç¨‹åºï¼Œçœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåœ¨è®¡ç®—æœºä¸Šè·‘èµ·æ¥çš„ã€‚ æºç  hello.c 12345#include &lt;stdio.h&gt;int main()&#123; printf("%s\n", "Hello,world!");&#125; ç¼–è¯‘ æºä»£ç é€šè¿‡ç¼–è¯‘å™¨ç¼–è¯‘å¾—åˆ°ç›®æ ‡ç¨‹åº è¿™ä¸ªæ—¶å€™ä¼šåœ¨æ¡Œé¢ç”Ÿæˆç›®æ ‡ç¨‹åºhelloã€å¯ç›´æ¥è¿è¡Œã€‘ ç›®æ ‡ç¨‹åºæ–‡ä»¶é‡Œé¢éƒ½æ˜¯ äºŒè¿›åˆ¶ ç¼–è¯‘ç³»ç»Ÿ ç¼–è¯‘æ—¶åˆ†å·¥æ˜¯è¿™æ ·çš„ è®¡ç®—æœºä½“ç³»ç»“æ„ æ€»çº¿ æ€»çº¿æ˜¯è´¯ç©¿æ•´ä¸ªç³»ç»Ÿçš„ä¸€ç»„ç”µå­ç®¡é“ï¼Œå®ƒæºå¸¦ä¿¡æ¯å­—èŠ‚å¹¶è´Ÿè´£åœ¨å„ä¸ªéƒ¨ä»¶é—´ä¼ é€’ã€‚ æŒ‰ç…§éƒ¨ä»¶ä¹‹é—´ä¿¡æ¯ä¼ é€’åˆ’åˆ†ï¼šç³»ç»Ÿæ€»çº¿ï¼Œå­˜å‚¨å™¨æ€»çº¿ï¼ŒI/Oæ€»çº¿ æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†ï¼šæ§åˆ¶æ€»çº¿ã€æ•°æ®æ€»çº¿ã€åœ°å€æ€»çº¿ I/Oè®¾å¤‡ è¾“å…¥/è¾“å‡ºï¼ˆI/O)è®¾å¤‡æ˜¯ç³»ç»Ÿä¸å¤–éƒ¨ä¸–ç•Œçš„è”ç³»é€šé“ ä¸€å…±æœ‰äº”ç§ï¼šé¼ æ ‡ã€é”®ç›˜ã€æ˜¾ç¤ºå™¨ã€ç£ç›˜ã€æ‰©å±•æ§½ï¼ˆå¸¸è§çš„ç½‘å¡ï¼‰ ä¸»å­˜ ä¸»å­˜æ˜¯ä¸€ä¸ªä¸´æ—¶å­˜å‚¨è®¾å¤‡ï¼Œåœ¨å¤„ç†å™¨æ‰§è¡Œç¨‹åºæ˜¯ï¼Œç”¨æ¥å­˜æ”¾ç¨‹åºå’Œç¨‹åºå¤„ç†çš„æ•°æ®ã€‚ é™¤å»é«˜é€Ÿç¼“å­˜ä½¿ç”¨SRAMå¤–ï¼Œä¸»å­˜ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯DRAMç¡¬ä»¶æŠ€æœ¯ CPUå¤„ç†å™¨ ä¸­å¤®å¤„ç†å•å…ƒï¼ˆCPUï¼‰,ç®€ç§°å¤„ç†å™¨ï¼Œæ˜¯è§£é‡Šï¼ˆæˆ–æ‰§è¡Œï¼‰å­˜å‚¨åœ¨ä¸»å­˜ä¸­æŒ‡ä»¤çš„å¼•æ“ã€‚ ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæ§åˆ¶å™¨ï¼Œè¿ç®—å™¨å’Œå¯„å­˜å™¨ ä½“ç³»ç»“æ„å›¾ ç›®æ ‡ç¨‹åºçš„æ‰§è¡Œ ç°åœ¨æˆ‘ä»¬ç›®æ ‡ç¨‹åºæœ‰äº†ï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰§è¡Œå‘¢ï¼Œä»ç”¨æˆ·è¾“å…¥å­—ç¬¦åˆ°æ‰“å°ç»“æœåˆ°å±å¹•ä¸Šï¼Œè®¡ç®—æœºåˆ°åº•ç»å†äº†ä»€ä¹ˆï¼Ÿ æ‰§è¡Œæ—¶å¯¹è¯æ˜¯è¿™æ ·çš„ å­˜å‚¨è®¾å¤‡å±‚æ¬¡ç»“æ„ ä»ä¸Šé¢çš„è¿‡ç¨‹å¯ä»¥çœ‹åˆ°ï¼Œhelloç¨‹åºåˆå§‹æ—¶åœ¨ç£ç›˜ä¸Šï¼Œå½“ç¨‹åºåŠ è½½æ—¶ï¼Œå®ƒåˆè¢«å¤åˆ¶åˆ°ä¸»å­˜ä¸­ï¼Œå½“å¤„ç†å™¨è¿è¡Œç¨‹åºæ—¶ï¼ŒæŒ‡ä»¤åˆä»ä¸»å­˜å¤åˆ¶åˆ°å¤„ç†å™¨ï¼Œå½“ç¨‹åºæ‰§è¡Œå®Œæ—¶ï¼Œâ€œhelloï¼Œworldâ€åˆå¾—å¤åˆ¶å›æ˜¾å¡ï¼Œè¿™ä¸€ç³»åˆ—è¿‡ç¨‹ä¸­éƒ½æ¶‰åŠæ•°æ®çš„å¤åˆ¶ï¼Œå¦‚æœå¤åˆ¶çš„é€Ÿåº¦è·Ÿä¸ä¸Šï¼Œé‚£ä¹ˆè®¡ç®—æœºå°±å¯èƒ½ä¼šç˜«ç—ªã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œå¯„å­˜å™¨ä¸CPUä¿¡æ¯ä¼ é€’é€Ÿåº¦æ˜¯ä¸»å­˜çš„æ•°ç™¾å€çº§åˆ«ï¼Œæ˜¯ç£ç›˜çš„ç™¾ä¸‡å€çº§åˆ«ï¼Œå¯æ˜¯ï¼Œå¯„å­˜å™¨èƒ½å­˜çš„æ•°æ®å¤ªå°ï¼Œå¹¶ä¸”åŒæ ·å¤§å°å­˜å‚¨é€ ä»·æ¯”ç£ç›˜è´µå¾—ä¸çŸ¥é“å¤šå°‘ä¸ªæ•°é‡çº§ã€‚ä¸ºäº†æå‡è®¡ç®—æœºæ€§èƒ½åŒæ—¶ï¼Œåˆä¸æƒ³æœ‰å¤ªå¤šçš„é€ ä»·è´Ÿæ‹…ï¼Œé«˜é€Ÿç¼“å­˜åº”è¿è€Œç”Ÿã€‚ é«˜é€Ÿç¼“å­˜çš„åŸç† ç©ºé—´å±€éƒ¨æ€§ å°±æ˜¯è¯´å†…å­˜ä¸Šå¦‚æœæŸä¸€åœ°å€ç©ºé—´çš„æ•°æ®é¢‘ç¹çš„è¢«CPUè®¿é—®ï¼Œé‚£ä¹ˆå…¶æ—è¾¹çš„å­˜å‚¨å•å…ƒä¹Ÿæœ‰å¯èƒ½è¢«è®¿é—®ã€‚ æ—¶é—´å±€éƒ¨æ€§ åœ¨æŸä¸€æ®µæ—¶é—´å†…ï¼Œå†…å­˜ä¸Šå¦‚æœæŸä¸€åœ°å€ç©ºé—´çš„æ•°æ®é¢‘ç¹çš„è¢«CPUè®¿é—®ï¼Œé‚£ä¹ˆåœ¨æœªæ¥å¾ˆå¯èƒ½ä¼šå†æ¬¡è®¿é—®ã€‚ å­˜å‚¨è®¾å¤‡å±‚æ¬¡ç»“æ„ æ“ä½œç³»ç»Ÿçš„æŠ½è±¡ åŸºæœ¬åŠŸèƒ½ é˜²æ­¢ç¡¬ä»¶è¢«å¤±æ§çš„åº”ç”¨ç¨‹åºæ»¥ç”¨ å‘åº”ç”¨ç¨‹åºæä¾›ç®€å•ä¸€è‡´çš„æœºåˆ¶æ¥æ§åˆ¶å¤æ‚è€Œåˆé€šå¸¸å¤§ç›¸å¾„åº­çš„ä½çº§ç¡¬ä»¶è®¾å¤‡ æŠ½è±¡ æ–‡ä»¶æ˜¯å¯¹I/Oè®¾å¤‡çš„æŠ½è±¡ï¼Œè™šæ‹Ÿå­˜å‚¨å™¨æ˜¯å¯¹ä¸»å­˜å’Œç£ç›˜I/Oè®¾å¤‡çš„æŠ½è±¡ï¼Œè¿›ç¨‹åˆ™æ˜¯å¯¹å¤„ç†å™¨ã€ä¸»å­˜å’ŒI/Oè®¾å¤‡çš„æŠ½è±¡ï¼Œè™šæ‹Ÿæœºï¼Œæä¾›å¯¹æ•´ä¸ªè®¡ç®—æœºï¼ˆåŒ…æ‹¬æ“ä½œç³»ç»Ÿã€å¤„ç†å™¨å’Œç¨‹åºï¼‰çš„æŠ½è±¡ã€‚ ç»“æ„å›¾ï¼š è¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºä¸€ç§æŠ½è±¡. åœ¨ä¸€ä¸ªç³»ç»Ÿä¸Šå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œè€Œæ¯ä¸ªè¿›ç¨‹éƒ½å¥½åƒåœ¨ç‹¬å åœ°ä½¿ç”¨ç¡¬ä»¶. è€Œå¹¶å‘è¿è¡Œï¼Œåˆ™æ˜¯è¯´ä¸€ä¸ªè¿›ç¨‹çš„æŒ‡ä»¤å’Œå¦ä¸€ä¸ªè¿›ç¨‹çš„æŒ‡ä»¤æ˜¯äº¤é”™æ‰§è¡Œçš„ï¼Œæ“ä½œç³»ç»Ÿå®ç°è¿™ç§äº¤é”™æ‰§è¡Œçš„æœºåˆ¶ç§°ä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ å®ç°è¿›ç¨‹è¿™ä¸ªæŠ½è±¡æ¦‚å¿µéœ€è¦ä½çº§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿè½¯ä»¶ä¹‹é—´çš„ç´§å¯†åˆä½œã€‚ çº¿ç¨‹ ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œä½†è‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹ã€‚ ä¹¦ä¸Šæ˜¯è¿™æ ·è¯´çš„ï¼Œåœ¨ç°ä»£ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹å®é™…ä¸Šæ˜¯å¯ä»¥ç”±å¤šä¸ªå—ç§°ä¸ºçº¿ç¨‹çš„æ‰§è¡Œå•å…ƒï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è¿è¡Œåœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶å…±äº«åŒæ ·çš„ä»£ç å’Œå…¨å±€æ•°æ®ã€‚ å¹¶ä¸”å¤šçº¿ç¨‹ä¹‹é—´æ¯”å¤šè¿›ç¨‹ä¹‹é—´æ›´å®¹æ˜“å…±äº«æ•°æ®ï¼Œçº¿ç¨‹ä¸€èˆ¬æ¥è¯´æ¯”è¿›ç¨‹æ›´é«˜æ•ˆã€‚ å¹¶å‘ä¸å¹¶è¡Œ å¹¶å‘ ä½¿è®¡ç®—æœºåšå¾—æ›´å¤š å•æ ¸å¤„ç†å™¨åœ¨æŸæ—¶é—´æ®µï¼ˆå®è§‚ä¸Šï¼‰å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚ æ³¨ï¼Œæ˜¯æŒ‡å®è§‚ä¸Šï¼ˆå³æŸä¸€æ—¶é—´æ®µï¼‰ï¼Œå…¶å®ä»å¾®è§‚çœ‹æ¥ï¼ˆåœ¨ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼‰ï¼Œå•å¤„ç†å™¨ç³»ç»Ÿéƒ½åªèƒ½æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹çš„ä»£ç ã€‚ å¹¶è¡Œ ä½¿è®¡ç®—æœºå¤„ç†çš„æ›´å¿« åŒä¸€ä¸ªè¿›ç¨‹é‡Œé¢çš„ä»»åŠ¡å¯ä»¥åœ¨å¤šä¸ªå¤„ç†å™¨ä¸Šè¿è¡Œã€‚ å¹¶å‘ä¸å¹¶è¡Œå¯¹æ¯”å›¾ å‚è€ƒèµ„æ–™: å­¦ä¹ ç¬”è®°æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿï¼ˆåŸä¹¦ç¬¬äºŒç‰ˆï¼‰]]></content>
      <categories>
        <category>csapp</category>
      </categories>
      <tags>
        <tag>csapp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SHELLå‘½ä»¤æ±‡æ€»]]></title>
    <url>%2F2019%2F04%2F10%2Fshell-commands%2F</url>
    <content type="text"><![CDATA[SHELLå‘½ä»¤æ±‡æ€»åœ¨Macä½¿ç”¨å°æŠ€å·§ä¸­æåˆ°äº†ç»ˆç«¯å‘½ä»¤æ“ä½œï¼Œä½†æ˜¯æ¦‚æ‹¬å¾—ä¸å…¨ï¼ŒåŠ ä¸Šä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡linuxå‘½ä»¤ï¼Œé¢è¯•æ—¶é—®åˆ°æ—¶å¾ˆæ˜¯æ…Œå¾—ä¸€æ‰¹ï¼Œä¸è¿‡ç°åœ¨æœ‰äº†Macæœ¬ï¼Œç»ˆäºæœ‰ç†ç”±é€¼è‡ªå·±ä¸€æŠŠäº†ï¼Œå“ˆå“ˆï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ å§ï¼ æŸ¥çœ‹éšè—æ–‡ä»¶å¤¹defaults write com.apple.finder AppleShowAllFiles TRUE killall Finderä¸æƒ³æ˜¾ç¤ºè¢«éšè—çš„æ–‡ä»¶defaults write com.apple.finder AppleShowAllFiles FALSE killall Finderä½¿æ–‡ä»¶ä¸éšè—chflags nohidden /Users/alongso_pro/Desktopï¼ˆåªå¯¹éšè—æ–‡ä»¶/æ–‡ä»¶å¤¹æœ‰ç”¨ï¼‰ä½¿æ–‡ä»¶éšè—chflags hidden /Users/alongso_pro/Desktopï¼ˆåªå¯¹å¯è§æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æœ‰ç”¨ï¼‰sudoå‘½ä»¤ä¸ºç³»ç»Ÿè¶…çº§ç®¡ç†å‘˜755 ä»£è¡¨ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶æ‹¥æœ‰è¯»ï¼Œå†™ï¼Œæ‰§è¡Œçš„æƒé™ã€‚åˆ›å»ºæ–‡ä»¶touch .aaæ‰“å¼€æ–‡ä»¶open .aaé…ç½®ç¯å¢ƒå˜é‡source .aaå¼€å¯tomcatè¿›å…¥tomcatçš„binç›®å½•ï¼Œé”®å…¥sudo sh startup.shå…³é—­tomcatæœåŠ¡sh ./shutdown.shæŸ¥çœ‹ç«¯å£è¢«å“ªä¸ªç¨‹åºå ç”¨sudo lsof -i tcp:8080æ ¹æ®è¿›ç¨‹çš„PIDï¼Œå¯ä»¥å°†è¿›ç¨‹æ€æ­»sudo kill -9 1659å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿä¸­æ¯ä¸ªè¿›ç¨‹:ps -A ps -eå‘½ä»¤æä¾›äº†è¿è¡Œä¸­ç³»ç»ŸåŠ¨æ€çš„è§†å›¾topæŸ¥çœ‹å½“å‰ç›®å½•çš„è·¯å¾„pwd /Users/alongso_pro/Desktopä½¿ç”¨ç»å¯¹è·¯å¾„è¿›å…¥æ–‡ä»¶å¤¹ï¼Œä¸æ”¹å˜å½“å‰ç›®å½•:cd / ä½¿ç”¨ç›¸å¯¹è·¯å¾„è¿›å…¥æ–‡ä»¶å¤¹ï¼Œæ”¹å˜å½“å‰ç›®å½•cd Users/alongso_pro/Desktop qianmoyushengMacBook-Pro:Desktop alongso_pro$ æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹,ä¸æ”¹å˜å½“å‰ç›®å½•(list directory contents)ï¼š ls -l/-R/-a ç»å¯¹è·¯å¾„/ç›¸å¯¹è·¯å¾„ -l,æŸ¥çœ‹ç›®å½•ä¸­æ¯ä¸ªæ–‡ä»¶çš„æƒé™ -R,æ˜¾ç¤ºç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ -a,æ˜¾ç¤ºç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å¤¹å’Œéšè—æ–‡ä»¶ man+æ‰€æœ‰å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥å‘½ä»¤çš„ä¿¡æ¯ä»‹ç»(format and display the on-line manual pages)ï¼š man lsã€ man open ã€man chflags ä¹Ÿå¯ä»¥æ•²ä¸‹è¯¥å‘½ä»¤ç›´æ¥å›è½¦ã€‚ man ls: å‘½ä»¤ååœ¨æœ€åå‡ºç°ä¸€ä¸ªend,è¿”å›ç»§ç»­è¾“å…¥å‘½ä»¤:qæˆ–è€…ctr+cå°†æ‰€æœ‰æˆªå›¾ä¿å­˜ä¸ºJPGï¼Œè€Œä¸æ˜¯ç³»ç»Ÿé»˜è®¤çš„PNGdefaults write com.apple.screencapture type -string â€œjpg&quot;æ–‡ä»¶çš„æ‹·è´ln -s ~/Desktop/å…šå‘˜å…šè´¹è¯¦æƒ….xlsx ~/workfile/ ln [-Ffhinsv] source_file [target_file] ln [-Ffhinsv] source_file ... target_direcho,ç›¸å½“äºprintln--write arguments to the standard outputsay è¯­éŸ³say -f /Users/alongso_pro/Desktop/ã€Šä¸‰å›½æ¼”ä¹‰ã€‹ç½—è´¯ä¸­.txtcat æ‰“å°æ–‡æœ¬å†…å®¹-- concatenate and print files cat /Users/alongso_pro/Desktop/ã€Šä¸‰å›½æ¼”ä¹‰ã€‹ç½—è´¯ä¸­.txthead-- display first lines of a filetail-- display the last part of a filenl-- line numbering filterä¸€ä¸ªæœ‰è¶£çš„ASCIIç‰ˆåŠ¨æ¼«:â€œæ˜Ÿçƒå¤§æˆ˜ï¼šæ–°å¸Œæœ›â€telnet towel.blinkenlights.nl chromeçš„å°æé¾™æ¸¸æˆï¼šåœ¨æ²¡è¿ç½‘çš„æƒ…å†µä¸‹åœ¨Chromeåœ°å€æ è¾“å…¥ï¼š`chrome://dino/`]]></content>
      <categories>
        <category>shell</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Macä½¿ç”¨å°æŠ€å·§]]></title>
    <url>%2F2019%2F03%2F10%2Fmac-skills%2F</url>
    <content type="text"><![CDATA[Macä½¿ç”¨å°æŠ€å·§ æœ€è¿‘æ–°å…¥æ‰‹äº†ä¸€å°Macç¬”è®°æœ¬ï¼Œå‘ç°Mac OSä½¿ç”¨èµ·æ¥ç‰¹åˆ«äººæ€§åŒ–ï¼ŒMacç³»ç»Ÿæ˜¯åŸºäºUnixå†…æ ¸çš„å›¾å½¢åŒ–æ“ä½œç³»ç»Ÿ.å¯¹äºä¸€ä½å¼€å‘è€…è€Œè¨€ï¼Œæˆ‘æœ€æ¬£èµçš„æ˜¯èƒ½åœ¨ç»ˆç«¯ä¸Šéšå¿ƒæ‰€æ¬²ï¼Œå¯¹ç”µè„‘è¿›è¡Œä»»ä½•æ“ä½œï¼Œå½“ä½ å®ç°äº†æŸä¸ªåŠŸèƒ½æ—¶å€™ï¼Œå¿ƒä¸­ä¸æ²¹è€Œç„¶ç”Ÿå‡ºä¸€ç§è«åçš„æˆå°±æ„Ÿï¼Œé•¿æ­¤ä»¥å¾€ï¼Œä¹Ÿèƒ½æ¿€å‘æˆ‘å¯¹ç¨‹åºå¼€å‘çš„çƒ­æƒ…ã€‚æˆ‘ä¸€ç›´ç›¸ä¿¡ï¼ŒMacç¬”è®°æœ¬ä¸åªæ˜¯å¼€å‘å·¥å…·ï¼Œå½“å®ƒæ‘†åœ¨ä½ é¢å‰ï¼Œå®ƒæ›´åƒä¸€ä»¶è‰ºæœ¯å“ã€‚ä¸ºäº†å¿«é€Ÿä¸Šæ‰‹Macï¼Œè¿™é‡Œæ€»ç»“äº†ä¸€äº›å°æŠ€å·§ã€‚ å¿«æ·é”®ç¯‡æ‹·è´æ–‡ä»¶çš„è·¯å¾„option+command+Cæ ¹æ®è·¯å¾„æ‰“å¼€æ–‡ä»¶command+shift+Gå¿«é€Ÿè¿›å…¥ç¡¬ç›˜æœ€é«˜ç›®å½•command+shift+Cå¿«é€Ÿå…³é—­appæˆ–è€…tabé¡µçª—å£command+w/command+Qæœ€å°åŒ–çª—å£Commmand+m(ç›¸å½“äºç‚¹å‡»çª—å£çš„æœ€å°åŒ–&apos;-&apos;)çª—å£æœ€å¤§åŒ–Command + control + Få¿«é€Ÿéšè—command+Hæ–°å»ºåº”ç”¨ç¨‹åºçª—å£command+Nåˆ·æ–°ç½‘é¡µCommand+Ræ’¤é”€/é‡åšcommand+Z/command+Shift+Zè¿”å›æ–‡ä»¶ä¸Šä¸€çº§Command + æ–¹å‘å…¨é¢æˆªå±å¿«æ·é”®command+shift+3éƒ¨åˆ†æˆªå±å¿«æ·é”®command+shift+4ï¼ˆè¿™ä¸ªæŒºéº»çƒ¦ï¼Œæˆ‘è¿˜æ˜¯å–œæ¬¢ç”¨wechatæˆªå›¾å·¥å…·ï¼‰å½•å±ï¼ˆå¿«é€Ÿæ‰“å¼€å±å¹•å¿«ç…§ï¼‰Shift + Command + 5å¿«é€ŸæŸ¥çœ‹/æ“ä½œæ‚¨ä¸ä»…å¯ä»¥é¢„è§ˆæ–‡ä»¶ï¼Œç°åœ¨è¿˜å¯ä»¥è¿›è¡Œå„ç§ç¼–è¾‘æ“ä½œï¼Œå¦‚è£å‰ªç…§ç‰‡ã€ç­¾å PDF è¡¨å•å’Œä¿®å‰ªè§†é¢‘ç‰‡æ®µï¼Œä»¥æ ‡è®°å›¾åƒã€‚è½»æ¾æœç´¢Command + ç©ºæ ¼é”® å¦‚æœæƒ³æŸ¥çœ‹æ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œå¯æŒ‰ä½commandï¼ˆä½†æ˜¯æˆ‘æƒ³æ‰“å¼€æ–‡ä»¶çš„æ‰€åœ¨ç›®å½•æ€ä¹ˆåŠå‘¢ï¼Ÿï¼‰æ‹·è´æ–‡ä»¶command+C&amp;&amp;command+Vç§»åŠ¨æ–‡ä»¶å…ˆæ‹·è´æ–‡ä»¶ï¼Œ ç„¶åè¿›å…¥ä½ è¦æ‹·è´åˆ°çš„æ–‡ä»¶å¤¹ï¼Œç©ºç™½å¤„å³é”®ï¼ŒæŒ‰ä½alté”®ï¼Œç‚¹å‡»å°†é¡¹ç›®ç§»åŠ¨åˆ°è¿™é‡Œæ–°å»ºæµè§ˆå™¨çª—å£command+shift+nä½¿ç”¨æµè§ˆå™¨å®šä½åœ°å€æ command+Lç¼©æ”¾å­—ä½“commandåŠ ä¸Š+/-é”®æ‰“å¼€åå¥½è®¾ç½®command+,ç¼©æ”¾å¿«æ·é”®ï¼ˆç›¸å½“äºç¼©æ”¾é•œï¼‰option+command+(-/+)æ¸…ç©ºåºŸçº¸ç¯“shift+command+deleteç›´æ¥æ¸…å€’åºŸçº¸ç¯“shift+option+command+deleteæ‰“å¼€æŸä¸ªæ–‡ä»¶command+O(=åŒå‡»)é‡å‘½åå›è½¦é”®ï¼ˆ=é—´éš”çš„ä¸¤æ¬¡ç‚¹å‡»ï¼‰æŸ¥çœ‹æŸä¸ªæ–‡ä»¶å¤¹ä¸­éšè—çš„æ–‡ä»¶shift+command+.æ¢å¤ä¹‹å‰æ˜¯å¦è¢«éšè—çš„çŠ¶æ€shift+command+.æ–°çš„tabé¡µä¸­æ‰“å¼€é“¾æ¥æŒ‰ä½commandï¼Œç‚¹å‡»é“¾æ¥tabé¡µä¹‹é—´çš„åˆ‡æ¢shift+command+å·¦å³æ–¹å‘é”®æ“ä½œç¯‡æ¡Œé¢åˆ†å±åœ¨åŒä¸€ä¸ªæ¡Œé¢çš„ä¸¤ä¸ªçª—å£ï¼ŒæŒ‰ä½çª—å£æœ€å¤§åŒ–æŒ‰é’®æ‹–åŠ¨åˆ°å·¦ä¸Šè§’ï¼Œç„¶åç‚¹å‡»å¦å¤–ä¸€ä¸ªçª—å£ã€‚å¦‚æœä¸å†åŒä¸€ä¸ªæ¡Œé¢ï¼Œå…ˆå°†ä¸€ä¸ªçª—å£æœ€å¤§åŒ–ï¼Œç„¶åå°†å¦å¤–ä¸€ä¸ªæ¡Œé¢çš„çª—å£æ‹–è¿›æ¥æ‰‹æœºé¥æ„Ÿkeynoteæ’­æ”¾pptæ—¶å¯ä»¥ç”¨æ‰‹æœºæ¥è¿›è¡Œé¥æ§æ–°å»ºæ£€ç´¢ç´¢å¼•ç‚¹å‡»æ–‡ä»¶/æ–‡ä»¶å¤¹â€”ç®€ä»‹ï¼Œä¿®æ”¹æ³¨é‡Šalisï¼Œç„¶åé€šè¿‡comand+spaceè¾“å…¥æ³¨é‡Šçš„æ–‡æœ¬è‹±æ–‡æç¤ºå¿«æ·é”®F5æˆ–è€…å¸¦barä¸­æ˜¾ç¤ºçš„æç¤ºï¼ˆæ™ºèƒ½é€‰å–-pages,keynoteï¼Œwechatä¹Ÿé€‚ç”¨ï¼‰å¯¹ç£ç›˜æƒé™è¿›è¡Œæ£€æŸ¥å’Œä¿®å¤sudo periodic daily weekly monthlyè‡ªå¸¦è¾“å…¥æ³•ä½¿ç”¨æŠ€å·§æ‹¼éŸ³åˆ†è¯ï¼Œæ‰“å¼€é”®ç›˜å¯ä»¥è®¾ç½®å¿«æ·é”®ï¼Œï¼ˆomw-on my way!ï¼‰shift+6å¯ä»¥è¾“å…¥è¡¨æƒ…ç¬¦å·ç§»åŠ¨åº•ä¸‹çš„çª—å£æ—¶ä¸ºäº†ä¸Šé¢çš„çª—å£è¢«é®æŒ¡æŒ‰ä½commandè¿›è¡Œæ‹–åŠ¨æ–‡ä»¶æ£€æŸ¥å™¨é€‰ä¸­æ–‡ä»¶ï¼Œå³é”®æŒ‰ä½altï¼Œç‚¹å‡»show inspectorï¼ŒæŸ¥çœ‹å‡ ä¸ªæ–‡ä»¶ï¼Œæ“ä½œï¼Œå›¾ç‰‡è¿˜èƒ½å¹»ç¯ç‰‡æ˜¾ç¤ºå±å¹•å…±äº«æ“æ§è®¾ç½® &gt; å…±äº«ä¸­å¼€å¯ã€Œå±å¹•å…±äº«ã€ï¼Œä¹‹åè¿›å…¥è®¿è¾¾ &gt; ç‚¹æŒ‰ã€Œç½‘ç»œã€&gt; è¿æ¥è¦å…±äº«çš„ Macï¼Œç„¶åç‚¹æŒ‰ã€Œå…±äº«å±å¹•ã€å‚è€ƒé“¾æ¥ ç»ˆç«¯å‘½ä»¤ç¯‡æŸ¥çœ‹æ–‡ä»¶/æ–‡ä»¶å¤¹å ç”¨çš„å­˜å‚¨ç©ºé—´du -sh */dir/fileæŸ¥çœ‹æ´»åŠ¨ç›‘è§†å™¨top htopç»ˆç«¯é¢œè‰²è£…é¥°çš„å‘½ä»¤(éœ€è‡ªå·±å®‰è£…) å®‰è£…å‚è€ƒé“¾æ¥ æŸ¥çœ‹æ‰€æœ‰æ‰§è¡Œè¿‡çš„å‘½ä»¤history æ‰“å¼€æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºå’Œç½‘å€open / || open http://baidu.comæŸ¥çœ‹å‰ªåˆ‡æ¿å†…å®¹pbpaste ä¹Ÿå¯ä»¥é€šè¿‡å¯è§†åŒ–çª—å£æŸ¥çœ‹ï¼šfinderâ€”&gt;editâ€”&gt;show cliboardè½¯ä»¶æ¨èç¯‡æˆªå±è½¯ä»¶XnipXnipâ€”â€”æˆªå±äº†ä»¥åå¯ä»¥é€‰æ‹©ä¿å­˜åˆ°å“ªä¸ªç›®å½•ä¸‹è§†é¢‘æ’­æ”¾å™¨IINAQuickTimæ˜¯Macè‡ªå¸¦çš„è§†å±æ’­æ”¾å™¨ï¼Œå¯ä»¥æ‰“å¼€mp4ã€movç­‰æ ¼å¼çš„è§†é¢‘ï¼Œå´æ— æ³•æ‰“å¼€rmbã€rmã€flvç­‰æ ¼å¼çš„è§†é¢‘ï¼Œæˆ‘ç”¨IINAäº†ä¸€æ®µæ—¶é—´ï¼Œæ„Ÿè§‰ä½“éªŒä¸é”™ã€‚å°è±¡ç¬”è®°åœ¨ç¬”è®°è¿™å—ï¼Œæˆ‘ç”¨çš„æ˜¯å°è±¡ç¬”è®°ï¼ŒåŠŸèƒ½ç›¸å½“å¼ºå¤§ï¼Œæ”¯æŒmarkdownå’ŒmindMapæ ¼å¼,ç”¨ä¹ æƒ¯äº†ç›¸å½“ä¸é”™ã€‚]]></content>
      <categories>
        <category>mac</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ è·¯çº¿è§„åˆ’]]></title>
    <url>%2F1994%2F10%2F02%2Fmyresume%2Flearn_route_planning%2F</url>
    <content type="text"><![CDATA[å²—ä½æè¿° è´Ÿè´£å†…å®¹ è´Ÿè´£é”™é¢˜æœ¬çš„å¼€å‘å’Œç»´æŠ¤å·¥ä½œ åˆ†åº“åˆ†è¡¨æŠ€æœ¯é€‰å‹ï¼Œåˆ¶å®šæ•°æ®è¿ç§»æ–¹æ¡ˆ æ¨é¢˜ç®—æ³•èåˆï¼Œå°†åŸæœ‰çš„ä¸¤å¥—é¢˜åº“ç³»ç»Ÿèå…¥æˆä¸€å¥— é¡¹ç›®æ¶æ„ Spring Cloudæ¶æ„ï¼ŒDAOå±‚Mybatisï¼Œæ•°æ®åº“mysql ç¼“å­˜ä¸­é—´ä»¶Redisã€ESã€æ¶ˆæ¯ä¸­é—´ä»¶Kafkaã€æ³¨å†Œä¸­å¿ƒK8Sã€é…ç½®ä¸­å¿ƒSpring Configã€ç½‘å…³ Spring Gateway ç‰ˆæœ¬ç®¡ç† Gitlab æœåŠ¡ä¾èµ– jaråŒ…ä»“åº“gradle å®‰å…¨ é‰´æƒ æ•°æ®ä¼ è¾“åŠ å¯† éƒ¨ç½² Dockerã€K8sï¼Œä½¿ç”¨gitlab-runner+rancherçš„æ–¹å¼å®ç°ci/cd ç›‘æ§ actuatorç›‘æ§æœåŠ¡ ELKæ—¥å¿—æ”¶é›† æ‰‹å¤´çš„äº‹æ•°æ®åº“æŠ€æœ¯é€‰å‹ ä¸¤å¼ å¤§è¡¨ï¼ˆæ•°é‡çº§éƒ½åœ¨ä¸ƒåƒä¸‡çº§åˆ«ï¼‰éœ€è¦åšå…³è”æŸ¥è¯¢ï¼Œåç»­ä¼šå¿«é€Ÿå¢é•¿åˆ°äº¿çº§åˆ«ï¼Œç›®å‰è¿˜æ²¡æœ‰åˆ†è¡¨ï¼Œéœ€è¦åˆ†è¡¨ã€‚è€ƒè™‘çš„åˆ†å¸ƒå¼æ•°æ®åº“æœ‰TiDBï¼Œåˆ†è¡¨ä¸­é—´ä»¶shading sphereï¼ŒåšæŠ€æœ¯é€‰å‹ï¼Œå¹¶å®è·µã€‚ æ¨é¢˜ç®—æ³•èåˆ å¯¹åŸæœ‰ä¸¤å¥—æ¨é¢˜æœåŠ¡è¿›è¡Œèåˆï¼Œå°†çŸ¥è¯†å›¾è°±çš„æ¨é¢˜æ€æƒ³æŠ½å–å‡ºæ¥ï¼Œèå…¥åˆ°jpkçš„æ¨é¢˜ä¸­ï¼Œæ ¹æ®ç”¨æˆ·è¡Œä¸ºï¼Œç­”é¢˜å¯¹é”™ï¼Œå¾—å‡ºç”¨æˆ·çš„çŸ¥è¯†ç‚¹è–„å¼±ï¼Œæ¨é€çŸ¥è¯†ç‚¹éš¾åº¦ç›¸å½“çš„é¢˜ç›®ã€‚ å­¦ä¹ è§„åˆ’mysqlè°ƒä¼˜ã€sharding sphereã€redisã€spring bootæºç ï¼ˆ7ï¼‰ã€springCloudï¼ˆ13ï¼‰ã€ç½‘çº¦è½¦ï¼ˆ32ï¼‰ã€ç®—æ³•ï¼ˆåŸºç¡€+è¿›é˜¶ï¼‰ã€kafkaã€ES]]></content>
      <categories>
        <category>learn_route_planning</category>
      </categories>
      <tags>
        <tag>resume</tag>
        <tag>job</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸ªäººç®€å†]]></title>
    <url>%2F1994%2F10%2F02%2Fmyresume%2Fnew_resume_forth%2F</url>
    <content type="text"><![CDATA[ä¸ªäººä¿¡æ¯ é™ˆå»ºè“‰/ç”·/1994 å­¦å†ï¼šè¥¿å—å¤§å­¦(211)/æœ¬ç§‘/è®¡ç®—æœºä¸“ä¸š æ¯•ä¸šæ—¶é—´ï¼š2018å¹´ å·¥ä½œå¹´é™ï¼š3å¹´ å¾®ä¿¡å…¬ä¼—å·ï¼šé˜¡é™Œä½™ç”Ÿ æŠ€æœ¯åšå®¢ï¼šhttps://alongsocjr.github.io åº”è˜ä¿¡æ¯ æœŸæœ›èŒä½ï¼šJavaé«˜çº§å·¥ç¨‹å¸ˆ ä¸Šå²—æ—¶é—´ï¼šå¯éšæ—¶åˆ°å²— æ‰‹æœºå·ï¼š17718480976ï¼ˆåŒå¾®ä¿¡ï¼‰ é‚®ç®±ï¼šalongsocjr@163.com æŠ€èƒ½æ¸…å• äº†è§£classæ–‡ä»¶ç»“æ„ ï¼Œç†è§£classæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œç†Ÿæ‚‰å¸¸ç”¨çš„å­—èŠ‚ç æŒ‡ä»¤é›†ã€‚ æŒæ¡Mysqläº‹åŠ¡éš”ç¦»çº§åˆ«ä¸é”çš„æœºåˆ¶ï¼Œå¤šå¹´å®æˆ˜ç»éªŒï¼Œå¯¹ç´¢å¼•åŠå­˜å‚¨å¼•æ“æœ‰æ·±å…¥ç ”ç©¶ï¼Œæœ‰çº¿ä¸Šè°ƒä¼˜ç»éªŒã€‚ ç†Ÿç»ƒæŒæ¡JavaåŸºç¡€ï¼Œç†Ÿæ‚‰JUC ã€é›†åˆæ¡†æ¶ã€è®¾è®¡æ¨¡å¼ï¼›ç†Ÿç»ƒå¸¸ç”¨ ç®—æ³•ï¼Œæœ‰è¾ƒå¼ºçš„ä»£ç ä¼˜åŒ–èƒ½åŠ›ã€‚ ç†Ÿæ‚‰JMMã€JVMå’ŒGCåº•å±‚ç®—æ³•ï¼Œç†Ÿæ‚‰å¤šç§å¸¸è§çš„åƒåœ¾å›æ”¶å™¨ï¼Œç†Ÿæ‚‰JVMè°ƒä¼˜ï¼Œæœ‰å®æˆ˜ç»éªŒã€‚ ç†Ÿæ‚‰ä½¿ç”¨Redisç¼“å­˜æŠ€æœ¯åŠåº”ç”¨åœºæ™¯ï¼Œç†Ÿæ‚‰æŒä¹…åŒ–æœºåˆ¶ä»¥åŠç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€ç­‰è§£å†³æ–¹æ¡ˆã€‚ æŒæ¡RabbitMqã€Zookeeperä¸­é—´ä»¶çš„ä½¿ç”¨ï¼Œæ‰‹å†™è¿‡åˆ†å¸ƒå¼é”çš„å®ç°ã€‚ ç†Ÿç»ƒSpringBootã€Springã€Mybatisï¼Œå¤šå¹´å®æˆ˜ç»éªŒï¼Œå¯ä»¥é€šè¿‡éœ€æ±‚å¿«é€Ÿæ„å»ºé¡¹ç›®ï¼Œçœ‹è¿‡æ ¸å¿ƒæºç ã€‚ å·¥ä½œç»å†çŒ¿è¾…å¯¼ï¼ˆåœ¨çº¿æ•™è‚²ç‹¬è§’å…½ï¼‰ï¼ˆ2020å¹´10æœˆ~è‡³ä»Šï¼‰å²—ä½ï¼šæœåŠ¡å™¨ç ”å‘å·¥ç¨‹å¸ˆ æè¿°ï¼šå°±èŒäºåŸºç¡€ç ”å‘å¹³å°éƒ¨ï¼Œä¸»è¦è´Ÿè´£è´¢åŠ¡çº¿ä¸ŠERPç›¸å…³ç³»ç»Ÿçš„å¼€å‘å’Œç»´æŠ¤å·¥ä½œï¼Œå‚ä¸è´¢åŠ¡æŠ¥é”€ç³»ç»Ÿçš„å…¨ä½“é‡æ„ï¼Œä»0åˆ°1çš„æŠ€æœ¯è½åœ°ã€‚åŒæ—¶å‚ä¸è®¡è´¹ç³»ç»Ÿã€ERPå‰ç½®ç³»ç»Ÿå¯¹å¤–æ¥å£çš„å¼€å‘ã€‚ é˜³å…‰ä¿é™© ï¼ˆ2018å¹´7æœˆ~2020å¹´10æœˆï¼‰å²—ä½ï¼šJAVAå¼€å‘å·¥ç¨‹å¸ˆ æè¿°ï¼šä»¥åº”å±Šç”Ÿçš„èº«ä»½åŠ å…¥é˜³å…‰ä¿é™©ï¼Œåœ¨æ ¡æ‹›ç”ŸåŸ¹è®­ä¸­è·å¾—ä¼˜ç§€å­¦å‘˜ç§°å·ï¼Œé¡¹ç›®å°ç»„ä½œå“è£è·ä¸€ç­‰å¥–ã€‚åœ¨å¯¿é™©è¥é”€æ¸ é“é¡¹ç›®ç»„ï¼Œä¸»è¦è´Ÿè´£æ–°è€ç³»ç»Ÿæ¶æ„è¿ç§»å·¥ä½œï¼Œå‚ä¸è–ªèµ„è®¡ç®—ã€è€ƒå‹¤è¿½è¸ªç­‰æ ¸å¿ƒé¡¹ç›®å¼€å‘ï¼Œåœ¨2019å¹´åº¦åˆ›æ–°é¡¹ç›®è¯„æ¯”ä¸­ï¼Œç”±æˆ‘ä¸»å¯¼çš„æ¶ˆæ¯æ¨é€å¹³å°è£è·ä¸‰ç­‰å¥–ã€‚ é¡¹ç›®ç»éªŒè´¢åŠ¡æŠ¥é”€ç³»ç»Ÿ ï¼ˆ2020å¹´10æœˆ~è‡³ä»Šï¼‰é¡¹ç›®æè¿°ï¼šé€šè¿‡OAç³»ç»Ÿç”³è¯·çš„æŠ¥é”€å•ï¼Œå®¡æ‰¹é€šè¿‡åè¿›å…¥æŠ¥é”€ç³»ç»Ÿï¼Œå¯¹å•æ®è¿›è¡Œä»˜æ¬¾ã€ç”Ÿæˆæ—¥è®°è´¦ã€å½’æ¡£ç­‰å¤„ç†ï¼Œä»£æ›¿äº†åŸæœ‰çº¿ä¸‹æ‰‹å·¥äººå·¥æ“ä½œä»˜æ¬¾ä»¥åŠå¯¹è´¦çš„æ–¹å¼ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚ æŠ€æœ¯æ ˆï¼šSpringBoot+Dubbo+Zookeeper+SpringJDBC+Mysql+Xxl Job+Swagger æ‹…ä»»èŒè´£ï¼š æ•°æ®åº“å»ºæ¨¡ä¸mysqlä¼˜åŒ– åˆ¶å®šå®šæ—¶ä»»åŠ¡è§£å†³æ–¹æ¡ˆ è´Ÿè´£åŸºç¡€æ•°æ®æ¨¡å—çš„å¼€å‘ è´Ÿè´£æœåŠ¡å™¨èµ„æºç”³è¯·å’Œå‰æœŸé¡¹ç›®æ­å»º è–ªèµ„è®¡ç®—å¼•æ“ ï¼ˆ2018å¹´7æœˆ~2020å¹´10æœˆï¼‰é¡¹ç›®æè¿°ï¼šä»¥æ¶ˆæ¯ä¸ºé©±åŠ¨ è§¦å‘è–ªèµ„å®æ—¶è®¡ç®—ï¼Œå®ç°äº†ä¸šåŠ¡å‘˜è–ªèµ„çš„å®æ—¶é¢„è­¦ï¼Œä»£ç†äººå‡ºå•åŠå°æ—¶å†…èƒ½çœ‹åˆ°æ‰€å‡ºæœ€æ–°ä¿å•å¸¦æ¥çš„è–ªèµ„å˜åŒ–ã€‚è§£å†³äº†åŸæœ‰è–ªèµ„è®¡ç®—å­˜åœ¨çš„è®¡ç®—æ»åã€åå¤æŸ¥è¯¢ã€é‡å¤è®¡ç®—ç­‰é—®é¢˜ã€‚ æŠ€æœ¯æ ˆï¼šSpringBoot+Dubbo+Zookeeper+RabbitMq+Redis+OneProxy+Mysql æ ¸å¿ƒç‚¹ï¼š ä½¿ç”¨redisä½œäºŒçº§é˜Ÿåˆ—æµé‡å‰Šå³°ï¼Œæé«˜äº†ç³»ç»Ÿååé‡ï¼ŒåŒæ—¶å¯¹MQä¸€çº§é˜Ÿåˆ—ä¸­å…¨å›½çš„è®¡ç®—æ¶ˆæ¯æœ‰åºåˆ†ç»„ã€‚ ä½¿ç”¨åˆ†å¸ƒå¼ZKé”ä¿è¯å¤šå°æœåŠ¡ä¹‹é—´ï¼ŒåŒä¸€æœºæ„çš„è®¡ç®—æ˜¯ä¸²è¡Œçš„ï¼Œä¸åŒæœºæ„çš„è®¡ç®—æ˜¯å¹¶è¡Œçš„ã€‚ ä½¿ç”¨çº¿ç¨‹æ± ç®¡ç†ç³»ç»ŸæœåŠ¡èµ„æºï¼Œå‡å°‘çº¿ç¨‹çš„æ¥å›åˆ›å»ºï¼Œä¸€ä¸ªçº¿ç¨‹è´Ÿè´£è®¡ç®—ä¸€å®¶æœºæ„å†…æ‰€æœ‰çš„æ¶ˆæ¯ã€‚ æ‹…ä»»èŒè´£ï¼š å‚ä¸äº†é¡¹ç›®çš„æ•´ä½“è§„åˆ’ä¸è®¾è®¡ ä¼˜åŒ–äº†åˆ†å¸ƒå¼é”çš„é€‰æ‹© è®¾è®¡äº†é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±çš„æ–¹æ¡ˆ å¯¹æ¥ä¼ä¸šå¾®ä¿¡ï¼Œå¯¹ç³»ç»Ÿå¼‚å¸¸å®æ—¶ç›‘æ§ è€ƒå‹¤å¤§å±è¿½è¸ª ï¼ˆ2019å¹´5æœˆ~2019å¹´10æœˆï¼‰é¡¹ç›®æè¿°ï¼šè¿½è¸ªå…¨å›½ä»£ç†äººå‡ºå‹¤æƒ…å†µï¼Œå°†è€ƒå‹¤æ•°æ®ä»çº¿ä¸‹æ¬è‡³çº¿ä¸Šï¼Œå¯é€šè¿‡è°ƒç”¨æ¥å£ç›‘æ§è¥ä¸šåŒºä»£ç†äººèŒåœºç”»é¢ã€‚ æŠ€æœ¯æ ˆï¼šSpringBoot+Dubbo+Zookeeper+Redis+Mysql+SqlServer æ ¸å¿ƒç‚¹ï¼š é…ç½®åŒæ•°æ®æºï¼Œä»SqlServeræ•°æ®åº“å–å½“å¤©æ‰“å¡ä¿¡æ¯åŸºç¡€æ•°æ®ï¼Œä»Mysqlæ•°æ®åº“å–å†å²å‡ºå‹¤æ•°æ®ã€‚ å¯ä»¥é€‰æ‹©å…¨å›½ã€äºŒçº§ã€ä¸‰çº§å’Œè¥ä¸šåŒºä¸åŒç»´åº¦ç»Ÿè®¡ï¼Œä¹Ÿå¯æŒ‰ç…§èŒçº§å’Œå­æ¸ é“è¿›è¡Œç»Ÿè®¡ã€‚ æ‹…ä»»èŒè´£ï¼š æ­å»ºæ–°çš„æœåŠ¡ï¼Œæ¨¡å—æ¢³ç†ä»¥åŠç¼“å­˜è®¾è®¡ è´Ÿè´£å¤–å›´ç³»ç»Ÿç½‘ç»œæƒé™çš„å¼€æ”¾ä¸æ¥å£çš„è”è°ƒ è§£å†³ä¸Šçº¿åˆæœŸçš„æ€§èƒ½é—®é¢˜ä¸bug æ‹…ä»»å¼€å‘ç»„é•¿ï¼Œè´Ÿè´£æ ¸å¿ƒä¸šåŠ¡å¼€å‘]]></content>
      <categories>
        <category>resume</category>
      </categories>
      <tags>
        <tag>resume</tag>
        <tag>job</tag>
      </tags>
  </entry>
</search>
